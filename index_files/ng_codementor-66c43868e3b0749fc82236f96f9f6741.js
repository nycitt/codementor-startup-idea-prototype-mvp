!function(window,angular){"use strict";function $RouteProvider(){function inherit(parent,extra){return angular.extend(Object.create(parent),extra)}function pathRegExp(path,opts){var insensitive=opts.caseInsensitiveMatch,ret={originalPath:path,regexp:path},keys=ret.keys=[];return path=path.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(_,slash,key,option){var optional="?"===option?option:null,star="*"===option?option:null;return keys.push({name:key,optional:!!optional}),slash=slash||"",""+(optional?"":slash)+"(?:"+(optional?slash:"")+(star&&"(.+?)"||"([^/]+)")+(optional||"")+")"+(optional||"")}).replace(/([\/$\*])/g,"\\$1"),ret.regexp=new RegExp("^"+path+"$",insensitive?"i":""),ret}var routes={};this.when=function(path,route){var routeCopy=angular.copy(route);if(angular.isUndefined(routeCopy.reloadOnSearch)&&(routeCopy.reloadOnSearch=!0),angular.isUndefined(routeCopy.caseInsensitiveMatch)&&(routeCopy.caseInsensitiveMatch=this.caseInsensitiveMatch),routes[path]=angular.extend(routeCopy,path&&pathRegExp(path,routeCopy)),path){var redirectPath="/"==path[path.length-1]?path.substr(0,path.length-1):path+"/";routes[redirectPath]=angular.extend({redirectTo:path},pathRegExp(redirectPath,routeCopy))}return this},this.caseInsensitiveMatch=!1,this.otherwise=function(params){return"string"==typeof params&&(params={redirectTo:params}),this.when(null,params),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce",function($rootScope,$location,$routeParams,$q,$injector,$templateRequest,$sce){function switchRouteMatcher(on,route){var keys=route.keys,params={};if(!route.regexp)return null;var m=route.regexp.exec(on);if(!m)return null;for(var i=1,len=m.length;len>i;++i){var key=keys[i-1],val=m[i];key&&val&&(params[key.name]=val)}return params}function prepareRoute($locationEvent){var lastRoute=$route.current;preparedRoute=parseRoute(),preparedRouteIsUpdateOnly=preparedRoute&&lastRoute&&preparedRoute.$$route===lastRoute.$$route&&angular.equals(preparedRoute.pathParams,lastRoute.pathParams)&&!preparedRoute.reloadOnSearch&&!forceReload,preparedRouteIsUpdateOnly||!lastRoute&&!preparedRoute||$rootScope.$broadcast("$routeChangeStart",preparedRoute,lastRoute).defaultPrevented&&$locationEvent&&$locationEvent.preventDefault()}function commitRoute(){var lastRoute=$route.current,nextRoute=preparedRoute;preparedRouteIsUpdateOnly?(lastRoute.params=nextRoute.params,angular.copy(lastRoute.params,$routeParams),$rootScope.$broadcast("$routeUpdate",lastRoute)):(nextRoute||lastRoute)&&(forceReload=!1,$route.current=nextRoute,nextRoute&&nextRoute.redirectTo&&(angular.isString(nextRoute.redirectTo)?$location.path(interpolate(nextRoute.redirectTo,nextRoute.params)).search(nextRoute.params).replace():$location.url(nextRoute.redirectTo(nextRoute.pathParams,$location.path(),$location.search())).replace()),$q.when(nextRoute).then(function(){if(nextRoute){var template,templateUrl,locals=angular.extend({},nextRoute.resolve);return angular.forEach(locals,function(value,key){locals[key]=angular.isString(value)?$injector.get(value):$injector.invoke(value,null,null,key)}),angular.isDefined(template=nextRoute.template)?angular.isFunction(template)&&(template=template(nextRoute.params)):angular.isDefined(templateUrl=nextRoute.templateUrl)&&(angular.isFunction(templateUrl)&&(templateUrl=templateUrl(nextRoute.params)),angular.isDefined(templateUrl)&&(nextRoute.loadedTemplateUrl=$sce.valueOf(templateUrl),template=$templateRequest(templateUrl))),angular.isDefined(template)&&(locals.$template=template),$q.all(locals)}}).then(function(locals){nextRoute==$route.current&&(nextRoute&&(nextRoute.locals=locals,angular.copy(nextRoute.params,$routeParams)),$rootScope.$broadcast("$routeChangeSuccess",nextRoute,lastRoute))},function(error){nextRoute==$route.current&&$rootScope.$broadcast("$routeChangeError",nextRoute,lastRoute,error)}))}function parseRoute(){var params,match;return angular.forEach(routes,function(route){!match&&(params=switchRouteMatcher($location.path(),route))&&(match=inherit(route,{params:angular.extend({},$location.search(),params),pathParams:params}),match.$$route=route)}),match||routes[null]&&inherit(routes[null],{params:{},pathParams:{}})}function interpolate(string,params){var result=[];return angular.forEach((string||"").split(":"),function(segment,i){if(0===i)result.push(segment);else{var segmentMatch=segment.match(/(\w+)(?:[?*])?(.*)/),key=segmentMatch[1];result.push(params[key]),result.push(segmentMatch[2]||""),delete params[key]}}),result.join("")}var preparedRoute,preparedRouteIsUpdateOnly,forceReload=!1,$route={routes:routes,reload:function(){forceReload=!0,$rootScope.$evalAsync(function(){prepareRoute(),commitRoute()})},updateParams:function(newParams){if(!this.current||!this.current.$$route)throw $routeMinErr("norout","Tried updating route when with no current route");newParams=angular.extend({},this.current.params,newParams),$location.path(interpolate(this.current.$$route.originalPath,newParams)),$location.search(newParams)}};return $rootScope.$on("$locationChangeStart",prepareRoute),$rootScope.$on("$locationChangeSuccess",commitRoute),$route}]}function $RouteParamsProvider(){this.$get=function(){return{}}}function ngViewFactory($route,$anchorScroll,$animate){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(scope,$element,attr,ctrl,$transclude){function cleanupLastView(){previousLeaveAnimation&&($animate.cancel(previousLeaveAnimation),previousLeaveAnimation=null),currentScope&&(currentScope.$destroy(),currentScope=null),currentElement&&(previousLeaveAnimation=$animate.leave(currentElement),previousLeaveAnimation.then(function(){previousLeaveAnimation=null}),currentElement=null)}function update(){var locals=$route.current&&$route.current.locals,template=locals&&locals.$template;if(angular.isDefined(template)){var newScope=scope.$new(),current=$route.current,clone=$transclude(newScope,function(clone){$animate.enter(clone,null,currentElement||$element).then(function(){!angular.isDefined(autoScrollExp)||autoScrollExp&&!scope.$eval(autoScrollExp)||$anchorScroll()}),cleanupLastView()});currentElement=clone,currentScope=current.scope=newScope,currentScope.$emit("$viewContentLoaded"),currentScope.$eval(onloadExp)}else cleanupLastView()}var currentScope,currentElement,previousLeaveAnimation,autoScrollExp=attr.autoscroll,onloadExp=attr.onload||"";scope.$on("$routeChangeSuccess",update),update()}}}function ngViewFillContentFactory($compile,$controller,$route){return{restrict:"ECA",priority:-400,link:function(scope,$element){var current=$route.current,locals=current.locals;$element.html(locals.$template);var link=$compile($element.contents());if(current.controller){locals.$scope=scope;var controller=$controller(current.controller,locals);current.controllerAs&&(scope[current.controllerAs]=controller),$element.data("$ngControllerController",controller),$element.children().data("$ngControllerController",controller)}link(scope)}}}var ngRouteModule=angular.module("ngRoute",["ng"]).provider("$route",$RouteProvider),$routeMinErr=angular.$$minErr("ngRoute");ngRouteModule.provider("$routeParams",$RouteParamsProvider),ngRouteModule.directive("ngView",ngViewFactory),ngRouteModule.directive("ngView",ngViewFillContentFactory),ngViewFactory.$inject=["$route","$anchorScroll","$animate"],ngViewFillContentFactory.$inject=["$compile","$controller","$route"]}(window,window.angular),function(window,angular){"use strict";function $SanitizeProvider(){this.$get=["$$sanitizeUri",function($$sanitizeUri){return function(html){var buf=[];return htmlParser(html,htmlSanitizeWriter(buf,function(uri,isImage){return!/^unsafe/.test($$sanitizeUri(uri,isImage))})),buf.join("")}}]}function sanitizeText(chars){var buf=[],writer=htmlSanitizeWriter(buf,angular.noop);return writer.chars(chars),buf.join("")}function makeMap(str){var i,obj={},items=str.split(",");for(i=0;i<items.length;i++)obj[items[i]]=!0;return obj}function htmlParser(html,handler){function parseStartTag(tag,tagName,rest,unary){if(tagName=angular.lowercase(tagName),blockElements[tagName])for(;stack.last()&&inlineElements[stack.last()];)parseEndTag("",stack.last());optionalEndTagElements[tagName]&&stack.last()==tagName&&parseEndTag("",tagName),unary=voidElements[tagName]||!!unary,unary||stack.push(tagName);var attrs={};rest.replace(ATTR_REGEXP,function(match,name,doubleQuotedValue,singleQuotedValue,unquotedValue){var value=doubleQuotedValue||singleQuotedValue||unquotedValue||"";attrs[name]=decodeEntities(value)}),handler.start&&handler.start(tagName,attrs,unary)}function parseEndTag(tag,tagName){var i,pos=0;if(tagName=angular.lowercase(tagName))for(pos=stack.length-1;pos>=0&&stack[pos]!=tagName;pos--);if(pos>=0){for(i=stack.length-1;i>=pos;i--)handler.end&&handler.end(stack[i]);stack.length=pos}}"string"!=typeof html&&(html=null===html||"undefined"==typeof html?"":""+html);var index,chars,match,text,stack=[],last=html;for(stack.last=function(){return stack[stack.length-1]};html;){if(text="",chars=!0,stack.last()&&specialElements[stack.last()]?(html=html.replace(new RegExp("([\\W\\w]*)<\\s*\\/\\s*"+stack.last()+"[^>]*>","i"),function(all,text){return text=text.replace(COMMENT_REGEXP,"$1").replace(CDATA_REGEXP,"$1"),handler.chars&&handler.chars(decodeEntities(text)),""}),parseEndTag("",stack.last())):(0===html.indexOf("<!--")?(index=html.indexOf("--",4),index>=0&&html.lastIndexOf("-->",index)===index&&(handler.comment&&handler.comment(html.substring(4,index)),html=html.substring(index+3),chars=!1)):DOCTYPE_REGEXP.test(html)?(match=html.match(DOCTYPE_REGEXP),match&&(html=html.replace(match[0],""),chars=!1)):BEGING_END_TAGE_REGEXP.test(html)?(match=html.match(END_TAG_REGEXP),match&&(html=html.substring(match[0].length),match[0].replace(END_TAG_REGEXP,parseEndTag),chars=!1)):BEGIN_TAG_REGEXP.test(html)&&(match=html.match(START_TAG_REGEXP),match?(match[4]&&(html=html.substring(match[0].length),match[0].replace(START_TAG_REGEXP,parseStartTag)),chars=!1):(text+="<",html=html.substring(1))),chars&&(index=html.indexOf("<"),text+=0>index?html:html.substring(0,index),html=0>index?"":html.substring(index),handler.chars&&handler.chars(decodeEntities(text)))),html==last)throw $sanitizeMinErr("badparse","The sanitizer was unable to parse the following block of html: {0}",html);last=html}parseEndTag()}function decodeEntities(value){return value?(hiddenPre.innerHTML=value.replace(/</g,"&lt;"),hiddenPre.textContent):""}function encodeEntities(value){return value.replace(/&/g,"&amp;").replace(SURROGATE_PAIR_REGEXP,function(value){var hi=value.charCodeAt(0),low=value.charCodeAt(1);return"&#"+(1024*(hi-55296)+(low-56320)+65536)+";"}).replace(NON_ALPHANUMERIC_REGEXP,function(value){return"&#"+value.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function htmlSanitizeWriter(buf,uriValidator){var ignore=!1,out=angular.bind(buf,buf.push);return{start:function(tag,attrs,unary){tag=angular.lowercase(tag),!ignore&&specialElements[tag]&&(ignore=tag),ignore||validElements[tag]!==!0||(out("<"),out(tag),angular.forEach(attrs,function(value,key){var lkey=angular.lowercase(key),isImage="img"===tag&&"src"===lkey||"background"===lkey;validAttrs[lkey]!==!0||uriAttrs[lkey]===!0&&!uriValidator(value,isImage)||(out(" "),out(key),out('="'),out(encodeEntities(value)),out('"'))}),out(unary?"/>":">"))},end:function(tag){tag=angular.lowercase(tag),ignore||validElements[tag]!==!0||(out("</"),out(tag),out(">")),tag==ignore&&(ignore=!1)},chars:function(chars){ignore||out(encodeEntities(chars))}}}var $sanitizeMinErr=angular.$$minErr("$sanitize"),START_TAG_REGEXP=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,END_TAG_REGEXP=/^<\/\s*([\w:-]+)[^>]*>/,ATTR_REGEXP=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,BEGIN_TAG_REGEXP=/^</,BEGING_END_TAGE_REGEXP=/^<\//,COMMENT_REGEXP=/<!--(.*?)-->/g,DOCTYPE_REGEXP=/<!DOCTYPE([^>]*?)>/i,CDATA_REGEXP=/<!\[CDATA\[(.*?)]]>/g,SURROGATE_PAIR_REGEXP=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,NON_ALPHANUMERIC_REGEXP=/([^\#-~| |!])/g,voidElements=makeMap("area,br,col,hr,img,wbr"),optionalEndTagBlockElements=makeMap("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),optionalEndTagInlineElements=makeMap("rp,rt"),optionalEndTagElements=angular.extend({},optionalEndTagInlineElements,optionalEndTagBlockElements),blockElements=angular.extend({},optionalEndTagBlockElements,makeMap("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),inlineElements=angular.extend({},optionalEndTagInlineElements,makeMap("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),svgElements=makeMap("animate,animateColor,animateMotion,animateTransform,circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,set,stop,svg,switch,text,title,tspan,use"),specialElements=makeMap("script,style"),validElements=angular.extend({},voidElements,blockElements,inlineElements,optionalEndTagElements,svgElements),uriAttrs=makeMap("background,cite,href,longdesc,src,usemap,xlink:href"),htmlAttrs=makeMap("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width"),svgAttrs=makeMap("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,attributeName,attributeType,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan"),validAttrs=angular.extend({},uriAttrs,svgAttrs,htmlAttrs),hiddenPre=document.createElement("pre");angular.module("ngSanitize",[]).provider("$sanitize",$SanitizeProvider),angular.module("ngSanitize").filter("linky",["$sanitize",function($sanitize){var LINKY_URL_REGEXP=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/i,MAILTO_REGEXP=/^mailto:/i;return function(text,target){function addText(text){text&&html.push(sanitizeText(text))}function addLink(url,text){html.push("<a "),angular.isDefined(target)&&html.push('target="',target,'" '),html.push('href="',url.replace(/"/g,"&quot;"),'">'),addText(text),html.push("</a>")}if(!text)return text;for(var match,url,i,raw=text,html=[];match=raw.match(LINKY_URL_REGEXP);)url=match[0],match[2]||match[4]||(url=(match[3]?"http://":"mailto:")+url),i=match.index,addText(raw.substr(0,i)),addLink(url,match[0].replace(MAILTO_REGEXP,"")),raw=raw.substring(i+match[0].length);return addText(raw),$sanitize(html.join(""))}}])}(window,window.angular),angular.module("ui.alias",[]).config(["$compileProvider","uiAliasConfig",function($compileProvider,uiAliasConfig){uiAliasConfig=uiAliasConfig||{},angular.forEach(uiAliasConfig,function(config,alias){angular.isString(config)&&(config={replace:!0,template:config}),$compileProvider.directive(alias,function(){return config})})}]),angular.module("ui.event",[]).directive("uiEvent",["$parse",function($parse){return function($scope,elm,attrs){var events=$scope.$eval(attrs.uiEvent);angular.forEach(events,function(uiEvent,eventName){var fn=$parse(uiEvent);elm.bind(eventName,function(evt){var params=Array.prototype.slice.call(arguments);params=params.splice(1),fn($scope,{$event:evt,$params:params}),$scope.$$phase||$scope.$apply()})})}}]),angular.module("ui.format",[]).filter("format",function(){return function(value,replace){var target=value;if(angular.isString(target)&&void 0!==replace)if(angular.isArray(replace)||angular.isObject(replace)||(replace=[replace]),angular.isArray(replace)){var rlen=replace.length,rfx=function(str,i){return i=parseInt(i,10),i>=0&&rlen>i?replace[i]:str};target=target.replace(/\$([0-9]+)/g,rfx)}else angular.forEach(replace,function(value,key){target=target.split(":"+key).join(value)});return target}}),angular.module("ui.highlight",[]).filter("highlight",function(){return function(text,search,caseSensitive){return search||angular.isNumber(search)?(text=text.toString(),search=search.toString(),caseSensitive?text.split(search).join('<span class="ui-match">'+search+"</span>"):text.replace(new RegExp(search,"gi"),'<span class="ui-match">$&</span>')):text}}),angular.module("ui.include",[]).directive("uiInclude",["$http","$templateCache","$anchorScroll","$compile",function($http,$templateCache,$anchorScroll,$compile){return{restrict:"ECA",terminal:!0,compile:function(element,attr){var srcExp=attr.uiInclude||attr.src,fragExp=attr.fragment||"",onloadExp=attr.onload||"",autoScrollExp=attr.autoscroll;return function(scope,element){function ngIncludeWatchAction(){var thisChangeId=++changeCounter,src=scope.$eval(srcExp),fragment=scope.$eval(fragExp);src?$http.get(src,{cache:$templateCache}).success(function(response){if(thisChangeId===changeCounter){childScope&&childScope.$destroy(),childScope=scope.$new();var contents;contents=fragment?angular.element("<div/>").html(response).find(fragment):angular.element("<div/>").html(response).contents(),element.html(contents),$compile(contents)(childScope),!angular.isDefined(autoScrollExp)||autoScrollExp&&!scope.$eval(autoScrollExp)||$anchorScroll(),childScope.$emit("$includeContentLoaded"),scope.$eval(onloadExp)}}).error(function(){thisChangeId===changeCounter&&clearContent()}):clearContent()}var childScope,changeCounter=0,clearContent=function(){childScope&&(childScope.$destroy(),childScope=null),element.html("")};scope.$watch(fragExp,ngIncludeWatchAction),scope.$watch(srcExp,ngIncludeWatchAction)}}}}]),angular.module("ui.indeterminate",[]).directive("uiIndeterminate",[function(){return{compile:function(tElm,tAttrs){return tAttrs.type&&"checkbox"===tAttrs.type.toLowerCase()?function($scope,elm,attrs){$scope.$watch(attrs.uiIndeterminate,function(newVal){elm[0].indeterminate=!!newVal})}:angular.noop}}}]),angular.module("ui.inflector",[]).filter("inflector",function(){function ucwords(text){return text.replace(/^([a-z])|\s+([a-z])/g,function($1){return $1.toUpperCase()})}function breakup(text,separator){return text.replace(/[A-Z]/g,function(match){return separator+match})}var inflectors={humanize:function(value){return ucwords(breakup(value," ").split("_").join(" "))},underscore:function(value){return value.substr(0,1).toLowerCase()+breakup(value.substr(1),"_").toLowerCase().split(" ").join("_")},variable:function(value){return value=value.substr(0,1).toLowerCase()+ucwords(value.split("_").join(" ")).substr(1).split(" ").join("")}};return function(text,inflector){return inflector!==!1&&angular.isString(text)?(inflector=inflector||"humanize",inflectors[inflector](text)):text}}),angular.module("ui.jq",[]).value("uiJqConfig",{}).directive("uiJq",["uiJqConfig","$timeout",function(uiJqConfig,$timeout){return{restrict:"A",compile:function(tElm,tAttrs){if(!angular.isFunction(tElm[tAttrs.uiJq]))throw new Error('ui-jq: The "'+tAttrs.uiJq+'" function does not exist');var options=uiJqConfig&&uiJqConfig[tAttrs.uiJq];return function(scope,elm,attrs){function callPlugin(){$timeout(function(){elm[attrs.uiJq].apply(elm,linkOptions)},0,!1)}var linkOptions=[];attrs.uiOptions?(linkOptions=scope.$eval("["+attrs.uiOptions+"]"),angular.isObject(options)&&angular.isObject(linkOptions[0])&&(linkOptions[0]=angular.extend({},options,linkOptions[0]))):options&&(linkOptions=[options]),attrs.ngModel&&elm.is("select,input,textarea")&&elm.bind("change",function(){elm.trigger("input")}),attrs.uiRefresh&&scope.$watch(attrs.uiRefresh,function(){callPlugin()}),callPlugin()}}}}]),angular.module("ui.keypress",[]).factory("keypressHelper",["$parse",function($parse){var keysByCode={8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete"},capitaliseFirstLetter=function(string){return string.charAt(0).toUpperCase()+string.slice(1)};return function(mode,scope,elm,attrs){var params,combinations=[];params=scope.$eval(attrs["ui"+capitaliseFirstLetter(mode)]),angular.forEach(params,function(v,k){var combination,expression;expression=$parse(v),angular.forEach(k.split(" "),function(variation){combination={expression:expression,keys:{}},angular.forEach(variation.split("-"),function(value){combination.keys[value]=!0}),combinations.push(combination)})}),elm.bind(mode,function(event){var metaPressed=!(!event.metaKey||event.ctrlKey),altPressed=!!event.altKey,ctrlPressed=!!event.ctrlKey,shiftPressed=!!event.shiftKey,keyCode=event.keyCode;"keypress"===mode&&!shiftPressed&&keyCode>=97&&122>=keyCode&&(keyCode-=32),angular.forEach(combinations,function(combination){var mainKeyPressed=combination.keys[keysByCode[keyCode]]||combination.keys[keyCode.toString()],metaRequired=!!combination.keys.meta,altRequired=!!combination.keys.alt,ctrlRequired=!!combination.keys.ctrl,shiftRequired=!!combination.keys.shift;mainKeyPressed&&metaRequired===metaPressed&&altRequired===altPressed&&ctrlRequired===ctrlPressed&&shiftRequired===shiftPressed&&scope.$apply(function(){combination.expression(scope,{$event:event})})})})}}]),angular.module("ui.keypress").directive("uiKeydown",["keypressHelper",function(keypressHelper){return{link:function(scope,elm,attrs){keypressHelper("keydown",scope,elm,attrs)}}}]),angular.module("ui.keypress").directive("uiKeypress",["keypressHelper",function(keypressHelper){return{link:function(scope,elm,attrs){keypressHelper("keypress",scope,elm,attrs)}}}]),angular.module("ui.keypress").directive("uiKeyup",["keypressHelper",function(keypressHelper){return{link:function(scope,elm,attrs){keypressHelper("keyup",scope,elm,attrs)}}}]),angular.module("ui.mask",[]).value("uiMaskConfig",{maskDefinitions:{9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/}}).directive("uiMask",["uiMaskConfig",function(maskConfig){return{priority:100,require:"ngModel",restrict:"A",compile:function(){var options=maskConfig;return function(scope,iElement,iAttrs,controller){function initialize(maskAttr){return angular.isDefined(maskAttr)?(processRawMask(maskAttr),maskProcessed?(initializeElement(),bindEventListeners(),!0):uninitialize()):uninitialize()}function initPlaceholder(placeholderAttr){angular.isDefined(placeholderAttr)&&(maskPlaceholder=placeholderAttr,maskProcessed&&eventHandler())}function formatter(fromModelValue){return maskProcessed?(value=unmaskValue(fromModelValue||""),isValid=validateValue(value),controller.$setValidity("mask",isValid),isValid&&value.length?maskValue(value):void 0):fromModelValue}function parser(fromViewValue){return maskProcessed?(value=unmaskValue(fromViewValue||""),isValid=validateValue(value),controller.$viewValue=value.length?maskValue(value):"",controller.$setValidity("mask",isValid),""===value&&void 0!==controller.$error.required&&controller.$setValidity("required",!1),isValid?value:void 0):fromViewValue}function uninitialize(){return maskProcessed=!1,unbindEventListeners(),angular.isDefined(originalPlaceholder)?iElement.attr("placeholder",originalPlaceholder):iElement.removeAttr("placeholder"),angular.isDefined(originalMaxlength)?iElement.attr("maxlength",originalMaxlength):iElement.removeAttr("maxlength"),iElement.val(controller.$modelValue),controller.$viewValue=controller.$modelValue,!1}function initializeElement(){value=oldValueUnmasked=unmaskValue(controller.$modelValue||""),valueMasked=oldValue=maskValue(value),isValid=validateValue(value);var viewValue=isValid&&value.length?valueMasked:"";iAttrs.maxlength&&iElement.attr("maxlength",2*maskCaretMap[maskCaretMap.length-1]),iElement.attr("placeholder",maskPlaceholder),iElement.val(viewValue),controller.$viewValue=viewValue}function bindEventListeners(){eventsBound||(iElement.bind("blur",blurHandler),iElement.bind("mousedown mouseup",mouseDownUpHandler),iElement.bind("input keyup click focus",eventHandler),eventsBound=!0)}function unbindEventListeners(){eventsBound&&(iElement.unbind("blur",blurHandler),iElement.unbind("mousedown",mouseDownUpHandler),iElement.unbind("mouseup",mouseDownUpHandler),iElement.unbind("input",eventHandler),iElement.unbind("keyup",eventHandler),iElement.unbind("click",eventHandler),iElement.unbind("focus",eventHandler),eventsBound=!1)}function validateValue(value){return value.length?value.length>=minRequiredLength:!0}function unmaskValue(value){var valueUnmasked="",maskPatternsCopy=maskPatterns.slice();return value=value.toString(),angular.forEach(maskComponents,function(component){value=value.replace(component,"")}),angular.forEach(value.split(""),function(chr){maskPatternsCopy.length&&maskPatternsCopy[0].test(chr)&&(valueUnmasked+=chr,maskPatternsCopy.shift())}),valueUnmasked}function maskValue(unmaskedValue){var valueMasked="",maskCaretMapCopy=maskCaretMap.slice();return angular.forEach(maskPlaceholder.split(""),function(chr,i){unmaskedValue.length&&i===maskCaretMapCopy[0]?(valueMasked+=unmaskedValue.charAt(0)||"_",unmaskedValue=unmaskedValue.substr(1),maskCaretMapCopy.shift()):valueMasked+=chr}),valueMasked}function getPlaceholderChar(i){var placeholder=iAttrs.placeholder;return"undefined"!=typeof placeholder&&placeholder[i]?placeholder[i]:"_"}function getMaskComponents(){return maskPlaceholder.replace(/[_]+/g,"_").replace(/([^_]+)([a-zA-Z0-9])([^_])/g,"$1$2_$3").split("_")}function processRawMask(mask){var characterCount=0;if(maskCaretMap=[],maskPatterns=[],maskPlaceholder="","string"==typeof mask){minRequiredLength=0;var isOptional=!1,splitMask=mask.split("");angular.forEach(splitMask,function(chr,i){linkOptions.maskDefinitions[chr]?(maskCaretMap.push(characterCount),maskPlaceholder+=getPlaceholderChar(i),maskPatterns.push(linkOptions.maskDefinitions[chr]),characterCount++,isOptional||minRequiredLength++):"?"===chr?isOptional=!0:(maskPlaceholder+=chr,characterCount++)})}maskCaretMap.push(maskCaretMap.slice().pop()+1),maskComponents=getMaskComponents(),maskProcessed=maskCaretMap.length>1?!0:!1}function blurHandler(){oldCaretPosition=0,oldSelectionLength=0,isValid&&0!==value.length||(valueMasked="",iElement.val(""),scope.$apply(function(){controller.$setViewValue("")}))}function mouseDownUpHandler(e){"mousedown"===e.type?iElement.bind("mouseout",mouseoutHandler):iElement.unbind("mouseout",mouseoutHandler)}function mouseoutHandler(){oldSelectionLength=getSelectionLength(this),iElement.unbind("mouseout",mouseoutHandler)}function eventHandler(e){e=e||{};var eventWhich=e.which,eventType=e.type;if(16!==eventWhich&&91!==eventWhich){var valMasked,val=iElement.val(),valOld=oldValue,valUnmasked=unmaskValue(val),valUnmaskedOld=oldValueUnmasked,valAltered=!1,caretPos=getCaretPosition(this)||0,caretPosOld=oldCaretPosition||0,caretPosDelta=caretPos-caretPosOld,caretPosMin=maskCaretMap[0],caretPosMax=maskCaretMap[valUnmasked.length]||maskCaretMap.slice().shift(),selectionLenOld=oldSelectionLength||0,isSelected=getSelectionLength(this)>0,wasSelected=selectionLenOld>0,isAddition=val.length>valOld.length||selectionLenOld&&val.length>valOld.length-selectionLenOld,isDeletion=val.length<valOld.length||selectionLenOld&&val.length===valOld.length-selectionLenOld,isSelection=eventWhich>=37&&40>=eventWhich&&e.shiftKey,isKeyLeftArrow=37===eventWhich,isKeyBackspace=8===eventWhich||"keyup"!==eventType&&isDeletion&&-1===caretPosDelta,isKeyDelete=46===eventWhich||"keyup"!==eventType&&isDeletion&&0===caretPosDelta&&!wasSelected,caretBumpBack=(isKeyLeftArrow||isKeyBackspace||"click"===eventType)&&caretPos>caretPosMin;if(oldSelectionLength=getSelectionLength(this),!isSelection&&(!isSelected||"click"!==eventType&&"keyup"!==eventType)){if("input"===eventType&&isDeletion&&!wasSelected&&valUnmasked===valUnmaskedOld){for(;isKeyBackspace&&caretPos>caretPosMin&&!isValidCaretPosition(caretPos);)caretPos--;for(;isKeyDelete&&caretPosMax>caretPos&&-1===maskCaretMap.indexOf(caretPos);)caretPos++;var charIndex=maskCaretMap.indexOf(caretPos);valUnmasked=valUnmasked.substring(0,charIndex)+valUnmasked.substring(charIndex+1),valAltered=!0}for(valMasked=maskValue(valUnmasked),oldValue=valMasked,oldValueUnmasked=valUnmasked,iElement.val(valMasked),valAltered&&scope.$apply(function(){controller.$setViewValue(valUnmasked)}),isAddition&&caretPosMin>=caretPos&&(caretPos=caretPosMin+1),caretBumpBack&&caretPos--,caretPos=caretPos>caretPosMax?caretPosMax:caretPosMin>caretPos?caretPosMin:caretPos;!isValidCaretPosition(caretPos)&&caretPos>caretPosMin&&caretPosMax>caretPos;)caretPos+=caretBumpBack?-1:1;(caretBumpBack&&caretPosMax>caretPos||isAddition&&!isValidCaretPosition(caretPosOld))&&caretPos++,oldCaretPosition=caretPos,setCaretPosition(this,caretPos)}}}function isValidCaretPosition(pos){return maskCaretMap.indexOf(pos)>-1}function getCaretPosition(input){if(!input)return 0;if(void 0!==input.selectionStart)return input.selectionStart;if(document.selection){input.focus();var selection=document.selection.createRange();return selection.moveStart("character",-input.value.length),selection.text.length}return 0}function setCaretPosition(input,pos){if(!input)return 0;if(0!==input.offsetWidth&&0!==input.offsetHeight)if(input.setSelectionRange)input.focus(),input.setSelectionRange(pos,pos);else if(input.createTextRange){var range=input.createTextRange();range.collapse(!0),range.moveEnd("character",pos),range.moveStart("character",pos),range.select()}}function getSelectionLength(input){return input?void 0!==input.selectionStart?input.selectionEnd-input.selectionStart:document.selection?document.selection.createRange().text.length:0:0}var maskCaretMap,maskPatterns,maskPlaceholder,maskComponents,minRequiredLength,value,valueMasked,isValid,oldValue,oldValueUnmasked,oldCaretPosition,oldSelectionLength,maskProcessed=!1,eventsBound=!1,originalPlaceholder=iAttrs.placeholder,originalMaxlength=iAttrs.maxlength,linkOptions={};iAttrs.uiOptions?(linkOptions=scope.$eval("["+iAttrs.uiOptions+"]"),angular.isObject(linkOptions[0])&&(linkOptions=function(original,current){for(var i in original)Object.prototype.hasOwnProperty.call(original,i)&&(current[i]?angular.extend(current[i],original[i]):current[i]=angular.copy(original[i]));return current}(options,linkOptions[0]))):linkOptions=options,iAttrs.$observe("uiMask",initialize),iAttrs.$observe("placeholder",initPlaceholder),controller.$formatters.push(formatter),controller.$parsers.push(parser),iElement.bind("mousedown mouseup",mouseDownUpHandler),Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement){if(null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if(0===len)return-1;var n=0;if(arguments.length>1&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&1/0!==n&&n!==-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=len)return-1;for(var k=n>=0?n:Math.max(len-Math.abs(n),0);len>k;k++)if(k in t&&t[k]===searchElement)return k;return-1})}}}}]),angular.module("ui.reset",[]).value("uiResetConfig",null).directive("uiReset",["uiResetConfig",function(uiResetConfig){var resetValue=null;return void 0!==uiResetConfig&&(resetValue=uiResetConfig),{require:"ngModel",link:function(scope,elm,attrs,ctrl){var aElement;aElement=angular.element('<a class="ui-reset" />'),elm.wrap('<span class="ui-resetwrap" />').after(aElement),aElement.bind("click",function(e){e.preventDefault(),scope.$apply(function(){ctrl.$setViewValue(attrs.uiReset?scope.$eval(attrs.uiReset):resetValue),ctrl.$render()})})}}}]),angular.module("ui.route",[]).directive("uiRoute",["$location","$parse",function($location,$parse){return{restrict:"AC",scope:!0,compile:function(tElement,tAttrs){var useProperty;if(tAttrs.uiRoute)useProperty="uiRoute";
else if(tAttrs.ngHref)useProperty="ngHref";else{if(!tAttrs.href)throw new Error("uiRoute missing a route or href property on "+tElement[0]);useProperty="href"}return function($scope,elm,attrs){function staticWatcher(newVal){var hash=newVal.indexOf("#");hash>-1&&(newVal=newVal.substr(hash+1)),(watcher=function(){modelSetter($scope,$location.path().indexOf(newVal)>-1)})()}function regexWatcher(newVal){var hash=newVal.indexOf("#");hash>-1&&(newVal=newVal.substr(hash+1)),(watcher=function(){var regexp=new RegExp("^"+newVal+"$",["i"]);modelSetter($scope,regexp.test($location.path()))})()}var modelSetter=$parse(attrs.ngModel||attrs.routeModel||"$uiRoute").assign,watcher=angular.noop;switch(useProperty){case"uiRoute":attrs.uiRoute?regexWatcher(attrs.uiRoute):attrs.$observe("uiRoute",regexWatcher);break;case"ngHref":attrs.ngHref?staticWatcher(attrs.ngHref):attrs.$observe("ngHref",staticWatcher);break;case"href":staticWatcher(attrs.href)}$scope.$on("$routeChangeSuccess",function(){watcher()}),$scope.$on("$stateChangeSuccess",function(){watcher()})}}}}]),angular.module("ui.scroll.jqlite",["ui.scroll"]).service("jqLiteExtras",["$log","$window",function(console,window){return{registerFor:function(element){var convertToPx,css,getMeasurements,getStyle,getWidthHeight,isWindow,scrollTo;return css=angular.element.prototype.css,element.prototype.css=function(name,value){var elem,self;return self=this,elem=self[0],elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style?css.call(self,name,value):void 0},isWindow=function(obj){return obj&&obj.document&&obj.location&&obj.alert&&obj.setInterval},scrollTo=function(self,direction,value){var elem,method,preserve,prop,_ref;return elem=self[0],_ref={top:["scrollTop","pageYOffset","scrollLeft"],left:["scrollLeft","pageXOffset","scrollTop"]}[direction],method=_ref[0],prop=_ref[1],preserve=_ref[2],isWindow(elem)?angular.isDefined(value)?elem.scrollTo(self[preserve].call(self),value):prop in elem?elem[prop]:elem.document.documentElement[method]:angular.isDefined(value)?elem[method]=value:elem[method]},window.getComputedStyle?(getStyle=function(elem){return window.getComputedStyle(elem,null)},convertToPx=function(elem,value){return parseFloat(value)}):(getStyle=function(elem){return elem.currentStyle},convertToPx=function(elem,value){var core_pnum,left,result,rnumnonpx,rs,rsLeft,style;return core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rnumnonpx.test(value)?(style=elem.style,left=style.left,rs=elem.runtimeStyle,rsLeft=rs&&rs.left,rs&&(rs.left=style.left),style.left=value,result=style.pixelLeft,style.left=left,rsLeft&&(rs.left=rsLeft),result):parseFloat(value)}),getMeasurements=function(elem,measure){var base,borderA,borderB,computedMarginA,computedMarginB,computedStyle,dirA,dirB,marginA,marginB,paddingA,paddingB,_ref;return isWindow(elem)?(base=document.documentElement[{height:"clientHeight",width:"clientWidth"}[measure]],{base:base,padding:0,border:0,margin:0}):(_ref={width:[elem.offsetWidth,"Left","Right"],height:[elem.offsetHeight,"Top","Bottom"]}[measure],base=_ref[0],dirA=_ref[1],dirB=_ref[2],computedStyle=getStyle(elem),paddingA=convertToPx(elem,computedStyle["padding"+dirA])||0,paddingB=convertToPx(elem,computedStyle["padding"+dirB])||0,borderA=convertToPx(elem,computedStyle["border"+dirA+"Width"])||0,borderB=convertToPx(elem,computedStyle["border"+dirB+"Width"])||0,computedMarginA=computedStyle["margin"+dirA],computedMarginB=computedStyle["margin"+dirB],marginA=convertToPx(elem,computedMarginA)||0,marginB=convertToPx(elem,computedMarginB)||0,{base:base,padding:paddingA+paddingB,border:borderA+borderB,margin:marginA+marginB})},getWidthHeight=function(elem,direction,measure){var computedStyle,measurements,result;return measurements=getMeasurements(elem,direction),measurements.base>0?{base:measurements.base-measurements.padding-measurements.border,outer:measurements.base,outerfull:measurements.base+measurements.margin}[measure]:(computedStyle=getStyle(elem),result=computedStyle[direction],(0>result||null===result)&&(result=elem.style[direction]||0),result=parseFloat(result)||0,{base:result-measurements.padding-measurements.border,outer:result,outerfull:result+measurements.padding+measurements.border+measurements.margin}[measure])},angular.forEach({before:function(newElem){var children,elem,i,parent,self,_i,_ref;if(self=this,elem=self[0],parent=self.parent(),children=parent.contents(),children[0]===elem)return parent.prepend(newElem);for(i=_i=1,_ref=children.length-1;_ref>=1?_ref>=_i:_i>=_ref;i=_ref>=1?++_i:--_i)if(children[i]===elem)return void angular.element(children[i-1]).after(newElem);throw new Error("invalid DOM structure "+elem.outerHTML)},height:function(value){var self;return self=this,angular.isDefined(value)?(angular.isNumber(value)&&(value+="px"),css.call(self,"height",value)):getWidthHeight(this[0],"height","base")},outerHeight:function(option){return getWidthHeight(this[0],"height",option?"outerfull":"outer")},offset:function(value){var box,doc,docElem,elem,self,win;return self=this,arguments.length?void 0===value?self:value:(box={top:0,left:0},elem=self[0],(doc=elem&&elem.ownerDocument)?(docElem=doc.documentElement,elem.getBoundingClientRect&&(box=elem.getBoundingClientRect()),win=doc.defaultView||doc.parentWindow,{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)}):void 0)},scrollTop:function(value){return scrollTo(this,"top",value)},scrollLeft:function(value){return scrollTo(this,"left",value)}},function(value,key){return element.prototype[key]?void 0:element.prototype[key]=value})}}}]).run(["$log","$window","jqLiteExtras",function(console,window,jqLiteExtras){return window.jQuery?void 0:jqLiteExtras.registerFor(angular.element)}]),angular.module("ui.scroll",[]).directive("ngScrollViewport",["$log",function(){return{controller:["$scope","$element",function(scope,element){return element}]}}]).directive("ngScroll",["$log","$injector","$rootScope","$timeout",function(console,$injector,$rootScope,$timeout){return{require:["?^ngScrollViewport"],transclude:"element",priority:1e3,terminal:!0,compile:function(element,attr,linker){return function($scope,$element,$attr,controllers){var adapter,adjustBuffer,adjustRowHeight,bof,bottomVisiblePos,buffer,bufferPadding,bufferSize,clipBottom,clipTop,datasource,datasourceName,enqueueFetch,eof,eventListener,fetch,finalize,first,insert,isDatasource,isLoading,itemName,loading,match,next,pending,reload,removeFromBuffer,resizeHandler,scrollHandler,scrollHeight,shouldLoadBottom,shouldLoadTop,tempScope,topVisiblePos,viewport;if(match=$attr.ngScroll.match(/^\s*(\w+)\s+in\s+(\w+)\s*$/),!match)throw new Error('Expected ngScroll in form of "item_ in _datasource_" but got "'+$attr.ngScroll+'"');if(itemName=match[1],datasourceName=match[2],isDatasource=function(datasource){return angular.isObject(datasource)&&datasource.get&&angular.isFunction(datasource.get)},datasource=$scope[datasourceName],!isDatasource(datasource)&&(datasource=$injector.get(datasourceName),!isDatasource(datasource)))throw new Error(datasourceName+" is not a valid datasource");return bufferSize=Math.max(3,+$attr.bufferSize||10),bufferPadding=function(){return viewport.height()*Math.max(.1,+$attr.padding||.1)},scrollHeight=function(elem){return elem[0].scrollHeight||elem[0].document.documentElement.scrollHeight},adapter=null,linker(tempScope=$scope.$new(),function(template){var bottomPadding,createPadding,padding,repeaterType,topPadding,viewport;if(repeaterType=template[0].localName,"dl"===repeaterType)throw new Error("ng-scroll directive does not support <"+template[0].localName+"> as a repeating tag: "+template[0].outerHTML);return"li"!==repeaterType&&"tr"!==repeaterType&&(repeaterType="div"),viewport=controllers[0]||angular.element(window),viewport.css({"overflow-y":"auto",display:"block"}),padding=function(repeaterType){var div,result,table;switch(repeaterType){case"tr":return table=angular.element("<table><tr><td><div></div></td></tr></table>"),div=table.find("div"),result=table.find("tr"),result.paddingHeight=function(){return div.height.apply(div,arguments)},result;default:return result=angular.element("<"+repeaterType+"></"+repeaterType+">"),result.paddingHeight=result.height,result}},createPadding=function(padding,element,direction){return element[{top:"before",bottom:"after"}[direction]](padding),{paddingHeight:function(){return padding.paddingHeight.apply(padding,arguments)},insert:function(element){return padding[{top:"after",bottom:"before"}[direction]](element)}}},topPadding=createPadding(padding(repeaterType),element,"top"),bottomPadding=createPadding(padding(repeaterType),element,"bottom"),tempScope.$destroy(),adapter={viewport:viewport,topPadding:topPadding.paddingHeight,bottomPadding:bottomPadding.paddingHeight,append:bottomPadding.insert,prepend:topPadding.insert,bottomDataPos:function(){return scrollHeight(viewport)-bottomPadding.paddingHeight()},topDataPos:function(){return topPadding.paddingHeight()}}}),viewport=adapter.viewport,first=1,next=1,buffer=[],pending=[],eof=!1,bof=!1,loading=datasource.loading||function(){},isLoading=!1,removeFromBuffer=function(start,stop){var i,_i;for(i=_i=start;stop>=start?stop>_i:_i>stop;i=stop>=start?++_i:--_i)buffer[i].scope.$destroy(),buffer[i].element.remove();return buffer.splice(start,stop-start)},reload=function(){return first=1,next=1,removeFromBuffer(0,buffer.length),adapter.topPadding(0),adapter.bottomPadding(0),pending=[],eof=!1,bof=!1,adjustBuffer(!1)},bottomVisiblePos=function(){return viewport.scrollTop()+viewport.height()},topVisiblePos=function(){return viewport.scrollTop()},shouldLoadBottom=function(){return!eof&&adapter.bottomDataPos()<bottomVisiblePos()+bufferPadding()},clipBottom=function(){var bottomHeight,i,itemHeight,overage,_i,_ref;for(bottomHeight=0,overage=0,i=_i=_ref=buffer.length-1;(0>=_ref?0>=_i:_i>=0)&&(itemHeight=buffer[i].element.outerHeight(!0),adapter.bottomDataPos()-bottomHeight-itemHeight>bottomVisiblePos()+bufferPadding());i=0>=_ref?++_i:--_i)bottomHeight+=itemHeight,overage++,eof=!1;return overage>0?(adapter.bottomPadding(adapter.bottomPadding()+bottomHeight),removeFromBuffer(buffer.length-overage,buffer.length),next-=overage,console.log("clipped off bottom "+overage+" bottom padding "+adapter.bottomPadding())):void 0},shouldLoadTop=function(){return!bof&&adapter.topDataPos()>topVisiblePos()-bufferPadding()},clipTop=function(){var item,itemHeight,overage,topHeight,_i,_len;for(topHeight=0,overage=0,_i=0,_len=buffer.length;_len>_i&&(item=buffer[_i],itemHeight=item.element.outerHeight(!0),adapter.topDataPos()+topHeight+itemHeight<topVisiblePos()-bufferPadding());_i++)topHeight+=itemHeight,overage++,bof=!1;return overage>0?(adapter.topPadding(adapter.topPadding()+topHeight),removeFromBuffer(0,overage),first+=overage,console.log("clipped off top "+overage+" top padding "+adapter.topPadding())):void 0},enqueueFetch=function(direction,scrolling){return isLoading||(isLoading=!0,loading(!0)),1===pending.push(direction)?fetch(scrolling):void 0},insert=function(index,item){var itemScope,toBeAppended,wrapper;return itemScope=$scope.$new(),itemScope[itemName]=item,toBeAppended=index>first,itemScope.$index=index,toBeAppended&&itemScope.$index--,wrapper={scope:itemScope},linker(itemScope,function(clone){return wrapper.element=clone,toBeAppended?index===next?(adapter.append(clone),buffer.push(wrapper)):(buffer[index-first].element.after(clone),buffer.splice(index-first+1,0,wrapper)):(adapter.prepend(clone),buffer.unshift(wrapper))}),{appended:toBeAppended,wrapper:wrapper}},adjustRowHeight=function(appended,wrapper){var newHeight;return appended?adapter.bottomPadding(Math.max(0,adapter.bottomPadding()-wrapper.element.outerHeight(!0))):(newHeight=adapter.topPadding()-wrapper.element.outerHeight(!0),newHeight>=0?adapter.topPadding(newHeight):viewport.scrollTop(viewport.scrollTop()+wrapper.element.outerHeight(!0)))},adjustBuffer=function(scrolling,newItems,finalize){var doAdjustment;return doAdjustment=function(){return console.log("top {actual="+adapter.topDataPos()+" visible from="+topVisiblePos()+" bottom {visible through="+bottomVisiblePos()+" actual="+adapter.bottomDataPos()+"}"),shouldLoadBottom()?enqueueFetch(!0,scrolling):shouldLoadTop()&&enqueueFetch(!1,scrolling),finalize?finalize():void 0},newItems?$timeout(function(){var row,_i,_len;for(_i=0,_len=newItems.length;_len>_i;_i++)row=newItems[_i],adjustRowHeight(row.appended,row.wrapper);return doAdjustment()}):doAdjustment()},finalize=function(scrolling,newItems){return adjustBuffer(scrolling,newItems,function(){return pending.shift(),0===pending.length?(isLoading=!1,loading(!1)):fetch(scrolling)})},fetch=function(scrolling){var direction;return direction=pending[0],direction?buffer.length&&!shouldLoadBottom()?finalize(scrolling):datasource.get(next,bufferSize,function(result){var item,newItems,_i,_len;if(newItems=[],0===result.length)eof=!0,adapter.bottomPadding(0),console.log("appended: requested "+bufferSize+" records starting from "+next+" recieved: eof");else{for(clipTop(),_i=0,_len=result.length;_len>_i;_i++)item=result[_i],newItems.push(insert(++next,item));console.log("appended: requested "+bufferSize+" received "+result.length+" buffer size "+buffer.length+" first "+first+" next "+next)}return finalize(scrolling,newItems)}):buffer.length&&!shouldLoadTop()?finalize(scrolling):datasource.get(first-bufferSize,bufferSize,function(result){var i,newItems,_i,_ref;if(newItems=[],0===result.length)bof=!0,adapter.topPadding(0),console.log("prepended: requested "+bufferSize+" records starting from "+(first-bufferSize)+" recieved: bof");else{for(clipBottom(),i=_i=_ref=result.length-1;0>=_ref?0>=_i:_i>=0;i=0>=_ref?++_i:--_i)newItems.unshift(insert(--first,result[i]));console.log("prepended: requested "+bufferSize+" received "+result.length+" buffer size "+buffer.length+" first "+first+" next "+next)}return finalize(scrolling,newItems)})},resizeHandler=function(){return $rootScope.$$phase||isLoading?void 0:(adjustBuffer(!1),$scope.$apply())},viewport.bind("resize",resizeHandler),scrollHandler=function(){return $rootScope.$$phase||isLoading?void 0:(adjustBuffer(!0),$scope.$apply())},viewport.bind("scroll",scrollHandler),$scope.$watch(datasource.revision,function(){return reload()}),eventListener=datasource.scope?datasource.scope.$new():$scope.$new(),$scope.$on("$destroy",function(){return eventListener.$destroy(),viewport.unbind("resize",resizeHandler),viewport.unbind("scroll",scrollHandler)}),eventListener.$on("update.items",function(event,locator,newItem){var wrapper,_fn,_i,_len,_ref;if(angular.isFunction(locator))for(_fn=function(wrapper){return locator(wrapper.scope)},_i=0,_len=buffer.length;_len>_i;_i++)wrapper=buffer[_i],_fn(wrapper);else 0<=(_ref=locator-first-1)&&_ref<buffer.length&&(buffer[locator-first-1].scope[itemName]=newItem);return null}),eventListener.$on("delete.items",function(event,locator){var i,item,temp,wrapper,_fn,_i,_j,_k,_len,_len1,_len2,_ref;if(angular.isFunction(locator)){for(temp=[],_i=0,_len=buffer.length;_len>_i;_i++)item=buffer[_i],temp.unshift(item);for(_fn=function(wrapper){return locator(wrapper.scope)?(removeFromBuffer(temp.length-1-i,temp.length-i),next--):void 0},i=_j=0,_len1=temp.length;_len1>_j;i=++_j)wrapper=temp[i],_fn(wrapper)}else 0<=(_ref=locator-first-1)&&_ref<buffer.length&&(removeFromBuffer(locator-first-1,locator-first),next--);for(i=_k=0,_len2=buffer.length;_len2>_k;i=++_k)item=buffer[i],item.scope.$index=first+i;return adjustBuffer(!1)}),eventListener.$on("insert.item",function(event,locator,item){var i,inserted,temp,wrapper,_fn,_i,_j,_k,_len,_len1,_len2,_ref;if(inserted=[],angular.isFunction(locator)){for(temp=[],_i=0,_len=buffer.length;_len>_i;_i++)item=buffer[_i],temp.unshift(item);for(_fn=function(wrapper){var j,newItems,_k,_len2,_results;if(newItems=locator(wrapper.scope)){if(insert=function(index,newItem){return insert(index,newItem),next++},angular.isArray(newItems)){for(_results=[],j=_k=0,_len2=newItems.length;_len2>_k;j=++_k)item=newItems[j],_results.push(inserted.push(insert(i+j,item)));return _results}return inserted.push(insert(i,newItems))}},i=_j=0,_len1=temp.length;_len1>_j;i=++_j)wrapper=temp[i],_fn(wrapper)}else 0<=(_ref=locator-first-1)&&_ref<buffer.length&&(inserted.push(insert(locator,item)),next++);for(i=_k=0,_len2=buffer.length;_len2>_k;i=++_k)item=buffer[i],item.scope.$index=first+i;return adjustBuffer(!1,inserted)})}}}}]),angular.module("ui.scrollfix",[]).directive("uiScrollfix",["$window",function($window){return{require:"^?uiScrollfixTarget",link:function(scope,elm,attrs,uiScrollfixTarget){function onScroll(){var offset;if(angular.isDefined($window.pageYOffset))offset=$window.pageYOffset;else{var iebody=document.compatMode&&"BackCompat"!==document.compatMode?document.documentElement:document.body;offset=iebody.scrollTop}!elm.hasClass("ui-scrollfix")&&offset>attrs.uiScrollfix?elm.addClass("ui-scrollfix"):elm.hasClass("ui-scrollfix")&&offset<attrs.uiScrollfix&&elm.removeClass("ui-scrollfix")}var top=elm[0].offsetTop,$target=uiScrollfixTarget&&uiScrollfixTarget.$element||angular.element($window);attrs.uiScrollfix?"string"==typeof attrs.uiScrollfix&&("-"===attrs.uiScrollfix.charAt(0)?attrs.uiScrollfix=top-parseFloat(attrs.uiScrollfix.substr(1)):"+"===attrs.uiScrollfix.charAt(0)&&(attrs.uiScrollfix=top+parseFloat(attrs.uiScrollfix.substr(1)))):attrs.uiScrollfix=top,$target.on("scroll",onScroll),scope.$on("$destroy",function(){$target.off("scroll",onScroll)})}}}]).directive("uiScrollfixTarget",[function(){return{controller:["$element",function($element){this.$element=$element}]}}]),angular.module("ui.showhide",[]).directive("uiShow",[function(){return function(scope,elm,attrs){scope.$watch(attrs.uiShow,function(newVal){newVal?elm.addClass("ui-show"):elm.removeClass("ui-show")})}}]).directive("uiHide",[function(){return function(scope,elm,attrs){scope.$watch(attrs.uiHide,function(newVal){newVal?elm.addClass("ui-hide"):elm.removeClass("ui-hide")})}}]).directive("uiToggle",[function(){return function(scope,elm,attrs){scope.$watch(attrs.uiToggle,function(newVal){newVal?elm.removeClass("ui-hide").addClass("ui-show"):elm.removeClass("ui-show").addClass("ui-hide")})}}]),angular.module("ui.unique",[]).filter("unique",["$parse",function($parse){return function(items,filterOn){if(filterOn===!1)return items;if((filterOn||angular.isUndefined(filterOn))&&angular.isArray(items)){var newItems=[],get=angular.isString(filterOn)?$parse(filterOn):function(item){return item},extractValueToCompare=function(item){return angular.isObject(item)?get(item):item};angular.forEach(items,function(item){for(var isDuplicate=!1,i=0;i<newItems.length;i++)if(angular.equals(extractValueToCompare(newItems[i]),extractValueToCompare(item))){isDuplicate=!0;break}isDuplicate||newItems.push(item)}),items=newItems}return items}}]),angular.module("ui.validate",[]).directive("uiValidate",function(){return{restrict:"A",require:"ngModel",link:function(scope,elm,attrs,ctrl){function apply_watch(watch){return angular.isString(watch)?void scope.$watch(watch,function(){angular.forEach(validators,function(validatorFn){validatorFn(ctrl.$modelValue)})}):angular.isArray(watch)?void angular.forEach(watch,function(expression){scope.$watch(expression,function(){angular.forEach(validators,function(validatorFn){validatorFn(ctrl.$modelValue)})})}):void(angular.isObject(watch)&&angular.forEach(watch,function(expression,validatorKey){angular.isString(expression)&&scope.$watch(expression,function(){validators[validatorKey](ctrl.$modelValue)}),angular.isArray(expression)&&angular.forEach(expression,function(intExpression){scope.$watch(intExpression,function(){validators[validatorKey](ctrl.$modelValue)})})}))}var validateFn,validators={},validateExpr=scope.$eval(attrs.uiValidate);validateExpr&&(angular.isString(validateExpr)&&(validateExpr={validator:validateExpr}),angular.forEach(validateExpr,function(exprssn,key){validateFn=function(valueToValidate){var expression=scope.$eval(exprssn,{$value:valueToValidate});return angular.isObject(expression)&&angular.isFunction(expression.then)?(expression.then(function(){ctrl.$setValidity(key,!0)},function(){ctrl.$setValidity(key,!1)}),valueToValidate):expression?(ctrl.$setValidity(key,!0),valueToValidate):(ctrl.$setValidity(key,!1),valueToValidate)},validators[key]=validateFn,ctrl.$formatters.push(validateFn),ctrl.$parsers.push(validateFn)}),attrs.uiValidateWatch&&apply_watch(scope.$eval(attrs.uiValidateWatch)))}}}),angular.module("ui.utils",["ui.event","ui.format","ui.highlight","ui.include","ui.indeterminate","ui.inflector","ui.jq","ui.keypress","ui.mask","ui.reset","ui.route","ui.scrollfix","ui.scroll","ui.scroll.jqlite","ui.showhide","ui.unique","ui.validate"]),angular.module("ui.calendar",[]).constant("uiCalendarConfig",{}).controller("uiCalendarCtrl",["$scope","$timeout",function($scope,$timeout){var sourceSerialId=1,eventSerialId=1,sources=$scope.eventSources,extraEventSignature=$scope.calendarWatchEvent?$scope.calendarWatchEvent:angular.noop,wrapFunctionWithScopeApply=function(functionToWrap){var wrapper;return functionToWrap&&(wrapper=function(){var args=arguments;$timeout(function(){functionToWrap.apply(this,args)})}),wrapper};this.eventsFingerprint=function(e){return e.__uiCalId||(e.__uiCalId=eventSerialId++),""+e.__uiCalId+(e.id||"")+(e.title||"")+(e.url||"")+(+e.start||"")+(+e.end||"")+(e.allDay||"")+(e.className||"")+extraEventSignature(e)||""},this.sourcesFingerprint=function(source){return source.__id||(source.__id=sourceSerialId++)},this.allEvents=function(){for(var arraySources=[],i=0,srcLen=sources.length;srcLen>i;i++){var source=sources[i];if(angular.isArray(source))arraySources.push(source);else if(angular.isObject(source)&&angular.isArray(source.events)){var extEvent={};for(var key in source)"_uiCalId"!==key&&"events"!==key&&(extEvent[key]=source[key]);for(var eI=0;eI<source.events.length;eI++)angular.extend(source.events[eI],extEvent);arraySources.push(source.events)}}return Array.prototype.concat.apply([],arraySources)},this.changeWatcher=function(arraySource,tokenFn){var self,getTokens=function(){for(var token,el,array=angular.isFunction(arraySource)?arraySource():arraySource,result=[],i=0,n=array.length;n>i;i++)el=array[i],token=tokenFn(el),map[token]=el,result.push(token);return result},subtractAsSets=function(a,b){var i,n,result=[],inB={};for(i=0,n=b.length;n>i;i++)inB[b[i]]=!0;for(i=0,n=a.length;n>i;i++)inB[a[i]]||result.push(a[i]);return result},map={},applyChanges=function(newTokens,oldTokens){var i,n,el,token,replacedTokens={},removedTokens=subtractAsSets(oldTokens,newTokens);for(i=0,n=removedTokens.length;n>i;i++){var removedToken=removedTokens[i];el=map[removedToken],delete map[removedToken];var newToken=tokenFn(el);newToken===removedToken?self.onRemoved(el):(replacedTokens[newToken]=removedToken,self.onChanged(el))}var addedTokens=subtractAsSets(newTokens,oldTokens);for(i=0,n=addedTokens.length;n>i;i++)token=addedTokens[i],el=map[token],replacedTokens[token]||self.onAdded(el)};return self={subscribe:function(scope,onChanged){scope.$watch(getTokens,function(newTokens,oldTokens){onChanged&&onChanged(newTokens,oldTokens)===!1||applyChanges(newTokens,oldTokens)},!0)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}},this.getFullCalendarConfig=function(calendarSettings,uiCalendarConfig){var config={};return angular.extend(config,uiCalendarConfig),angular.extend(config,calendarSettings),angular.forEach(config,function(value,key){"function"==typeof value&&(config[key]=wrapFunctionWithScopeApply(config[key]))}),config}}]).directive("uiCalendar",["uiCalendarConfig","$locale",function(uiCalendarConfig,$locale){var tValues=function(data){var r,k;r=[];for(k in data)r[k]=data[k];return r},dtf=$locale.DATETIME_FORMATS;return uiCalendarConfig=angular.extend({monthNames:tValues(dtf.MONTH),monthNamesShort:tValues(dtf.SHORTMONTH),dayNames:tValues(dtf.DAY),dayNamesShort:tValues(dtf.SHORTDAY)},uiCalendarConfig||{}),{restrict:"A",scope:{eventSources:"=ngModel",calendarWatchEvent:"&"},controller:"uiCalendarCtrl",link:function(scope,elm,attrs,controller){function getOptions(){var fullCalendarConfig,calendarSettings=attrs.uiCalendar?scope.$parent.$eval(attrs.uiCalendar):{};fullCalendarConfig=controller.getFullCalendarConfig(calendarSettings,uiCalendarConfig),options={eventSources:sources},angular.extend(options,fullCalendarConfig);var options2={};for(var o in options)"eventSources"!==o&&(options2[o]=options[o]);return JSON.stringify(options2)}var sources=scope.eventSources,sourcesChanged=!1,eventSourcesWatcher=controller.changeWatcher(sources,controller.sourcesFingerprint),eventsWatcher=controller.changeWatcher(controller.allEvents,controller.eventsFingerprint),options=null;scope.destroy=function(){scope.calendar=attrs.calendar?scope.$parent[attrs.calendar]=elm.html(""):elm.html("")},scope.init=function(){scope.calendar.fullCalendar(options)},eventSourcesWatcher.onAdded=function(source){scope.calendar.fullCalendar("addEventSource",source),sourcesChanged=!0},eventSourcesWatcher.onRemoved=function(source){scope.calendar.fullCalendar("removeEventSource",source),sourcesChanged=!0},eventsWatcher.onAdded=function(event){scope.calendar.fullCalendar("renderEvent",event)},eventsWatcher.onRemoved=function(event){scope.calendar.fullCalendar("removeEvents",function(e){return e===event})},eventsWatcher.onChanged=function(event){scope.calendar.fullCalendar("updateEvent",event)},eventSourcesWatcher.subscribe(scope),eventsWatcher.subscribe(scope,function(){return sourcesChanged===!0?(sourcesChanged=!1,!1):void 0}),scope.$watch(getOptions,function(){scope.destroy(),scope.init()})}}}]),angular.module("mm.foundation",["mm.foundation.tpls","mm.foundation.accordion","mm.foundation.alert","mm.foundation.bindHtml","mm.foundation.buttons","mm.foundation.position","mm.foundation.dropdownToggle","mm.foundation.transition","mm.foundation.modal","mm.foundation.pagination","mm.foundation.tooltip","mm.foundation.popover","mm.foundation.progressbar","mm.foundation.rating","mm.foundation.tabs","mm.foundation.tour","mm.foundation.typeahead"]),angular.module("mm.foundation.tpls",["template/accordion/accordion-group.html","template/accordion/accordion.html","template/alert/alert.html","template/modal/backdrop.html","template/modal/window.html","template/pagination/pager.html","template/pagination/pagination.html","template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html","template/popover/popover.html","template/progressbar/bar.html","template/progressbar/progress.html","template/progressbar/progressbar.html","template/rating/rating.html","template/tabs/tab.html","template/tabs/tabset.html","template/tour/tour.html","template/typeahead/typeahead-match.html","template/typeahead/typeahead-popup.html"]),angular.module("mm.foundation.accordion",[]).constant("accordionConfig",{closeOthers:!0}).controller("AccordionController",["$scope","$attrs","accordionConfig",function($scope,$attrs,accordionConfig){this.groups=[],this.closeOthers=function(openGroup){var closeOthers=angular.isDefined($attrs.closeOthers)?$scope.$eval($attrs.closeOthers):accordionConfig.closeOthers;closeOthers&&angular.forEach(this.groups,function(group){group!==openGroup&&(group.isOpen=!1)})},this.addGroup=function(groupScope){var that=this;this.groups.push(groupScope),groupScope.$on("$destroy",function(){that.removeGroup(groupScope)})},this.removeGroup=function(group){var index=this.groups.indexOf(group);-1!==index&&this.groups.splice(this.groups.indexOf(group),1)}}]).directive("accordion",function(){return{restrict:"EA",controller:"AccordionController",transclude:!0,replace:!1,templateUrl:"template/accordion/accordion.html"}}).directive("accordionGroup",["$parse",function($parse){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/accordion/accordion-group.html",scope:{heading:"@"},controller:function(){this.setHeading=function(element){this.heading=element}},link:function(scope,element,attrs,accordionCtrl){var getIsOpen,setIsOpen;accordionCtrl.addGroup(scope),scope.isOpen=!1,attrs.isOpen&&(getIsOpen=$parse(attrs.isOpen),setIsOpen=getIsOpen.assign,scope.$parent.$watch(getIsOpen,function(value){scope.isOpen=!!value})),scope.$watch("isOpen",function(value){value&&accordionCtrl.closeOthers(scope),setIsOpen&&setIsOpen(scope.$parent,value)})}}}]).directive("accordionHeading",function(){return{restrict:"EA",transclude:!0,template:"",replace:!0,require:"^accordionGroup",compile:function(element,attr,transclude){return function(scope,element,attr,accordionGroupCtrl){accordionGroupCtrl.setHeading(transclude(scope,function(){}))}}}}).directive("accordionTransclude",function(){return{require:"^accordionGroup",link:function(scope,element,attr,controller){scope.$watch(function(){return controller[attr.accordionTransclude]},function(heading){heading&&(element.html(""),element.append(heading))})}}}),angular.module("mm.foundation.alert",[]).controller("AlertController",["$scope","$attrs",function($scope,$attrs){$scope.closeable="close"in $attrs}]).directive("alert",function(){return{restrict:"EA",controller:"AlertController",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"=",close:"&"}}}),angular.module("mm.foundation.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(scope,element,attr){element.addClass("ng-binding").data("$binding",attr.bindHtmlUnsafe),scope.$watch(attr.bindHtmlUnsafe,function(value){element.html(value||"")})}}),angular.module("mm.foundation.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).controller("ButtonsController",["buttonConfig",function(buttonConfig){this.activeClass=buttonConfig.activeClass,this.toggleEvent=buttonConfig.toggleEvent}]).directive("btnRadio",function(){return{require:["btnRadio","ngModel"],controller:"ButtonsController",link:function(scope,element,attrs,ctrls){var buttonsCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl.$render=function(){element.toggleClass(buttonsCtrl.activeClass,angular.equals(ngModelCtrl.$modelValue,scope.$eval(attrs.btnRadio)))},element.bind(buttonsCtrl.toggleEvent,function(){element.hasClass(buttonsCtrl.activeClass)||scope.$apply(function(){ngModelCtrl.$setViewValue(scope.$eval(attrs.btnRadio)),ngModelCtrl.$render()})})}}}).directive("btnCheckbox",function(){return{require:["btnCheckbox","ngModel"],controller:"ButtonsController",link:function(scope,element,attrs,ctrls){function getTrueValue(){return getCheckboxValue(attrs.btnCheckboxTrue,!0)}function getFalseValue(){return getCheckboxValue(attrs.btnCheckboxFalse,!1)}function getCheckboxValue(attributeValue,defaultValue){var val=scope.$eval(attributeValue);return angular.isDefined(val)?val:defaultValue}var buttonsCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl.$render=function(){element.toggleClass(buttonsCtrl.activeClass,angular.equals(ngModelCtrl.$modelValue,getTrueValue()))},element.bind(buttonsCtrl.toggleEvent,function(){scope.$apply(function(){ngModelCtrl.$setViewValue(element.hasClass(buttonsCtrl.activeClass)?getFalseValue():getTrueValue()),ngModelCtrl.$render()})})}}}),angular.module("mm.foundation.position",[]).factory("$position",["$document","$window",function($document,$window){function getStyle(el,cssprop){return el.currentStyle?el.currentStyle[cssprop]:$window.getComputedStyle?$window.getComputedStyle(el)[cssprop]:el.style[cssprop]}function isStaticPositioned(element){return"static"===(getStyle(element,"position")||"static")}var parentOffsetEl=function(element){for(var docDomEl=$document[0],offsetParent=element.offsetParent||docDomEl;offsetParent&&offsetParent!==docDomEl&&isStaticPositioned(offsetParent);)offsetParent=offsetParent.offsetParent;return offsetParent||docDomEl};return{position:function(element){var elBCR=this.offset(element),offsetParentBCR={top:0,left:0},offsetParentEl=parentOffsetEl(element[0]);offsetParentEl!=$document[0]&&(offsetParentBCR=this.offset(angular.element(offsetParentEl)),offsetParentBCR.top+=offsetParentEl.clientTop-offsetParentEl.scrollTop,offsetParentBCR.left+=offsetParentEl.clientLeft-offsetParentEl.scrollLeft);var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:elBCR.top-offsetParentBCR.top,left:elBCR.left-offsetParentBCR.left}},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].body.scrollTop||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].body.scrollLeft||$document[0].documentElement.scrollLeft)}
}}}]),angular.module("mm.foundation.dropdownToggle",["mm.foundation.position"]).directive("dropdownToggle",["$document","$location","$position",function($document,$location,$position){var openElement=null,closeMenu=angular.noop;return{restrict:"CA",scope:{dropdownToggle:"@"},link:function(scope,element){var dropdown=angular.element($document[0].querySelector(scope.dropdownToggle));scope.$watch("$location.path",function(){closeMenu()}),dropdown.css("display","none").bind("click",function(){closeMenu()}),element.bind("click",function(event){var elementWasOpen=element===openElement;if(event.preventDefault(),event.stopPropagation(),openElement&&closeMenu(),!elementWasOpen&&!element.hasClass("disabled")&&!element.prop("disabled")){dropdown.css("display","block");var offset=$position.offset(element),parentOffset=$position.offset(angular.element(dropdown[0].offsetParent));dropdown.css({left:offset.left-parentOffset.left+"px",top:offset.top-parentOffset.top+offset.height+"px"}),openElement=element,closeMenu=function(event){event&&(event.preventDefault(),event.stopPropagation()),$document.unbind("click",closeMenu),dropdown.css("display","none"),closeMenu=angular.noop,openElement=null},$document.bind("click",closeMenu)}})}}}]),angular.module("mm.foundation.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function($q,$timeout,$rootScope){function findEndEventName(endEventNames){for(var name in endEventNames)if(void 0!==transElement.style[name])return endEventNames[name]}var $transition=function(element,trigger,options){options=options||{};var deferred=$q.defer(),endEventName=$transition[options.animation?"animationEndEventName":"transitionEndEventName"],transitionEndHandler=function(){$rootScope.$apply(function(){element.unbind(endEventName,transitionEndHandler),deferred.resolve(element)})};return endEventName&&element.bind(endEventName,transitionEndHandler),$timeout(function(){angular.isString(trigger)?element.addClass(trigger):angular.isFunction(trigger)?trigger(element):angular.isObject(trigger)&&element.css(trigger),endEventName||deferred.resolve(element)}),deferred.promise.cancel=function(){endEventName&&element.unbind(endEventName,transitionEndHandler),deferred.reject("Transition cancelled")},deferred.promise},transElement=document.createElement("trans"),transitionEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},animationEndEventNames={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return $transition.transitionEndEventName=findEndEventName(transitionEndEventNames),$transition.animationEndEventName=findEndEventName(animationEndEventNames),$transition}]),angular.module("mm.foundation.modal",["mm.foundation.transition"]).factory("$$stackedMap",function(){return{createNew:function(){var stack=[];return{add:function(key,value){stack.push({key:key,value:value})},get:function(key){for(var i=0;i<stack.length;i++)if(key==stack[i].key)return stack[i]},keys:function(){for(var keys=[],i=0;i<stack.length;i++)keys.push(stack[i].key);return keys},top:function(){return stack[stack.length-1]},remove:function(key){for(var idx=-1,i=0;i<stack.length;i++)if(key==stack[i].key){idx=i;break}return stack.splice(idx,1)[0]},removeTop:function(){return stack.splice(stack.length-1,1)[0]},length:function(){return stack.length}}}}}).directive("modalBackdrop",["$modalStack","$timeout",function($modalStack,$timeout){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(scope){scope.animate=!1,$timeout(function(){scope.animate=!0}),scope.close=function(evt){var modal=$modalStack.getTop();modal&&modal.value.backdrop&&"static"!=modal.value.backdrop&&evt.target===evt.currentTarget&&(evt.preventDefault(),evt.stopPropagation(),$modalStack.dismiss(modal.key,"backdrop click"))}}}}]).directive("modalWindow",["$modalStack","$timeout",function($modalStack,$timeout){return{restrict:"EA",scope:{index:"@",animate:"="},replace:!0,transclude:!0,templateUrl:"template/modal/window.html",link:function(scope,element,attrs){scope.windowClass=attrs.windowClass||"",$timeout(function(){scope.animate=!0,element[0].focus()})}}}]).factory("$modalStack",["$transition","$timeout","$document","$compile","$rootScope","$$stackedMap",function($transition,$timeout,$document,$compile,$rootScope,$$stackedMap){function backdropIndex(){for(var topBackdropIndex=-1,opened=openedWindows.keys(),i=0;i<opened.length;i++)openedWindows.get(opened[i]).value.backdrop&&(topBackdropIndex=i);return topBackdropIndex}function removeModalWindow(modalInstance){var body=$document.find("body").eq(0),modalWindow=openedWindows.get(modalInstance).value;openedWindows.remove(modalInstance),removeAfterAnimate(modalWindow.modalDomEl,modalWindow.modalScope,300,checkRemoveBackdrop),body.toggleClass(OPENED_MODAL_CLASS,openedWindows.length()>0)}function checkRemoveBackdrop(){if(backdropDomEl&&-1==backdropIndex()){var backdropScopeRef=backdropScope;removeAfterAnimate(backdropDomEl,backdropScope,150,function(){backdropScopeRef.$destroy(),backdropScopeRef=null}),backdropDomEl=void 0,backdropScope=void 0}}function removeAfterAnimate(domEl,scope,emulateTime,done){function afterAnimating(){afterAnimating.done||(afterAnimating.done=!0,domEl.remove(),done&&done())}scope.animate=!1;var transitionEndEventName=$transition.transitionEndEventName;if(transitionEndEventName){var timeout=$timeout(afterAnimating,emulateTime);domEl.bind(transitionEndEventName,function(){$timeout.cancel(timeout),afterAnimating(),scope.$apply()})}else $timeout(afterAnimating,0)}var backdropDomEl,backdropScope,OPENED_MODAL_CLASS="modal-open",openedWindows=$$stackedMap.createNew(),$modalStack={};return $rootScope.$watch(backdropIndex,function(newBackdropIndex){backdropScope&&(backdropScope.index=newBackdropIndex)}),$document.bind("keydown",function(evt){var modal;27===evt.which&&(modal=openedWindows.top(),modal&&modal.value.keyboard&&$rootScope.$apply(function(){$modalStack.dismiss(modal.key)}))}),$modalStack.open=function(modalInstance,modal){openedWindows.add(modalInstance,{deferred:modal.deferred,modalScope:modal.scope,backdrop:modal.backdrop,keyboard:modal.keyboard});var body=$document.find("body").eq(0),currBackdropIndex=backdropIndex();currBackdropIndex>=0&&!backdropDomEl&&(backdropScope=$rootScope.$new(!0),backdropScope.index=currBackdropIndex,backdropDomEl=$compile("<div modal-backdrop></div>")(backdropScope),body.append(backdropDomEl));var angularDomEl=angular.element("<div modal-window></div>");angularDomEl.attr("window-class",modal.windowClass),angularDomEl.attr("index",openedWindows.length()-1),angularDomEl.attr("animate","animate"),angularDomEl.html(modal.content);var modalDomEl=$compile(angularDomEl)(modal.scope);openedWindows.top().value.modalDomEl=modalDomEl,body.append(modalDomEl),body.addClass(OPENED_MODAL_CLASS)},$modalStack.close=function(modalInstance,result){var modalWindow=openedWindows.get(modalInstance).value;modalWindow&&(modalWindow.deferred.resolve(result),removeModalWindow(modalInstance))},$modalStack.dismiss=function(modalInstance,reason){var modalWindow=openedWindows.get(modalInstance).value;modalWindow&&(modalWindow.deferred.reject(reason),removeModalWindow(modalInstance))},$modalStack.dismissAll=function(reason){for(var topModal=this.getTop();topModal;)this.dismiss(topModal.key,reason),topModal=this.getTop()},$modalStack.getTop=function(){return openedWindows.top()},$modalStack}]).provider("$modal",function(){var $modalProvider={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function($injector,$rootScope,$q,$http,$templateCache,$controller,$modalStack){function getTemplatePromise(options){return options.template?$q.when(options.template):$http.get(options.templateUrl,{cache:$templateCache}).then(function(result){return result.data})}function getResolvePromises(resolves){var promisesArr=[];return angular.forEach(resolves,function(value){(angular.isFunction(value)||angular.isArray(value))&&promisesArr.push($q.when($injector.invoke(value)))}),promisesArr}var $modal={};return $modal.open=function(modalOptions){var modalResultDeferred=$q.defer(),modalOpenedDeferred=$q.defer(),modalInstance={result:modalResultDeferred.promise,opened:modalOpenedDeferred.promise,close:function(result){$modalStack.close(modalInstance,result)},dismiss:function(reason){$modalStack.dismiss(modalInstance,reason)}};if(modalOptions=angular.extend({},$modalProvider.options,modalOptions),modalOptions.resolve=modalOptions.resolve||{},!modalOptions.template&&!modalOptions.templateUrl)throw new Error("One of template or templateUrl options is required.");var templateAndResolvePromise=$q.all([getTemplatePromise(modalOptions)].concat(getResolvePromises(modalOptions.resolve)));return templateAndResolvePromise.then(function(tplAndVars){var modalScope=(modalOptions.scope||$rootScope).$new();modalScope.$close=modalInstance.close,modalScope.$dismiss=modalInstance.dismiss;var ctrlInstance,ctrlLocals={},resolveIter=1;modalOptions.controller&&(ctrlLocals.$scope=modalScope,ctrlLocals.$modalInstance=modalInstance,angular.forEach(modalOptions.resolve,function(value,key){ctrlLocals[key]=tplAndVars[resolveIter++]}),ctrlInstance=$controller(modalOptions.controller,ctrlLocals)),$modalStack.open(modalInstance,{scope:modalScope,deferred:modalResultDeferred,content:tplAndVars[0],backdrop:modalOptions.backdrop,keyboard:modalOptions.keyboard,windowClass:modalOptions.windowClass})},function(reason){modalResultDeferred.reject(reason)}),templateAndResolvePromise.then(function(){modalOpenedDeferred.resolve(!0)},function(){modalOpenedDeferred.reject(!1)}),modalInstance},$modal}]};return $modalProvider}),angular.module("mm.foundation.pagination",[]).controller("PaginationController",["$scope","$attrs","$parse","$interpolate",function($scope,$attrs,$parse,$interpolate){var self=this,setNumPages=$attrs.numPages?$parse($attrs.numPages).assign:angular.noop;this.init=function(defaultItemsPerPage){$attrs.itemsPerPage?$scope.$parent.$watch($parse($attrs.itemsPerPage),function(value){self.itemsPerPage=parseInt(value,10),$scope.totalPages=self.calculateTotalPages()}):this.itemsPerPage=defaultItemsPerPage},this.noPrevious=function(){return 1===this.page},this.noNext=function(){return this.page===$scope.totalPages},this.isActive=function(page){return this.page===page},this.calculateTotalPages=function(){var totalPages=this.itemsPerPage<1?1:Math.ceil($scope.totalItems/this.itemsPerPage);return Math.max(totalPages||0,1)},this.getAttributeValue=function(attribute,defaultValue,interpolate){return angular.isDefined(attribute)?interpolate?$interpolate(attribute)($scope.$parent):$scope.$parent.$eval(attribute):defaultValue},this.render=function(){this.page=parseInt($scope.page,10)||1,this.page>0&&this.page<=$scope.totalPages&&($scope.pages=this.getPages(this.page,$scope.totalPages))},$scope.selectPage=function(page){!self.isActive(page)&&page>0&&page<=$scope.totalPages&&($scope.page=page,$scope.onSelectPage({page:page}))},$scope.$watch("page",function(){self.render()}),$scope.$watch("totalItems",function(){$scope.totalPages=self.calculateTotalPages()}),$scope.$watch("totalPages",function(value){setNumPages($scope.$parent,value),self.page>value?$scope.selectPage(value):self.render()})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function($parse,config){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &"},controller:"PaginationController",templateUrl:"template/pagination/pagination.html",replace:!0,link:function(scope,element,attrs,paginationCtrl){function makePage(number,text,isActive,isDisabled){return{number:number,text:text,active:isActive,disabled:isDisabled}}var maxSize,boundaryLinks=paginationCtrl.getAttributeValue(attrs.boundaryLinks,config.boundaryLinks),directionLinks=paginationCtrl.getAttributeValue(attrs.directionLinks,config.directionLinks),firstText=paginationCtrl.getAttributeValue(attrs.firstText,config.firstText,!0),previousText=paginationCtrl.getAttributeValue(attrs.previousText,config.previousText,!0),nextText=paginationCtrl.getAttributeValue(attrs.nextText,config.nextText,!0),lastText=paginationCtrl.getAttributeValue(attrs.lastText,config.lastText,!0),rotate=paginationCtrl.getAttributeValue(attrs.rotate,config.rotate);paginationCtrl.init(config.itemsPerPage),attrs.maxSize&&scope.$parent.$watch($parse(attrs.maxSize),function(value){maxSize=parseInt(value,10),paginationCtrl.render()}),paginationCtrl.getPages=function(currentPage,totalPages){var pages=[],startPage=1,endPage=totalPages,isMaxSized=angular.isDefined(maxSize)&&totalPages>maxSize;isMaxSized&&(rotate?(startPage=Math.max(currentPage-Math.floor(maxSize/2),1),endPage=startPage+maxSize-1,endPage>totalPages&&(endPage=totalPages,startPage=endPage-maxSize+1)):(startPage=(Math.ceil(currentPage/maxSize)-1)*maxSize+1,endPage=Math.min(startPage+maxSize-1,totalPages)));for(var number=startPage;endPage>=number;number++){var page=makePage(number,number,paginationCtrl.isActive(number),!1);pages.push(page)}if(isMaxSized&&!rotate){if(startPage>1){var previousPageSet=makePage(startPage-1,"...",!1,!1);pages.unshift(previousPageSet)}if(totalPages>endPage){var nextPageSet=makePage(endPage+1,"...",!1,!1);pages.push(nextPageSet)}}if(directionLinks){var previousPage=makePage(currentPage-1,previousText,!1,paginationCtrl.noPrevious());pages.unshift(previousPage);var nextPage=makePage(currentPage+1,nextText,!1,paginationCtrl.noNext());pages.push(nextPage)}if(boundaryLinks){var firstPage=makePage(1,firstText,!1,paginationCtrl.noPrevious());pages.unshift(firstPage);var lastPage=makePage(totalPages,lastText,!1,paginationCtrl.noNext());pages.push(lastPage)}return pages}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"\xab Previous",nextText:"Next \xbb",align:!0}).directive("pager",["pagerConfig",function(config){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &"},controller:"PaginationController",templateUrl:"template/pagination/pager.html",replace:!0,link:function(scope,element,attrs,paginationCtrl){function makePage(number,text,isDisabled,isPrevious,isNext){return{number:number,text:text,disabled:isDisabled,previous:align&&isPrevious,next:align&&isNext}}var previousText=paginationCtrl.getAttributeValue(attrs.previousText,config.previousText,!0),nextText=paginationCtrl.getAttributeValue(attrs.nextText,config.nextText,!0),align=paginationCtrl.getAttributeValue(attrs.align,config.align);paginationCtrl.init(config.itemsPerPage),paginationCtrl.getPages=function(currentPage){return[makePage(currentPage-1,previousText,paginationCtrl.noPrevious(),!0,!1),makePage(currentPage+1,nextText,paginationCtrl.noNext(),!1,!0)]}}}}]),angular.module("mm.foundation.tooltip",["mm.foundation.position","mm.foundation.bindHtml"]).provider("$tooltip",function(){function snake_case(name){var regexp=/[A-Z]/g,separator="-";return name.replace(regexp,function(letter,pos){return(pos?separator:"")+letter.toLowerCase()})}var defaultOptions={placement:"top",animation:!0,popupDelay:0},triggerMap={mouseenter:"mouseleave",click:"click",focus:"blur"},globalOptions={};this.options=function(value){angular.extend(globalOptions,value)},this.setTriggers=function(triggers){angular.extend(triggerMap,triggers)},this.$get=["$window","$compile","$timeout","$parse","$document","$position","$interpolate",function($window,$compile,$timeout,$parse,$document,$position,$interpolate){return function(type,prefix,defaultTriggerShow){function getTriggers(trigger){var show=trigger||options.trigger||defaultTriggerShow,hide=triggerMap[show]||show;return{show:show,hide:hide}}var options=angular.extend({},defaultOptions,globalOptions),directiveName=snake_case(type),startSym=$interpolate.startSymbol(),endSym=$interpolate.endSymbol(),template="<div "+directiveName+'-popup title="'+startSym+"tt_title"+endSym+'" content="'+startSym+"tt_content"+endSym+'" placement="'+startSym+"tt_placement"+endSym+'" animation="tt_animation" is-open="tt_isOpen"></div>';return{restrict:"EA",scope:!0,compile:function(){var tooltipLinker=$compile(template);return function(scope,element,attrs){function toggleTooltipBind(){scope.tt_isOpen?hideTooltipBind():showTooltipBind()}function showTooltipBind(){(!hasEnableExp||scope.$eval(attrs[prefix+"Enable"]))&&(scope.tt_popupDelay?(popupTimeout=$timeout(show,scope.tt_popupDelay,!1),popupTimeout.then(function(reposition){reposition()})):show()())}function hideTooltipBind(){scope.$apply(function(){hide()})}function show(){return scope.tt_content?(createTooltip(),transitionTimeout&&$timeout.cancel(transitionTimeout),tooltip.css({top:0,left:0,display:"block"}),appendToBody?$document.find("body").append(tooltip):element.after(tooltip),positionTooltip(),scope.tt_isOpen=!0,scope.$digest(),positionTooltip):angular.noop}function hide(){scope.tt_isOpen=!1,$timeout.cancel(popupTimeout),scope.tt_animation?transitionTimeout=$timeout(removeTooltip,500):removeTooltip()}function createTooltip(){tooltip&&removeTooltip(),tooltip=tooltipLinker(scope,function(){}),scope.$digest()}function removeTooltip(){tooltip&&(tooltip.remove(),tooltip=null)}var tooltip,transitionTimeout,popupTimeout,appendToBody=angular.isDefined(options.appendToBody)?options.appendToBody:!1,triggers=getTriggers(void 0),hasRegisteredTriggers=!1,hasEnableExp=angular.isDefined(attrs[prefix+"Enable"]),positionTooltip=function(){var position,ttWidth,ttHeight,ttPosition;switch(position=appendToBody?$position.offset(element):$position.position(element),ttWidth=tooltip.prop("offsetWidth"),ttHeight=tooltip.prop("offsetHeight"),scope.tt_placement){case"right":ttPosition={top:position.top+position.height/2-ttHeight/2,left:position.left+position.width+10};break;case"bottom":ttPosition={top:position.top+position.height+10,left:position.left};break;case"left":ttPosition={top:position.top+position.height/2-ttHeight/2,left:position.left-ttWidth-10};break;default:ttPosition={top:position.top-ttHeight-10,left:position.left}}ttPosition.top+="px",ttPosition.left+="px",tooltip.css(ttPosition)};scope.tt_isOpen=!1,attrs.$observe(type,function(val){scope.tt_content=val,!val&&scope.tt_isOpen&&hide()}),attrs.$observe(prefix+"Title",function(val){scope.tt_title=val}),attrs.$observe(prefix+"Placement",function(val){scope.tt_placement=angular.isDefined(val)?val:options.placement}),attrs.$observe(prefix+"PopupDelay",function(val){var delay=parseInt(val,10);scope.tt_popupDelay=isNaN(delay)?options.popupDelay:delay});var unregisterTriggers=function(){hasRegisteredTriggers&&(element.unbind(triggers.show,showTooltipBind),element.unbind(triggers.hide,hideTooltipBind))},unregisterTriggerFunction=function(){};attrs.$observe(prefix+"Trigger",function(val){unregisterTriggers(),unregisterTriggerFunction(),triggers=getTriggers(val),angular.isFunction(triggers.show)?unregisterTriggerFunction=scope.$watch(function(){return triggers.show(scope,element,attrs)},function(val){return $timeout(val?show:hide)}):triggers.show===triggers.hide?element.bind(triggers.show,toggleTooltipBind):(element.bind(triggers.show,showTooltipBind),element.bind(triggers.hide,hideTooltipBind)),hasRegisteredTriggers=!0});var animation=scope.$eval(attrs[prefix+"Animation"]);scope.tt_animation=angular.isDefined(animation)?!!animation:options.animation,attrs.$observe(prefix+"AppendToBody",function(val){appendToBody=angular.isDefined(val)?$parse(val)(scope):appendToBody}),appendToBody&&scope.$on("$locationChangeSuccess",function(){scope.tt_isOpen&&hide()}),scope.$on("$destroy",function(){$timeout.cancel(transitionTimeout),$timeout.cancel(popupTimeout),unregisterTriggers(),unregisterTriggerFunction(),removeTooltip()})}}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function($tooltip){return $tooltip("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function($tooltip){return $tooltip("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("mm.foundation.popover",["mm.foundation.tooltip"]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$tooltip",function($tooltip){return $tooltip("popover","popover","click")}]),angular.module("mm.foundation.progressbar",["mm.foundation.transition"]).constant("progressConfig",{animate:!0,max:100}).controller("ProgressController",["$scope","$attrs","progressConfig","$transition",function($scope,$attrs,progressConfig,$transition){var self=this,bars=[],max=angular.isDefined($attrs.max)?$scope.$parent.$eval($attrs.max):progressConfig.max,animate=angular.isDefined($attrs.animate)?$scope.$parent.$eval($attrs.animate):progressConfig.animate;this.addBar=function(bar,element){var oldValue=0,index=bar.$parent.$index;angular.isDefined(index)&&bars[index]&&(oldValue=bars[index].value),bars.push(bar),this.update(element,bar.value,oldValue),bar.$watch("value",function(value,oldValue){value!==oldValue&&self.update(element,value,oldValue)}),bar.$on("$destroy",function(){self.removeBar(bar)})},this.update=function(element,newValue,oldValue){var percent=this.getPercentage(newValue);animate?(element.css("width",this.getPercentage(oldValue)+"%"),$transition(element,{width:percent+"%"})):element.css({transition:"none",width:percent+"%"})},this.removeBar=function(bar){bars.splice(bars.indexOf(bar),1)},this.getPercentage=function(value){return Math.round(100*value/max)}}]).directive("progress",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",require:"progress",scope:{},template:'<div class="progress" ng-transclude></div>'}}).directive("bar",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"^progress",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/bar.html",link:function(scope,element,attrs,progressCtrl){progressCtrl.addBar(scope,element)}}}).directive("progressbar",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/progressbar.html",link:function(scope,element,attrs,progressCtrl){progressCtrl.addBar(scope,angular.element(element.children()[0]))}}}),angular.module("mm.foundation.rating",[]).constant("ratingConfig",{max:5,stateOn:null,stateOff:null}).controller("RatingController",["$scope","$attrs","$parse","ratingConfig",function($scope,$attrs,$parse,ratingConfig){this.maxRange=angular.isDefined($attrs.max)?$scope.$parent.$eval($attrs.max):ratingConfig.max,this.stateOn=angular.isDefined($attrs.stateOn)?$scope.$parent.$eval($attrs.stateOn):ratingConfig.stateOn,this.stateOff=angular.isDefined($attrs.stateOff)?$scope.$parent.$eval($attrs.stateOff):ratingConfig.stateOff,this.createRateObjects=function(states){for(var defaultOptions={stateOn:this.stateOn,stateOff:this.stateOff},i=0,n=states.length;n>i;i++)states[i]=angular.extend({index:i},defaultOptions,states[i]);return states},$scope.range=this.createRateObjects(angular.isDefined($attrs.ratingStates)?angular.copy($scope.$parent.$eval($attrs.ratingStates)):new Array(this.maxRange)),$scope.rate=function(value){$scope.value===value||$scope.readonly||($scope.value=value)},$scope.enter=function(value){$scope.readonly||($scope.val=value),$scope.onHover({value:value})},$scope.reset=function(){$scope.val=angular.copy($scope.value),$scope.onLeave()},$scope.$watch("value",function(value){$scope.val=value}),$scope.readonly=!1,$attrs.readonly&&$scope.$parent.$watch($parse($attrs.readonly),function(value){$scope.readonly=!!value})}]).directive("rating",function(){return{restrict:"EA",scope:{value:"=",onHover:"&",onLeave:"&"},controller:"RatingController",templateUrl:"template/rating/rating.html",replace:!0}}),angular.module("mm.foundation.tabs",[]).controller("TabsetController",["$scope",function($scope){var ctrl=this,tabs=ctrl.tabs=$scope.tabs=[];ctrl.select=function(tab){angular.forEach(tabs,function(tab){tab.active=!1}),tab.active=!0},ctrl.addTab=function(tab){tabs.push(tab),(1===tabs.length||tab.active)&&ctrl.select(tab)},ctrl.removeTab=function(tab){var index=tabs.indexOf(tab);if(tab.active&&tabs.length>1){var newActiveIndex=index==tabs.length-1?index-1:index+1;ctrl.select(tabs[newActiveIndex])}tabs.splice(index,1)}}]).directive("tabset",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{},controller:"TabsetController",templateUrl:"template/tabs/tabset.html",link:function(scope,element,attrs){scope.vertical=angular.isDefined(attrs.vertical)?scope.$parent.$eval(attrs.vertical):!1,scope.justified=angular.isDefined(attrs.justified)?scope.$parent.$eval(attrs.justified):!1,scope.type=angular.isDefined(attrs.type)?scope.$parent.$eval(attrs.type):"tabs"}}}).directive("tab",["$parse",function($parse){return{require:"^tabset",restrict:"EA",replace:!0,templateUrl:"template/tabs/tab.html",transclude:!0,scope:{heading:"@",onSelect:"&select",onDeselect:"&deselect"},controller:function(){},compile:function(elm,attrs,transclude){return function(scope,elm,attrs,tabsetCtrl){var getActive,setActive;attrs.active?(getActive=$parse(attrs.active),setActive=getActive.assign,scope.$parent.$watch(getActive,function(value,oldVal){value!==oldVal&&(scope.active=!!value)}),scope.active=getActive(scope.$parent)):setActive=getActive=angular.noop,scope.$watch("active",function(active){setActive(scope.$parent,active),active?(tabsetCtrl.select(scope),scope.onSelect()):scope.onDeselect()}),scope.disabled=!1,attrs.disabled&&scope.$parent.$watch($parse(attrs.disabled),function(value){scope.disabled=!!value}),scope.select=function(){scope.disabled||(scope.active=!0)},tabsetCtrl.addTab(scope),scope.$on("$destroy",function(){tabsetCtrl.removeTab(scope)}),scope.$transcludeFn=transclude}}}}]).directive("tabHeadingTransclude",[function(){return{restrict:"A",require:"^tab",link:function(scope,elm){scope.$watch("headingElement",function(heading){heading&&(elm.html(""),elm.append(heading))})}}}]).directive("tabContentTransclude",function(){function isTabHeading(node){return node.tagName&&(node.hasAttribute("tab-heading")||node.hasAttribute("data-tab-heading")||"tab-heading"===node.tagName.toLowerCase()||"data-tab-heading"===node.tagName.toLowerCase())}return{restrict:"A",require:"^tabset",link:function(scope,elm,attrs){var tab=scope.$eval(attrs.tabContentTransclude);tab.$transcludeFn(tab.$parent,function(contents){angular.forEach(contents,function(node){isTabHeading(node)?tab.headingElement=node:elm.append(node)})})}}}),angular.module("mm.foundation.tour",["mm.foundation.position","mm.foundation.tooltip"]).service("$tour",["$window",function($window){function getCurrentStep(){return parseInt($window.localStorage.getItem("mm.tour.step"),10)}function setCurrentStep(step){currentIndex=step,$window.localStorage.setItem("mm.tour.step",step)}var currentIndex=getCurrentStep(),steps={};this.add=function(index,attrs){steps[index]=attrs},this.has=function(index){return!!steps[index]},this.isActive=function(){return currentIndex>0},this.current=function(index){return index?void setCurrentStep(currentIndex):currentIndex},this.start=function(){setCurrentStep(1)},this.next=function(){setCurrentStep(currentIndex+1)},this.end=function(){setCurrentStep(0)}}]).directive("stepPopup",["$tour",function($tour){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tour/tour.html",link:function(scope,element){scope.isLastStep=function(){return!$tour.has($tour.current()+1)},scope.endTour=function(){element.remove(),$tour.end()},scope.nextStep=function(){element.remove(),$tour.next()}}}}]).directive("step",["$position","$tooltip","$tour","$window",function($position,$tooltip,$tour,$window){function isElementInViewport(element){var rect=element[0].getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=$window.innerHeight-80&&rect.right<=$window.innerWidth}function show(scope,element,attrs){var index=parseInt(attrs.stepIndex,10);if($tour.isActive()&&index&&($tour.add(index,attrs),index===$tour.current())){if(!isElementInViewport(element)){var offset=$position.offset(element);$window.scrollTo(0,offset.top-$window.innerHeight/2)}return!0}return!1}return $tooltip("step","step",show)}]),angular.module("mm.foundation.typeahead",["mm.foundation.position","mm.foundation.bindHtml"]).factory("typeaheadParser",["$parse",function($parse){var TYPEAHEAD_REGEXP=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(input){var match=input.match(TYPEAHEAD_REGEXP);if(!match)throw new Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+input+"'.");return{itemName:match[3],source:$parse(match[4]),viewMapper:$parse(match[2]||match[1]),modelMapper:$parse(match[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function($compile,$parse,$q,$timeout,$document,$position,typeaheadParser){var HOT_KEYS=[9,13,27,38,40];return{require:"ngModel",link:function(originalScope,element,attrs,modelCtrl){var hasFocus,minSearch=originalScope.$eval(attrs.typeaheadMinLength)||1,waitTime=originalScope.$eval(attrs.typeaheadWaitMs)||0,isEditable=originalScope.$eval(attrs.typeaheadEditable)!==!1,isLoadingSetter=$parse(attrs.typeaheadLoading).assign||angular.noop,onSelectCallback=$parse(attrs.typeaheadOnSelect),inputFormatter=attrs.typeaheadInputFormatter?$parse(attrs.typeaheadInputFormatter):void 0,appendToBody=attrs.typeaheadAppendToBody?$parse(attrs.typeaheadAppendToBody):!1,$setModelValue=$parse(attrs.ngModel).assign,parserResult=typeaheadParser.parse(attrs.typeahead),popUpEl=angular.element("<div typeahead-popup></div>");popUpEl.attr({matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position"}),angular.isDefined(attrs.typeaheadTemplateUrl)&&popUpEl.attr("template-url",attrs.typeaheadTemplateUrl);var scope=originalScope.$new();originalScope.$on("$destroy",function(){scope.$destroy()});var resetMatches=function(){scope.matches=[],scope.activeIdx=-1},getMatchesAsync=function(inputValue){var locals={$viewValue:inputValue};isLoadingSetter(originalScope,!0),$q.when(parserResult.source(originalScope,locals)).then(function(matches){if(inputValue===modelCtrl.$viewValue&&hasFocus){if(matches.length>0){scope.activeIdx=0,scope.matches.length=0;for(var i=0;i<matches.length;i++)locals[parserResult.itemName]=matches[i],scope.matches.push({label:parserResult.viewMapper(scope,locals),model:matches[i]});scope.query=inputValue,scope.position=appendToBody?$position.offset(element):$position.position(element),scope.position.top=scope.position.top+element.prop("offsetHeight")}else resetMatches();isLoadingSetter(originalScope,!1)}},function(){resetMatches(),isLoadingSetter(originalScope,!1)})};resetMatches(),scope.query=void 0;var timeoutPromise;modelCtrl.$parsers.unshift(function(inputValue){return hasFocus=!0,inputValue&&inputValue.length>=minSearch?waitTime>0?(timeoutPromise&&$timeout.cancel(timeoutPromise),timeoutPromise=$timeout(function(){getMatchesAsync(inputValue)},waitTime)):getMatchesAsync(inputValue):(isLoadingSetter(originalScope,!1),resetMatches()),isEditable?inputValue:inputValue?void modelCtrl.$setValidity("editable",!1):(modelCtrl.$setValidity("editable",!0),inputValue)}),modelCtrl.$formatters.push(function(modelValue){var candidateViewValue,emptyViewValue,locals={};return inputFormatter?(locals.$model=modelValue,inputFormatter(originalScope,locals)):(locals[parserResult.itemName]=modelValue,candidateViewValue=parserResult.viewMapper(originalScope,locals),locals[parserResult.itemName]=void 0,emptyViewValue=parserResult.viewMapper(originalScope,locals),candidateViewValue!==emptyViewValue?candidateViewValue:modelValue)}),scope.select=function(activeIdx){var model,item,locals={};locals[parserResult.itemName]=item=scope.matches[activeIdx].model,model=parserResult.modelMapper(originalScope,locals),$setModelValue(originalScope,model),modelCtrl.$setValidity("editable",!0),onSelectCallback(originalScope,{$item:item,$model:model,$label:parserResult.viewMapper(originalScope,locals)}),resetMatches(),element[0].focus()
},element.bind("keydown",function(evt){0!==scope.matches.length&&-1!==HOT_KEYS.indexOf(evt.which)&&(evt.preventDefault(),40===evt.which?(scope.activeIdx=(scope.activeIdx+1)%scope.matches.length,scope.$digest()):38===evt.which?(scope.activeIdx=(scope.activeIdx?scope.activeIdx:scope.matches.length)-1,scope.$digest()):13===evt.which||9===evt.which?scope.$apply(function(){scope.select(scope.activeIdx)}):27===evt.which&&(evt.stopPropagation(),resetMatches(),scope.$digest()))}),element.bind("blur",function(){hasFocus=!1});var dismissClickHandler=function(evt){element[0]!==evt.target&&(resetMatches(),scope.$digest())};$document.bind("click",dismissClickHandler),originalScope.$on("$destroy",function(){$document.unbind("click",dismissClickHandler)});var $popup=$compile(popUpEl)(scope);appendToBody?$document.find("body").append($popup):element.after($popup)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead-popup.html",link:function(scope,element,attrs){scope.templateUrl=attrs.templateUrl,scope.isOpen=function(){return scope.matches.length>0},scope.isActive=function(matchIdx){return scope.active==matchIdx},scope.selectActive=function(matchIdx){scope.active=matchIdx},scope.selectMatch=function(activeIdx){scope.select({activeIdx:activeIdx})}}}}).directive("typeaheadMatch",["$http","$templateCache","$compile","$parse",function($http,$templateCache,$compile,$parse){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(scope,element,attrs){var tplUrl=$parse(attrs.templateUrl)(scope.$parent)||"template/typeahead/typeahead-match.html";$http.get(tplUrl,{cache:$templateCache}).success(function(tplContent){element.replaceWith($compile(tplContent.trim())(scope))})}}}]).filter("typeaheadHighlight",function(){function escapeRegexp(queryToEscape){return queryToEscape.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(matchItem,query){return query?matchItem.replace(new RegExp(escapeRegexp(query),"gi"),"<strong>$&</strong>"):matchItem}}),angular.module("template/accordion/accordion-group.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/accordion/accordion-group.html",'<dd>\n  <a ng-click="isOpen = !isOpen" accordion-transclude="heading">{{heading}}</a>\n  <div class="content" ng-style="isOpen ? {display: \'block\'} : {}" ng-transclude></div>\n</dd>\n')}]),angular.module("template/accordion/accordion.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/accordion/accordion.html",'<dl class="accordion" ng-transclude></div>\n')}]),angular.module("template/alert/alert.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/alert/alert.html","<div class='alert-box' ng-class='(type || \"\")'>\n  <span ng-transclude></span>\n  <a ng-show='closeable' class='close' ng-click='close()'>&times;</a>\n</div>\n")}]),angular.module("template/modal/backdrop.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/modal/backdrop.html",'<div class="reveal-modal-bg fade" ng-class="{in: animate}" ng-click="close($event)" style="display: block"></div>\n')}]),angular.module("template/modal/window.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/modal/window.html",'<div tabindex="-1" class="reveal-modal fade {{ windowClass }}"\n  ng-class="{in: animate}" ng-click="close($event)"\n  style="display: block; position: fixed; visibility: visible">\n  <div ng-transclude></div>\n</div>\n')}]),angular.module("template/pagination/pager.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pager.html",'<ul class="pagination">\n  <li ng-repeat="page in pages" class="arrow" ng-class="{unavailable: page.disabled, left: page.previous, right: page.next}"><a ng-click="selectPage(page.number)">{{page.text}}</a></li>\n</ul>\n')}]),angular.module("template/pagination/pagination.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pagination.html",'<ul class="pagination">\n  <li ng-repeat="page in pages" ng-class="{arrow: $first || $last, current: page.active, unavailable: page.disabled}"><a ng-click="selectPage(page.number)">{{page.text}}</a></li>\n</ul>\n')}]),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-html-unsafe-popup.html",'<span class="tooltip tip-{{placement}}"\n  ng-class="{ in: isOpen(), fade: animation() }"\n  style="width: auto">\n  <span bind-html-unsafe="content"></span>\n  <span class="nub"></span>\n</span>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-popup.html",'<span class="tooltip tip-{{placement}}"\n  ng-class="{ in: isOpen(), fade: animation() }"\n  style="width: auto">\n  <span ng-bind="content"></span>\n  <span class="nub"></span>\n</span>\n')}]),angular.module("template/popover/popover.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover.html",'<div class="joyride-tip-guide" ng-class="{ in: isOpen(), fade: animation() }">\n  <span class="joyride-nub" ng-class="{\n    bottom: placement === \'top\',\n    left: placement === \'right\',\n    right: placement === \'left\',\n    top: placement === \'bottom\'\n  }"></span>\n  <div class="joyride-content-wrapper">\n    <h4 ng-bind="title" ng-show="title"></h4>\n    <p ng-bind="content"></p>\n  </div>\n</div>\n')}]),angular.module("template/progressbar/bar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/bar.html",'<span class="meter" ng-transclude></span>\n')}]),angular.module("template/progressbar/progress.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/progress.html",'<div class="progress" ng-class="type" ng-transclude></div>\n')}]),angular.module("template/progressbar/progressbar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/progressbar.html",'<div class="progress" ng-class="type">\n  <span class="meter" ng-transclude></span>\n</div>\n')}]),angular.module("template/rating/rating.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/rating/rating.html",'<span ng-mouseleave="reset()">\n  <i ng-repeat="r in range" ng-mouseenter="enter($index + 1)" ng-click="rate($index + 1)" class="fa"\n    ng-class="$index < val && (r.stateOn || \'fa-star\') || (r.stateOff || \'fa-star-o\')"></i>\n</span>\n')}]),angular.module("template/tabs/tab.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tabs/tab.html",'<dd ng-class="{active: active}">\n  <a ng-click="select()" tab-heading-transclude>{{heading}}</a>\n</dd>\n')}]),angular.module("template/tabs/tabset.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tabs/tabset.html",'<div class="tabbable">\n  <dl class="tabs" ng-class="{\'vertical\': vertical}" ng-transclude></dl>\n  <div class="tabs-content">\n    <div class="content" \n      ng-repeat="tab in tabs" \n      ng-class="{active: tab.active}">\n      <div tab-content-transclude="tab"></div>\n    </div>\n  </div>\n</div>\n')}]),angular.module("template/tour/tour.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tour/tour.html",'<div class="joyride-tip-guide" ng-class="{ in: isOpen(), fade: animation() }">\n  <span class="joyride-nub" ng-class="{\n    bottom: placement === \'top\',\n    left: placement === \'right\',\n    right: placement === \'left\',\n    top: placement === \'bottom\'\n  }"></span>\n  <div class="joyride-content-wrapper">\n    <h4 ng-bind="title" ng-show="title"></h4>\n    <p ng-bind="content"></p>\n    <a class="small button joyride-next-tip" ng-show="!isLastStep()" ng-click="nextStep()">Next</a>\n    <a class="small button joyride-next-tip" ng-show="isLastStep()" ng-click="endTour()">End</a>\n    <a class="joyride-close-tip" ng-click="endTour()">&times;</a>\n  </div>\n</div>\n')}]),angular.module("template/typeahead/typeahead-match.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/typeahead/typeahead-match.html",'<a tabindex="-1" bind-html-unsafe="match.label | typeaheadHighlight:query"></a>')}]),angular.module("template/typeahead/typeahead-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/typeahead/typeahead-popup.html","<ul class=\"f-dropdown\" ng-style=\"{display: isOpen()&&'block' || 'none', top: position.top+'px', left: position.left+'px'}\">\n"+'    <li ng-repeat="match in matches" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)">\n        <div typeahead-match index="$index" match="match" query="query" template-url="templateUrl"></div>\n    </li>\n</ul>\n')}]),function(root,factory){"use strict";"function"==typeof define&&define.amd?define(["angular"],factory):"object"==typeof exports?module.exports=factory(require("angular")):factory(root.angular)}(this,function(angular){"use strict";function _storageProvider(storageType){return function(){var storageKeyPrefix="ngStorage-";this.setKeyPrefix=function(prefix){if("string"!=typeof prefix)throw new TypeError("[ngStorage] - "+storageType+"Provider.setKeyPrefix() expects a String.");storageKeyPrefix=prefix};var serializer=angular.toJson,deserializer=angular.fromJson;this.setSerializer=function(s){if("function"!=typeof s)throw new TypeError("[ngStorage] - "+storageType+"Provider.setSerializer expects a function.");serializer=s},this.setDeserializer=function(d){if("function"!=typeof d)throw new TypeError("[ngStorage] - "+storageType+"Provider.setDeserializer expects a function.");deserializer=d},this.get=function(key){return deserializer(window[storageType].getItem(storageKeyPrefix+key))},this.set=function(key,value){return window[storageType].setItem(storageKeyPrefix+key,serializer(value))},this.$get=["$rootScope","$window","$log","$timeout",function($rootScope,$window,$log,$timeout){function isStorageSupported(storageType){var supported;try{supported=$window[storageType]}catch(err){supported=!1}if(supported&&"localStorage"===storageType){var key="__"+Math.round(1e7*Math.random());try{localStorage.setItem(key,key),localStorage.removeItem(key)}catch(err){supported=!1}}return supported}var _last$storage,_debounce,prefixLength=storageKeyPrefix.length,webStorage=isStorageSupported(storageType)||($log.warn("This browser does not support Web Storage!"),{setItem:angular.noop,getItem:angular.noop}),$storage={$default:function(items){for(var k in items)angular.isDefined($storage[k])||($storage[k]=items[k]);return $storage.$sync(),$storage},$reset:function(items){for(var k in $storage)"$"===k[0]||delete $storage[k]&&webStorage.removeItem(storageKeyPrefix+k);return $storage.$default(items)},$sync:function(){for(var k,i=0,l=webStorage.length;l>i;i++)(k=webStorage.key(i))&&storageKeyPrefix===k.slice(0,prefixLength)&&($storage[k.slice(prefixLength)]=deserializer(webStorage.getItem(k)))},$apply:function(){var temp$storage;if(_debounce=null,!angular.equals($storage,_last$storage)){temp$storage=angular.copy(_last$storage),angular.forEach($storage,function(v,k){angular.isDefined(v)&&"$"!==k[0]&&(webStorage.setItem(storageKeyPrefix+k,serializer(v)),delete temp$storage[k])});for(var k in temp$storage)webStorage.removeItem(storageKeyPrefix+k);_last$storage=angular.copy($storage)}}};return $storage.$sync(),_last$storage=angular.copy($storage),$rootScope.$watch(function(){_debounce||(_debounce=$timeout($storage.$apply,100,!1))}),$window.addEventListener&&$window.addEventListener("storage",function(event){storageKeyPrefix===event.key.slice(0,prefixLength)&&(event.newValue?$storage[event.key.slice(prefixLength)]=deserializer(event.newValue):delete $storage[event.key.slice(prefixLength)],_last$storage=angular.copy($storage),$rootScope.$apply())}),$window.addEventListener&&$window.addEventListener("beforeunload",function(){$storage.$apply()}),$storage}]}}return angular=angular&&angular.module?angular:window.angular,angular.module("ngStorage",[]).provider("$localStorage",_storageProvider("localStorage")).provider("$sessionStorage",_storageProvider("sessionStorage"))}),function(){var AngularFire,AngularFireAuth;angular.module("firebase",[]).value("Firebase",Firebase),angular.module("firebase").provider("$firebase",function(){var self=this;self.$get=["$q","$parse","$timeout",function($q,$parse,$timeout){return function(ref){var af=new AngularFire($q,$parse,$timeout,self.extend,ref);return af.construct()}}]}),angular.module("firebase").filter("orderByPriority",function(){return function(input){var sorted=[];if(input)if(input.$getIndex&&"function"==typeof input.$getIndex){var index=input.$getIndex();if(index.length>0)for(var i=0;i<index.length;i++){var val=input[index[i]];val&&(angular.isObject(val)&&(val.$id=index[i]),sorted.push(val))}}else angular.isArray(input)?sorted=input.slice(0):angular.isObject(input)&&angular.forEach(input,function(prop){sorted.push(prop)});return sorted}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement,fromIndex){if(void 0===this||null===this)throw new TypeError("'this' is null or not defined");var length=this.length>>>0;for(fromIndex=+fromIndex||0,1/0===Math.abs(fromIndex)&&(fromIndex=0),0>fromIndex&&(fromIndex+=length,0>fromIndex&&(fromIndex=0));length>fromIndex;fromIndex++)if(this[fromIndex]===searchElement)return fromIndex;return-1}),AngularFire=function($q,$parse,$timeout,fns,ref){if(this._q=$q,this._parse=$parse,this._timeout=$timeout,this._bound=!1,this._loaded=!1,this._index=[],this._on={value:[],change:[],loaded:[],child_added:[],child_moved:[],child_changed:[],child_removed:[]},"string"==typeof ref)throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");this._fRef=ref,this._fns=fns},AngularFire.prototype={construct:function(){var self=this,object={};return object.$id=self._fRef.ref().name(),object.$bind=function(scope,name,defaultFn){return self._bind(scope,name,defaultFn)},object.$add=function(item){function _addCb(err){err?deferred.reject(err):deferred.resolve(ref)}var ref,deferred=self._q.defer();return ref="object"==typeof item?self._fRef.ref().push(self._parseObject(item),_addCb):self._fRef.ref().push(item,_addCb),deferred.promise},object.$save=function(key){function _saveCb(err){err?deferred.reject(err):deferred.resolve()}var deferred=self._q.defer();if(key){var obj=self._parseObject(self._object[key]);self._fRef.ref().child(key).set(obj,_saveCb)}else self._fRef.ref().set(self._parseObject(self._object),_saveCb);return deferred.promise},object.$set=function(newValue){var deferred=self._q.defer();return self._fRef.ref().set(self._parseObject(newValue),function(err){err?deferred.reject(err):deferred.resolve()}),deferred.promise},object.$update=function(newValue){var deferred=self._q.defer();return self._fRef.ref().update(self._parseObject(newValue),function(err){err?deferred.reject(err):deferred.resolve()}),deferred.promise},object.$transaction=function(updateFn,applyLocally){var deferred=self._q.defer();return self._fRef.ref().transaction(updateFn,function(err,committed,snapshot){err?deferred.reject(err):deferred.resolve(committed?snapshot:null)},applyLocally),deferred.promise},object.$remove=function(key){function _removeCb(err){err?deferred.reject(err):deferred.resolve()}var deferred=self._q.defer();return key?self._fRef.ref().child(key).remove(_removeCb):self._fRef.ref().remove(_removeCb),deferred.promise},object.$child=function(key){var af=new AngularFire(self._q,self._parse,self._timeout,self._fns,self._fRef.ref().child(key));return af.construct()},object.$on=function(type,callback){if(!self._on.hasOwnProperty(type))throw new Error("Invalid event type "+type+" specified");return self._sendInitEvent(type,callback),"loaded"===type&&this._loaded||self._on[type].push(callback),object},object.$off=function(type,callback){if(self._on.hasOwnProperty(type))if(callback){var index=self._on[type].indexOf(callback);-1!==index&&self._on[type].splice(index,1)}else self._on[type]=[];else self._fRef.off()},object.$auth=function(token){var deferred=self._q.defer();return self._fRef.auth(token,function(err,obj){null!==err?deferred.reject(err):deferred.resolve(obj)},function(rej){deferred.reject(rej)}),deferred.promise},object.$getIndex=function(){return angular.copy(self._index)},object.$getRef=function(){return self._fRef.ref()},self._fns&&angular.forEach(self._fns,function(fn,name){object[name]=fn}),self._object=object,self._getInitialValue(),self._object},_getInitialValue:function(){function _processSnapshot(snapshot,prevChild){var key=snapshot.name(),val=snapshot.val(),curIdx=self._index.indexOf(key);if(-1!==curIdx&&self._index.splice(curIdx,1),prevChild){var prevIdx=self._index.indexOf(prevChild);self._index.splice(prevIdx+1,0,key)}else self._index.unshift(key);_isPrimitive(val)||null===snapshot.getPriority()||(val.$priority=snapshot.getPriority()),self._updateModel(key,val)}function _handleAndBroadcastEvent(type,handler){return function(snapshot,prevChild){handler(snapshot,prevChild),self._broadcastEvent(type,self._makeEventSnapshot(snapshot.name(),snapshot.val(),prevChild))}}function _handleFirebaseEvent(type,handler){self._fRef.on(type,_handleAndBroadcastEvent(type,handler))}function _isPrimitive(v){return null===v||"object"!=typeof v}function _initialLoad(value){self._loaded=!0,self._broadcastEvent("loaded",value)}function handleNullValues(value){if(self._bound&&null===value){var local=self._parseObject(self._parse(self._name)(self._scope));switch(typeof local){case"string":case"undefined":value="";break;case"number":value=0;break;case"boolean":value=!1}}return value}var self=this;_handleFirebaseEvent("child_added",_processSnapshot),_handleFirebaseEvent("child_moved",_processSnapshot),_handleFirebaseEvent("child_changed",_processSnapshot),_handleFirebaseEvent("child_removed",function(snapshot){var key=snapshot.name(),idx=self._index.indexOf(key);self._index.splice(idx,1),self._updateModel(key,null)}),self._fRef.on("value",function(snap){var value=snap.val();_isPrimitive(value)?(value=handleNullValues(value),self._updatePrimitive(value)):delete self._object.$value,self._broadcastEvent("value",self._makeEventSnapshot(snap.name(),value)),self._loaded||_initialLoad(value)})},_updateModel:function(key,value){null==value?delete this._object[key]:this._object[key]=value,this._broadcastEvent("change",key),this._triggerModelUpdate()},_triggerModelUpdate:function(){if(!this._runningTimer){var self=this;this._runningTimer=self._timeout(function(){if(self._runningTimer=null,self._bound){var current=self._object,local=self._parse(self._name)(self._scope);angular.equals(current,local)||self._parse(self._name).assign(self._scope,angular.copy(current))}})}},_updatePrimitive:function(value){var self=this;self._timeout(function(){if(self._object.$value&&angular.equals(self._object.$value,value)||(self._object.$value=value),self._broadcastEvent("change"),self._bound){var local=self._parseObject(self._parse(self._name)(self._scope));angular.equals(local,value)||self._parse(self._name).assign(self._scope,value)}})},_broadcastEvent:function(evt,param){function _wrapTimeout(cb,param){self._timeout(function(){cb(param)})}var cbs=this._on[evt]||[];"loaded"===evt&&(this._on[evt]=[]);var self=this;if(cbs.length>0)for(var i=0;i<cbs.length;i++)"function"==typeof cbs[i]&&_wrapTimeout(cbs[i],param)},_sendInitEvent:function(evt,callback){var self=this;self._loaded&&["child_added","loaded","value"].indexOf(evt)>-1&&self._timeout(function(){var parsedValue=self._object.hasOwnProperty("$value")?self._object.$value:self._parseObject(self._object);switch(evt){case"loaded":callback(parsedValue);break;case"value":callback(self._makeEventSnapshot(self._fRef.name(),parsedValue,null));break;case"child_added":self._iterateChildren(parsedValue,function(name,val,prev){callback(self._makeEventSnapshot(name,val,prev))})}})},_iterateChildren:function(data,callback){if(this._loaded&&angular.isObject(data)){var prev=null;for(var key in data)data.hasOwnProperty(key)&&(callback(key,data[key],prev),prev=key)}},_makeEventSnapshot:function(key,value,prevChild){return angular.isUndefined(prevChild)&&(prevChild=null),{snapshot:{name:key,value:value},prevChild:prevChild}},_bind:function(scope,name,defaultFn){var self=this,deferred=self._q.defer();self._name=name,self._bound=!0,self._scope=scope;var local=self._parse(name)(scope);void 0!==local&&"object"==typeof local&&self._fRef.ref().update(self._parseObject(local)),scope.$on("$destroy",function(){unbind()}),self._object.$on("loaded",function(value){self._timeout(function(){scope[name]=null===value&&"function"==typeof defaultFn?defaultFn():value,deferred.resolve(unbind)})});var unbind=scope.$watch(name,function(){var local=self._parseObject(self._parse(name)(scope));void 0!==self._object.$value&&angular.equals(local,self._object.$value)||angular.equals(local,self._parseObject(self._object))||void 0!==local&&self._loaded&&(self._fRef.set?self._fRef.set(local):self._fRef.ref().update(local))},!0);return deferred.promise},_parseObject:function(obj){function _findReplacePriority(item){for(var prop in item)item.hasOwnProperty(prop)&&("$priority"==prop?(item[".priority"]=item.$priority,delete item.$priority):"object"==typeof item[prop]&&_findReplacePriority(item[prop]));return item}var newObj=_findReplacePriority(angular.copy(obj));return angular.fromJson(angular.toJson(newObj))}},angular.module("firebase").factory("$firebaseSimpleLogin",["$q","$timeout","$rootScope",function($q,$t,$rs){return function(ref){var auth=new AngularFireAuth($q,$t,$rs,ref);return auth.construct()}}]),AngularFireAuth=function($q,$t,$rs,ref){if(this._q=$q,this._timeout=$t,this._rootScope=$rs,this._loginDeferred=null,this._getCurrentUserDeferred=[],this._currentUserData=void 0,"string"==typeof ref)throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");this._fRef=ref},AngularFireAuth.prototype={construct:function(){var object={user:null,$login:this.login.bind(this),$logout:this.logout.bind(this),$createUser:this.createUser.bind(this),$changePassword:this.changePassword.bind(this),$removeUser:this.removeUser.bind(this),$getCurrentUser:this.getCurrentUser.bind(this),$sendPasswordResetEmail:this.sendPasswordResetEmail.bind(this)};if(this._object=object,!window.FirebaseSimpleLogin){var err=new Error("FirebaseSimpleLogin is undefined. Did you forget to include firebase-simple-login.js?");throw this._rootScope.$broadcast("$firebaseSimpleLogin:error",err),err}var client=new FirebaseSimpleLogin(this._fRef,this._onLoginEvent.bind(this));return this._authClient=client,this._object},login:function(provider,options){var deferred=this._q.defer(),self=this;return this.getCurrentUser().then(function(){self._loginDeferred=deferred,self._authClient.login(provider,options)}),deferred.promise},logout:function(){this._authClient.logout(),delete this._currentUserData},createUser:function(email,password){var self=this,deferred=this._q.defer();return self._authClient.createUser(email,password,function(err,user){err?(self._rootScope.$broadcast("$firebaseSimpleLogin:error",err),deferred.reject(err)):deferred.resolve(user)}),deferred.promise},changePassword:function(email,oldPassword,newPassword){var self=this,deferred=this._q.defer();return self._authClient.changePassword(email,oldPassword,newPassword,function(err){err?(self._rootScope.$broadcast("$firebaseSimpleLogin:error",err),deferred.reject(err)):deferred.resolve()}),deferred.promise},getCurrentUser:function(){var self=this,deferred=this._q.defer();return void 0!==self._currentUserData?deferred.resolve(self._currentUserData):self._getCurrentUserDeferred.push(deferred),deferred.promise},removeUser:function(email,password){var self=this,deferred=this._q.defer();return self._authClient.removeUser(email,password,function(err){err?(self._rootScope.$broadcast("$firebaseSimpleLogin:error",err),deferred.reject(err)):deferred.resolve()}),deferred.promise},sendPasswordResetEmail:function(email){var self=this,deferred=this._q.defer();return self._authClient.sendPasswordResetEmail(email,function(err){err?(self._rootScope.$broadcast("$firebaseSimpleLogin:error",err),deferred.reject(err)):deferred.resolve()}),deferred.promise},_onLoginEvent:function(err,user){if(this._currentUserData!==user||null!==err){var self=this;err?(self._loginDeferred&&(self._loginDeferred.reject(err),self._loginDeferred=null),self._rootScope.$broadcast("$firebaseSimpleLogin:error",err)):(this._currentUserData=user,self._timeout(function(){for(self._object.user=user,user?self._rootScope.$broadcast("$firebaseSimpleLogin:login",user):self._rootScope.$broadcast("$firebaseSimpleLogin:logout"),self._loginDeferred&&(self._loginDeferred.resolve(user),self._loginDeferred=null);self._getCurrentUserDeferred.length>0;){var def=self._getCurrentUserDeferred.pop();def.resolve(user)}}))}}}}(),function(){"use strict";function angularMoment(angular,moment){return angular.module("angularMoment",[]).constant("angularMomentConfig",{preprocess:null,timezone:""}).constant("moment",moment).constant("amTimeAgoConfig",{withoutSuffix:!1}).directive("amTimeAgo",["$window","moment","amMoment","amTimeAgoConfig","angularMomentConfig",function($window,moment,amMoment,amTimeAgoConfig,angularMomentConfig){return function(scope,element,attr){function cancelTimer(){activeTimeout&&($window.clearTimeout(activeTimeout),activeTimeout=null)}function updateTime(momentInstance){element.text(momentInstance.fromNow(withoutSuffix));var howOld=moment().diff(momentInstance,"minute"),secondsUntilUpdate=3600;1>howOld?secondsUntilUpdate=1:60>howOld?secondsUntilUpdate=30:180>howOld&&(secondsUntilUpdate=300),activeTimeout=$window.setTimeout(function(){updateTime(momentInstance)},1e3*secondsUntilUpdate)}function updateMoment(){cancelTimer(),currentValue&&updateTime(amMoment.preprocessDate(currentValue,preprocess,currentFormat))}var currentValue,currentFormat,activeTimeout=null,withoutSuffix=amTimeAgoConfig.withoutSuffix,preprocess=angularMomentConfig.preprocess;scope.$watch(attr.amTimeAgo,function(value){return"undefined"==typeof value||null===value||""===value?(cancelTimer(),void(currentValue&&(element.text(""),currentValue=null))):(currentValue=value,void updateMoment())}),angular.isDefined(attr.amWithoutSuffix)&&scope.$watch(attr.amWithoutSuffix,function(value){"boolean"==typeof value?(withoutSuffix=value,updateMoment()):withoutSuffix=amTimeAgoConfig.withoutSuffix}),attr.$observe("amFormat",function(format){currentFormat=format,updateMoment()}),attr.$observe("amPreprocess",function(newValue){preprocess=newValue,updateMoment()}),scope.$on("$destroy",function(){cancelTimer()}),scope.$on("amMoment:languageChange",function(){updateMoment()})}}]).service("amMoment",["moment","$rootScope","$log","angularMomentConfig",function(moment,$rootScope,$log,angularMomentConfig){this.preprocessors={utc:moment.utc,unix:moment.unix},this.changeLanguage=function(lang){var result=moment.lang(lang);return angular.isDefined(lang)&&$rootScope.$broadcast("amMoment:languageChange"),result},this.preprocessDate=function(value,preprocess,format){return angular.isUndefined(preprocess)&&(preprocess=angularMomentConfig.preprocess),this.preprocessors[preprocess]?this.preprocessors[preprocess](value,format):(preprocess&&$log.warn("angular-moment: Ignoring unsupported value for preprocess: "+preprocess),!isNaN(parseFloat(value))&&isFinite(value)?moment(parseInt(value,10)):moment(value,format))},this.applyTimezone=function(aMoment){var timezone=angularMomentConfig.timezone;return aMoment&&timezone&&(aMoment.tz?aMoment=aMoment.tz(timezone):$log.warn("angular-moment: timezone specified but moment.tz() is undefined. Did you forget to include moment-timezone.js?")),aMoment}}]).filter("amCalendar",["moment","amMoment",function(moment,amMoment){return function(value,preprocess){if("undefined"==typeof value||null===value)return"";value=amMoment.preprocessDate(value,preprocess);var date=moment(value);return date.isValid()?amMoment.applyTimezone(date).calendar():""}}]).filter("amDateFormat",["moment","amMoment",function(moment,amMoment){return function(value,format,preprocess){if("undefined"==typeof value||null===value)return"";value=amMoment.preprocessDate(value,preprocess);var date=moment(value);return date.isValid()?amMoment.applyTimezone(date).format(format):""}}]).filter("amDurationFormat",["moment",function(moment){return function(value,format,suffix){return"undefined"==typeof value||null===value?"":moment.duration(value,format).humanize(suffix)}}])}"function"==typeof define&&define.amd?define("angular-moment",["angular","moment"],angularMoment):angularMoment(angular,window.moment)}(),/**
 * @license angular-bootstrap-datetimepicker  version: 0.3.13
 * Copyright 2013-2015 Knight Rider Consulting, Inc. http://www.knightrider.com
 * License: MIT
 */
function(factory){"use strict";"function"==typeof define&&define.amd?define(["angular","moment"],factory):"object"==typeof exports?module.exports=factory(require("angular"),require("moment")):factory(window.angular,window.moment)}(function(angular,moment){"use strict";angular.module("ui.bootstrap.datetimepicker",[]).constant("dateTimePickerConfig",{dropdownSelector:null,minuteStep:5,minView:"minute",startView:"day"}).directive("datetimepicker",["$log","dateTimePickerConfig",function($log,defaultConfig){function DateObject(){var tempDate=new Date,localOffset=6e4*tempDate.getTimezoneOffset();this.utcDateValue=tempDate.getTime(),this.selectable=!0,this.localDateValue=function(){return this.utcDateValue+localOffset};var validProperties=["utcDateValue","localDateValue","display","active","selectable","past","future"];for(var prop in arguments[0])validProperties.indexOf(prop)>=0&&(this[prop]=arguments[0][prop])}var validateConfiguration=function(configuration){var validOptions=["startView","minView","minuteStep","dropdownSelector"];for(var prop in configuration)if(validOptions.indexOf(prop)<0)throw"invalid option: "+prop;var validViews=["minute","hour","day","month","year"];if(validViews.indexOf(configuration.startView)<0)throw"invalid startView value: "+configuration.startView;if(validViews.indexOf(configuration.minView)<0)throw"invalid minView value: "+configuration.minView;if(validViews.indexOf(configuration.minView)>validViews.indexOf(configuration.startView))throw"startView must be greater than minView";if(!angular.isNumber(configuration.minuteStep))throw"minuteStep must be numeric";if(configuration.minuteStep<=0||configuration.minuteStep>=60)throw"minuteStep must be greater than zero and less than 60";if(null!==configuration.dropdownSelector&&!angular.isString(configuration.dropdownSelector))throw"dropdownSelector must be a string";null===configuration.dropdownSelector||"undefined"!=typeof jQuery&&"function"==typeof jQuery().dropdown||($log.error("Please DO NOT specify the dropdownSelector option unless you are using jQuery AND Bootstrap.js. Please include jQuery AND Bootstrap.js, or write code to close the dropdown in the on-set-time callback. \n\nThe dropdownSelector configuration option is being removed because it will not function properly."),delete configuration.dropdownSelector)};return{restrict:"E",require:"ngModel",template:'<div class="datetimepicker table-responsive"><table class="table table-striped  {{ data.currentView }}-view">   <thead>       <tr>           <th class="left" data-ng-click="changeView(data.currentView, data.leftDate, $event)" data-ng-show="data.leftDate.selectable"><i class="glyphicon glyphicon-arrow-left"/></th>           <th class="switch" colspan="5" data-ng-show="data.previousViewDate.selectable" data-ng-click="changeView(data.previousView, data.previousViewDate, $event)">{{ data.previousViewDate.display }}</th>           <th class="right" data-ng-click="changeView(data.currentView, data.rightDate, $event)" data-ng-show="data.rightDate.selectable"><i class="glyphicon glyphicon-arrow-right"/></th>       </tr>       <tr>           <th class="dow" data-ng-repeat="day in data.dayNames" >{{ day }}</th>       </tr>   </thead>   <tbody>       <tr data-ng-if="data.currentView !== \'day\'" >           <td colspan="7" >              <span    class="{{ data.currentView }}"                        data-ng-repeat="dateObject in data.dates"                         data-ng-class="{active: dateObject.active, past: dateObject.past, future: dateObject.future, disabled: !dateObject.selectable}"                        data-ng-click="changeView(data.nextView, dateObject, $event)">{{ dateObject.display }}</span>            </td>       </tr>       <tr data-ng-if="data.currentView === \'day\'" data-ng-repeat="week in data.weeks">           <td data-ng-repeat="dateObject in week.dates"                data-ng-click="changeView(data.nextView, dateObject, $event)"               class="day"                data-ng-class="{active: dateObject.active, past: dateObject.past, future: dateObject.future, disabled: !dateObject.selectable}" >{{ dateObject.display }}</td>       </tr>   </tbody></table></div>',scope:{onSetTime:"&",beforeRender:"&"},replace:!0,link:function(scope,element,attrs,ngModelController){var directiveConfig={};attrs.datetimepickerConfig&&(directiveConfig=scope.$parent.$eval(attrs.datetimepickerConfig));var configuration={};angular.extend(configuration,defaultConfig,directiveConfig),validateConfiguration(configuration);var startOfDecade=function(unixDate){var startYear=10*parseInt(moment.utc(unixDate).year()/10,10);return moment.utc(unixDate).year(startYear).startOf("year")},dataFactory={year:function(unixDate){for(var selectedDate=moment.utc(unixDate).startOf("year"),startDecade=10*parseInt(selectedDate.year()/10,10),startDate=moment.utc(startOfDecade(unixDate)).subtract(1,"year").startOf("year"),activeYear=ngModelController.$modelValue?moment(ngModelController.$modelValue).year():0,result={currentView:"year",nextView:"year"===configuration.minView?"setTime":"month",previousViewDate:new DateObject({utcDateValue:null,display:startDecade+"-"+(startDecade+9)}),leftDate:new DateObject({utcDateValue:moment.utc(startDate).subtract(9,"year").valueOf()}),rightDate:new DateObject({utcDateValue:moment.utc(startDate).add(11,"year").valueOf()}),dates:[]},i=0;12>i;i+=1){var yearMoment=moment.utc(startDate).add(i,"years"),dateValue={utcDateValue:yearMoment.valueOf(),display:yearMoment.format("YYYY"),past:yearMoment.year()<startDecade,future:yearMoment.year()>startDecade+9,active:yearMoment.year()===activeYear};result.dates.push(new DateObject(dateValue))}return result},month:function(unixDate){for(var startDate=moment.utc(unixDate).startOf("year"),previousViewDate=startOfDecade(unixDate),activeDate=ngModelController.$modelValue?moment(ngModelController.$modelValue).format("YYYY-MMM"):0,result={previousView:"year",currentView:"month",nextView:"month"===configuration.minView?"setTime":"day",previousViewDate:new DateObject({utcDateValue:previousViewDate.valueOf(),display:startDate.format("YYYY")}),leftDate:new DateObject({utcDateValue:moment.utc(startDate).subtract(1,"year").valueOf()}),rightDate:new DateObject({utcDateValue:moment.utc(startDate).add(1,"year").valueOf()}),dates:[]},i=0;12>i;i+=1){var monthMoment=moment.utc(startDate).add(i,"months"),dateValue={utcDateValue:monthMoment.valueOf(),display:monthMoment.format("MMM"),active:monthMoment.format("YYYY-MMM")===activeDate};result.dates.push(new DateObject(dateValue))}return result},day:function(unixDate){for(var selectedDate=moment.utc(unixDate),startOfMonth=moment.utc(selectedDate).startOf("month"),previousViewDate=moment.utc(selectedDate).startOf("year"),endOfMonth=moment.utc(selectedDate).endOf("month"),startDate=moment.utc(startOfMonth).subtract(Math.abs(startOfMonth.weekday()),"days"),activeDate=ngModelController.$modelValue?moment(ngModelController.$modelValue).format("YYYY-MMM-DD"):"",result={previousView:"month",currentView:"day",nextView:"day"===configuration.minView?"setTime":"hour",previousViewDate:new DateObject({utcDateValue:previousViewDate.valueOf(),display:startOfMonth.format("YYYY-MMM")}),leftDate:new DateObject({utcDateValue:moment.utc(startOfMonth).subtract(1,"months").valueOf()}),rightDate:new DateObject({utcDateValue:moment.utc(startOfMonth).add(1,"months").valueOf()}),dayNames:[],weeks:[]},dayNumber=0;7>dayNumber;dayNumber+=1)result.dayNames.push(moment.utc().weekday(dayNumber).format("dd"));for(var i=0;6>i;i+=1){for(var week={dates:[]},j=0;7>j;j+=1){var monthMoment=moment.utc(startDate).add(7*i+j,"days"),dateValue={utcDateValue:monthMoment.valueOf(),display:monthMoment.format("D"),active:monthMoment.format("YYYY-MMM-DD")===activeDate,past:monthMoment.isBefore(startOfMonth),future:monthMoment.isAfter(endOfMonth)};week.dates.push(new DateObject(dateValue))}result.weeks.push(week)}return result},hour:function(unixDate){for(var selectedDate=moment.utc(unixDate).startOf("day"),previousViewDate=moment.utc(selectedDate).startOf("month"),activeFormat=ngModelController.$modelValue?moment(ngModelController.$modelValue).format("YYYY-MM-DD H"):"",result={previousView:"day",currentView:"hour",nextView:"hour"===configuration.minView?"setTime":"minute",previousViewDate:new DateObject({utcDateValue:previousViewDate.valueOf(),display:selectedDate.format("ll")}),leftDate:new DateObject({utcDateValue:moment.utc(selectedDate).subtract(1,"days").valueOf()}),rightDate:new DateObject({utcDateValue:moment.utc(selectedDate).add(1,"days").valueOf()}),dates:[]},i=0;24>i;i+=1){var hourMoment=moment.utc(selectedDate).add(i,"hours"),dateValue={utcDateValue:hourMoment.valueOf(),display:hourMoment.format("LT"),active:hourMoment.format("YYYY-MM-DD H")===activeFormat};result.dates.push(new DateObject(dateValue))}return result},minute:function(unixDate){for(var selectedDate=moment.utc(unixDate).startOf("hour"),previousViewDate=moment.utc(selectedDate).startOf("day"),activeFormat=ngModelController.$modelValue?moment(ngModelController.$modelValue).format("YYYY-MM-DD H:mm"):"",result={previousView:"hour",currentView:"minute",nextView:"setTime",previousViewDate:new DateObject({utcDateValue:previousViewDate.valueOf(),display:selectedDate.format("lll")}),leftDate:new DateObject({utcDateValue:moment.utc(selectedDate).subtract(1,"hours").valueOf()}),rightDate:new DateObject({utcDateValue:moment.utc(selectedDate).add(1,"hours").valueOf()}),dates:[]},limit=60/configuration.minuteStep,i=0;limit>i;i+=1){var hourMoment=moment.utc(selectedDate).add(i*configuration.minuteStep,"minute"),dateValue={utcDateValue:hourMoment.valueOf(),display:hourMoment.format("LT"),active:hourMoment.format("YYYY-MM-DD H:mm")===activeFormat};result.dates.push(new DateObject(dateValue))}return result},setTime:function(unixDate){var tempDate=new Date(unixDate),newDate=new Date(tempDate.getTime()+6e4*tempDate.getTimezoneOffset()),oldDate=ngModelController.$modelValue;return ngModelController.$setViewValue(newDate),configuration.dropdownSelector&&jQuery(configuration.dropdownSelector).dropdown("toggle"),scope.onSetTime({newDate:newDate,oldDate:oldDate}),dataFactory[configuration.startView](unixDate)}},getUTCTime=function(modelValue){var tempDate=modelValue?moment(modelValue).toDate():new Date;return tempDate.getTime()-6e4*tempDate.getTimezoneOffset()};scope.changeView=function(viewName,dateObject,event){if(event&&(event.stopPropagation(),event.preventDefault()),viewName&&dateObject.utcDateValue>-1/0&&dateObject.selectable&&dataFactory[viewName]){var result=dataFactory[viewName](dateObject.utcDateValue),weekDates=[];if(result.weeks)for(var i=0;i<result.weeks.length;i+=1)for(var week=result.weeks[i],j=0;j<week.dates.length;j+=1){var weekDate=week.dates[j];weekDates.push(weekDate)}scope.beforeRender({$view:result.currentView,$dates:result.dates||weekDates,$leftDate:result.leftDate,$upDate:result.previousViewDate,$rightDate:result.rightDate}),scope.data=result}},ngModelController.$render=function(){scope.changeView(configuration.startView,new DateObject({utcDateValue:getUTCTime(ngModelController.$viewValue)}))}}}}])}),angular.module("monospaced.elastic",[]).constant("msdElasticConfig",{append:""}).directive("msdElastic",["$timeout","$window","msdElasticConfig",function($timeout,$window,config){"use strict";return{require:"ngModel",restrict:"A, C",link:function(scope,element,attrs,ngModel){function initMirror(){mirrored=ta,taStyle=getComputedStyle(ta),angular.forEach(copyStyle,function(val){mirrorStyle+=val+":"+taStyle.getPropertyValue(val)+";"}),mirror.setAttribute("style",mirrorStyle)}function adjust(){var taHeight,taComputedStyleWidth,mirrorHeight,width,overflow;mirrored!==ta&&initMirror(),active||(active=!0,mirror.value=ta.value+append,mirror.style.overflowY=ta.style.overflowY,taHeight=""===ta.style.height?"auto":parseInt(ta.style.height,10),taComputedStyleWidth=getComputedStyle(ta).getPropertyValue("width"),"px"===taComputedStyleWidth.substr(taComputedStyleWidth.length-2,2)&&(width=parseInt(taComputedStyleWidth,10)-boxOuter.width,mirror.style.width=width+"px"),mirrorHeight=mirror.scrollHeight,mirrorHeight>maxHeight?(mirrorHeight=maxHeight,overflow="scroll"):minHeight>mirrorHeight&&(mirrorHeight=minHeight),mirrorHeight+=boxOuter.height,ta.style.overflowY=overflow||"hidden",taHeight!==mirrorHeight&&(ta.style.height=mirrorHeight+"px",scope.$emit("elastic:resize",$ta)),$timeout(function(){active=!1},1))}function forceAdjust(){active=!1,adjust()}var ta=element[0],$ta=element;if("TEXTAREA"===ta.nodeName&&$window.getComputedStyle){$ta.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var text=ta.value;ta.value="",ta.value=text;var mirrored,active,append=attrs.msdElastic?attrs.msdElastic.replace(/\\n/g,"\n"):config.append,$win=angular.element($window),mirrorStyle="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",$mirror=angular.element('<textarea tabindex="-1" style="'+mirrorStyle+'"/>').data("elastic",!0),mirror=$mirror[0],taStyle=getComputedStyle(ta),resize=taStyle.getPropertyValue("resize"),borderBox="border-box"===taStyle.getPropertyValue("box-sizing")||"border-box"===taStyle.getPropertyValue("-moz-box-sizing")||"border-box"===taStyle.getPropertyValue("-webkit-box-sizing"),boxOuter=borderBox?{width:parseInt(taStyle.getPropertyValue("border-right-width"),10)+parseInt(taStyle.getPropertyValue("padding-right"),10)+parseInt(taStyle.getPropertyValue("padding-left"),10)+parseInt(taStyle.getPropertyValue("border-left-width"),10),height:parseInt(taStyle.getPropertyValue("border-top-width"),10)+parseInt(taStyle.getPropertyValue("padding-top"),10)+parseInt(taStyle.getPropertyValue("padding-bottom"),10)+parseInt(taStyle.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},minHeightValue=parseInt(taStyle.getPropertyValue("min-height"),10),heightValue=parseInt(taStyle.getPropertyValue("height"),10),minHeight=Math.max(minHeightValue,heightValue)-boxOuter.height,maxHeight=parseInt(taStyle.getPropertyValue("max-height"),10),copyStyle=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];$ta.data("elastic")||(maxHeight=maxHeight&&maxHeight>0?maxHeight:9e4,mirror.parentNode!==document.body&&angular.element(document.body).append(mirror),$ta.css({resize:"none"===resize||"vertical"===resize?"none":"horizontal"}).data("elastic",!0),ta.oninput="onpropertychange"in ta&&"oninput"in ta?ta.onkeyup=adjust:adjust,$win.bind("resize",forceAdjust),scope.$watch(function(){return ngModel.$modelValue},function(){forceAdjust()}),scope.$on("elastic:adjust",function(){forceAdjust()}),$timeout(adjust),scope.$on("$destroy",function(){$mirror.remove(),$win.unbind("resize",forceAdjust)}))}}}}]),function(angular){"use strict";angular.module("uuid4",[]).factory("uuid4",function(){return{generate:function(){var now=Date.now(),uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(now+16*Math.random())%16|0;return now=Math.floor(now/16),("x"==c?r:7&r|8).toString(16)});return uuid}}})}(angular),function(){angular.module("angulike",[]).directive("fbLike",["$window","$rootScope",function($window,$rootScope){return{restrict:"A",scope:{fbLike:"=?"},link:function(scope,element,attrs){function renderLikeButton(){if(!attrs.fbLike||scope.fbLike||watchAdded)element.html('<div class="fb-like"'+(scope.fbLike?' data-href="'+scope.fbLike+'"':"")+' data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>'),$window.FB.XFBML.parse(element.parent()[0]);else var watchAdded=!0,unbindWatch=scope.$watch("fbLike",function(newValue){newValue&&(renderLikeButton(),unbindWatch())})}$window.FB?renderLikeButton():$.getScript("//connect.facebook.net/en_US/sdk.js",function(){$window.FB.init({appId:$rootScope.facebookAppId,xfbml:!0,version:"v2.0"}),renderLikeButton()})}}}]).directive("fbShare",["$window","$rootScope",function($window,$rootScope){return{restrict:"A",scope:{fbShare:"=?"},link:function(scope,element,attrs){function renderShareButton(){if(!attrs.fbShare||scope.fbShare||watchAdded)element.html('<div class="fb-share-button"'+(scope.fbShare?' data-href="'+scope.fbShare+'"':"")+' data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>'),$window.FB.XFBML.parse(element.parent()[0]);else var watchAdded=!0,unbindWatch=scope.$watch("fbShare",function(newValue){newValue&&(renderShareButton(),unbindWatch())})}$window.FB?renderShareButton():$.getScript("//connect.facebook.net/en_US/sdk.js",function(){$window.FB.init({appId:$rootScope.facebookAppId,xfbml:!0,version:"v2.0"}),renderShareButton()})}}}]).directive("googlePlus",["$window",function($window){return{restrict:"A",scope:{url:"="},link:function(scope,element){function renderPlusButton(){element.html('<div class="g-plusone" data-size="medium" data-href="'+scope.url+'"></div>'),$window.gapi.plusone.go(element.parent()[0])}$window.gapi?renderPlusButton():$.getScript("//apis.google.com/js/platform.js",function(){renderPlusButton()})}}}]).directive("tweet",["$window",function($window){return{restrict:"A",scope:{tweet:"=",url:"="},link:function(scope,element){function renderTweetButton(){if(scope.tweet||watchAdded)element.html('<a href="https://twitter.com/share" class="twitter-share-button" data-text="'+scope.tweet+'" data-url="'+scope.url+'">Tweet</a>'),$window.twttr.widgets.load(element.parent()[0]);else{watchAdded=!0;var unbindWatch=scope.$watch("tweet",function(newValue){newValue&&(renderTweetButton(),unbindWatch())})}}$window.twttr&&$window.twttr.widgets?renderTweetButton():$.getScript("//platform.twitter.com/widgets.js",function(){renderTweetButton()});var watchAdded=!1}}}]).directive("pinIt",["$window","$location",function($window,$location){return{restrict:"A",scope:{pinIt:"=",pinItImage:"="},link:function(scope,element){function renderPinItButton(){if(scope.pinIt||watchAdded)scope.pinItUrl=$location.absUrl(),element.html('<a href="//www.pinterest.com/pin/create/button/?url='+scope.pinItUrl+"&media="+scope.pinItImage+"&description="+scope.pinIt+'" data-pin-do="buttonPin" data-pin-config="beside"><img src="//assets.pinterest.com/images/pidgets/pinit_fg_en_rect_gray_20.png" /></a>'),$window.parsePins(element.parent()[0]);else{watchAdded=!0;var unbindWatch=scope.$watch("pinIt",function(newValue){newValue&&(renderPinItButton(),unbindWatch())})}}$window.parsePins?renderPinItButton():!function(d){var f=d.getElementsByTagName("SCRIPT")[0],p=d.createElement("SCRIPT");p.type="text/javascript",p.async=!0,p.src="//assets.pinterest.com/js/pinit.js",p["data-pin-build"]="parsePins",p.onload=function(){$window.parsePins?renderPinItButton():setTimeout(p.onload,100)},f.parentNode.insertBefore(p,f)}($window.document);var watchAdded=!1}}}])}(),/*!
 * ngTagsInput v2.3.0
 * http://mbenford.github.io/ngTagsInput
 *
 * Copyright (c) 2013-2015 Michael Benford
 * License: MIT
 *
 * Generated at 2015-03-23 18:16:24 -0300
 */
function(){"use strict";var KEYS={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,left:37,right:39,"delete":46,comma:188},MAX_SAFE_INTEGER=9007199254740991,SUPPORTED_INPUT_TYPES=["text","email","url"],tagsInput=angular.module("ngTagsInput",[]);tagsInput.directive("tagsInput",["$timeout","$document","$window","tagsInputConfig","tiUtil",function($timeout,$document,$window,tagsInputConfig,tiUtil){function TagList(options,events,onTagAdding,onTagRemoving){var getTagText,setTagText,tagIsValid,self={};return getTagText=function(tag){return tiUtil.safeToString(tag[options.displayProperty])},setTagText=function(tag,text){tag[options.displayProperty]=text},tagIsValid=function(tag){var tagText=getTagText(tag);return tagText&&tagText.length>=options.minLength&&tagText.length<=options.maxLength&&options.allowedTagsPattern.test(tagText)&&!tiUtil.findInObjectArray(self.items,tag,options.keyProperty||options.displayProperty)&&onTagAdding({$tag:tag})},self.items=[],self.addText=function(text){var tag={};return setTagText(tag,text),self.add(tag)},self.add=function(tag){var tagText=getTagText(tag);return options.replaceSpacesWithDashes&&(tagText=tiUtil.replaceSpacesWithDashes(tagText)),setTagText(tag,tagText),tagIsValid(tag)?(self.items.push(tag),events.trigger("tag-added",{$tag:tag})):tagText&&events.trigger("invalid-tag",{$tag:tag}),tag},self.remove=function(index){var tag=self.items[index];return onTagRemoving({$tag:tag})?(self.items.splice(index,1),self.clearSelection(),events.trigger("tag-removed",{$tag:tag}),tag):void 0},self.select=function(index){0>index?index=self.items.length-1:index>=self.items.length&&(index=0),self.index=index,self.selected=self.items[index]},self.selectPrior=function(){self.select(--self.index)},self.selectNext=function(){self.select(++self.index)},self.removeSelected=function(){return self.remove(self.index)},self.clearSelection=function(){self.selected=null,self.index=-1},self.clearSelection(),self}function validateType(type){return-1!==SUPPORTED_INPUT_TYPES.indexOf(type)}return{restrict:"E",require:"ngModel",scope:{tags:"=ngModel",onTagAdding:"&",onTagAdded:"&",onInvalidTag:"&",onTagRemoving:"&",onTagRemoved:"&"},replace:!1,transclude:!0,templateUrl:"ngTagsInput/tags-input.html",controller:["$scope","$attrs","$element",function($scope,$attrs,$element){$scope.events=tiUtil.simplePubSub(),tagsInputConfig.load("tagsInput",$scope,$attrs,{template:[String,"ngTagsInput/tag-item.html"],type:[String,"text",validateType],placeholder:[String,"Add a tag"],tabindex:[Number,null],removeTagSymbol:[String,String.fromCharCode(215)],replaceSpacesWithDashes:[Boolean,!0],minLength:[Number,3],maxLength:[Number,MAX_SAFE_INTEGER],addOnEnter:[Boolean,!0],addOnSpace:[Boolean,!1],addOnComma:[Boolean,!0],addOnBlur:[Boolean,!0],addOnPaste:[Boolean,!1],pasteSplitPattern:[RegExp,/,/],allowedTagsPattern:[RegExp,/.+/],enableEditingLastTag:[Boolean,!1],minTags:[Number,0],maxTags:[Number,MAX_SAFE_INTEGER],displayProperty:[String,"text"],keyProperty:[String,""],allowLeftoverText:[Boolean,!1],addFromAutocompleteOnly:[Boolean,!1],spellcheck:[Boolean,!0]}),$scope.tagList=new TagList($scope.options,$scope.events,tiUtil.handleUndefinedResult($scope.onTagAdding,!0),tiUtil.handleUndefinedResult($scope.onTagRemoving,!0)),this.registerAutocomplete=function(){var input=$element.find("input");return{addTag:function(tag){return $scope.tagList.add(tag)},focusInput:function(){input[0].focus()},getTags:function(){return $scope.tags},getCurrentTagText:function(){return $scope.newTag.text},getOptions:function(){return $scope.options},on:function(name,handler){return $scope.events.on(name,handler),this}}},this.registerTagItem=function(){return{getOptions:function(){return $scope.options},removeTag:function(index){$scope.disabled||$scope.tagList.remove(index)}}}}],link:function(scope,element,attrs,ngModelCtrl){var setElementValidity,hotkeys=[KEYS.enter,KEYS.comma,KEYS.space,KEYS.backspace,KEYS["delete"],KEYS.left,KEYS.right],tagList=scope.tagList,events=scope.events,options=scope.options,input=element.find("input"),validationOptions=["minTags","maxTags","allowLeftoverText"];setElementValidity=function(){ngModelCtrl.$setValidity("maxTags",scope.tags.length<=options.maxTags),ngModelCtrl.$setValidity("minTags",scope.tags.length>=options.minTags),ngModelCtrl.$setValidity("leftoverText",scope.hasFocus||options.allowLeftoverText?!0:!scope.newTag.text)},ngModelCtrl.$isEmpty=function(value){return!value||!value.length},scope.newTag={text:"",invalid:null,setText:function(value){this.text=value,events.trigger("input-change",value)}},scope.track=function(tag){return tag[options.keyProperty||options.displayProperty]},scope.$watch("tags",function(value){scope.tags=tiUtil.makeObjectArray(value,options.displayProperty),tagList.items=scope.tags}),scope.$watch("tags.length",function(){setElementValidity()}),attrs.$observe("disabled",function(value){scope.disabled=value}),scope.eventHandlers={input:{change:function(text){events.trigger("input-change",text)},keydown:function($event){events.trigger("input-keydown",$event)},focus:function(){scope.hasFocus||(scope.hasFocus=!0,events.trigger("input-focus"))},blur:function(){$timeout(function(){var activeElement=$document.prop("activeElement"),lostFocusToBrowserWindow=activeElement===input[0],lostFocusToChildElement=element[0].contains(activeElement);(lostFocusToBrowserWindow||!lostFocusToChildElement)&&(scope.hasFocus=!1,events.trigger("input-blur"))})},paste:function($event){$event.getTextData=function(){var clipboardData=$event.clipboardData||$event.originalEvent&&$event.originalEvent.clipboardData;return clipboardData?clipboardData.getData("text/plain"):$window.clipboardData.getData("Text")},events.trigger("input-paste",$event)}},host:{click:function(){scope.disabled||input[0].focus()}}},events.on("tag-added",scope.onTagAdded).on("invalid-tag",scope.onInvalidTag).on("tag-removed",scope.onTagRemoved).on("tag-added",function(){scope.newTag.setText("")}).on("tag-added tag-removed",function(){ngModelCtrl.$setViewValue(scope.tags)}).on("invalid-tag",function(){scope.newTag.invalid=!0}).on("option-change",function(e){-1!==validationOptions.indexOf(e.name)&&setElementValidity()}).on("input-change",function(){tagList.clearSelection(),scope.newTag.invalid=null}).on("input-focus",function(){element.triggerHandler("focus"),ngModelCtrl.$setValidity("leftoverText",!0)}).on("input-blur",function(){options.addOnBlur&&!options.addFromAutocompleteOnly&&tagList.addText(scope.newTag.text),element.triggerHandler("blur"),setElementValidity()}).on("input-keydown",function(event){var shouldAdd,shouldRemove,shouldSelect,shouldEditLastTag,key=event.keyCode,isModifier=event.shiftKey||event.altKey||event.ctrlKey||event.metaKey,addKeys={};if(!isModifier&&-1!==hotkeys.indexOf(key)){if(addKeys[KEYS.enter]=options.addOnEnter,addKeys[KEYS.comma]=options.addOnComma,addKeys[KEYS.space]=options.addOnSpace,shouldAdd=!options.addFromAutocompleteOnly&&addKeys[key],shouldRemove=(key===KEYS.backspace||key===KEYS["delete"])&&tagList.selected,shouldEditLastTag=key===KEYS.backspace&&0===scope.newTag.text.length&&options.enableEditingLastTag,shouldSelect=(key===KEYS.backspace||key===KEYS.left||key===KEYS.right)&&0===scope.newTag.text.length&&!options.enableEditingLastTag,shouldAdd)tagList.addText(scope.newTag.text);else if(shouldEditLastTag){var tag;tagList.selectPrior(),tag=tagList.removeSelected(),tag&&scope.newTag.setText(tag[options.displayProperty])}else shouldRemove?tagList.removeSelected():shouldSelect&&(key===KEYS.left||key===KEYS.backspace?tagList.selectPrior():key===KEYS.right&&tagList.selectNext());(shouldAdd||shouldSelect||shouldRemove||shouldEditLastTag)&&event.preventDefault()}}).on("input-paste",function(event){if(options.addOnPaste){var data=event.getTextData(),tags=data.split(options.pasteSplitPattern);tags.length>1&&(tags.forEach(function(tag){tagList.addText(tag)}),event.preventDefault())}})}}}]),tagsInput.directive("tiTagItem",["tiUtil",function(tiUtil){return{restrict:"E",require:"^tagsInput",template:'<ng-include src="$$template"></ng-include>',scope:{data:"="},link:function(scope,element,attrs,tagsInputCtrl){var tagsInput=tagsInputCtrl.registerTagItem(),options=tagsInput.getOptions();scope.$$template=options.template,scope.$$removeTagSymbol=options.removeTagSymbol,scope.$getDisplayText=function(){return tiUtil.safeToString(scope.data[options.displayProperty])},scope.$removeTag=function(){tagsInput.removeTag(scope.$index)},scope.$watch("$parent.$index",function(value){scope.$index=value})}}}]),tagsInput.directive("autoComplete",["$document","$timeout","$sce","$q","tagsInputConfig","tiUtil",function($document,$timeout,$sce,$q,tagsInputConfig,tiUtil){function SuggestionList(loadFn,options,events){var getDifference,lastPromise,getTagId,self={};return getTagId=function(){return options.tagsInput.keyProperty||options.tagsInput.displayProperty},getDifference=function(array1,array2){return array1.filter(function(item){return!tiUtil.findInObjectArray(array2,item,getTagId(),function(a,b){return options.tagsInput.replaceSpacesWithDashes&&(a=tiUtil.replaceSpacesWithDashes(a),b=tiUtil.replaceSpacesWithDashes(b)),tiUtil.defaultComparer(a,b)})})},self.reset=function(){lastPromise=null,self.items=[],self.visible=!1,self.index=-1,self.selected=null,self.query=null},self.show=function(){options.selectFirstMatch?self.select(0):self.selected=null,self.visible=!0},self.load=tiUtil.debounce(function(query,tags){self.query=query;var promise=$q.when(loadFn({$query:query}));lastPromise=promise,promise.then(function(items){promise===lastPromise&&(items=tiUtil.makeObjectArray(items.data||items,getTagId()),items=getDifference(items,tags),self.items=items.slice(0,options.maxResultsToShow),self.items.length>0?self.show():self.reset())})},options.debounceDelay),self.selectNext=function(){self.select(++self.index)},self.selectPrior=function(){self.select(--self.index)},self.select=function(index){0>index?index=self.items.length-1:index>=self.items.length&&(index=0),self.index=index,self.selected=self.items[index],events.trigger("suggestion-selected",index)},self.reset(),self}function scrollToElement(root,index){var element=root.find("li").eq(index),parent=element.parent(),elementTop=element.prop("offsetTop"),elementHeight=element.prop("offsetHeight"),parentHeight=parent.prop("clientHeight"),parentScrollTop=parent.prop("scrollTop");parentScrollTop>elementTop?parent.prop("scrollTop",elementTop):elementTop+elementHeight>parentHeight+parentScrollTop&&parent.prop("scrollTop",elementTop+elementHeight-parentHeight)}return{restrict:"E",require:"^tagsInput",scope:{source:"&"},templateUrl:"ngTagsInput/auto-complete.html",controller:["$scope","$element","$attrs",function($scope,$element,$attrs){$scope.events=tiUtil.simplePubSub(),tagsInputConfig.load("autoComplete",$scope,$attrs,{template:[String,"ngTagsInput/auto-complete-match.html"],debounceDelay:[Number,100],minLength:[Number,3],highlightMatchedText:[Boolean,!0],maxResultsToShow:[Number,10],loadOnDownArrow:[Boolean,!1],loadOnEmpty:[Boolean,!1],loadOnFocus:[Boolean,!1],selectFirstMatch:[Boolean,!0],displayProperty:[String,""]}),$scope.suggestionList=new SuggestionList($scope.source,$scope.options,$scope.events),this.registerAutocompleteMatch=function(){return{getOptions:function(){return $scope.options},getQuery:function(){return $scope.suggestionList.query}}}}],link:function(scope,element,attrs,tagsInputCtrl){var shouldLoadSuggestions,hotkeys=[KEYS.enter,KEYS.tab,KEYS.escape,KEYS.up,KEYS.down],suggestionList=scope.suggestionList,tagsInput=tagsInputCtrl.registerAutocomplete(),options=scope.options,events=scope.events;options.tagsInput=tagsInput.getOptions(),shouldLoadSuggestions=function(value){return value&&value.length>=options.minLength||!value&&options.loadOnEmpty},scope.addSuggestionByIndex=function(index){suggestionList.select(index),scope.addSuggestion()},scope.addSuggestion=function(){var added=!1;return suggestionList.selected&&(tagsInput.addTag(angular.copy(suggestionList.selected)),suggestionList.reset(),tagsInput.focusInput(),added=!0),added},scope.track=function(item){return item[options.tagsInput.keyProperty||options.tagsInput.displayProperty]},tagsInput.on("tag-added invalid-tag input-blur",function(){suggestionList.reset()}).on("input-change",function(value){shouldLoadSuggestions(value)?suggestionList.load(value,tagsInput.getTags()):suggestionList.reset()}).on("input-focus",function(){var value=tagsInput.getCurrentTagText();options.loadOnFocus&&shouldLoadSuggestions(value)&&suggestionList.load(value,tagsInput.getTags())}).on("input-keydown",function(event){var key=event.keyCode,handled=!1;if(-1!==hotkeys.indexOf(key))return suggestionList.visible?key===KEYS.down?(suggestionList.selectNext(),handled=!0):key===KEYS.up?(suggestionList.selectPrior(),handled=!0):key===KEYS.escape?(suggestionList.reset(),handled=!0):(key===KEYS.enter||key===KEYS.tab)&&(handled=scope.addSuggestion()):key===KEYS.down&&scope.options.loadOnDownArrow&&(suggestionList.load(tagsInput.getCurrentTagText(),tagsInput.getTags()),handled=!0),handled?(event.preventDefault(),event.stopImmediatePropagation(),!1):void 0}),events.on("suggestion-selected",function(index){scrollToElement(element,index)})}}}]),tagsInput.directive("tiAutocompleteMatch",["$sce","tiUtil",function($sce,tiUtil){return{restrict:"E",require:"^autoComplete",template:'<ng-include src="$$template"></ng-include>',scope:{data:"="},link:function(scope,element,attrs,autoCompleteCtrl){var autoComplete=autoCompleteCtrl.registerAutocompleteMatch(),options=autoComplete.getOptions();scope.$$template=options.template,scope.$index=scope.$parent.$index,scope.$highlight=function(text){return options.highlightMatchedText&&(text=tiUtil.safeHighlight(text,autoComplete.getQuery())),$sce.trustAsHtml(text)},scope.$getDisplayText=function(){return tiUtil.safeToString(scope.data[options.displayProperty||options.tagsInput.displayProperty])}}}}]),tagsInput.directive("tiTranscludeAppend",function(){return function(scope,element,attrs,ctrl,transcludeFn){transcludeFn(function(clone){element.append(clone)})}}),tagsInput.directive("tiAutosize",["tagsInputConfig",function(tagsInputConfig){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ctrl){var span,resize,threshold=tagsInputConfig.getTextAutosizeThreshold();span=angular.element('<span class="input"></span>'),span.css("display","none").css("visibility","hidden").css("width","auto").css("white-space","pre"),element.parent().append(span),resize=function(originalValue){var width,value=originalValue;return angular.isString(value)&&0===value.length&&(value=attrs.placeholder),value&&(span.text(value),span.css("display",""),width=span.prop("offsetWidth"),span.css("display","none")),element.css("width",width?width+threshold+"px":""),originalValue},ctrl.$parsers.unshift(resize),ctrl.$formatters.unshift(resize),attrs.$observe("placeholder",function(value){ctrl.$modelValue||resize(value)})}}}]),tagsInput.directive("tiBindAttrs",function(){return function(scope,element,attrs){scope.$watch(attrs.tiBindAttrs,function(value){angular.forEach(value,function(value,key){attrs.$set(key,value)})},!0)}}),tagsInput.provider("tagsInputConfig",function(){var globalDefaults={},interpolationStatus={},autosizeThreshold=3;this.setDefaults=function(directive,defaults){return globalDefaults[directive]=defaults,this},this.setActiveInterpolation=function(directive,options){return interpolationStatus[directive]=options,this},this.setTextAutosizeThreshold=function(threshold){return autosizeThreshold=threshold,this},this.$get=["$interpolate",function($interpolate){var converters={};return converters[String]=function(value){return value},converters[Number]=function(value){return parseInt(value,10)},converters[Boolean]=function(value){return"true"===value.toLowerCase()},converters[RegExp]=function(value){return new RegExp(value)},{load:function(directive,scope,attrs,options){var defaultValidator=function(){return!0};scope.options={},angular.forEach(options,function(value,key){var type,localDefault,validator,converter,getDefault,updateValue;type=value[0],localDefault=value[1],validator=value[2]||defaultValidator,converter=converters[type],getDefault=function(){var globalValue=globalDefaults[directive]&&globalDefaults[directive][key];return angular.isDefined(globalValue)?globalValue:localDefault},updateValue=function(value){scope.options[key]=value&&validator(value)?converter(value):getDefault()},interpolationStatus[directive]&&interpolationStatus[directive][key]?attrs.$observe(key,function(value){updateValue(value),scope.events.trigger("option-change",{name:key,newValue:value})}):updateValue(attrs[key]&&$interpolate(attrs[key])(scope.$parent))})},getTextAutosizeThreshold:function(){return autosizeThreshold}}}]}),tagsInput.factory("tiUtil",["$timeout",function($timeout){var self={};return self.debounce=function(fn,delay){var timeoutId;return function(){var args=arguments;$timeout.cancel(timeoutId),timeoutId=$timeout(function(){fn.apply(null,args)},delay)}},self.makeObjectArray=function(array,key){return array=array||[],array.length>0&&!angular.isObject(array[0])&&array.forEach(function(item,index){array[index]={},array[index][key]=item}),array},self.findInObjectArray=function(array,obj,key,comparer){var item=null;return comparer=comparer||self.defaultComparer,array.some(function(element){return comparer(element[key],obj[key])?(item=element,!0):void 0}),item},self.defaultComparer=function(a,b){return self.safeToString(a).toLowerCase()===self.safeToString(b).toLowerCase()},self.safeHighlight=function(str,value){function escapeRegexChars(str){return str.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}if(!value)return str;str=self.encodeHTML(str),value=self.encodeHTML(value);var expression=new RegExp("&[^;]+;|"+escapeRegexChars(value),"gi");return str.replace(expression,function(match){return match.toLowerCase()===value.toLowerCase()?"<em>"+match+"</em>":match})},self.safeToString=function(value){return angular.isUndefined(value)||null==value?"":value.toString().trim()},self.encodeHTML=function(value){return self.safeToString(value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},self.handleUndefinedResult=function(fn,valueIfUndefined){return function(){var result=fn.apply(null,arguments);return angular.isUndefined(result)?valueIfUndefined:result}},self.replaceSpacesWithDashes=function(str){return self.safeToString(str).replace(/\s/g,"-")},self.simplePubSub=function(){var events={};return{on:function(names,handler){return names.split(" ").forEach(function(name){events[name]||(events[name]=[]),events[name].push(handler)}),this},trigger:function(name,args){var handlers=events[name]||[];return handlers.every(function(handler){return self.handleUndefinedResult(handler,!0)(args)}),this}}},self}]),tagsInput.run(["$templateCache",function($templateCache){$templateCache.put("ngTagsInput/tags-input.html",'<div class="host" tabindex="-1" ng-click="eventHandlers.host.click()" ti-transclude-append=""><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list"><li class="tag-item" ng-repeat="tag in tagList.items track by track(tag)" ng-class="{ selected: tag == tagList.selected }"><ti-tag-item data="tag"></ti-tag-item></li></ul><input class="input" autocomplete="off" ng-model="newTag.text" ng-change="eventHandlers.input.change(newTag.text)" ng-keydown="eventHandlers.input.keydown($event)" ng-focus="eventHandlers.input.focus($event)" ng-blur="eventHandlers.input.blur($event)" ng-paste="eventHandlers.input.paste($event)" ng-trim="false" ng-class="{\'invalid-tag\': newTag.invalid}" ng-disabled="disabled" ti-bind-attrs="{type: options.type, placeholder: options.placeholder, tabindex: options.tabindex, spellcheck: options.spellcheck}" ti-autosize=""></div></div>'),$templateCache.put("ngTagsInput/tag-item.html",'<span ng-bind="$getDisplayText()"></span> <a class="remove-button" ng-click="$removeTag()" ng-bind="$$removeTagSymbol"></a>'),$templateCache.put("ngTagsInput/auto-complete.html",'<div class="autocomplete" ng-if="suggestionList.visible"><ul class="suggestion-list"><li class="suggestion-item" ng-repeat="item in suggestionList.items track by track(item)" ng-class="{selected: item == suggestionList.selected}" ng-click="addSuggestionByIndex($index)" ng-mouseenter="suggestionList.select($index)"><ti-autocomplete-match data="item"></ti-autocomplete-match></li></ul></div>'),$templateCache.put("ngTagsInput/auto-complete-match.html",'<span ng-bind-html="$highlight($getDisplayText())"></span>')}])}(),angular.module("modal/hellosign-tutorial.html",[]).run(function($templateCache){$templateCache.put("modal/hellosign-tutorial.html",'<div class="hellosign-modal">  <div class="modal-header">    <h3 class="modal-title">Non-Disclosure Agreement: Instructions</h3>  </div>  <div class="modal-body">    <ul>      <li ng-repeat="step in steps">        <div class="li-title">{{$index + 1}}</div>        <div class="li-content">{{step}}</div>        <div class="li-clear"></div>      </li>    </ul>    <div class="sign-warning">        <i class="icon-warning-sign"></i> e-Signature is legally binded in Non-Disclosure Agreement.    </div>  </div>  <div class="modal-footer">    <button ng-show="showContinue" class="btn btn-primary" ng-click="ok()">Continue</button>    <button class="btn" ng-click="cancel()">Cancel</button>  </div></div>')}),angular.module("template/appNote.html",[]).run(function($templateCache){$templateCache.put("template/appNote.html",'<div class="note-wrapper"><div class="note-loading" ng-show="loading"><i class="icon-spin icon-spinner"></i> Loading...</div><div class="note-li clearfix" ng-repeat="note in notes | reverse"><img class="pull-left" ng-src="{{ note.sender.small_avatar_url }}"><div class="note-li-container"><b ng-if="note.sender.level == \'mentor\'" class="note-li-name"><a ng-href="/{{ note.sender.username }}">{{ note.sender.name || note.sender.username }}</a></b><b ng-if="note.sender.level != \'mentor\'" class="note-li-username"><a ng-href="/{{ note.sender.username }}">{{ note.sender.name || note.sender.username }}</a></b><small class="muted note-li-ago">{{note.created_at | strftime: \'%b %-d, %l:%M %p\'}}</small><a ng-if="note.sender.username == User.username" confirmed-click="removeNote(note)"  ng-confirm-click="Are you sure you want to remove this note?" class="muted icon-remove note-li-remove"></a><div class="note-li-note" ng-bind-html="note.message | parseNote"></div></div></div><div class="note-li clearfix" ng-if="creatingNote"><img class="pull-left" ng-src="{{ User.avatarUrl }}"><div class="note-li-container"><b ng-if="User.isMentor" class="note-li-name"><a ng-href="/{{ User.username }}">{{ User.name || User.username }}</a></b><b ng-if="!User.isMentor" class="note-li-username">{{ User.name || User.username }}</b><div class="note-li-note"><i class="icon-spin icon-spinner"></i></div></div></div><div class="note-textarea clearfix"><img class="pull-left" ng-src="{{ currentUserAvatar}}"><div class="note-li-container note-li-actions"><textarea msd-elastic class="note-li-textarea" ng-model="newNote" placeholder="Add note here. (only you and {{oppositeName}} could see this)" rows="3"></textarea><div class="note-li-attach-files" ng-show="files.length>0"><attach-file file="f" ng-repeat="f in files"></div><div class="note-li-action-bar clearfix"><a href="#" class="note-li-action-link pull-left" ng-click="pickfile()"><i class="icon-paper-clip"> Attach File</i></a><button class="btn btn-primary" ng-click="createNote()">Send</button></div></div></div></div>'),$templateCache.put("template/attachFile.html",'<div class="attach-file"><a href="{{file.url}}" target="_blank">{{file.filename}}</a> <b>{{ file.size | fileSize }}</b><span class="act"><span class="attach-file-remove" ng-click="remove(file)"><i class="icon-remove"></i></span></span></div>')}),angular.module("appNote",["template/appNote.html"]).factory("Note",function($resource){return $resource("/api/questions/:question_id/messages/:id",{id:"@id",question_id:"@question_id"},{deleteNote:{method:"DELETE"}})}).directive("ngConfirmClick",function(){return{link:function(scope,element,attr){var msg=attr.ngConfirmClick||"Are you sure?",clickAction=attr.confirmedClick;element.bind("click",function(){window.confirm(msg)&&scope.$eval(clickAction)})}}}).directive("appNote",function($timeout,$rootScope,Note){return{restrict:"E",replace:!0,scope:!0,templateUrl:"template/appNote.html",controller:function($scope){$scope.$on("removeAttachFile",function(e,file){$scope.files=_.without($scope.files,file)})},link:function(scope,element,attrs){scope.loading=!0,scope.oppositeName=attrs.oppositeName,scope.currentUserAvatar=attrs.currentUserAvatar,scope.newNote="",scope.files=[],scope.notes=[];var textAreaElement=(angular.element(element.children()[1].children[1]),angular.element(element.children()[1].children[1].children[0]));"true"==attrs.initWithNotes&&$timeout(function(){scope.loadNotes()}),scope.loadNotes=function(){scope.notes=Note.query({question_id:attrs.questionId,mentor_id:attrs.mentorId},function(){scope.loading=!1})},scope.$on("loadNotesOfRequest-"+attrs.questionId,function(){scope.loadNotes()}),scope.$on("loadNotesOfRequest-"+attrs.questionId,function(){scope.notes=Note.query({question_id:attrs.questionId,mentor_id:attrs.mentorId},function(){scope.loading=!1})}),scope.pickfile=function(){filepicker.pick(function(InkBlob){scope.files.push(InkBlob),scope.$digest()})},scope.createNote=function(newContent){var content=newContent||scope.newNote;content&&(scope.creatingNote=!0,scope.files.length>0&&angular.forEach(scope.files,function(file){content+='\n[Attachment: <a codementor-attach-file target="_blank" href="'+file.url+'">'+file.filename+"</a>]"}),new Note({question_id:attrs.questionId,message:content,mentor_id:attrs.mentorId}).$save(function(note){scope.notes.unshift(note),scope.creatingNote=!1}),newContent||(scope.newNote=""),scope.files=[])},scope.removeNote=function(note){Note.deleteNote({question_id:attrs.questionId,id:note.id}).$promise.then(function(data){data.success&&(scope.notes=_.without(scope.notes,note))})},$rootScope.$on("onNoteAdd"+attrs.questionId,function(){textAreaElement.attr("placeholder","Tell more about how you can help. (only you and "+scope.oppositeName+" could see this)"),textAreaElement.focus(),textAreaElement.parent().addClass("highlight");var textWatcher=scope.$watch("newNote",function(newVal,oldVal){newVal!==oldVal&&(textAreaElement.attr("placeholder","Add note here. (only you and "+scope.oppositeName+" could see this)"),textAreaElement.parent().removeClass("highlight"),textWatcher())})}),scope.$on("$destroy",function(){delete $rootScope.$$listeners["onNoteAdd"+attrs.questionId]})}}}).directive("attachFile",function(){return{restrict:"E",replace:!0,templateUrl:"template/attachFile.html",scope:{file:"=file"},link:function(scope){scope.remove=function(file){scope.$emit("removeAttachFile",file),console.log("removeAttachFile")}}}}),angular.module("template/appSound.html",[]).run(function($templateCache){$templateCache.put("template/appSound.html",'<audio data-effect="notify" ng-src="{{CdnRoot + \'/notify.wav\'}}"></audio>')}),angular.module("appSound",["template/appSound.html"]).factory("Sound",function(){return{}}).directive("appSound",function(Sound){return{restrict:"E",templateUrl:"template/appSound.html",link:function(scope,element){angular.forEach(element.children(),function(child){Sound[child.dataset.effect]=function(){child.volume=.2,child.play()}})}}}),angular.module("template/appChat.html",[]).run(function($templateCache){$templateCache.put("template/appChat.html",'<app-chat-list></app-chat-list><app-chatbox var-chatroom="chatroom" var-messages="data[chatroom.id]" ng-repeat="chatroom in Chat.chatrooms | filter: {  isClosed: false, isHidden: false} | orderBy:\'lastOpenedAt\'"></app-chatbox><app-sys-chatbox var-chatroom="sysChatroom" var-messages="sysMessages" ng-if="User.isMember&&sysChatroom.isClosed==false"></app-sys-chatbox><div id="hidden-chat-container" ng-if="Chat.hiddenChatrooms().length>0"><div id="hidden-list" ng-show="showHiddenList"><div ng-click="Chat.openChatroom(chatroom); toggleHiddenList()"class="hidden-chatroom-name"ng-repeat="chatroom in hiddenList = (Chat.chatrooms | filter: { isClosed: false, isHidden: true }) | orderBy: \'lastOpenedAt\'">{{ chatroom.contact.name }}</div></div><div id="hidden-list-count" ng-click="toggleHiddenList()"><i class="icon-comment"></i><strong>{{ hiddenList.length }}</strong></div></div>')}),angular.module("template/appChatNotification.html",[]).run(function($templateCache){$templateCache.put("template/appChatNotification.html",'<div class="chatNotification pull-right ng-cloak"><a class="cm-notify" ng-class="{active:chatNoti.show}" href="#" ng-click="chatNoti.toggleNoti()"><i class="icon-comments"></i><i class="count" ng-hide="chatNoti.count<=0 || chatNoti.hideCount">{{chatNoti.count|min:99}}</i></a><div class="notification-list list-group" ng-show="chatNoti.show"><div class="list-group-heading clearfix"><h3 class="list-group-title pull-left">Inbox<img ng-src="/assets/ajax-loader.gif" ng-cloak ng-show="chatNoti.loading"></h3></div><div class="list-group-body"><div ng-class="{read:chatNoti.isRead(noti)}" class="list-group-item clearfix" ng-repeat="noti in chatNoti.notifications" ng-click="chatNoti.openChat(noti)"><span class="cm-avatar pull-left"><img ng-src="{{(User.username==noti.sender.username)?noti.receiver.avatar_url:noti.sender.avatar_url}}"></span><h4 class="list-group-item-heading">{{(User.username==noti.sender.username)?noti.receiver.name:noti.sender.name}}</h4><p class="list-group-item-text"><i class="icon-reply" style="font-size:12px; margin-right: 5px;" ng-show="User.username==noti.sender.username"></i>{{chatNoti.getContent(noti)|truncate:35}}</p><div class="muted time">{{noti.created_at | strftime: \'%b %-d, %l:%M %p\'}}</div></div><div class="empty-notification list-group-item read center" ng-cloak ng-show="chatNoti.notifications.length==0">No notifications.</div></div><div class="list-group-footer center clearfix"></div></div></div>')}),angular.module("appChat",["ngResource","ngSanitize","ui.keypress","mm.foundation.modal","mm.foundation.tpls","angularMoment","monospaced.elastic","uuid4","appFirebase","debounceService","appSchedule","template/appChat.html","template/appChatNotification.html"]).factory("ChatData",function($rootScope){return $rootScope.$new(!0)}).factory("NewChatData",function(Firebase,User){return Firebase("realtime/"+User.firebaseId+"/new_chat")}).factory("UnreadCount",function(Firebase,User){return Firebase("realtime/"+User.firebaseId+"/unread_count")}).factory("BindRooms",function(){return{}}).factory("SysChatData",function(){return{}}).factory("ChatNotificationData",function($resource){return $resource("/api/chatrooms")}).factory("Chat",function($filter,$window,$timeout,$rootScope,$http,$localStorage,Firebase,User,ChatData,BindRooms,SysChatData,RefreshAlert,Sound){var ret={chatSideBar:!1,chatrooms:$localStorage.$default({chatrooms:[]}).chatrooms,chatList:$localStorage.$default({chatList:{isMinimized:!1}}).chatList,categoryID:null,chatBarMinimize:function(){$rootScope.$broadcast("disableChatBar"),this.chatSideBar=!1,this.chatList.isMinimized=!0},chatBarMaximize:function(){$rootScope.$broadcast("enableChatBar"),this.chatSideBar=!0,this.chatList.isMinimized=!1},maxChatBox:3,getChatroom:function(id){return $filter("filter")(this.chatrooms,{id:id},!0)[0]},openedChatrooms:function(){return this.chatrooms.filter(function(chatroom){return!chatroom.isClosed&&!chatroom.isHidden}).sort(function(c1){return c1.lastOpenedAt<c1.lastOpenedAt})},hiddenChatrooms:function(){return this.chatrooms.filter(function(chatroom){return!chatroom.isClosed&&chatroom.isHidden}).sort(function(c1){return c1.lastOpenedAt>c1.lastOpenedAt})},openHiddenChatroom:function(n){n=n||1;for(var hiddenChatrooms=this.hiddenChatrooms(),i=0;n>i;i++)hiddenChatrooms[i]&&(hiddenChatrooms[i].isClosed=!1,hiddenChatrooms[i].isMinimized=!1,hiddenChatrooms[i].isHidden=!1,hiddenChatrooms[i].lastOpenedAt=(new Date).getTime())},openChatroom:function(chatroom,config){if(User.username==chatroom.contact.username)return!1;var config=config||{},_chatroom=this.getChatroom(chatroom.id);if(!config.silent){var openedChatrooms=this.openedChatrooms();if(openedChatrooms.length>=this.maxChatBox){var openedIds=_.map(openedChatrooms,function(c){return c.id});openedIds.indexOf(chatroom.id)<0&&_.each(openedChatrooms.slice(this.maxChatBox-1),function(c){c.isClosed=!1,c.isMinimized=c.isHidden=!0})}}if(_chatroom?(_chatroom.chatroomFirebaseId=chatroom.chatroomFirebaseId,config.silent||((_chatroom.isClosed||_chatroom.isHidden)&&(_chatroom.lastOpenedAt=(new Date).getTime()),_chatroom.isClosed=_chatroom.isMinimized=_chatroom.isHidden=!1,config.isNew||(_chatroom.doClick=!0),config.initMessage&&(_chatroom.initMessage=config.initMessage))):(_chatroom=this.chatrooms[this.chatrooms.push(angular.extend(chatroom,{isMinimized:!!config.close,isClosed:!!config.close,isHidden:!!config.close,doClick:!config.isNew,initMessage:config.initMessage,isFake:!1}))-1],_chatroom.lastOpenedAt=(new Date).getTime()),User.isMember||(_chatroom.isFake=!0),!config.silent)try{mixpanel.track("/chat/open",{username:_chatroom.contact.username})
}catch(e){console.log(e)}if(!BindRooms[chatroom.id]){var _init=!0,count=config.isNew?0:1;BindRooms[chatroom.id]=Firebase("chatrooms/"+chatroom.chatroomFirebaseId+"/"+chatroom.id,function(fb){return fb.endAt().limit(11)}),BindRooms[chatroom.id].$on$("child_added",function(response){var sender=response.snapshot.value.sender.username,blocked=_.contains(User.blocked_users,sender);_init&&0!=count||(_chatroom.isClosed||_chatroom.isHidden||(_chatroom.isMinimized=!1),ChatData.$emit(chatroom.id+"_after_init"),sender!==User.username&&!blocked&&Sound.notify()),config.isNew&&count++,_chatroom.lastMessageKey=response.snapshot.name,ChatData[chatroom.id]=ChatData[chatroom.id]||{},ChatData[chatroom.id][response.snapshot.name]=response.snapshot.value,ChatData.$emit(chatroom.id)}).$on$("loaded",function(){_init=!1,ChatData.$emit(chatroom.id+"_after_init")})}return _chatroom},openSysChatroom:function(){var _init=!0,_sysChatroom={isMinimized:!0,isClosed:!0};return Firebase("system_chatrooms/"+User.firebaseId).$on$("child_added",function(response){_init||(_sysChatroom.isClosed=_sysChatroom.isMinimized=!1),SysChatData[response.snapshot.name]=response.snapshot.value,_init||mixpanel.track("/system_message/receive",{message:response.snapshot.value})}).$on$("loaded",function(){_init=!1}),_sysChatroom},openChatroomViaAPI:function(username,img,displayName,callback){$http.get("/api/chat_info/"+username).success(function(result){var chatbox=this.openChatroom({id:result.chatroom_id_for,chatroomFirebaseId:result.chatroom_firebase_id_for,contact:{name:displayName||result.display_name,username:username,avatarUrl:img||result.avatar}});callback&&callback(chatbox)}.bind(this)).error(function(data,status){401==status&&RefreshAlert.open("logout")})},resetChatBoxes:function(){var openedChatrooms=this.openedChatrooms(),diff=(this.hiddenChatrooms(),this.maxChatBox-openedChatrooms.length);0>diff?_.each(openedChatrooms.slice(this.maxChatBox),function(c){c.isClosed=!1,c.isMinimized=c.isHidden=!0}):diff>0&&this.openHiddenChatroom(diff)},send:function(username,content,config){this.openChatroomViaAPI(username,null,null,function(chatbox){ChatData.$emit(chatbox.id+"-send",content,config)})}};return window.addEventListener("cmOpenChat",function(ev){$rootScope.$apply(function(){ret.openChatroom(ev.detail.chatroom,ev.detail.config)})}),ret}).directive("doCompile",function($compile){return function(scope,element,attrs){var content=attrs.doCompile&&scope.$eval(attrs.doCompile);element.html(content),$compile(element.find("a[ng-click]"))(scope.$parent.$parent.$parent)}}).directive("appChatboxMessage",function($resource,$modal,$rootScope,User){return{restrict:"E",replace:!0,templateUrl:"/template/appChatboxMessage.html",scope:{contactUsername:"=",appChatboxObject:"=",message:"=varMessage",isLast:"=varIsLast"},link:function(scope){scope.User=User,scope.mentorStartSign=function(signUrl,clientId,fromUser){$modal.open({templateUrl:"modal/hellosign-tutorial.html",controller:"HellosignModalInstanceCtrl",resolve:{showContinue:function(){return!1},steps:function(){var menteeName=fromUser,steps=["Once "+menteeName+" has completed and signed the Non-Disclosure Agreement, you will receive the agreement in your email address via HelloSign.","Please review carefully and sign the agreement electronically on HelloSign.","The final document will be sent to both "+menteeName+"'s and your email addresses. Please keep it for future reference."];return steps}}})},$rootScope.$on("onProfileImgChange",function(event,imgUrl){scope.User.avatarUrl=imgUrl})}}}).directive("appChatbox",function($timeout,$resource,$document,$modal,$rootScope,Idle,User,Schedule,Firebase,ChatData,Chat,BindRooms,SignUpForm,RefreshAlert,BlackBackground,NewModal,OfflineHelpModals,LongtermModals){return{restrict:"E",replace:!1,templateUrl:"/template/appChatbox.html",scope:{chatroom:"=varChatroom",messages:"=varMessages"},controllerAs:"chatbox",controller:function($rootScope,$window,$scope,$http,uuid4,User,Modal,NewModal){var that=this;$scope.messageNum=10,$scope.showMore=!1,$scope.moreLoading=!1,$scope.chatroom.showToolbox=!1,$scope.chatroom.mentorAskSession=!1,$scope.chatroom.contact.blocked=_.contains(User.blocked_users,$scope.chatroom.contact.username),$scope.chatroom.contact.favorited=_.contains(User.favorite_users,$scope.chatroom.contact.username),$scope.self=this,$scope.contactUsername=$scope.chatroom.contact.username,$document.click(function(){$scope.chatroom.showToolbox=!1,$scope.$digest()});var getMsgKeys=function(ms){return ms.$add?_.filter(Object.keys(ms||{}),function(k){return k&&"-"==k[0]}):Object.keys(ms||{})};User.isUser&&$http.get("/api/users/"+$scope.contactUsername+"/on_vacation").success(function(result){$scope.showOnVacationMsg=result.on_vacation});var checkLastMessageCreatedAt=function(seconds){if($scope.messages&&User.isUser){var msgLength=getMsgKeys($scope.messages).length,sentMsCount=_.countBy(_.values($scope.messages),function(m){return m.sender.username})[User.username],lastMsg=$scope.messages[$scope.chatroom.lastMessageKey];10>msgLength&&msgLength==sentMsCount&&Date.now()-lastMsg.createdAt>seconds?that.getResponseInfo(function(result){$scope.responseTimeDisplay=null===result.chats_response_time?"a long time":result.chats_response_time<86400?"a few hours":"a day",$scope.showNoReplyMsg=!0}):$scope.showNoReplyMsg=!1}},doubleCheckLastMessageCreatedAt=function(){var seconds=36e5;checkLastMessageCreatedAt(seconds),$timeout(function(){checkLastMessageCreatedAt(seconds)},seconds+1)};$scope.chatroom.contact.username&&$http.get("/api/chat_info/"+$scope.chatroom.contact.username).success(function(result){result&&result.timezone_offset&&($scope.oppositeTimezoneOffset=result.timezone_offset)}),$scope.$watch("messages",function(ms){ms&&$timeout(function(){var msgLength=getMsgKeys(ms).length;msgLength-$scope.messageNum>1&&($scope.messageNum=msgLength-1),$scope.showMore=msgLength>$scope.messageNum},0)}),ChatData.$on($scope.chatroom.id,function(){if($scope.messages){var msgLength=getMsgKeys($scope.messages).length;msgLength-$scope.messageNum>1&&($scope.messageNum=msgLength-1)}}),ChatData.$on($scope.chatroom.id+"_after_init",function(){doubleCheckLastMessageCreatedAt(),User.isUser&&!$scope.messages&&that.getResponseInfo(function(result){(result.chats_response_rate<.6||result.chats_response_time>86400)&&($scope.showNotResponsiveMsg=!0)})}),ChatData.$on($scope.chatroom.id+"-send",function(e,content,config){that.send(content,config)}),ChatData.$on($scope.chatroom.id+"-send-pending",function(event,args){that.send(args.content,{type:"pending_msg"})}),this.userOnline=!1,this.getChatroomID=function(){return $scope.chatroom.id},this.more=function(){if(!$scope.moreLoading){$scope.moreLoading=!0;var addDisplayLength=function(){var messageLength=getMsgKeys($scope.messages).length;$scope.messageNum+10<=messageLength?$scope.messageNum+=10:($scope.messageNum=messageLength>10?messageLength:10,$scope.showMore=!1),$scope.moreLoading=!1},msgKeys=getMsgKeys($scope.messages);if(msgKeys-1>$scope.messageNum+10)addDisplayLength();else{var index=Math.max(0,msgKeys.length-$scope.messageNum-1),nextEndMsg=$scope.messages[msgKeys[index]],path=BindRooms[nextEndMsg.chatroomId].$getRef().path.toString().substr(1),moreFb=Firebase(path,function(fb){return fb.endAt(null,msgKeys[index]).limit(11)}),newMessages={};moreFb.$once$("child_added",function(response){response.snapshot.name!=msgKeys[0]&&(newMessages[response.snapshot.name]=response.snapshot.value)}).$on$("loaded",function(){angular.extend(newMessages,$scope.messages),$scope.messages=newMessages,addDisplayLength()})}}},this.checkConnectionForMonthly=function(e){if(!this.userOnline){var statusTxt=this.presence.$value||"offline";"session"==statusTxt&&(statusTxt="in a session"),$scope.alertMsg=$scope.chatroom.contact.name+" is currently "+statusTxt+". Please schedule a session or leave a message",e.stopPropagation(),e.preventDefault()}},this.showToolbarButtonInfo=function(msg,fn,event){msg===!0?($scope.toolbarButtonInfo=this._prevToolbarButtonInfo,this._onExtraInfoClick=this._prevOnExtraInfoClick,angular.element(this._prevToolbarButtonTarget).addClass("active"),this._toolbarButtonTarget=this._prevToolbarButtonTarget):(this._prevToolbarButtonInfo=$scope.toolbarButtonInfo,this._prevOnExtraInfoClick=this._onExtraInfoClick,this._prevToolbarButtonTarget=this._toolbarButtonTarget,msg?($scope.toolbarButtonInfo=msg,this._onExtraInfoClick=fn,this._toolbarButtonTarget=event.target):($scope.toolbarButtonInfo="",this._onExtraInfoClick=function(){},angular.element(this._toolbarButtonTarget).removeClass("active"),this._toolbarButtonTarget=null))}.bind(this),this.onExtraInfoClick=function(e){this._onExtraInfoClick(e,$scope.chatroom.contact)}.bind(this),this.read=function(){var lastMessage=$scope.messages&&$scope.messages[$scope.chatroom.lastMessageKey];lastMessage&&!lastMessage.readAt&&lastMessage.receiver.username===User.username&&$http.post("/api/chatrooms/"+$scope.chatroom.contact.username+"/read").success(function(){Idle.cancelIdleTimer()}).error(function(data,status){401==status&&RefreshAlert.open("logout")})},this.openMenteeRecentRequestsModal=function(){mixpanel.track("Mentee Recent Requests Modal Opened",{mentee:$scope.chatroom.contact.username}),NewModal.open("mentee-recent-requests",{windowClass:"mentee-recent-requests-modal",mentee:$scope.chatroom.contact,footer:!1})},this.uploadFile=function(){filepicker.pick(function(InkBlob){this.send(InkBlob,{type:"file"})}.bind(this))}.bind(this),this.startSession=function(sessionLink){$scope.chatroom.mentorAskSession=!1,this.findScheduleCluster()?this.send({},{type:"schedule_cluster_connect"}):sessionLink?this.send({},{type:"sessionLink",sessionLink:sessionLink}):this.send({},{type:"connect"})}.bind(this),this.startFreeSession=function(){$scope.chatroom.mentorAskSession=!1,this.send({},{type:"freeConnect"})}.bind(this),this.attachRequest=function(){Modal.open("choose-request",{title:"Attach Request Information",actions:["Cancel","Attach"],data:{mentor:$scope.chatroom.contact.username}}).then(function(result){this.send(result,{type:"request"})}.bind(this))}.bind(this),this.sendNda=function(){var modalInstance=$modal.open({windowClass:"hellosign-modal-frame",templateUrl:"modal/hellosign-tutorial.html",controller:"HellosignModalInstanceCtrl",resolve:{showContinue:function(){return!0},steps:function(){var mentorName=$scope.chatroom.contact.name,steps=["Press Continue to initiate a Non-Disclosure Agreement request with "+mentorName+". You will receive an email with a Non-Disclosure Agreement template provided by Codementor via HelloSign.","You will be asked to fill in project and personal information in the Non-Disclosure Agreement.  After you sign electronically, the agreement will be sent to "+mentorName+"'s email address.",mentorName+" will review the details and sign the agreement.","The final document will be sent to both "+mentorName+"'s and your email addresses. Please keep it for future reference."];return steps}}}),self=this;modalInstance.result.then(function(){{var signResource=$resource("/start_NDA",{},{post:{method:"POST",isArray:!1}});$resource("/mentee_done_NDA",{},{post:{method:"POST",isArray:!1}})}BlackBackground.open(!0),signResource.post(null,{mentor:$scope.chatroom.contact.username},function(data){data.mentee_sign_url,data.mentor_signature_id,data.signature_request_id,data.client_id;self.send({fromUser:User.name,general:!1},{type:"signature"}),BlackBackground.remove()},function(){BlackBackground.remove()})})}.bind(this),this.startSessionFromLinkInChat=function(link){User.isMentor?alert("Please wait for user joining the sesssion room first."):window.location.href=link},this.send=function(content,config){if($scope.chatroom.isFake){SignUpForm.open({onopen:function(){angular.element('input[name="pending_msg_content"]').val(content),angular.element('input[name="pending_msg_mentor"]').val($scope.chatroom.contact.username)},title:"Please Sign Up to Continue",extraInfo:"The message for "+$scope.chatroom.contact.name+" will be sent after signing up.",becomeMentorLink:!1});try{mixpanel.track("/message/prelogin",{message:content})}catch(e){console.log(e)}return void localStorage.removeItem("ngStorage-chatrooms")}var config=config||{type:"message"},message={id:uuid.v1(),chatroomId:$scope.chatroom.id,type:config.type,createdAt:{".sv":"timestamp"},readAt:null,sender:User,sessionLink:config.sessionLink,receiver:$scope.chatroom.contact};switch(config.type){case"message":message.content=content,$scope.chatroom.input="";break;case"pending_msg":message.content=content,message.is_pending_msg=!0,$scope.chatroom.input="";break;case"request":message.request=content;break;case"file":message.request=content;break;case"connect":message.request=content;break;case"freeConnect":message.request=content;break;case"schedule_cluster_connect":message.request=content;break;case"signature":message.request=content}Idle.cancelIdleTimer(),content&&BindRooms[$scope.chatroom.id].$push$(message).then(function(reference){$http.post("/api/chatrooms/"+$scope.chatroom.contact.username,{name:reference.name(),message:message}).success(function(){message.createdAt=(new Date).getTime(),$rootScope.$emit("NewComingChatMsg",message)}).error(function(data,status){401==status&&RefreshAlert.open("logout")});try{mixpanel.track("/chat/send/message",{to:$scope.chatroom.contact.username})}catch(e){console.log(e)}})},this.close=function(){if(this.expanded)this.toggleExpand();else{{Chat.hiddenChatrooms()}$scope.chatroom.input="",$scope.chatroom.isClosed=!0,$scope.chatroom.isMinimized=!0,$scope.chatroom.isHidden=!0,Chat.openHiddenChatroom()}},this.toggleToolbox=function(show,e){if($scope.chatroom.showToolbox=show,show&&($scope.chatroom.oppositeTimezoneOffsetText=!1,$scope.oppositeTimezoneOffset)){var timezoneTxt=timezoneToText(-($scope.oppositeTimezoneOffset/60));$scope.chatroom.oppositeTimezoneOffsetText=(new Date).offset(1e3*$scope.oppositeTimezoneOffset).strftime("%a %l:%M %p ")+"GMT"+timezoneTxt.sign+timezoneTxt.h+timezoneTxt.m}e.stopPropagation()},this.toggleMentorAskSession=function(show){$scope.chatroom.mentorAskSession=show},$scope.$watch(function(){return User.favorite_users.length},function(){$scope.chatroom.contact.favorited=_.contains(User.favorite_users,$scope.chatroom.contact.username)}),this.favorite=function(e){e.stopPropagation(),$scope.chatroom.contact.favorited=!0,$http.post("/users/favorite_users/"+$scope.chatroom.contact.username),User.favorite_users.push($scope.chatroom.contact.username)},this.unfavorite=function(e){e.stopPropagation(),$scope.chatroom.contact.favorited=!1,$http["delete"]("/users/favorite_users/"+$scope.chatroom.contact.username),User.favorite_users=_.reject(User.favorite_users,function(n){return n==$scope.chatroom.contact.username})},this.openReportModal=function(e){e.stopPropagation(),NewModal.open("report-user",{username:$scope.chatroom.contact.username,name:$scope.chatroom.contact.name,footer:!1,windowClass:"report-user-modal new-modal",ok:that.reportUser})},this.reportUser=function(result){var data=_.extend(result,{username:$scope.chatroom.contact.username});$http.post("/users/report_user",data).success(function(){window.showMessage("notice","Thanks for helping us make Codementor a better community.  Our team will review this shortly.")}).error(function(){window.showMessage("error","Some error occurred, please try again later")})},this.block=function(e){e.stopPropagation(),$scope.chatroom.contact.blocked=!0,$http.post("/api/users/block/"+$scope.chatroom.contact.username).success(function(){$rootScope.$broadcast("BlockUser",$scope.chatroom.contact.username)}).error(function(){$scope.chatroom.contact.blocked=!1})},this.unblock=function(e){e.stopPropagation(),$scope.chatroom.contact.blocked=!1,$http.post("/api/users/unblock/"+$scope.chatroom.contact.username).success(function(){$rootScope.$broadcast("UnblockUser",$scope.chatroom.contact.username)}).error(function(){$scope.chatroom.contact.blocked=!0})},this.openOfflineHelpModal=function(e){e.stopPropagation(),$scope.chatroom.contact.blocked||OfflineHelpModals.openRequestModal($scope.chatroom.contact.username,$scope.chatroom.contact.name)},this.openDirectLongtermModal=function(e){e.stopPropagation(),$scope.chatroom.contact.blocked||LongtermModals.openDirectRequestModal($scope.chatroom.contact.username,$scope.chatroom.contact.name)},this.goToScheduleCluster=function(){var sc=that.findScheduleCluster();$window.location.href="/dashboard#/monthly/"+sc.id},this.connect=function(mentor){if(!User.isMentor)if(this.userOnline)Schedule.showConnectForm({mentor:mentor,from:"chat-box"}).then(function(){$scope.chatroom.isMinimized=!0;try{mixpanel.track("/chat/connect/now/start/session",{to:mentor.username})}catch(e){console.log(e)}}.bind(this));else{var statusTxt=this.presence.$value||"offline";"session"==statusTxt&&(statusTxt="in a session"),$scope.alertMsg=$scope.chatroom.contact.name+" is currently "+statusTxt+". Please schedule a session or leave a message"}}.bind(this),this.schedule=function(e,mentor){mentor||(mentor=e),Schedule.showScheduleForm({mentor:mentor,from:"chat-box"}).then(function(){try{mixpanel.track("/chat/schedule",{to:mentor.username})}catch(e){console.log(e)}})},this.findScheduleCluster=function(){return User.isMentor?_.findWhere(User.mentored_schedule_clusters,{username:$scope.chatroom.contact.username}):_.findWhere(User.schedule_clusters,{mentor_username:$scope.chatroom.contact.username})},this.getStartScheduleClusterSessionPath=function(){var sc=that.findScheduleCluster();return sc?"/questions/connect_realtime?username="+$scope.chatroom.contact.username+"&schedule_cluster_id="+sc.id:""},this.getResponseInfo=function(callback){$http.get("/api/users/"+$scope.contactUsername+"/response_info").success(callback)},$scope.$watch("chatroom.isClosed",function(newValue){var willOpen=!newValue;willOpen&&(this.read(),$scope.goBottom())}.bind(this)),this.getHelpNow=function(e,from){window.IHRc&&window.IHRc.getHelpNow(event,from)},$scope.$watch("chatroom.isMinimized",function(newValue){var willOpen=!newValue,hasOpened=!$scope.chatroom.isClosed;willOpen&&hasOpened&&(this.read(),$scope.goBottom())}.bind(this)),_.contains(User.targets,md5($scope.chatroom.contact.username))||(this.presence=Firebase("presence/"+$scope.chatroom.contact.username.replace(/\./g,"^")+"/magic"),this.presence.$on$("value",function(response){var _v=response.snapshot.value;$.isEmptyObject(_v)?(this.userOnline=!1,$scope.alertMsg=""):(this.userOnline="offline"==_v||"session"==_v?!1:!0,$scope.alertMsg="")}.bind(this)))},link:function(scope,element){var textBox=element.find(".appChatbox-action"),contentBox=element.find(".appChatbox-dialog");scope.User=User,scope.$watch("chatroom.doClick",function(yes){yes&&($timeout(function(){element.find("textarea")[0].focus()}),scope.chatroom.doClick=!1)}),scope.$watch("chatroom.initMessage",function(text){if(text){var origin=scope.chatroom.input||" ";scope.chatroom.input=origin+text,scope.chatroom.initMessage=""}}),element.click(function(e){e.target==element.get(0)&&scope.chatbox.toggleExpand()}),scope.$on("elastic:resize",function(e,$ta){$ta=$ta||element.find("textarea");var taHeight=parseInt($ta[0].style.height,10),newHeight=306-taHeight-11,diff=contentBox.height()-newHeight;textBox.height(taHeight+1),scope.chatbox.expanded?contentBox.css(110>taHeight?{height:"calc(100vh - 200px - "+taHeight+"px)","max-height":"calc(100vh - 200px - "+taHeight+"px)"}:{height:"calc(100vh - 310px)","max-height":"calc(100vh - 310px)"}):newHeight>=186&&(contentBox.height(newHeight),scope.rescroll(diff))}),scope.chatbox.toggleExpand=function(){scope.chatbox.expanded=!scope.chatbox.expanded,scope.chatbox.expanded?(angular.element("body").css("overflow","hidden"),angular.element("app-chat").addClass("fullscreen"),element.addClass("fullscreen")):(angular.element("body").css("overflow","auto"),angular.element("app-chat").removeClass("fullscreen"),element.removeClass("fullscreen")),scope.$emit("elastic:resize"),scope.goBottom(),scope.chatroom.isMinimized=!1,element.find("textarea")[0].focus()},scope.goBottom=function(){$timeout(function(){contentBox.get(0).scrollTop=contentBox.get(0).scrollHeight},0)},scope.rescroll=function(diff){$timeout(function(){contentBox.get(0).scrollTop+=diff},0)},scope.$on("goBottom",scope.goBottom)}}}).directive("appSysChatbox",function($timeout){return{restrict:"E",replace:!1,templateUrl:"/template/appSysChatbox.html",scope:{chatroom:"=varChatroom",messages:"=varMessages"},controllerAs:"chatbox",controller:function($scope){this.close=function(){$scope.chatroom.isClosed=!0},this.minimized=function(){$scope.chatroom.isMinimized=!0}},link:function(scope,element){var contentBox=element.find(".appChatbox-dialog");scope.goBottom=function(){$timeout(function(){contentBox.get(0).scrollTop=contentBox.get(0).scrollHeight},0)},scope.$on("goBottom",scope.goBottom)}}}).directive("scrollBottom",function(){return function(scope){scope.$last===!0&&scope.$emit("goBottom")}}).directive("appChatNotification",function($resource,$rootScope,$http,ChatNotificationData,User,Chat,Idle,UnreadCount,RefreshAlert){return{restrict:"E",replace:!0,templateUrl:"template/appChatNotification.html",controllerAs:"chatNoti",controller:function($scope){this.show=!1,this.count=0,this.hideCount=!1,this.loading=!1,this.notifications=[],this._clickOut=function(event){$(event.target).parents(".chatNotification").size()>0||$(event.target).hasClass("chatNotification")||($(document).off("click",this._clickOut),$(document).off("touchend",this._clickOut),this.show=!1,$scope.$digest())}.bind(this),this.toggleNoti=function(){this.show||(this.hideCount=!0,this.getNoti()),this.show=!this.show,this.show&&($(document).on("click",this._clickOut),$(document).on("touchend",this._clickOut))}.bind(this),this.getNoti=function(){this.loading=!0,ChatNotificationData.query(function(data){this.loading=!1;var that=this;this.notifications=_.reject(data,function(noti){return that.isBlocked(noti)});var unread=_.filter(this.notifications,function(noti){return!that.isRead(noti)});this.count=unread.length}.bind(this),function(err){console.log(err),this.loading=!1,err&&401==err.status&&RefreshAlert.open("logout")}.bind(this))}.bind(this),UnreadCount.$on("value",function(data){if(this.count=data.snapshot.value?data.snapshot.value.count:0,this.count){var flashMessage="("+this.count+") new message";this.count>1&&(flashMessage+="s")}}.bind(this));var _read=function(id){var target=_.find(this.notifications,function(noti){return noti.id==id?noti:void 0});if(!target.read_at){target.read_at=(new Date).toJSON(),this.count-=1,this.count<0&&(this.count=0);var targetUser=target.sender.username==User.username?target.receiver:target.sender;$http.post("/api/chatrooms/"+targetUser.username+"/read").success(function(){Idle.cancelIdleTimer()}).error(function(data,status){401==status&&RefreshAlert.open("logout")})}}.bind(this);this.openChat=function(noti){_read(noti.id);var targetUser=noti.sender.username==User.username?noti.receiver:noti.sender;Chat.openChatroom({id:noti.chatroom_id,contact:{name:targetUser.name,username:targetUser.username,avatarUrl:targetUser.avatar_url},chatroomFirebaseId:noti.chatroom_firebase_id}),this.show=!1,$scope.$$phase||$scope.$digest()}.bind(this),this.isRead=function(noti){return noti.sender.username===User.username?!0:noti.read_at?new Date(noti.read_at)<new Date:!1},this.isBlocked=function(noti){return _.contains(User.blocked_users,noti.sender.username)||_.contains(User.blocked_users,noti.receiver.username)?!0:!1},this.getContent=function(noti){switch(noti.type){case"request":return"[Request] "+noti.request.title;case"file":return"[File] "+noti.request.filename;case"connect":return"Please click Start Session to connect with me.";case"freeConnect":return"Please click here to have a free info session with me.";case"signature":return noti.request.general?"[NDA Request] "+noti.request.msg:"[NDA Request] Please review and sign the Non Disclosure Agreement";default:return noti.content}},$scope.User=User,$rootScope.$on("NewComingChatMsg",function(){this.hideCount=!1}.bind(this)),$rootScope.$on("UnblockUser",function(){this.hideCount=!1}.bind(this)),this.getNoti()},link:function(){}}}).directive("appChatList",function($http,$rootScope,$timeout,$caser,User,Chat,ChatData,RefreshAlert,Rating){return{restrict:"E",scope:!0,templateUrl:"/templates/appChatList.html",replace:!1,controllerAs:"chatList",controller:function($scope){function _rejectBlockedUsers(list){return list.longterm=_.reject(list.longterm,function(v){return _.contains(User.blocked_users,that.oppositeUser(v).username)}),list.recent_chats=_.reject(list.recent_chats,function(v){return _.contains(User.blocked_users,that.oppositeUser(v).username)}),list.category_chats=_.map(list.category_chats,function(category){return category.chat_list=_.reject(category.chat_list,function(v){_.contains(User.blocked_users,that.oppositeUser(v).username)}),category}),list.my=_.reject(list.my,function(v){return _.contains(User.blocked_users,that.oppositeUser(v).username)}),list}var that=this,init=!1;that.list={longterm:[],recent_chats:[],category_chats:[],my:[]},that.loading=!0,that.recentChatLimit=20,that.myListLimit=20,that.noMoreList=!1,that.noMoreMy=!1,that.tab="category",$scope.Rating=Rating,$rootScope.$on("BlockUser",function(e,username){User.blocked_users.push(username),that.list=_rejectBlockedUsers(that.list)}),$rootScope.$on("UnblockUser",function(e,username){User.blocked_users=_.reject(User.blocked_users,function(v){return v==username}),that.update()});var _checkIfChange=function(){return!0};if(that.update=function(){var updateUrl;updateUrl=User.isMember?"/api/chatrooms/list":"/api/public_chat_list",Chat.categoryID&&(updateUrl+="?category_id="+Chat.categoryID),$http.get(updateUrl).success(function(data){data=_rejectBlockedUsers(data),(!that.list||_checkIfChange(data))&&(that.list=data),!init&&that.list.recent_chats.length&&(that.tab="recent"),init=!0,that.loading=!1,that.list.recent_chats.length<=that.recentChatLimit&&(that.noMoreList=!0),that.list.my.length<=that.myListLimit&&(that.noMoreMy=!0)}).error(function(data,status){that.loading=!1,401==status&&RefreshAlert.open("logout")})},$rootScope.$on("NewComingChatMsg",function(e,msg){var roomMsg=_.find(that.list.recent_chats,function(r){return r.chatroom_id==msg.chatroomId});roomMsg?_.extend(roomMsg,$caser.toSnakeCase(msg)):that.list.recent_chats.push($caser.toSnakeCase(msg))}),this.signup=function(){$("#signup-modal").modal()},that.oppositeUser=function(obj){return obj.mentor?obj.mentor.username==User.username?obj.mentee:obj.mentor:obj.sender.username==User.username?obj.receiver:obj.sender},that.openChat=function(obj){var targetUser=that.oppositeUser(obj);Chat.openChatroom({id:obj.chatroom_id,contact:{name:targetUser.name,username:targetUser.username,avatarUrl:targetUser.avatar_url},chatroomFirebaseId:obj.chatroom_firebase_id})},that.sortByStatus=function(obj){var user=that.oppositeUser(obj);switch(obj.presence){case"available":return 4*new Date(user.created_at).getTime();case"online":return 3*new Date(user.created_at).getTime();case"away":return 2*new Date(user.created_at).getTime();default:return 1*new Date(user.created_at).getTime()}},that.sortByStatusAndFavorite=function(obj){var user=that.oppositeUser(obj),isFavorited=_.contains(User.favorite_users,user.username);return isFavorited?500*new Date(user.created_at).getTime():that.sortByStatus(obj)},that.sortByCreatedAt=function(obj){return new Date(obj.created_at).getTime()},that.ramaining=function(longterm){return parseInt(longterm.credit/longterm.rate/4*10)/10},that.dueDate=function(longterm){return new Date(1e3*longterm.valid_to).strftime("%b %d, %Y")},that.loadMoreList=function(){that.recentChatLimit=that.recentChatLimit+10,that.list.recent_chats.length<=that.recentChatLimit&&(that.noMoreList=!0)},that.loadMoreMy=function(){that.myListLimit=that.myListLimit+10,that.list.my.length<=that.myListLimit&&(that.noMoreMy=!0)},that.domChatboxDialog=angular.element(".appChatbox-dialog"),that.domRecentChats=angular.element(".appChatList-recent-chats"),User.pending_msg_data){{var pmd=User.pending_msg_data;Chat.openChatroom({id:pmd.chatroom_id,chatroomFirebaseId:pmd.chatroom_firebase_id,contact:{name:pmd.mentor_name,username:pmd.mentor_username,avatarUrl:pmd.mentor_avatar_url}})}$timeout(function(){ChatData.$emit(pmd.chatroom_id+"-send-pending",{content:pmd.content})})}that.toggleFooter=function(){angular.element("footer.signed-in").toggleClass("active"),that.infoActive=!that.infoActive},that.expandOlark=function(){olark("api.box.expand")},that.isFavorited=function(u){return _.contains(User.favorite_users,u.username)},that.update(),User.isMember&&!User.isMentor&&$scope.$watch(function(){return User.favorite_users.length},function(){that.update(),$(".popoverProfileParent").mouseleave(function(e){$(e.currentTarget).remove()})})}}}).directive("appChat",function(User,ChatData,NewChatData,BindRooms,SysChatData,Chat,Idle,$timeout,Firebase,debounce,$rootScope){return{restrict:"E",templateUrl:"template/appChat.html",link:function(scope,elem,attrs){if(attrs.category&&(Chat.categoryID=attrs.category),User.username){scope.data=ChatData,angular.forEach(Chat.chatrooms,function(room){room.chatroomFirebaseId&&0==room.isClosed?Chat.openChatroom({id:room.id,contact:room.contact,chatroomFirebaseId:room.chatroomFirebaseId},{silent:!0}):room.isClosed=!0});var init=!0;NewChatData.$on$("value",function(response){if(response.snapshot.value.chatroomFirebaseId&&!init&&!_.contains(User.blocked_users,response.snapshot.value.sender.username)){{var message=response.snapshot.value,_contact=message.sender.username===User.username?"receiver":"sender";Chat.openChatroom({id:message.chatroomId,contact:{name:message[_contact].name,username:message[_contact].username,avatarUrl:message[_contact].avatarUrl},chatroomFirebaseId:message.chatroomFirebaseId},{isNew:!0})}Idle.idleTimer||Idle.setIdleTimer(),$rootScope.$emit("NewComingChatMsg",message)}}).$on$("loaded",function(){init=!1}),scope.sysChatroom=Chat.openSysChatroom(),scope.sysMessages=SysChatData,scope.showHiddenList=!1,scope.toggleHiddenList=function(){scope.showHiddenList=!scope.showHiddenList}}scope.$watch("Viewport.width",function(w){w>0&&(w>=1280?gon.minimize_chat_side_bar?(gon.minimize_chat_side_bar=!1,Chat.chatBarMinimize()):Chat.chatBarMaximize():Chat.chatBarMinimize(),Chat.maxChatBox=w>1685?4:w>1389?3:w>1119?2:1,Chat.resetChatBoxes())})}}}),angular.module("template/appAlert.html",[]).run(function($templateCache){$templateCache.put("template/appAlert.html",'<div class="center alert">   <a class="close" data-dismiss="alert">\xd7</a>   <div class="msg" ng-transclude></div></div>')}),angular.module("modal/crop-image-modal.html",[]).run(function($templateCache){$templateCache.put("modal/crop-image-modal.html",'<div class="profile-modal">  <div class="modal-header">    <h3 class="modal-title">Crop Photo</h3>  </div>  <div class="modal-body">    <div id="profile-wrapper" class="profile-wrapper-modal">      <img ng-src="/assets/ajax-loader.gif" ng-show="!showImg" src="/assets/ajax-loader.gif" class="ng-hide">      <img id="profile-image-crop" ng-show="showImg" ng-cloak ng-src="{{imgUrl}}">      <div id="profile-image-frame" ng-show="showImg" class="profile-frame-modal">        <div class="inner-frame">        </div>      </div>    </div>  </div>  <div class="modal-footer">    <button ng-show="showImg" class="btn btn-primary" ng-click="ok()">Crop</button>    <button class="btn" ng-click="cancel()">Cancel</button>  </div></div>')}),angular.module("appExpertiseSorting",[]).directive("appExpertiseSorting",function(){return{restrict:"A",controller:function($scope){$scope.sortable=!1,$scope.changeMode=function(){$scope.sortable=!$scope.sortable},$scope.updateRanking=function(){}},link:function(scope,element){element.find(".cm-expertise-item").click(function(e){return element.hasClass("sortable")?(e.preventDefault(),e.stopPropagation(),!1):void 0}),scope.$watch("sortable",function(nVal){nVal===!0?scope.sortableObj=new Sortable(element.find(".cm-expertise-list")[0],{ghostClass:"sortable-ghost",onUpdate:function(){element.find(".cm-expertise-list li").each(function(i){element.find(".expertiseRank"+$(this).data("id")).val(i)}),scope.$digest()}}):scope.sortableObj&&scope.sortableObj.destroy()})}}}),angular.module("appPayoutSettings",[]).directive("appPayoutSettings",function(){return{restrict:"A",controller:function($scope){$scope.init=function(method){$scope.payoutMethod=method},$scope.onChange=function(){}},link:function(){}}}),angular.module("appPopoverProfile",["userInfoService","appSchedule","appFavorite"]).factory("PopoverStorage",function(){return{}}).directive("popoverProfile",function($compile,$q,$modal,$sessionStorage,$timeout,$window,$http,Viewport,Chat,User,PopoverStorage,userInfo){return{restrict:"A",replace:!1,scope:{username:"@popoverProfile",placement:"@",hideAction:"@"},link:function(scope,element){function getScrollOffsets(w){if(w=w||window,null!=w.pageXOffset)return{x:w.pageXOffset,y:w.pageYOffset};
var d=w.document;return"CSS1Compat"==document.compatMode?{x:d.documentElement.scrollLeft,y:d.documentElement.scrollTop}:{x:d.body.scrollLeft,y:d.body.scrollTop}}function setPopoverHeight(){var obj=scope.popoverDom;if(obj){var scrollY=getScrollOffsets($window).y;obj.position().top-scrollY<0?$(".popover.popoverProfileParent").css("top",scrollY+5+"px"):obj.height()+obj.position().top>scrollY+$(window).height()&&$(".popover.popoverProfileParent").css("top",scrollY+$(window).height()-obj.height()-5+"px")}}function hitLocalStorage(){return _.findWhere(scope.$storage.mentor,{username:scope.username})}function open(){opened=!0,firstOpen?($(element).popover("show"),$(element).popover("hide"),$(element).popover("show"),firstOpen=!1):$(element).popover("show")}function openPopover(event){return User.isMentor||!scope.username||Viewport.width<790?!1:(scope.mouseEvent=event,scope.cancel=!1,$(element).mouseleave(function(){scope.cancel=!0}),void $timeout(function(){if(!opened&&!scope.cancel){var mentor_data,mentor_local=hitLocalStorage();if(void 0===mentor_local){var promise=userInfo.getUserInfo(scope.username);promise.then(function(data){""===data||scope.cancel||(mentor_data=data.data,mentor_data.username===scope.username&&(scope.mentor=mentor_data,scope.gravatar_profile_image=mentor_data.gravatar_profile_image,scope.$storage.mentor.push({username:mentor_data.username,mentor_data:mentor_data}),open()))},function(err){return err})}else scope.mentor=mentor_local.mentor_data,scope.gravatar_profile_image=scope.mentor.gravatar_profile_image,open()}},300))}if(User.isMentor)return!1;scope.uuid=uuid.v1();var html='<div rel="popover" class="popoverProfile '+scope.uuid+'" id="mentor_popover"  ng-mouseleave="mouseleave(100)" ng-mouseenter="cancelClose()"><favorite-star ng-attr-username="{{username}}" ng-if="user.isMember"></favorite-star><div class="mentor_popover_container"><div class="popover-header"><div class="popover-gravatar"><img ng-src="{{gravatar_profile_image}}" class="img-circle"></div><div class="popover-info"><div class="mentor_popover_name"><a ng-href="/{{username}}" ng-bind="mentor.name"></a></div><div class="rating" ng-show="mentor.rating>0"><span class="star" ng-repeat="i in range(mentor.rating) track by $index" ng-if="i !== undefined"> \u2605 </span><span class="star empty" ng-repeat="i in range(5-mentor.rating) track by $index" ng-if="i !== undefined"> \u2605 </span></div><div ng-switch="mentor.reason" class="price" ng-if="User.isMember||!mentor.hide_my_rate"><strong>${{mentor.rate}}</strong> <small>/15min</small> <small ng-switch-when="special_deal" class="muted">(special rate)</small><small ng-switch-when="longterm_rate" class="muted">(long-term mentorship rate)</small><small ng-switch-when="group_rate" class="muted">({{mentor.group.title}} rate)</small></div><div class="free-length" ng-if="mentor.free_length>0"><small class="red">First {{mentor.free_length/60}} Minutes Free</small></div><div class="session-count" ng-if="getSessionCount()>0"><small class="muted">{{getSessionCount()}} session{{(getSessionCount()>1)?"s":""}}</small></div></div></div><div class="popover-actions" ng-if="!hideAction && !User.isMentor"><div class="btn btn-success" ng-click="startMsg();hide();">Get Help From {{mentor.first_name}}</div></div></div></div>';scope.$storage=PopoverStorage,scope.$storage.mentor=scope.$storage.mentor||[];var opened=!1,firstOpen=!0;element.popover({animation:!1,trigger:"manual",html:!0,container:"body",viewport:{selector:"body",padding:0},placement:scope.placement||"right",content:function(){return $compile(html)(scope)}}),element.on("shown.bs.popover",function(){scope.popoverDom=$("."+scope.uuid).parents(".popover"),scope.popoverDom.addClass("popoverProfileParent"),$timeout(function(){setPopoverHeight()},0)}),$(element).bind("mouseenter",function(event){scope.mouseenter(event)}),$(element).bind("mouseleave",function(){scope.mouseleave(100)}),scope.timer=null,scope.getSessionCount=function(){return scope.mentor?parseInt(scope.mentor.finished_session):0},scope.cancelClose=function(){scope.timer&&$timeout.cancel(scope.timer)},scope.range=function(n){return _.range(n)},scope.hide=function(){scope.cancel=!0,$(element).popover("hide")},scope.mouseleave=function(interval){scope.timer=$timeout(function(){opened=!1,scope.hide()},interval)},scope.mouseenter=function(event){openPopover(event),$timeout.cancel(scope.timer)},scope.user=User,element.bind("click",function(){scope.hide()})},controller:function($scope){$scope.startMsg=function(){Chat.openChatroom({id:$scope.mentor.chatroom_id,chatroomFirebaseId:$scope.mentor.chatroom_firebase_id,contact:{name:$scope.mentor.name,username:$scope.mentor.username,avatarUrl:$scope.mentor.gravatar_profile_image}})}}}}),angular.module("appSelectAllText",[]).directive("appSelectAllText",function(){return function(scope,element){element.on("click",function(){element[0].select()})}}),angular.module("appAlert",["appUser","template/appAlert.html"]).service("Alert",function(){function neverAskAgainCookie(name){return"never-ask-"+name+"-again"}var that=this;that.alerts=[],that.addCookieAlert=function(msgType,msg,name,htmlUnsafe){var alert={name:name};$.cookie(neverAskAgainCookie(name))||(alert.type="notice"==msgType?"alert-success":"alert-"+msgType,alert.type+=" cookie-alert",htmlUnsafe?alert.msgHtmlUnsafe=msg:alert.msg=msg,that.alerts.push(alert))},that.neverAskAgain=function(name){that.alerts=_.reject(that.alerts,function(alert){return alert.name==name}),$.cookie(neverAskAgainCookie(name),!0,{path:"/",expires:365})}}).controller("AlertCtrl",function(Payment,Alert,User,$scope){var alertHtml;$scope.Alert=Alert,$scope.openPaymentSettingForm=function(){Payment.openSettingForm({backdrop:!0})},!User.isMember||User.isMentor||!User.isUser||User.hadLessonBefore||gon.dontShowSetUpAlert||(alertHtml=(User.hasPayment||User.team_id)&&User.cardAuthorized||User.credit>0?'Make sure you\'re properly set up!  Please <a href="/session" target="_blank">try a test session</a>.':'Make sure you\'re properly set up!  Please <a href="/session" target="_blank">try a test session</a> and <a href="#" ng-click="openPaymentSettingForm()">set up billing info</a>.',Alert.addCookieAlert("notice",alertHtml,"ask-set-payment-and-test-session",!0))}).directive("msgHtmlUnsafe",function($compile){return{restrict:"A",replace:!0,link:function(scope,ele,attrs){scope.$watch(attrs.msgHtmlUnsafe,function(html){ele.html(html),$compile(ele.contents())(scope)})}}}).directive("appAlert",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"template/appAlert.html"}}),angular.module("appApplicantNew",[]).controller("applicantNewCtrl",function($scope,NewModal){$scope.learnMore=function(){NewModal.open("applicant-learn-more",{windowClass:"applicant-learn-more",actions:["ok"]})}}),angular.module("appAvatar",[]).directive("avatar",function(){return{restrict:"E",replace:!0,templateUrl:"template/avatar.html",scope:{},controller:function(){},link:function(scope,elem,attrs){scope.userAvatarUrl=attrs.imgSrc.replace("d=mm","d=404");var shortName=function(name){return name?name.replace(/[^\w]/g,"")[0]||"":""};elem.find("img").on("error",function(){scope.userShortName=shortName(attrs.name).toUpperCase(),scope.$digest()})}}}).run(function($templateCache){$templateCache.put("template/avatar.html",'<span>    <img ng-hide="!!userShortName" class="img-circle avatar" ng-src="{{userAvatarUrl}}">    <div class="customizeAvatar" ng-show="!!userShortName">{{userShortName}}</div>  </span>')}),angular.module("appBlogShow",[]).controller("blogShowCtrl",function($timeout,$scope){$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(){}})},0),$scope.popReceiveTutorialForm=function(){$("#email_collection_modal").modal()}}),angular.module("appBlogList",[]).controller("blogListCtrl",function($timeout,$scope){$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(){}})},0)}),angular.module("appBusiness",[]).factory("BusinessUtils",function(){return{scrollTo:function(selector){var to=parseInt(selector);to||(to=($(selector).offset()||{}).top||0),$("html, body").animate({scrollTop:Math.max(to-30,0)},400)}}}).controller("businessCtrl",function($scope,BusinessUtils){this.scrollTo=function(selector){BusinessUtils.scrollTo(selector)}}),angular.module("appCategory",["ngTagsInput"]).factory("TagUtils",function($q,$http){return{convert:function(text){return text.toLowerCase().replace(/[^#\+\-\.0-9A-Za-z]/g,"-").replace(/-+/g,"-")},loadTags:function(query){var XCSRFTOKEN=$http.defaults.headers.common["X-CSRF-TOKEN"];return delete $http.defaults.headers.common["X-CSRF-TOKEN"],$http.defaults.headers.common["X-Algolia-API-Key"]=gon.agoliaAPIKey,$http.defaults.headers.common["X-Algolia-Application-Id"]=gon.agoliaAPPID,$http.get(gon.agoliaCategoryURL+"?query="+query).then(function(response){return $http.defaults.headers.common["X-CSRF-TOKEN"]=XCSRFTOKEN,_.map(response.data.hits,function(category){return{text:category.name}})})},recommand:function(tags){var deferred=$q.defer(),tagsStr=_.map(tags,function(t){return t.text}).join(";").replace("#","%23");return $.getJSON("https://api.stackexchange.com/2.2/tags/"+tagsStr+"/related?site=stackoverflow&key=LecJZYqlUgzwPLAVNQ6KYA((",function(data){deferred.resolve(data)}),deferred.promise}}}).controller("CategoryCtrl",function($scope,$timeout,TagUtils){$scope.requiredWarning=!1,$scope.max=0,$scope.recommandations=[],$scope.tags=$scope.realTags||[],$scope.defaultRecommandations=[],$scope.updateTags=$scope.updateTags||function(){},$scope.onInit=$scope.onInit||function(){},$scope.recommandCount=10,$scope.enableRecommand=!0,this.initTags=function(tags){tags&&($scope.tags=_.map(tags,function(tag){return{text:tag}}),$scope.onInit($scope.tags)),this.id&&$scope.$parent.$on("changeTags_"+this.id,function(e,tags){0==tags.length?$timeout(function(){$scope.tags=[]}):$scope.tags=_.map(tags,function(t){return{text:TagUtils.convert(t)}})}.bind(this))},this.setDefaultRecommand=function(tagSet){$scope.recommandations=tagSet,$scope.defaultRecommandations=tagSet},this.updateRecommand=function(){if(!$scope.enableRecommand)return!1;if(0==$scope.tags.length)$scope.recommandations=$scope.defaultRecommandations;else{var promise=TagUtils.recommand($scope.tags);promise.then(function(results){$scope.recommandations=_.map(_.first(results.items,$scope.recommandCount),function(item){return item.name})})}},this.removeWarning=function(){$scope.tags.length>0&&($scope.requiredWarning=!1)},this.loadTags=TagUtils.loadTags,this.onAddTag=function(tag){if($scope.max>0&&$scope.tags.length>$scope.max)$scope.tags.pop();else{var _tmpTag=_.clone(tag);_tmpTag.text=TagUtils.convert(_tmpTag.text),tag.text!=_tmpTag.text&&$scope.tags.pop()&&$scope.tags.push(_tmpTag),this.updateRecommand(),$scope.updateTags($scope.tags)}this.removeWarning()}.bind(this),this.onRemoveTag=function(){this.updateRecommand(),$scope.updateTags($scope.tags)}.bind(this),this.addTag=function(tagName){if(!($scope.max>0&&$scope.tags.length>=$scope.max)){var _tagName=TagUtils.convert(tagName);_.find($scope.tags,function(t){return t.text==_tagName})||$scope.tags.push({text:TagUtils.convert(_tagName)}),this.updateRecommand(),$scope.updateTags($scope.tags),this.removeWarning()}}.bind(this),$scope.$parent.$on("changeTags",function(e,tags){$scope.tags=_.map(tags,function(t){return{text:TagUtils.convert(t)}})}),$scope.$on("required",function(){$scope.requiredWarning=!0,$scope.$digest()})}),angular.module("appCodementorMonthly",[]).controller("cmMonthlyCtrl",function($scope,$timeout){$("[data-typer-targets]").typer(),$scope.scrollToPlan=function(){$timeout(function(){var to=$("#plans").offset().top;$("html, body").animate({scrollTop:Math.max(to,0)},1e3)},50)},$scope.trackClickPlan=function(e){var name=$(e.currentTarget).data("name"),months=$(".group.active").data("months");mixpanel.track("/Monthly/ChoosePlan/"+name,{months:months})}}).directive("hourCounter",function(){return{restrict:"E",scope:{count:"=",cost:"@",totalCost:"="},replace:!0,template:'<span class="hourCounter"><i ng-click="op($event, -1)" class="opBtn fa fa-minus"></i><span class="sessionNum"><b>{{count}} </b> {{(count>1)?"hours":"hour"}} / week</span><i ng-click="op($event, 1)" class="opBtn fa fa-plus"></i></span>',link:function(scope){scope.op=function(e,n){e.stopPropagation(),e.preventDefault();var tmp=scope.count+n;tmp>0&&10>=tmp&&(scope.count=tmp),scope.totalCost=scope.count*scope.cost}}}}),angular.module("appCourse",[]).factory("Course",function(User,$http){var nextMidnight=function(d){return d=new Date(d),d.setDate(d.getDate()+1),d.setHours(0,0,0,0),d},isSameDate=function(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()},scheduleClusterMassage=function(sc){var nextScheduleIndex,now=new Date;if(sc.schedules=_.sortBy(sc.schedules,function(s){return s.appointment_time}),nextScheduleIndex=_.findIndex(sc.schedules,function(s){return nextMidnight(s.appointment_time)>Date.now()}),-1==nextScheduleIndex)return sc.upcomingScheduleCount=0,sc.finishedScheduleCount=sc.size,void _.each(sc.schedules,function(s){s.tab="finished"});var nextSchedule=sc.schedules[nextScheduleIndex];sc.nextSchedule=nextSchedule,nextSchedule.isNext=!0,sc.upcomingScheduleCount=sc.schedules.length-nextScheduleIndex,sc.finishedScheduleCount=nextScheduleIndex,_.each(sc.schedules,function(s,i){nextScheduleIndex>i?s.tab="finished":(s.tab="upcoming",s.upcomingIndex=i-nextScheduleIndex,isSameDate(new Date(s.appointment_time),new Date(nextSchedule.appointment_time))&&isSameDate(new Date(s.appointment_time),now)&&(s.isNext=!0,s.isToday=!0,sc.nextSchedule.last_finished_sub_lesson_obfuscated_id&&(sc.nextSchedule=s)))}),sc.schedules=_.sortBy(sc.schedules,function(s,i){return nextScheduleIndex>i?-s.appointment_time:void 0})};return{funCourses:function(scope){var url;url=User.isMentor?"/api/dashboard/mentor/schedule_clusters":"/api/dashboard/mentee/schedule_clusters",$http.get(url).success(function(data){scope.db.hideCoursesLoading=!0,scope.scheduleClusters=data.schedule_clusters,_.each(scope.scheduleClusters,scheduleClusterMassage)})}}}).controller("CoursesRegistrationCtrl",function($scope){var that=this;this.courseId=gon.courseId,this.plans=gon.plans,$scope.plan=getUrlParameterByName("plan")||this.plans[0].name,$scope.change_plan=function(plan){$scope.plan=plan},$scope.is_selected_plan=function(plan){return $scope.plan==plan},$scope.generate_amount=function(){var amount=0;switch($scope.plan){case that.plans[0].name:amount=that.plans[0].cost;break;case that.plans[1].name:amount=that.plans[1].cost;break;case that.plans[2].name:amount=that.plans[2].cost}return amount.toString()}}).controller("CoursesConfirmCtrl",function($scope,$timeout,$http){var that=this;this.last4=gon.last4,this.addCard=!gon.last4,this.courseId=gon.courseId,this.cost=gon.cost,this.curriculum=gon.curriculum,$timeout(function(){$("input.cc-num").payment("formatCardNumber"),$scope.load_paypal_payment_link()},0),this.toggleAddCard=function(){that.addCard=!that.addCard,$timeout(function(){$("input.cc-num").payment("formatCardNumber")},0)},$scope.load_paypal_payment_link=function(){$scope.paypalPaymentUrl=null,$scope.loadingPaypalLink=!1,$scope.paypalError=null,$scope.loadingPaypalLink=!0,$http.post("/paypal/courses/"+that.courseId+"/payment_link").success(function(result){$scope.loadingPaypalLink=!1,$scope.paypalPaymentUrl=result.approval_url}).error(function(){$scope.loadingPaypalLink=!1,$scope.paypalError="Some error occurred, please try again later"})}}).controller("RequestDetailCtrl",function(){var that=this;this.submit=function(e){var data=$(".edit_schedule_cluster").serializeArray();that.errors={},that.errors.description=0==_.findWhere(data,{name:"schedule_cluster[description]"}).value.trim().length,that.errors.categories=0==_.where(data,{name:"schedule_cluster[categories][]"}).length,that.errors.whyUse=_.where(data,{name:"user[why_use][]"}).length+_.findWhere(data,{name:"user[why_use_other]"}).value.trim().length==0,_.filter(that.errors,function(v){return v}).length>0&&(e.preventDefault(),e.stopPropagation())}}).controller("CourseStudentsCtrl",function($scope,CMVideo){this.playback=function(youtubeId){CMVideo.openWithId(youtubeId)}}).controller("CourseIndexCtrl",function($scope,$timeout){function fix(e){$(e).find(".dsektop-wapper").css({position:"fixed",top:"50px"}),$(e).find("#inner-table").css({position:"fixed",top:"calc((100vh - 50px) * 0.75 + 50px)",bottom:"auto"}),$(e).find(".shadow-block").css({position:"fixed",top:"0px",bottom:"auto"})}function relative(e){$(e).find(".dsektop-wapper").css({position:"relative",left:"auto",top:"auto",right:"auto",bottom:"auto",transform:"translateY(0px)"}),$(e).find("#inner-table").css({position:"absolute",top:"calc(100vh * 0.75)",bottom:"auto"}),$(e).find(".shadow-block").css({position:"absolute",top:"0px",bottom:"auto"})}function absolute(e){$(e).find(".dsektop-wapper").css({position:"absolute",left:"auto",top:"auto",right:"auto",bottom:"0px",transform:"translateY(0px)"}),$(e).find("#inner-table").css({position:"absolute",top:"auto",bottom:"calc(100vh * -0.25)"}),$(e).find(".shadow-block").css({position:"absolute",top:"auto",bottom:"0px"})}bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(element,name,direction){"data51Top"==name&&("down"==direction?fix(element):relative(element)),"dataBottomBottom"==name&&("down"==direction?absolute(element):fix(element))}})},0)}),angular.module("appDashboard",["ngRoute","mm.foundation.tooltip","angulike","appScheduleCluster"]).factory("storage",function(){return{finishedSessins:[],finishedRequests:[],cancelledRequests:[],interestedRequests:[],mentorSessionsPage:1,mentorFinishedRequestsPage:1,mentorCancelledRequestsPage:1,mentorInterestedRequestsPage:1}}).config(function($routeProvider){return gon.dashboardRoute?$routeProvider.when("/general-assembly",{}).when("/makegameswithus",{}).when("/getting-started",{}).when("/active-requests",{}).when("/active-requests/:id",{}).when("/finished-sessions",{}).when("/finished-sessions/:id",{}).when("/finished-requests",{}).when("/finished-requests/:id",{}).when("/cancelled-requests",{}).when("/cancelled-requests/:id",{}).when("/open-requests",{}).when("/open-requests/:id",{}).when("/interested-requests",{}).when("/other-open-requests",{}).when("/other-open-requests/:id",{}).when("/confirmed-offline-helps",{}).when("/confirmed-offline-helps/:id",{}).when("/finished-offline-helps",{}).when("/finished-offline-helps/:id",{}).when("/solved-offline-helps",{}).when("/solved-offline-helps/:id",{}).when("/upcoming-office-hours",{}).when("/finished-office-hours",{}).when("/find-longterm-mentors",{}).when("/find-longterm-mentors/:id",{}).when("/longterm-mentorships",{}).when("/open-longterm-requests",{}).when("/open-longterm-requests/:id",{}).when("/interested-longterm-requests",{}).when("/ongoing-longterm-requests",{}).when("/monthly",{}).when("/finished-monthly",{}).when("/monthly/:id",{}).when("/monthly-requests",{}).when("/monthly-requests/:id",{}).when("/unpublished-tutorials",{}).when("/published-tutorials",{}).when("/application",{}).when("/mentors",{}).when("/clients",{}).otherwise({redirectTo:function(routeParams,path){var match=null;return(match=path.match(/finished-question-(\d+)/))?"/finished-requests/"+match[1]:(match=path.match(/active-question-(\d+)/))?"/active-requests/"+match[1]:(match=path.match(/open-question-(\d+)/))?"/open-requests/"+match[1]:void 0}}):void 0}).controller("dashboardCtrl",function($rootScope,$scope,$location,$resource,$http,$timeout,$document,$sce,$q,Chat,CMVideo,NewModal,User,Schedule,Lesson,storage){function truncate(text,n,useWordBoundary){var that=String(text),toLong=that.length>n,s_=toLong?that.substr(0,n-1):that;return s_=useWordBoundary&&toLong?s_.substr(0,s_.lastIndexOf(" ")):s_,toLong?s_+" ...":s_}function getNeedTags(){var deffered=$q.defer();return $http.get("/api/feature_experts").success(function(data){$scope.needed_tag=data.needs,deffered.resolve(data)}),deffered.promise}var tabs=["/general-assembly","/makegameswithus","/getting-started","/active-requests","/finished-sessions","/finished-requests","/cancelled-requests","/open-requests","/interested-requests","/other-open-requests","/find-longterm-mentors","/longterm-mentorships","/open-longterm-requests","/interested-longterm-requests","/ongoing-longterm-requests","/monthly-requests","/monthly","/finished-monthly","/confirmed-offline-helps","/finished-offline-helps","/solved-offline-helps","/upcoming-office-hours","/finished-office-hours","/unpublished-tutorials","/published-tutorials","/application"],that=this;$scope.interested=[],$scope.interested_num=[],$scope.skipped=[],$scope.client=new AlgoliaSearch(gon.agoliaAPPID,gon.agoliaAPIKey),$scope.index=$scope.client.initIndex(gon.agoliaMentorIndex),this.tab=User.isUser&&gon.group_active?gon.group_url_string:User.isUser&&!gon.group_active?"/getting-started":User.isMentor?"/active-requests":User.isApplicant?"/application":"/active-requests",$scope.issue={body:"",title:""},$scope.editMode=function(id){$("#questionEdit").modal(),$scope.issue.title=$('[question-panel="'+id+'"] h4').text();var blank_body=$('[question-panel="'+id+'"] .truncated-body').hasClass("muted");blank_body?$scope.issue.body="":($scope.issue.body=$('[question-panel="'+id+'"] .full-body div').text()||$('[question-panel="'+id+'"] .full-body').text(),""===$scope.issue.body&&($scope.issue.body=$('[question-panel="'+id+'"] .truncated-body div').text()||$('[question-panel="'+id+'"] .truncated-body').text())),$scope.issue.id=id},$scope.submitQuestion=function(issue){$http.put("/api/questions/"+issue.id+"/update",issue).success(function(){$('[question-panel="'+issue.id+'"] h4').text(issue.title),""===issue.body||" "===issue.body?(issue.body="No Description",$('[question-panel="'+issue.id+'"] .truncated-body').addClass("muted"),$('[question-panel="'+issue.id+'"] .full-body').addClass("muted")):($('[question-panel="'+issue.id+'"] .truncated-body').removeClass("muted"),$('[question-panel="'+issue.id+'"] .full-body').removeClass("muted"));var more_html="",less_html="",full_body=0!==$('[question-panel="'+issue.id+'"] .full-body').length;full_body?(issue.body.length>300&&(more_html="<a class='more' href='#'>more<i class='icon-double-angle-right'></i></a>",less_html="<a class='less' href='#'>less<i class='icon-double-angle-right'></i></a>"),$('[question-panel="'+issue.id+'"] .full-body').html("<div style='white-space:pre-wrap;'>"+issue.body+"</div>"+less_html),$('[question-panel="'+issue.id+'"] .truncated-body').html("<div style='white-space:pre-wrap;'>"+truncate(issue.body,300,!0)+"</div>"+more_html)):$('[question-panel="'+issue.id+'"] .truncated-body').html("<div style='white-space:pre-wrap;'>"+issue.body+"</div>"+more_html)}).error(function(){console.log(issue)}),$("#questionEdit").modal("hide")},$scope.setNumericFilters=function(){var filter="rate_for_index>=0,stamina>50,rating>3.9,free_length>0";return filter},$scope.itemsPerPage=15,$scope.currentPage=1,$scope.searchAlgolia=function(){$scope.query_term=$scope.needed_tag.join(" "),$scope.index.search($scope.query_term,$scope.searchCallback,{hitsPerPage:$scope.itemsPerPage,page:$scope.currentPage-1,numericFilters:$scope.setNumericFilters(),facets:"expertise_names",facetFilters:[[]]},500)},$scope.searchCallback=function(success,result){if(0===result.hits.length)return $scope.needed_tag=[],void $scope.searchAlgolia();if(result.page==$scope.currentPage-1&&result.query==$scope.query_term){{20*Math.pow(window.scrollY,.5)}$scope.loaded=!0,$scope.items=_.map(result.hits,function(hit){return hit.rate=getRate(hit),hit.group_imgs=getGroupImg(hit),hit.expertises=genExpertises(hit),hit}),$scope.$digest(),$(".free-trial-block").tooltip()}};var returnRate=function(rate,reason){var r="$"+(rate||0).toFixed(2);return reason?r+"<br><small class='red'>"+reason+"</small>":r},getExpTagUrl=function(expertiseName){return expertiseName.toLowerCase().replace(/^\./g,"dot_").replace(/\./g,"").replace(/\+/g,"_plus").replace(/\#/g,"_sharp").replace(/\-css/g,"_css").replace(/[^0-9A-Za-z_]/g,"-").replace(/^-+/,"").replace(/-+$/,"")},addEmTag=function(displayName,url){for(var i=0;i<$scope.needed_tag.length;i++)if(getExpTagUrl($scope.needed_tag[i])==url)return"<em>"+displayName+"</em>";return displayName},getExpUrl=function(expertiseName){return"/"+getExpTagUrl(expertiseName)+"-experts"},getRate=function(hit){var longterm=_.find(hit.longterm_list,function(longterm){return longterm.username==User.username&&1e3*longterm.valid_to>(new Date).getTime()});if(longterm)return returnRate(longterm.rate,"(long-term mentorship rate)");var groups=getMutualGroups(hit);if(groups.length>0)return returnRate(groups[0].default_rate,"("+groups[0].name+" rate)");var specialterm=_.find(hit.rate_list,function(specialterm){return specialterm.username==User.username});return specialterm&&specialterm.rate!=hit.rate_for_index?returnRate(specialterm.rate,"(special rate)"):returnRate(hit.rate_for_index)},getGroupImg=function(hit){return _.map(getMutualGroups(hit),function(group){return group.icon})},getMutualGroups=function(hit){return _.filter(hit.group_for_index,function(gi){return User.groups?User.groups.indexOf(gi.id)>-1:!1})},genExpertises=function(hit){return _.map(hit.expertise_names,function(exp){return{route:getExpUrl(exp),name:addEmTag(hit.expertise_display_names[exp],getExpTagUrl(exp))}})};getNeedTags().then(function(){$scope.searchAlgolia()}),this.gotPromoteFeature=function(id){$http.post("/api/users/got_promote_feature",{id:id}).success(function(){that.hidePromoteFeatue=!0}).error(function(){that.hidePromoteFeatue=!0})},$rootScope.$on("$routeChangeStart",function(event,currRoute){if(currRoute&&currRoute.$$route){currRoute.params.id&&0==$("[question-panel="+currRoute.params.id+"]").size(),$scope.qid=currRoute.params.id;for(var path=currRoute.$$route.originalPath,match=null,i=0,len=tabs.length;len>i;i++)if(match=path.match(new RegExp(tabs[i]))){this.tab=tabs[i],$scope.$broadcast("change_tab_"+this.tab);break}}}.bind(this)),$scope.toggleExpand=function(path,id){$scope.qid==id?($scope.qid="",$location.path("/")):($scope.qid=id,$location.path(path+id))},$scope.popupRequestOptions=function(id,$event){$scope.open[id]=!0,$($event.currentTarget).bind("mouseleave",function(){$scope.open[id]=!1,$scope.$apply()})},$scope.disable=function($event){$($event.currentTarget).attr("disabled",!0),$($event.currentTarget).click(function(e){e.preventDefault()})},$scope.confirmPayment=function($event,name){confirm("I confirm that the request has been completed. By clicking on 'OK', the payment to "+name+" will be processed and will be non-refundable.  Are you sure?")||($event.preventDefault(),$event.stopPropagation())},$scope.getCategoryIconURL=function(icon){return"/assets/category_icons/"+icon+".png"},$scope.showDateWithTimeOffset=function(timestamp){return new Date(1e3*timestamp).strftime("%b %d, %Y")+" ("+d.currentTimeZoneText()+")"},$scope.showDate=function(timestamp){return new Date(1e3*timestamp).strftime("%b %d, %Y")},$scope.showDateFromDatetime=function(datetime){return new Date(datetime).strftime("%b %d, %Y")},$scope.lessThanNDays=function(timestamp,n){var t=(new Date).getTime()-1e3*timestamp;return 24*n*60*60*1e3>t},$scope.getHourUnit=function(num){return parseInt(num)>1?"hours":"hour"},$scope.getInterest=function(num){return 0==parseInt(num)?"interests":1==parseInt(num)?"interest":"interests"},$scope.genEmptyRateRange=function(rating){return _.range(5-Math.round(rating))},$scope.genRateRange=function(rating){return _.range(Math.round(rating))},$scope.withTruncated=function(trun,desc){return trun.length<desc.length?!0:!1},$scope.clickMsgBtn=function(username){Chat.openChatroomViaAPI(username)},$scope.sendMsg=function(username,content,config){Chat.send(username,content,config)},$scope.clickScheduleBtn=function(mentor){Schedule.showScheduleForm({from:"long-term",mentor:mentor})},$scope.getAmount=function(amount,calAmount){return amount>0?amount:calAmount.toFixed(2)},$scope.getRemainingHour=function(credit,rate){return rate>0?(credit/rate/4).toFixed(2):0},$scope.getRemainingHourUnit=function(credit,rate){return $scope.getRemainingHour(credit,rate)>1?"hours":"hour"},$scope.mentorLongtermHowItWork=function(){NewModal.open("mentor-longterm-howitworks",{actions:["Okay"]})},$scope.mentorOfficeHourHowItWork=function(){NewModal.open("mentor-office-hour-howitworks",{actions:["Okay"]})},this.openHowToStartOfficeHourModal=function(oh){NewModal.open("how-to-start-office-hours",{officeHour:oh,footer:!1})},this.openInterestScheduleClusterModal=function(sc){var modal=NewModal.open("interest-schedule-cluster",{scheduleCluster:sc,footer:!1});modal.result.then(function(){sc.interested=!0})},$scope.removeArticle=function(id){if(confirm("Are you sure you\u2019d like to remove this tutorial?  This will be permanently deleted.")){var url="/api/dashboard/mentor/tutorials/delete/"+id;$http["delete"](url).success(function(){$(".article_"+id).hide()})}},$scope.loadMoreSessions=function(){var url;storage.mentorSessionsPage=storage.mentorSessionsPage+1,url="/templates/finished-sessions.html?page="+storage.mentorSessionsPage,$scope.db.hideFinishedSessionsLoading=!1,$http.get(url).success(function(data){$scope.db.hideFinishedSessionsLoading=!0,storage.finishedSessions=data})},$scope.loadMoreFinishedRequests=function(){var url;storage.mentorFinishedRequestsPage=storage.mentorFinishedRequestsPage+1,url="/templates/finished-requests.html?page="+storage.mentorFinishedRequestsPage,$scope.db.hideFinishedRequestsLoading=!1,$http.get(url).success(function(data){$scope.db.hideFinishedRequestsLoading=!0,storage.finishedRequests=data})},$scope.loadMoreInterestedRequests=function(){var url;storage.mentorInterestedRequestsPage=storage.mentorInterestedRequestsPage+1,url="/templates/interested-requests.html?page="+storage.mentorInterestedRequestsPage,$scope.db.hideInterestedRequestsLoading=!1,$http.get(url).success(function(data){$scope.db.hideInterestedRequestsLoading=!0,storage.interestedRequests=data})},$scope.loadMoreCancelledRequests=function(){var url;storage.mentorCancelledRequestsPage=storage.mentorCancelledRequestsPage+1,url="/templates/cancelled-requests.html?page="+storage.mentorCancelledRequestsPage,$scope.db.hideCancelledRequestsLoading=!1,$http.get(url).success(function(data){$scope.db.hideCancelledRequestsLoading=!0,storage.cancelledRequests=data})},this.setupModal=function(){NewModal.open("first-time-setup",{actions:["Okay"]})},this.revokePublic=function(qid){$http.put("/api/questions/"+qid+"/revoke_public").success(function(){})},this.makePublic=function(qid){$http.put("/api/questions/"+qid+"/make_public").success(function(){})},this.openSessionFeedbackModal=function(lessonId,steps){Lesson.openFeedbackModal({lessonId:lessonId,steps:steps,ok:function(){var commentbtn=".comment"+lessonId,invoicebtn=".invoice"+lessonId;$(commentbtn).hide(),$(invoicebtn).removeClass("btnInvoice"),$(invoicebtn).addClass("btn-success")}})},this.playWelcomeVideo=function(){CMVideo.open("welcome","Mentee Dashboard")},this.playStartSessionVideo=function(){CMVideo.open("firstSession","Monthly")},this.requestStartScheduleClusterSession=function(username){$scope.sendMsg(username,{},{type:"schedule_cluster_connect"})},this.askToStartSession=function(username,sessionLink){User.isMentor&&Chat.send(username,{},{type:"sessionLink",sessionLink:sessionLink})},gon.show_first_time_survey&&!(User.groups||{}).length&&(!window.localStorage||(new Date).getTime()-parseInt(JSON.parse(localStorage.skipSurveyObj||"{}")[User.username]||0)>864e5)&&NewModal.open("first-time-survey",{windowClass:"first-time-survey",backdrop:"static",keyboard:!1,footer:!1,ok:function(){getNeedTags().then(function(){$scope.searchAlgolia()}),CMVideo.open("welcome","After Survey")},cancel:function(reason){}})}).controller("dashboardOfficeHoursCtrl",function($scope,$http,$timeout,$sce,NewModal){function camelCase(input){return input.toLowerCase().replace(/-(.)/g,function(match,group){return group.toUpperCase()})}function capitaliseFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)}function toTweeterTag(string){return"#"+capitaliseFirstLetter(camelCase(string))}var that=this;$scope.$on("change_tab_/upcoming-office-hours",function(){that.upcomingOfficeHours=null,$http.get("/api/dashboard/mentor/active_office_hours").success(function(officeHours){that.upcomingOfficeHours=_.map(officeHours,function(oh){var tags=_.reduce(oh.categories,function(tags,c){return tags.push(toTweeterTag(c.name)),tags},[]);return oh.tweet="RSVP for my free "+tags.join(" ")+" @CodementorIO #OfficeHours "+oh.title,oh})}).error(function(){showMessage("error","Some error occurred. Please try again later.")
})}),$scope.$on("change_tab_/finished-office-hours",function(){that.finishedOfficeHours=null,$http.get("/api/dashboard/mentor/finished_office_hours").success(function(officeHours){that.finishedOfficeHours=officeHours}).error(function(){showMessage("error","Some error occurred. Please try again later.")})}),this.cancelOfficeHour=function(id){confirm("Are you sure you'd like to cancel the office hours proposal?")&&($("#office-hour-"+id).hide(),$http.post("/officehours/"+id+"/cancel").success(function(){that.upcomingOfficeHours=_.reject(that.upcomingOfficeHours,function(oh){return oh.id==id})}).error(function(){$("#office-hour-"+id).show(),showMessage("error","Some error occurred. Please try again later.")}))},this.openHowToStartOfficeHourModal=function(oh){NewModal.open("how-to-start-office-hours",{officeHour:oh,footer:!1,windowClass:"how-to-start-office-hours-modal"})}}).directive("compile",["$compile",function($compile){return function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.compile)},function(value){scope.scrollHandlers&&_.each(scope.scrollHandlers,function(unregister){unregister()}),element.html(value),$compile(element.contents())(scope)})}}]).directive("questionPanel",function($timeout){return{restrict:"A",link:function(scope,element,attrs){scope.scrollHandlers=scope.scrollHandlers||[];var handler=scope.$watch("qid",function(nVal){if(nVal==attrs.questionPanel){if($(".navbar-inner").height()>40)var reduce=90;else var reduce=50;$timeout(function(){$("html, body").animate({scrollTop:element.offset().top-reduce},300)},0),scope.$broadcast("loadNotesOfRequest-"+nVal)}});scope.scrollHandlers.push(handler)}}}).directive("tmpltFinishedSessions",function(storage,$http){return{restrict:"E",templateUrl:"/templates/finished-sessions-module.html",link:function(scope){scope.storage=storage;var funFinishedSessions=function(){var url="/templates/finished-sessions.html?page="+storage.mentorSessionsPage;$http.get(url).success(function(data){scope.db.hideFinishedSessionsLoading=!0,storage.finishedSessions=data})};"/finished-sessions"==scope.db.tab&&funFinishedSessions(),scope.$on("change_tab_/finished-sessions",function(){scope.qid||funFinishedSessions()})}}}).directive("tmpltInterestedRequests",function(storage,$http){return{restrict:"E",templateUrl:"/templates/interested-requests-module.html",link:function(scope){scope.storage=storage;var funInterestedRequests=function(){var url="/templates/interested-requests.html?page="+storage.mentorRequestsPage;$http.get(url).success(function(data){scope.db.hideInterestedRequestsLoading=!0,storage.interestedRequests=data})};"/interested-requests"==scope.db.tab&&funInterestedRequests(),scope.$on("change_tab_/interested-requests",function(){scope.qid||funInterestedRequests()})}}}).directive("tmpltFinishedRequests",function(storage,$http){return{restrict:"E",templateUrl:"/templates/finished-requests-module.html",link:function(scope){scope.storage=storage;var funFinishedRequests=function(){var url="/templates/finished-requests.html?page="+storage.mentorFinishedRequestsPage;$http.get(url).success(function(data){scope.db.hideFinishedRequestsLoading=!0,storage.finishedRequests=data})};"/finished-requests"==scope.db.tab&&funFinishedRequests(),scope.$on("change_tab_/finished-requests",function(){scope.qid||funFinishedRequests()})}}}).directive("tmpltCancelledRequests",function(storage,$http){return{restrict:"E",templateUrl:"/templates/cancelled-requests-module.html",link:function(scope){scope.storage=storage;var funCancelledRequests=function(){var url="/templates/cancelled-requests.html?page="+storage.mentorCancelledRequestsPage;$http.get(url).success(function(data){scope.db.hideCancelledRequestsLoading=!0,storage.cancelledRequests=data})};"/cancelled-requests"==scope.db.tab&&funCancelledRequests(),scope.$on("change_tab_/cancelled-requests",function(){scope.qid||funCancelledRequests()})}}}).directive("tmpltHelpRequests",function($http,$rootScope){return{restrict:"E",scope:{path:"@",qshow:"@",mentorId:"@"},template:'<a class="btn btn-primary" ng-click="helpRequest()"><i class="icon-ok" ng-hide="loading"></i><i class="icon-spin icon-spinner" ng-show="loading"></i> I Can Help </a>',link:function(scope,elem){scope.loading=!1,scope.helpRequest=function(){scope.loading=!0,$http.post("/api/questions/"+scope.path+"/interest",{user:scope.user}).success(function(data){return data.message.error?(window.showMessage("error",data.message.flash),data.message.error):("1"===scope.qshow?scope.$parent.interested=!0:(scope.$parent.interested[parseInt(scope.path,10)]=!0,scope.$parent.interested_num[parseInt(scope.path,10)]=scope.$parent.interested_num[parseInt(scope.path,10)]+1),gon.auto_applied||$rootScope.$broadcast("onNoteAdd"+scope.path),elem.parents(".question-header").find(".question .interested").show(),void(scope.loading=!1))})}}}}).directive("tmpltSkipRequests",function($http,$rootScope,NewModal){return{restrict:"E",scope:{path:"@",qshow:"@",mentorId:"@"},template:'<a class="btn btn-default" ng-click="openSkipRequestModal()"><i class="icon-remove" ng-hide="loading"></i><i class="icon-spin icon-spinner" ng-show="loading"></i> Skip </a>',link:function(scope){scope.loading=!1,scope.skipRequest=function(result){scope.loading=!0,$http.post("/api/questions/"+scope.path+"/skip",result).success(function(){"1"===scope.qshow?scope.$parent.skipped=!0:scope.$parent.skipped[parseInt(scope.path,10)]=!0,scope.loading=!1}).error(function(){window.showMessage("error","Some error occurred, please try again later"),scope.loading=!1})},scope.openSkipRequestModal=function(){NewModal.open("skip-question",{footer:!1,windowClass:"skip-question-modal new-modal",ok:scope.skipRequest})}}}}).directive("tmpltUndoSkipRequests",function($http){return{restrict:"E",scope:{path:"@",qshow:"@",mentorId:"@"},template:'<a class="btn btn-default" ng-click="undoSkipRequest()"><i class="icon-undo" ng-hide="loading"></i><i class="icon-spin icon-spinner" ng-show="loading"></i> Undo </a>',link:function(scope){scope.loading=!1,scope.undoSkipRequest=function(){scope.loading=!0,$http["delete"]("/api/questions/"+scope.path+"/skip",{user:scope.user}).success(function(){"1"===scope.qshow?scope.$parent.skipped=!1:scope.$parent.skipped[parseInt(scope.path,10)]=!1,scope.loading=!1}).error(function(){window.showMessage("error","Some error occurred, please try again later"),scope.loading=!1})}}}}).directive("tmpltFindLongtermMentors",function($http){return{restrict:"E",templateUrl:"/templates/find-longterm-mentors.html",link:function(scope){scope.longtermRequests=[],scope.longtermMatchResults=null,scope.openFlag=!1,scope.db.hideLongtermRequestsLoading=!1,scope.db.LongtermMatchResultsLoading=!1;var funLongtermRequests=function(){var url="/api/dashboard/mentee/longterms";$http.get(url).success(function(data){scope.db.hideLongtermRequestsLoading=!0,scope.db.LongtermMatchResultsLoading=!1,scope.longtermRequests=data.longterms})},funLongtermMatchResults=function(){var url="/api/dashboard/mentee/longterms/interested/"+scope.qid;$http.get(url).success(function(data){scope.db.hideLongtermRequestsLoading=!0,scope.db.LongtermMatchResultsLoading=!1,scope.longtermMatchResults=data.longterm})};scope.changeOpenFlag=function(val){scope.openFlag=val},"/find-longterm-mentors"==scope.db.tab&&(scope.qid?(scope.db.LongtermMatchResultsLoading=!0,funLongtermMatchResults()):funLongtermRequests()),scope.$on("change_tab_/find-longterm-mentors",function(){scope.qid?(scope.db.LongtermMatchResultsLoading=!0,funLongtermMatchResults()):funLongtermRequests()})}}}).directive("tmpltLongtermMentorships",function($http){return{restrict:"E",templateUrl:"/templates/longterm-mentorships.html",link:function(scope){scope.longtermMentorships=[];var funLongterms=function(){var url="/api/dashboard/mentee/longterms/ongoing";$http.get(url).success(function(data){scope.db.hideLongtermMentorshipsLoading=!0,scope.longtermMentorships=data.longterms}).error(function(){scope.db.hideLongtermMentorshipsLoading=!0})};"/longterm-mentorships"==scope.db.tab&&funLongterms(),scope.$on("change_tab_/longterm-mentorships",function(){funLongterms()})}}}).directive("tmpltOpenLongtermRequests",function($http,NewModal){return{restrict:"E",templateUrl:"/templates/open-longterm-requests.html",link:function(scope){scope.openLongtermRequests=[],scope.openLongtermSpecificRequest=null,scope.db.hideOpenLongtermRequestsLoading=!1;var funOpenLongtermRequests=function(){var url="/api/dashboard/mentor/longterms/open";$http.get(url).success(function(data){scope.db.hideOpenLongtermRequestsLoading=!0,scope.openLongtermRequests=data.longterms})},funOpenLongtermSpecificRequest=function(){var url="/api/dashboard/mentor/longterms/open/"+scope.qid;$http.get(url).success(function(data){scope.db.hideOpenLongtermRequestsLoading=!0,scope.openLongtermSpecificRequest=data.longterm})};"/open-longterm-requests"==scope.db.tab&&(scope.qid?funOpenLongtermSpecificRequest():funOpenLongtermRequests()),scope.$on("change_tab_/open-longterm-requests",function(){scope.qid?funOpenLongtermSpecificRequest():funOpenLongtermRequests()}),scope.openCancelDirectLontermModal=function(applicantLongterm){NewModal.open("cancel-direct-longterm-modal",{footer:!1,windowClass:"cancel-direct-longterm-modal new-modal",applicantLongterm:applicantLongterm})}}}}).directive("tmpltInterestedLongtermRequests",function($http){return{restrict:"E",templateUrl:"/templates/interested-longterm-requests.html",link:function(scope){scope.interestedLongtermRequests=[],scope.db.hideInterestedLongtermRequestsLoading=!1;var funInterestedLongtermRequests=function(){var url="/api/dashboard/mentor/longterms/interested";$http.get(url).success(function(data){scope.db.hideInterestedLongtermRequestsLoading=!0,scope.interestedLongtermRequests=data.longterms})};"/interested-longterm-requests"==scope.db.tab&&funInterestedLongtermRequests(),scope.$on("change_tab_/interested-longterm-requests",function(){funInterestedLongtermRequests()})}}}).directive("tmpltOngoingLongtermRequests",function($http){return{restrict:"E",templateUrl:"/templates/ongoing-longterm-requests.html",link:function(scope){scope.ongoingLongtermRqeusts=[],scope.db.hideOngoingLongtermRequestsLoading=!1;var funOngoingLongtermRequests=function(){var url="/api/dashboard/mentor/longterms/ongoing";$http.get(url).success(function(data){scope.db.hideOngoingLongtermRequestsLoading=!0,scope.ongoingLongtermRequests=data.longterms})};"/ongoing-longterm-requests"==scope.db.tab&&funOngoingLongtermRequests(),scope.$on("change_tab_/ongoing-longterm-requests",function(){funOngoingLongtermRequests()})}}}).directive("tmpltScheduleClusters",function(ScheduleCluster){return{restrict:"E",templateUrl:"/templates/schedule_clusters.html",link:function(scope){scope.ongoingLongtermRqeusts=[],scope.db.hideScheduleClustersLoading=!1,ScheduleCluster.funScheduleClusters(scope),"/monthly"==scope.db.tab&&ScheduleCluster.funScheduleClusters(scope),scope.$on("change_tab_/monthly",function(){ScheduleCluster.funScheduleClusters(scope)}),scope.goToScheduleCluster=function(id){location.hash="/monthly/"+id}}}}).directive("tmpltMentorScheduleClusters",function(ScheduleCluster){return{restrict:"E",templateUrl:"/templates/mentor_schedule_clusters.html",link:function(scope){scope.db.hideScheduleClustersLoading=!1,ScheduleCluster.funScheduleClusters(scope),"/monthly"==scope.db.tab&&ScheduleCluster.funScheduleClusters(scope),scope.$on("change_tab_/monthly",function(){ScheduleCluster.funScheduleClusters(scope)}),scope.goToScheduleCluster=function(id){location.hash="/monthly/"+id}}}}).directive("tmpltMentorFinishedScheduleClusters",function(ScheduleCluster){return{restrict:"E",templateUrl:"/templates/mentor_schedule_clusters.html",link:function(scope){scope.db.hideFinishedScheduleClustersLoading=!1,ScheduleCluster.funFinishedScheduleClusters(scope),"/finished-monthly"==scope.db.tab&&ScheduleCluster.funFinishedScheduleClusters(scope),scope.$on("change_tab_/finished-monthly",function(){ScheduleCluster.funFinishedScheduleClusters(scope)}),scope.goToScheduleCluster=function(id){location.hash="/monthly/"+id}}}}).directive("tmpltMentorScheduleClusterRequests",function($http){return{restrict:"E",templateUrl:"/templates/mentor_schedule_cluster_requests.html",link:function(scope){scope.db.hideScheduleClusterRequestsLoading=!1;var funScheduleClusterRequests=function(){var url="/api/dashboard/mentor/schedule_cluster_requests";scope.qid&&(url+="/"+scope.qid),$http.get(url).success(function(data){scope.db.hideScheduleClusterRequestsLoading=!0,scope.qid?scope.sc=data.schedule_cluster:scope.scheduleClusters=data.schedule_clusters})};"/monthly-requests"==scope.db.tab&&funScheduleClusterRequests(),scope.$on("change_tab_/monthly-requests",function(){funScheduleClusterRequests()}),scope.goToScheduleClusterRequest=function(id){location.hash="/monthly-requests/"+id}}}}).directive("tmpltUnpublishedTutorials",function($http){return{restrict:"E",templateUrl:"/templates/unpublished-tutorials.html",link:function(scope){scope.unpublishedTutorials=[],scope.db.hideUnpublishedTutorialsLoading=!1;var funTutorialDrafts=function(){var url="/api/dashboard/mentor/tutorials/unpublished";$http.get(url).success(function(data){scope.db.hideUnpublishedTutorialsLoading=!0,scope.unpublishedTutorials=data.articles})};"/unpublished-tutorials"==scope.db.tab&&funTutorialDrafts(),scope.$on("change_tab_/unpublished-tutorials",function(){funTutorialDrafts()})}}}).directive("tmpltPublishedTutorials",function($http){return{restrict:"E",templateUrl:"/templates/published-tutorials.html",link:function(scope){scope.publishedTutorials=[],scope.db.hidePublishedTutorialsLoading=!1;var funPublishedTutorials=function(){var url="/api/dashboard/mentor/tutorials/published";$http.get(url).success(function(data){scope.db.hidePublishedTutorialsLoading=!0,scope.publishedTutorials=data.articles})};"/published-tutorials"==scope.db.tab&&funPublishedTutorials(),scope.$on("change_tab_/published-tutorials",function(){funPublishedTutorials()})}}}).directive("tmpltApplication",function(){return{restrict:"E",templateUrl:"/templates/application.html.haml",link:function(){}}}),angular.module("appDirectory",["ngSanitize"]).controller("DirectoryCtrl",function($rootScope,$scope,$http,$location,$timeout,$modal,NewModal,User,Chat,$window){function clearLanguages(){$scope.languages={}}var that=this;$scope.currentPage=1,$scope.itemsPerPage=30,$scope.totalCount=0,$scope.query_term="",$scope.items=[],$scope.facets=[],$scope.tags_name=[],$scope.isSearch=!1,$scope.loaded=!1,$scope.urlChanged=!0,$scope.client=new AlgoliaSearch(gon.agoliaAPPID,gon.agoliaAPIKey),$scope.index=$scope.client.initIndex(gon.agoliaMentorIndex),$scope.iconArray=[],$scope.noRecommend=!1,$scope.gID=0,$scope.languages={},$scope.redirectUrls=[],$scope.topicCats={},$scope.topicCatUrl=!1,$scope.topicCatName=!1,$scope.relatedCat=null,$scope.reviews=[],this.showLanguageFilter=!1,$scope.initialSet=function(queryString,rateLevel,hirable,firstSessionFree,totalCount,currentPage,itemsPerPage,icons,gID,checkedLanguages,topics,topicCats){$scope.tags_name=_.map(queryString.trim().split(" "),function(c){return c.toLowerCase().replace(/[^#\+\-\.0-9A-Za-z]/g,"-").replace(/-+/g,"-")}),$scope.rateLevel=rateLevel,$scope.hirable=hirable,$scope.firstSessionFree=firstSessionFree,$scope.totalCount=totalCount,$scope.currentPage=currentPage,$scope.itemsPerPage=itemsPerPage,$scope.iconArray=icons,$scope.gID=gID,$scope.redirectUrls=topics,$scope.topicCats=topicCats;for(var i=0;i<checkedLanguages.length;i++)$scope.languages[checkedLanguages[i]]=!0},$rootScope.floatRound=function(f,n){n||(n=0);var p=Math.pow(10,n),r=Math.round(f*p)/p;return 10*r%10===0&&(r+=".0"),r},$rootScope.$on("$locationChangeStart",function(e){var pathMatch2,pathMatch=$location.path().match(/(([\w#_\-\.]+)-)?experts/);return that.initPathMatch2?pathMatch2=$location.path().match(/(([\w#_\-\.]+)-)?experts\/.+/):(pathMatch2=!1,that.initPathMatch2=!0),!pathMatch&&!pathMatch2||isMatchTopicUrl()?($window.location.href=$location.url(),e.preventDefault(),!1):void 0}),$rootScope.$on("$locationChangeSuccess",function(){var pathMatch=$location.path().match(/(([\w#_\-\.]+)-)?experts$/);if(pathMatch||(pathMatch=$location.path().match(/(([\w#_\-\.]+)-)?experts\/.+/)),!$scope.urlChanged){var params=$location.search();params.q=params.q||"",void 0!=User.groups&&isGroupMember(params.g),pathMatch[2]&&-1==params.q.indexOf(pathMatch[2])&&("famous"==pathMatch[2]&&(pathMatch[2]="famo.us"),params.q+=pathMatch[2]+" "),params.q=params.q.replace(/_plus/g,"+").replace(/_sharp/g,"#").replace(/^dot_/g,".").replace(/_css/g,"-css"),$scope.$emit("clearLanguages",[]),clearLanguages(),params.q?($scope.tags_name=params.q.trim().replace("%20"," ").split(" "),$scope.$emit("changeTags",$scope.tags_name)):($scope.tags_name=[],$scope.$emit("changeTags",[])),$scope.rateLevel=params.r>0?params.r:0,$scope.hirable=params.h>0?params.h:!1,$scope.firstSessionFree=params.f>0?params.f:!1,$scope.currentPage=params.p>1?params.p:1,$scope.searchAlgolia(!0)}$scope.urlChanged=!1});var isMatchTopicUrl=function(){for(var i=0;i<$scope.redirectUrls.length;i++)if($location.path().match("experts/"+$scope.redirectUrls[i]))return!0;return!1},isGroupMember=function(){var i,isMember=!1;for(i=0;i<User.groups.length;i++)User.groups[i]==$scope.gID&&(isMember=!0);0==isMember&&0==$scope.gID},changeUrl=function(){var search={};$scope.query_term&&(search.q=$scope.query_term),$scope.rateLevel>0&&(search.r=$scope.rateLevel),$scope.hirable&&(search.h=$scope.hirable+""),$scope.firstSessionFree&&(search.f=$scope.firstSessionFree+""),$scope.currentPage>1&&(search.p=$scope.currentPage);var langs="";for(var i in $scope.languages)$scope.languages[i]===!0&&(langs.length>0&&(langs+=","),langs+=i);langs&&(search.lang=langs),$scope.urlChanged=!0,$location.path("/experts").search(search)};$scope.addTag=function(url_string){var params=$location.search();params.q=params.q||"",params.q=params.q.replace(/_plus/g,"+").replace(/_sharp/g,"#").replace(/^dot_/g,".").replace(/_css/g,"-css"),$scope.tags_name=params.q?params.q.trim().replace("%20"," ").split(" "):[],$scope.tags_name.indexOf(url_string)<0&&($scope.tags_name.push(url_string),$scope.$emit("changeTags",$scope.tags_name),$scope.searchAlgolia(!1))},$scope.addSubTag=function(url_string){var m=$location.path().match(/(([\w#_\-\.]+)-)?experts$/);m||(m=$location.path().match(/(([\w#_\-\.]+)-)?experts\/.+/)),$scope.tags_name=m[2]?[m[2]]:[],$scope.tags_name.indexOf(url_string)<0&&($scope.tags_name.push(url_string),$scope.$emit("changeTags",$scope.tags_name),$scope.searchAlgolia(!0)),$scope.currentPage=1,$scope.rateLevel=0,$scope.urlChanged=!0},$scope.searchAlgolia=function(dontChangeUrl){$scope.query_term=$scope.tags_name.join(" "),dontChangeUrl||changeUrl(),$scope.index.search($scope.query_term,$scope.searchCallback,{hitsPerPage:$scope.itemsPerPage,page:$scope.currentPage-1,numericFilters:$scope.setNumericFilters(),facets:"expertise_names",facetFilters:[getLangFacetFilter()]},500),$scope.isSearch=!0,mixpanel.track("/experts/search",{q:$scope.tags_name,r:$scope.rateLevel,p:$scope.currentPage})},$scope.searchCallback=function(success,result){if($scope.isSearch=!1,result.page==$scope.currentPage-1&&result.query==$scope.query_term){{20*Math.pow(window.scrollY,.5)}$scope.loaded=!0,$scope.isSearch=!1,$scope.items=_.map(result.hits,function(hit){return hit.rate=getRate(hit),hit.group_imgs=getGroupImg(hit),hit.expertises=genExpertises(hit),hit}),$scope.totalCount=result.nbHits,$scope.facets=genFacets(result.facets.expertise_names),$(".h1Title").html("Codementor Software Expert Help"),$(".h1Description").html("Get instant 1:1 help from expert developers on Codementor. Experts on Codementor include book authors, creators of popular open source libraries, and engineers at well-known tech companies."),$(".recentPostHeader").hide(),$(".relatedPost").hide(),$(".showMorePost").hide(),$("h4.getHelpFromExperts").text("Get help from experts"),$scope.noRecommend=0===$scope.facets.length?!0:!1,$scope.tags_name.length>0&&(setTopicCategory($scope.tags_name[0]),setRelatedCategory($scope.tags_name[0]),User.isMember||getReviews($scope.tags_name[0])),$scope.$digest()}},$scope.getNumber=function(num){return new Array(num)};var getReviews=function(url_string){$http.get("/api/reviews?category_url_string="+url_string).success(function(data){$scope.reviews=data.reviews}).error(function(){$scope.reviews=[]})},setRelatedCategory=function(url_string){var name,url;name=url_string.toLowerCase().replace(/^\./g,"dot_").replace(/\./g,"").replace(/\+/g,"_plus").replace(/\#/g,"_sharp").replace(/\-css/g,"_css").replace(/[^0-9A-Za-z_]/g,"-").replace(/^-+/,"").replace(/-+$/,""),url="/api/get_child_categories?category_url_string="+name,$http.get(url).success(function(data){$scope.relatedCat=data}).error(function(){$scope.relatedCat=null})},setTopicCategory=function(url_string){var name=url_string;for(var i in $scope.topicCats){var n=$scope.topicCats[i].url_string.replace(/_plus/g,"+").replace(/_sharp/g,"#").replace(/^dot_/g,".").replace(/_css/g,"-css");if(n==name)return $scope.topicCatUrl=$scope.topicCats[i].url_string,$scope.topicCatName=$scope.topicCats[i].name,!0}return $scope.topicCatUrl=!1,$scope.topicCatName=!1,!1},getLangFacetFilter=function(){var langFilter=[];for(var i in $scope.languages)$scope.languages[i]===!0&&langFilter.push("language_index:"+i[0].toUpperCase()+i.substring(1));return langFilter},getMutualGroups=function(hit){return _.filter(hit.group_for_index,function(gi){return User.groups?User.groups.indexOf(gi.id)>-1:!1})},getGroupImg=function(hit){return _.map(getMutualGroups(hit),function(group){return group.icon})},getExpTagUrl=function(expertiseName){return expertiseName.toLowerCase().replace(/^\./g,"dot_").replace(/\./g,"").replace(/\+/g,"_plus").replace(/\#/g,"_sharp").replace(/\-css/g,"_css").replace(/[^0-9A-Za-z_]/g,"-").replace(/^-+/,"").replace(/-+$/,"")},getExpUrl=function(expertiseName){return"/"+getExpTagUrl(expertiseName)+"-experts"},addEmTag=function(displayName,url){for(var i=0;i<$scope.tags_name.length;i++)if(getExpTagUrl($scope.tags_name[i])==url)return"<em>"+displayName+"</em>";return displayName},genFacets=function(exps){var facets=[],i=0;for(var expName in exps)if($scope.tags_name.indexOf(expName.toLowerCase())<0){var icon;if(icon=expName in $scope.iconArray?"/assets/category_icons/"+$scope.iconArray[expName]+".png":"/assets/category_icons/no-icon.png",facets.push({url:getExpTagUrl(expName),name:expName,count:exps[expName],icon:icon}),i>=9)break;i+=1}return facets},genExpertises=function(hit){return _.map(hit.expertise_names,function(exp){return{route:getExpUrl(exp),name:addEmTag(hit.expertise_display_names[exp],getExpTagUrl(exp))}})},getRate=function(hit){var longterm=_.find(hit.longterm_list,function(longterm){return longterm.username==User.username&&1e3*longterm.valid_to>(new Date).getTime()});if(longterm)return returnRate(longterm.rate,"(long-term mentorship rate)");var groups=getMutualGroups(hit);if(groups.length>0)return returnRate(groups[0].default_rate,"("+groups[0].name+" rate)");var specialterm=_.find(hit.rate_list,function(specialterm){return specialterm.username==User.username});return specialterm&&specialterm.rate!=hit.rate_for_index?returnRate(specialterm.rate,"(special rate)"):returnRate(hit.rate_for_index)},returnRate=function(rate,reason){var r="$"+(rate||0).toFixed(2);return reason?r+"<br><small class='red'>"+reason+"</small>":r};$scope.startMsg=function(username,img,displayName){Chat.openChatroomViaAPI(username,img,displayName)},$scope.setRateFilter=function(){switch(parseInt($scope.rateLevel)){case 0:return"rate_for_index>=0";case 1:return"rate_for_index<=20";case 2:return"rate_for_index>20,rate_for_index<= 40";case 3:return"rate_for_index>40";default:return"rate_for_index>=0"}},$scope.setHirableFilter=function(){return $scope.hirable?"contract_job_for_index=1":""},$scope.setFirstSessionFreeFilter=function(){return $scope.firstSessionFree?$scope.User.applicableForFreeSession?"free_length>0":($scope.firstSessionFree=!1,"rate_for_index>=0"):""},$scope.setNumericFilters=function(){var filter=$scope.setRateFilter()+","+$scope.setHirableFilter()+","+$scope.setFirstSessionFreeFilter()+",stamina>50,(rating>3.9, rating=0)";return 0!=$scope.gID&&(filter+=",group_for_index.id="+$scope.gID),filter},$scope.setGroup=function(gID){$scope.gID=gID,$scope.currentPage=1,$scope.rateLevel=0,$scope.searchAlgolia()},$scope.$watch("rateLevel",function(){that.initRateLevel?($scope.currentPage=1,$scope.gID=0,$scope.searchAlgolia()):that.initRateLevel=!0}),$scope.$watch("hirable",function(n){that.initHirable?($scope.hirable=n,$scope.currentPage=1,$scope.gID=0,$scope.searchAlgolia()):that.initHirable=!0}),$scope.$watch("firstSessionFree",function(){that.initFirstSessionFree?($scope.currentPage=1,$scope.gID=0,$scope.searchAlgolia()):that.initFirstSessionFree=!0}),$scope.activeCategory=function(tags_name,cat){var name=cat.toLowerCase().replace(/[^#\+\-\.0-9A-Za-z]/g,"-").replace(/-+/g,"-");return 1==tags_name.length?tags_name[0]==name:2==tags_name.length&&$location.path().match(/(([\w#_\-\.]+)-)?experts\/\2\-.+/)?-1!=tags_name.indexOf(name):!1},$scope.filterIsSelected=function(level){return $scope.rateLevel===level},$scope.updateTags=function(tags){$scope.tags_name=_.map(tags,function(tag){return tag.text.toLowerCase().replace(/[^#\+\-\.0-9A-Za-z]/g,"-").replace(/-+/g,"-")}),$scope.currentPage=1,$scope.searchAlgolia()},$scope.prevPage=function(){$scope.currentPage>1&&($scope.currentPage--,$scope.searchAlgolia())},$scope.range=function(){var start,end,rangeSize=10,ret=[];start=Math.ceil($scope.currentPage-rangeSize/2),start>$scope.pageCount()-rangeSize&&(start=$scope.pageCount()-rangeSize+1),0>=start&&(start=1),end=start+rangeSize,end>$scope.pageCount()&&(end=$scope.pageCount()+1);for(var i=start;end>i;i++)ret.push(i);return ret},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.pageCount=function(){return Math.ceil($scope.totalCount/$scope.itemsPerPage)},$scope.nextPage=function(){$scope.currentPage<$scope.pageCount()&&($scope.currentPage++,$scope.searchAlgolia())},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.pageCount()?"disabled":""},$scope.setPage=function(n){$scope.currentPage=n,$scope.searchAlgolia(),$("html, body").animate({scrollTop:44},20*Math.pow(window.scrollY,.5))},$scope.genEmptyRateRange=function(rating){return _.range(5-Math.round(rating))},$scope.genRateRange=function(rating){return _.range(Math.round(rating))};var _focusSearchInput=function(){$timeout(function(){angular.element(".searchBarContent .tags > input").focus()})};this.firstTimeSurvey=function(){NewModal.open("first-time-survey",{windowClass:"first-time-survey",backdrop:"static",keyboard:!1,footer:!1,ok:function(result){result&&_focusSearchInput(),window.showMessage("notice",'Great! Let\'s start from <b>Search</b> or <a href="/questions/new">Get Help Now</a>',function(){})},cancel:function(reason){}})},$scope.onLanguageChange=function(lang){$scope.languages[lang.text.toLowerCase()]=lang.checked,$scope.currentPage=1,$scope.searchAlgolia(!1)},gon.first_time_sign_in&&!(User.groups||{}).length&&(!window.localStorage||(new Date).getTime()-parseInt(JSON.parse(localStorage.skipSurveyObj||"{}")[User.username]||0)>864e5)&&this.firstTimeSurvey()}),angular.module("appDirectoryTopic",["ngSanitize"]).controller("DirectoryTopicCtrl",function($scope,$window){$scope.tags_name=[],$scope.searchCount=0,$scope.updateTags=function(tags){$scope.tags_name=_.map(tags,function(tag){return tag.text}),$scope.searchCount-=1};var genUrl=function(){var query_string="";return 1==$scope.tags_name.length?query_string="/"+$scope.tags_name[0]+"-experts":$scope.tags_name.length>1&&(query_string="/experts?q="+$scope.tags_name.join("%20")),query_string};$(document).on("keyup",".question_category_names input",function(event){13==event.which&&($scope.searchCount+=1,1==$scope.searchCount&&$scope.searchAndRedirect())}),$scope.searchAndRedirect=function(){$window.location.href=genUrl()}}),angular.module("appEditExpertise",[]).controller("editExpertiseCtrl",function($scope,$http,$window){$scope.expertise=[],$scope.expObj={},$scope.newExp=[],$scope.user_id,$scope.submitBtn="Submit Application",$scope.isSubmitting=!1,$scope.initialSet=function(expertise,user_id){$scope.expertise=JSON.parse(expertise),$scope.user_id=user_id,$scope.expertise.length>0&&($scope.expObj=$scope.expertise[0],$scope.expertise=$scope.expertise.map(function(exp){return 0==exp.experience&&(exp.experience=null),0==exp.p_rating&&(exp.p_rating=null),exp}))},$scope.updateTags=function(tags){$scope.expObj.tags=_.map(tags,function(tag){return tag.text.toLowerCase().replace(/[^#\+\-\.0-9A-Za-z]/g,"-").replace(/-+/g,"-")})},$scope.changeTab=function(exp){$scope.expObj=exp,$scope.$emit("changeTags_tagsCtrl",exp.tags)},$scope.removeExp=function(exp){var index=$scope.expertise.indexOf(exp);confirm("Do you really want to delete "+exp.display_name+"? You will not receive any request related to this expertise anymore. Are you sure?")&&index>-1&&($scope.expertise.splice(index,1),$scope.expObj=$scope.expertise.length>0?$scope.expertise[0]:{})},$scope.openModal=function(){$scope.newExp=[],$scope.$emit("changeTags_nec",[]),$("#newExpertise").modal("show")},$scope.saveAndRoute=function(user_id,currentPage,toPage){$scope.isSubmitting=!0,$scope.submitBtn="Submit Application",$http.post("/mentor/"+$scope.user_id+"/add_expertise",{expertise:$scope.expertise}).success(function(){$window.location="/mentor/"+user_id+"/edit/"+toPage}).error(function(){$scope.isSubmitting=!1,$scope.submitBtn="Submit Application"})},$scope.createNewExpertise=function(){$scope.expertise=$scope.expertise.concat($scope.newExp),$scope.newExp.length>0&&$scope.changeTab($scope.newExp[0]),$scope.newExp=[],$scope.$emit("changeTags_nec",[]),$("#newExpertise").modal("hide")},$scope.addNewExpertise=function(tag){for(var obj={display_name:tag.text,name:tag.text,description:"",experience:null,p_rating:null,tags:[]},i=$scope.expertise.length-1;i>=0;i--)if($scope.expertise[i].name==tag.text)return;for(var i=$scope.newExp.length-1;i>=0;i--)if($scope.newExp[i].name==tag.text)return;$scope.newExp.push(obj)},$scope.removeNewExpertise=function(tag){for(var i=$scope.newExp.length-1;i>=0;i--)$scope.newExp[i].name==tag.text&&$scope.newExp.splice(i,1)},$scope.submitApplication=function(){$scope.isSubmitting=!0,$scope.submitBtn="Submitting...",$http.post("/mentor/"+$scope.user_id+"/add_expertise",{expertise:$scope.expertise}).success(function(){$window.location.href="/mentor/"+$scope.user_id+"/save/2"}).error(function(){$scope.isSubmitting=!1,$scope.submitBtn="Submit Application"})},$scope.goBack=function(){$scope.isSubmitting=!0,$http.post("/mentor/"+$scope.user_id+"/add_expertise",{expertise:$scope.expertise}).success(function(){$window.location.href="/mentor/"+$scope.user_id+"/edit/1"}).error(function(){$scope.isSubmitting=!1})}}),angular.module("appExpertiseForm",["appCategory"]).controller("NewExpertiseFormCtrl",function($q,$http,$scope,TagUtils){$scope.recommandations=[],$scope.categoryTags=[],$scope.relatedTags=[],this.loadTags=TagUtils.loadTags,this.removeWarning=function(){$scope.categoryTags.length>0&&($scope.requiredWarning=!1)},this.updateRecommand=function(){var allTags=_.last(_.union($scope.categoryTags,$scope.relatedTags),4);if(0==allTags.length)return void($scope.recommandations=[]);var deferred=$q.defer(),tagsStr=_.map(allTags,function(t){return t.text}).join(";").replace("#","%23");$.getJSON("https://api.stackexchange.com/2.2/tags/"+tagsStr+"/related?site=stackoverflow&key=LecJZYqlUgzwPLAVNQ6KYA((",function(data){deferred.resolve(data)}),deferred.promise.then(function(results){$scope.recommandations=_.map(_.first(results.items,6),function(item){return item.name})})},this.onAddCategoryTag=function(tag){if($scope.categoryTags.length>1)$scope.categoryTags.pop();else{var _tmpTag=_.clone(tag);_tmpTag.text=TagUtils.convert(_tmpTag.text),tag.text!=_tmpTag.text&&$scope.categoryTags.pop()&&$scope.categoryTags.push(_tmpTag),this.removeWarning(),this.updateRecommand()}}.bind(this),this.onRemoveCategoryTag=function(){this.updateRecommand()}.bind(this),this.onAddRelatedTag=function(tag){if($scope.relatedTags.length>8)$scope.relatedTags.pop();else if($scope.categoryTags.length>0&&TagUtils.convert(tag.text)==TagUtils.convert($scope.categoryTags[0].text))$scope.relatedTags.pop();else{var _tmpTag=_.clone(tag);_tmpTag.text=TagUtils.convert(_tmpTag.text),tag.text!=_tmpTag.text&&$scope.relatedTags.pop()&&$scope.relatedTags.push(_tmpTag),this.updateRecommand()}}.bind(this),this.onRemoveRelatedTag=function(){this.updateRecommand()}.bind(this),this.clickToAddTag=function(tagName){if(!($scope.relatedTags.length>8)){var _tagName=TagUtils.convert(tagName);
_.find($scope.relatedTags,function(t){return t.text==_tagName})||$scope.relatedTags.push({text:TagUtils.convert(_tagName)}),this.updateRecommand()}}.bind(this),this.onSubmit=function(e){return 0==$scope.categoryTags.length?(e.preventDefault(),e.stopPropagation(),$scope.requiredWarning=!0,!1):void 0}.bind(this)}),angular.module("appFaq",[]).factory("FaqUtils",function(){return{scrollTo:function(selector){var to=parseInt(selector);to||(to=($(selector).offset()||{}).top||0),$("html, body").animate({scrollTop:Math.max(to-70,0)},400)}}}).controller("faqCtrl",function($rootScope,$scope,$anchorScroll,$location,FaqUtils){$rootScope.$on("$locationChangeSuccess",function(){"/"!=$location.path()&&FaqUtils.scrollTo("#"+$location.path().replace("/",""))})}),angular.module("appFavorite",[]).directive("favoriteStar",function(User,$document,$http){$document.find('meta[name="csrf-token"]').attr("content");return{restrict:"E",scope:{username:"@"},controller:function($scope){$scope.favorited=!!_.contains(User.favorite_users,$scope.username),$scope.toggleFavorite=function(){$scope.favorited?($http["delete"]("/users/favorite_users/"+$scope.username),User.favorite_users=_.reject(User.favorite_users,function(n){return n==$scope.username})):($http.post("/users/favorite_users/"+$scope.username),User.favorite_users.push($scope.username)),$scope.favorited=!$scope.favorited},$scope.$watch(function(){return User.favorite_users.length},function(){$scope.favorited=!!_.contains(User.favorite_users,$scope.username)})},link:function(scope,element){scope.$on("$destroy",function(){element.click(function(){element.hasClass("favorited")?element.removeClass("favorited"):element.addClass("favorited")})})},replace:!0,template:'<div class="favorite" ng-class="{favorited: favorited}" ng-click="toggleFavorite()" style="cursor: pointer;"><i class="icon-star"></i></div>'}}),angular.module("appFreeCredit",[]).controller("FreeCreditCtrl",function($scope,$http,User,SignUpForm){this.code="",this.types={basicDark:"//cdn.codementor.io/badges/codementor_dark@2x.png",basicLight:"//cdn.codementor.io/badges/codementor_light@2x.png",builtDark:"//cdn.codementor.io/badges/built_with_codementor_dark@2x.png",builtLight:"//cdn.codementor.io/badges/built_with_codementor_light@2x.png",poweredDark:"//cdn.codementor.io/badges/powered_by_codementor_dark@2x.png",poweredLight:"//cdn.codementor.io/badges/powered_by_codementor_light@2x.png"},this.url="",this.genCode=function(type){return this.types[type]?'<a href="https://www.codementor.io"><img width="108" src="'+this.types[type]+'" alt="Codementor" /></a>':""},this.doSelect=function(e){e.target.select()},this.verifyBadge=function(){User.username?this.url.trim()&&(this.loading=!0,this.urlSuccess="",this.urlError="",$http.post("/api/badge/verify",{url:this.url.trim()}).success(function(res){res.success?this.urlSuccess="Success - your badge has been detected and you will receive the free credit soon.":this.urlError="THE BADGE WAS NOT FOUND ON THAT PAGE.",this.loading=!1}.bind(this)).error(function(){this.loading=!1,this.urlError="ERROR! PLEASE TRY AGAIN."}.bind(this))):SignUpForm.open({onopen:function(){angular.element('input[name="utm_form"]').val("user_badge")},title:"Please Sign Up to Continue",becomeMentorLink:!1})}.bind(this),this.changeBadge=function(badgeName){this.badgeType=badgeName},this.compareBadge=function(badge){return this.badgeType===badge},$scope.$watch("fc.badgeType",function(n){n&&(this.code=this.genCode(n))}.bind(this)),this.badgeType="basicDark"}),angular.module("appFindMentor",[]).factory("TopBottomEvent",function($rootScope){function bodyScrollState(){return document.documentElement.clientHeight+$(document).scrollTop()>=document.body.offsetHeight?"bottom":0==$(document).scrollTop()?"top":!1}function checkScroll(){var state=bodyScrollState(),bottom="bottom"==state,top="top"==state;scope.$emit("bodyScrollBottom",bottom),scope.$emit("bodyScrollTop",top)}var scope=$rootScope.$new(!0);return $(window).scroll(checkScroll),{scope:scope,checkScroll:checkScroll}}).controller("findMentorsCtrl",function($scope,$http,$rootScope,$timeout,$location,$anchorScroll,$window,User,RefreshAlert,TopBottomEvent){$scope.init=function(params){$scope.original_budget=params.budget,$scope.budget=$scope.original_budget,$scope.offlineMentorDisplay="budget",$scope.isBroadcasted=params.isBroadcasted,$scope.broadcastUrl=params.broadcastUrl,$scope.initStep=params.step,$scope.loading=!0,$scope.percentage=100,$scope.remove_loading(),$rootScope.$on("$routeChangeSuccess",function(){switch($location.path()){case"/online_mentors":$scope.step=1;break;case"/available_mentors":$scope.step=2}}),$scope.bottom=!1,TopBottomEvent.scope.$on("bodyScrollBottom",function(e,state){$timeout(function(){$scope.bottom=state})}),$scope.goStep($scope.initStep),$scope.show=!0,$scope.online_mentor_count=params.online_mentor_count,$scope.offline_mentor_count=params.online_mentor_count,$window.showMessage("notice","Your request has been broadcasted to Codementor experts. In the mean time, you are also free to connect with one of the expert mentors below.",null,"broadcastSuccess"),mixpanel.track("Find Mentor",{online_mentor_count:$scope.online_mentor_count,offline_mentor_count:$scope.offline_mentor_count})},$scope.offlineMentorShow=function(state){$scope.offlineMentorDisplay=state,$scope.budget="all"==state?999999:$scope.original_budget},$scope.remove_loading=function(){$timeout(function(){$scope.loading=!1,$anchorScroll(),$scope.isBroadcasted||$scope.doBroadcast()},4500)},$scope.doBroadcast=function(){$scope.broadcastUrl&&void 0!=$scope.isBroadcasted&&1!=$scope.isBroadcasted&&$http.post($scope.broadcastUrl).success(function(){$scope.isBroadcasted=!0,$window.showMessage("notice","Your request has been broadcasted to Codementor experts. In the mean time, you are also free to connect with one of the expert mentors below.",null,"broadcastSuccess"),mixpanel.track("Find Mentor - broadcasted")}).error(function(data,status){401==status&&RefreshAlert.open("logout")})},$scope.goStep=function(n){switch(n>$scope.loaded&&!$scope.isBroadcasted&&($scope.loading=n,$scope.loaded=n,$scope.remove_loading()),n){case 1:$location.path("/online_mentors"),mixpanel.track("Find Mentor - step 1: online_mentors",{online_mentor_count:$scope.online_mentor_count});break;case 2:$location.path("/available_mentors"),mixpanel.track("Find Mentor - step 2: available_mentors",{offline_mentor_count:$scope.offline_mentor_count})}TopBottomEvent.checkScroll(),$("#broadcastSuccess > .close").click()}}),angular.module("appFirebase",["firebase"]).config(function($caser,$firebaseProvider){var _config={except:/^-/};$firebaseProvider.extend={$push$:function(item){return this.$add($caser.toSnakeCase(item,_config))},$bind$:function(scope,key){var promise=this.$bind(scope,"$$"+key+"$$");return scope.$watch("$$"+key+"$$",function(){scope[key]=$caser.toCamelCase(scope["$$"+key+"$$"],_config)}),promise},$on$:function(type,callback){return this.$on(type,function(response){callback($caser.toCamelCase(response,_config))})},$once$:function(type,callback){return this.$on(type,function(response){callback($caser.toCamelCase(response,_config))})}}}).factory("Firebase",function($init,$firebase){return function(location,queries){var fb=new Firebase($init.firebase.path+location);return angular.isFunction(queries)&&(fb=queries(fb)),$firebase(fb)}}),angular.module("appHelpListingShow",[]).controller("helpListingShowCtrl",function($scope,$timeout){$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(){}})},0),$scope.popReceiveTutorialForm=function(){$("#email_collection_modal").modal()}}),angular.module("appHourOfCode",[]).config(function($locationProvider){gon.normalHashPage&&$locationProvider.html5Mode(!0)}).controller("hourOfCodeCtrl",function(NewModal,$rootScope,$location,$anchorScroll,$window,$http){function validate(){if(that.data.errorName=!1,that.data.errorEmail=!1,that.data.errorRequirement=!1,that.data.name&&that.data.email&&that.data.requirement){var name=that.data.name.trim(),email=that.data.email.trim(),requirement=that.data.requirement.trim();return name&&email&&requirement?[name,email,requirement]:(that.data.errorName=!name,that.data.errorEmail=!email,that.data.errorRequirement=!requirement,that.data.errorMsg="All fields are required.",!1)}return that.data.errorName=!that.data.name,that.data.errorEmail=!that.data.email,that.data.errorRequirement=!that.data.requirement,that.data.errorMsg="All fields are required.",!1}var that=this;this.data={},$rootScope.$on("$locationChangeStart",function(e){var pathMatch=$location.path().match(/hourofcode/);return pathMatch?void 0:($window.location.href=$location.url(),e.preventDefault(),!1)}),this.submit=function(kind){var submitDate=validate();submitDate&&$http.post("/api/hourofcode",{kind:kind,name:submitDate[0],email:submitDate[1],requirement:submitDate[2],timezoneOffset:(new Date).getTimezoneOffset()}).success(function(){that.data.success=!0,mixpanel.track("/hourofcode/submit",{kind:kind})}).error(function(){that.data.errorMsg="Something went wrong, please try again later."})},this.scrollTo=function(hash){$location.hash(hash),$anchorScroll()},this.openStudentForm=function(){NewModal.open("hour-of-code-student",{windowClass:"hour-of-code-student-modal",footer:!1,data:that.data,onSubmit:that.submit,ok:function(){that.data={}},cancel:function(){that.data={}}}),mixpanel.track("/hourofcode/open_form/",{kind:"student"})},this.openTeacherForm=function(){NewModal.open("hour-of-code-teacher",{windowClass:"hour-of-code-teacher-modal",footer:!1,data:that.data,onSubmit:that.submit,ok:function(){that.data={}},cancel:function(){that.data={}}}),mixpanel.track("/hourofcode/open_form/",{kind:"teacher"})}}),angular.module("appInvoice",["appUser","appPayment","appLesson"]).controller("InvoiceController",function(User,Payment,Lesson){function submitEvent(){if(confirm(confirmContent)){var tips=$("#tipAmount").val();$("#payNow").attr("disabled",!0),$("#payNow").html("Processing..."),$("#submitNotSatisfied").attr("disabled",!0),mixpanel.track("/invoice/tips",{tip_amount:tips}),mixpanel.track("/invoice/pay_now"),$("#payForm").submit()}}function calCreditTotal(){var url="/api/lessons/"+lessonId+"/estimated_cost?tips="+$("#tipAmount").val().toString();$("#calLoading").show(),$.get(url,function(data){var $obj=$("#creditAmount");if(0!=data.credit?($obj.html(parseFloat(data.credit)),$obj.addClass("colorRed")):($obj.html(0),$obj.removeClass("colorRed")),specialterm){var $longterm_obj=$("#longterm_creditAmount");0!=data.longterm_credit?($longterm_obj.html(parseFloat(data.longterm_credit)),$longterm_obj.addClass("colorRed")):($longterm_obj.html(0),$longterm_obj.removeClass("colorRed"))}data.money>=0&&$("#totalAmount").html(parseFloat(data.money)),data.money>0?($("#payNow").html("Pay Now!"),confirmContent="Your "+(User.team_id?"organization's ":" ")+"credit card will be charge $"+data.money+" for the session."):($("#payNow").html("Confirm"),confirmContent="Your "+(User.team_id?"organization's ":" ")+"credit will be deducted for the session."),$("#calLoading").hide()})}function isPositiveFloat(n){var regex=/^(?:[1-9]\d*|0)?(?:\.\d+)?$/;return null==n.match(regex)?!1:!0}var that=this,paid=gon.paymentProcessed,isMonthly=gon.isMonthly,specialterm=gon.specialterm,lessonId=gon.lessonId,confirmContent="";gon.openFeedbackModal&&Lesson.openFeedbackModal({lessonId:lessonId,steps:gon.feedbackSteps}),that.openPaymentSettingForm=function(warning){Payment.openSettingForm({warning:warning,ok:function(){User.hasPayment=!0,User.cardAuthorized=!0,submitEvent()}})},paid||isMonthly||(calCreditTotal(),$("#tipAmount").on("blur",function(){var tips=$(this).val();isPositiveFloat(tips)&&parseFloat(tips)||$(this).val(0),calCreditTotal()}),$("#payNow").on("click",function(){var url="/api/lessons/"+lessonId+"/estimated_cost?tips="+$("#tipAmount").val().toString();event.preventDefault(),$("#calLoading").show(),$.get(url,function(data){0!=data.credit&&($("#creditRow").show(),$("#creditAmount").html(parseFloat(data.credit))),1==specialterm&&0!=data.longterm_credit&&($("#longterm_creditRow").show(),$("#longterm_creditAmount").html(parseFloat(data.longterm_credit))),data.money>0?($("#totalAmount").html(parseFloat(data.money)),User.team_id||User.hasPayment&&User.cardAuthorized?submitEvent():that.openPaymentSettingForm()):submitEvent(),$("#calLoading").hide()})}),$("#submitNotSatisfied").on("click",function(){var tips=$("#tipAmount").val();$(this).attr("disabled",!0),$(this).html("Processing..."),$("#payNow").attr("disabled",!0),mixpanel.track("/invoice/tips",{tip_amount:tips}),mixpanel.track("/invoice/invoice_question"),$("#notSatisfiedForm").submit()}),$("#triggerTips").on("click",function(){$(this).hide(),$("#tipsRow").show(),$("#tipAmount").focus()}),$("#tipAmount").bind("keyup paste",function(){$("#tipHideAmount").val($(this).val())}))}),angular.module("appLanguage",["ngTagsInput","ngResource"]).controller("LanguageCtrl",function($scope,$resource,$location,$q,$timeout,$rootScope){function removeFromCheckedlanguages(tag){for(var i in $scope.checkedLanguages)if($scope.checkedLanguages[i].text===tag.text){$scope.checkedLanguages.splice(i,1);break}}function addToCheckedlanguages(tag){removeFromCheckedlanguages(tag),$scope.checkedLanguages.push(tag)}function removeFromPopularLanguages(tag){for(var i in $scope.popularLanguages)if($scope.popularLanguages[i].text===tag.text){$scope.popularLanguages.splice(i,1);break}}function addToPopularLanguages(tag){removeFromPopularLanguages(tag),$scope.popularLanguages.push(tag)}$scope.popularLanguages=[],$scope.loading=!0,$scope.checkedLanguages=[],$scope.showAdd=!0,$scope.firstHide=!0;var langInputElement,langInputBox,suggestElement;$timeout(function(){langInputElement=angular.element("#add-lang-btn input"),langInputBox=angular.element("#add-lang-btn .host .tags")[0],suggestElement=angular.element("#add-lang-btn auto-complete")[0],langInputElement.blur(function(){langInputElement[0].value="",langInputElement[0].style.width="80px",langInputBox.style.display="none",$scope.showAdd=!0}),suggestElement.style.position="absolute",suggestElement.style.top="30px",suggestElement.style.width="100%"},0);var otherLanguages=[],langResource=$resource($location.protocol()+"://"+$location.host()+":"+$location.port()+"/get_all_languages");langResource.get({},function(langList){otherLanguages=langList.data.other_languages,$scope.loading=!1,$scope.popularLanguages=langList.data.popular_languages;var isFind=!1;for(var i in $scope.checkedLanguages){isFind=!1;for(var j in $scope.popularLanguages)if($scope.checkedLanguages[i].text===$scope.popularLanguages[j].text){$scope.popularLanguages[j]=$scope.checkedLanguages[i],isFind=!0;break}if(!isFind){$scope.popularLanguages.push($scope.checkedLanguages[i]);for(var k in otherLanguages)if(otherLanguages[k]===$scope.checkedLanguages[i].text){otherLanguages.splice(i,1);break}}}}),$scope.toggleBtn=function(){$scope.showAdd=!$scope.showAdd,$scope.firstHide=!1,langInputBox.style.display="block",$scope.showAdd||$timeout(function(){langInputElement[0].focus()},0)},this.initTags=function(tags){tags&&($scope.checkedLanguages=_.map(tags,function(tag){return tag=tag[0].toUpperCase()+tag.substring(1),{text:tag,checked:!0}}))},this.loadTags=function(query){var langCandidates=[],deferred=$q.defer();for(var i in otherLanguages)0===otherLanguages[i].text.toLowerCase().indexOf(query.toLowerCase())&&langCandidates.push(otherLanguages[i]);return $timeout(function(){deferred.resolve(langCandidates)},0),deferred.promise},this.onAddTag=function(tag){$scope.tags=[],tag.checked=!0,addToPopularLanguages(tag),addToCheckedlanguages(tag),otherLanguages.splice(otherLanguages.indexOf(tag),1)},this.checkChange=function(tag){if(tag.checked){for(var i in $scope.checkedLanguages)if($scope.checkedLanguages[i].text===tag.text){$scope.checkedLanguages.splice(i,1);break}}else $scope.checkedLanguages.push(tag)},angular.element(document).on("keypress","#add-lang-btn input",function(e){return 13==e.keyCode?!1:void 0}),$rootScope.$on("clearLanguages",function(){for(var i=0;i<$scope.popularLanguages.length;i++)$scope.popularLanguages[i].checked=!1})}),angular.module("appLearn",[]).controller("learnCtrl",function($timeout,$scope,Viewport){$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(element,name,direction){if("data48Top"==name){var mq=window.matchMedia("(min-width: 1280px)");if("down"==direction){if(mq.matches&&document.getElementsByClassName("chat-side-bar").length>0){{$(element)}$(element).css({top:48,width:"100%","padding-right":Viewport.width>=1280?"220px":"0px","box-shadow":"0px 3px 4px rgba(0,0,0,0.2)","z-index":6,background:"#fff","box-sizing":"border-box",position:"fixed"})}else $(element).css({top:48,width:"100%","box-sizing":"border-box","box-shadow":"0px 3px 4px rgba(0,0,0,0.2)",background:"#fff","z-index":6,position:"fixed"});$(".second").css({"margin-top":"48px"}),$(".top-promotion-area").hide()}else"up"==direction&&($(element).css(mq.matches&&document.getElementsByClassName("chat-side-bar").length>0?{top:"auto",width:"100%","padding-right":"0px","box-shadow":"none","z-index":3,"box-sizing":"border-box",background:"#e9eaec"}:{top:"auto","box-shadow":"none","z-index":3,background:"#e9eaec"}),$(".second").css({"margin-top":"0px"}),$(".top-promotion-area").show())}}})},0)}),angular.module("appLesson",[]).factory("Lesson",function(NewModal){return{openFeedbackModal:function(options){return options=options||{},NewModal.open("lesson-feedback",{windowClass:"lesson-feedback-modal",keyboard:!1,footer:!1,lessonId:options.lessonId,steps:options.steps,ok:options.ok||function(){},cancel:options.cancel||function(){}})}}}),angular.module("appLongterm",[]).controller("DirectLongtermModalCtrl",function($modalInstance,$http,config){var that=this;that.config=config,that.acceptableHours=1,that.hoursPerWeek="1 hour per week";var isFilled=function(){return that.description&&that.prefer_time?(that.requiredMsgTitle="",!0):(that.requiredMsgTitle="redborder",!1)};that.acceptableHoursChanged=function(){that.hoursPerWeek=that.acceptableHours>1?that.acceptableHours+" hours per week":that.acceptableHours+" hour per week"},that.submit=function(e){var confirmMsg="You are about to send a long-term request to "+that.config.mentorName+".  Are you sure?";!that.loading&&isFilled()&&confirm(confirmMsg)?that.loading=!0:e.preventDefault()}}).factory("LongtermModals",function($modal){return{openDirectRequestModal:function(mentorUsername,mentorName){$modal.open({windowClass:"direct-longterm-modal new-modal",templateUrl:"/template/direct-longterm-modal.html",resolve:{config:function(){var config={mentorUsername:mentorUsername,mentorName:mentorName};return config}},controller:"DirectLongtermModalCtrl as modal"})}}}),angular.module("appMenteeProfile",["surveyService"]).factory("profileUtils",function(){return{scrollTo:function(selector){var to=parseInt(selector);to||(to=($(selector).offset()||{}).top||0),$("html, body").animate({scrollTop:Math.max(to-90,0)},400)}}}).controller("menteeProfileCtrl",function($scope,$window,$timeout,$location,$http,Chat,profileUtils,survey){function getMenteeData(){return gon.mentee_profile_user}function sendUpdateRequest(mentee,section){$http.post("users/mentee_profile",{authenticity_token:$('meta[name="csrf-token"]').attr("content"),user:mentee,section:section}).success(function(data){switch(section){case"time_zone":$scope.mentee.time_zone_str=data.time_zone_str}})}function initMentee(){$scope.mentee=getMenteeData(),$scope.experience=survey.getExperienceLevelText(),$scope.why_use=survey.getWhyUseText(),_.each($scope.why_use,function(item,index){_.contains($scope.mentee.why_use,index)&&(item.selected=!0)}),_.each($scope.mentee.why_use_text,function(item){_.contains($scope.why_use,item)||($scope.mentee.other=!0,$scope.mentee.other_text=item)})}$scope.currentTab="overview",bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(element,name,direction){if("data50Top"==name){var mq=window.matchMedia("(min-width: 1280px)");"down"==direction?$(element).css(mq.matches&&!document.getElementsByClassName("chat-side-bar")?{top:50,"box-shadow":"0px 0px 4px rgba(0,0,0,0.2)","z-index":6}:{top:50,width:"100%","padding-right":Chat.chatSideBar?"220px":"0px","box-shadow":"0px 0px 4px rgba(0,0,0,0.2)","z-index":6,"box-sizing":"border-box"}):"up"==direction&&$(element).css(mq.matches&&!document.getElementsByClassName("chat-side-bar")?{top:"auto","box-shadow":"none","z-index":3}:{top:"auto",width:"100%","padding-right":"0px","box-shadow":"none","z-index":3,"box-sizing":"border-box"})}"dataBottomTop"==name&&"down"==direction&&$(element).hasClass("menuPart")&&$(element).css({top:"auto","box-shadow":"none"})}})},0),$scope.setTab=function(tab){$scope.currentTab=tab,$scope.tabScrollTo("#"+tab)},$scope.isTabSelected=function(tab){return tab==$scope.currentTab},$scope.tabScrollTo=function(selector){profileUtils.scrollTo(selector)},$scope.setTab=function(tab){$scope.currentTab=tab,$scope.tabScrollTo("#"+tab)},$scope.isTabSelected=function(tab){return tab==$scope.currentTab},$scope.tabScrollTo=function(selector){profileUtils.scrollTo(selector)},$scope.updateTags=function(tags){$scope.mentee.need_categories=_.map(tags,function(tag){return tag.text})},$scope.editMode={},$scope.editSection=function(section){$scope.editMode[section]=!0},$scope.submitSection=function(section,cancel){if($scope.editMode[section]=!1,cancel)switch(initMentee(),section){case"need_categories":$scope.$emit("changeTags",$scope.need_cats),$scope.mentee.need_categories=$scope.need_cats;break;case"experience_level":$scope.mentee.experience_level=$scope.experience_level}else"experience_level"===section&&($scope.mentee.experience_level_text=$scope.experience[$scope.mentee.experience_level].title),$scope.mentee.why_use=[],$scope.mentee.why_use_text=[],_.each($scope.why_use,function(item,index){item.selected&&($scope.mentee.why_use.push(index),$scope.mentee.why_use_text.push(item.title))}),$scope.mentee.other&&$scope.mentee.why_use_text.push($scope.mentee.other_text),sendUpdateRequest($scope.mentee,section),$scope.need_cats=$scope.mentee.need_categories},$scope.isEditingSection=function(section){return void 0===$scope.editMode[section]&&($scope.editMode[section]=!1),$scope.editMode[section]},initMentee(),$scope.need_cats=$scope.mentee.need_categories,$scope.experience_level=$scope.mentee.experience_level}),angular.module("appMentorApplyEdit",[]).controller("mentorApplyEditCtrl",function($scope,$http){$scope.categories=[],$scope.selected_categories=[],$scope.user_id="",$scope.input_tags=[],$scope.initial_set=function(user_id){$scope.user_id=user_id,$http.get("/api/mentor/apply/get_init_categories").success(function(data){$scope.categories=JSON.parse(data.categories),$http.get("/api/mentor/"+user_id+"/categories").success(function(data){$scope.selected_categories=JSON.parse(data.categories),$scope.setup_categories()})})},$scope.is_selected_category=function(category){return void 0!==_.find($scope.selected_categories,function(cat){return cat.id==category.id})},$scope.setup_categories=function(){var cats=_.map($scope.categories,function(cat){return cat.id}),init_cats=_.filter($scope.selected_categories,function(cat){return-1==cats.indexOf(cat.id)});$scope.input_tags=_.map(init_cats,function(cat){return cat.name}),$scope.$emit("changeTags",$scope.input_tags)},$scope.saveAndRoute=function(user_id,currentPage,toPage){$("form").attr("action","/mentor/"+user_id+"/save/"+currentPage+"/"+toPage),$("form").submit()}}),angular.module("appMentorProfile",[]).controller("mentorProfileCtrl",function($timeout,$rootScope,$location,$scope,$modal,NewModal,Chat){$("body").attr("id","skrollr-body"),this.checkUrl=function(){var path=$location.path();path&&("/review"==path&&angular.element(".tab-review").size()>0?$scope.currentProfileTab="review":"/activity"==path&&angular.element(".tab-reputation").size()>0?$scope.currentProfileTab="reputation":"/overview"==path&&(path&&$location.path("/overview").replace(),$scope.currentProfileTab="overview"),$scope.scrollToCurrentProfileTab())},$scope.scrollToCurrentProfileTab=function(){$timeout(function(){$("html, body").animate({scrollTop:$("#"+$scope.currentProfileTab).position().top-100+"px"})},0)},bowser.mobile||($timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(element,name,direction){if("data50Top"==name){var mq=window.matchMedia("(min-width: 1280px)");"down"==direction?($(element).css(mq.matches&&!document.getElementsByClassName("chat-side-bar")?{top:50,"box-shadow":"0px 3px 4px rgba(0,0,0,0.2)","z-index":6}:{top:50,width:"100%","padding-right":Chat.chatSideBar?"220px":"0px","box-shadow":"0px 3px 4px rgba(0,0,0,0.2)","z-index":6,"box-sizing":"border-box"}),$(".top-promotion-area").hide()):"up"==direction&&($(element).css(mq.matches&&!document.getElementsByClassName("chat-side-bar")?{top:"auto","box-shadow":"none","z-index":3}:{top:"auto",width:"100%","padding-right":"0px","box-shadow":"none","z-index":3,"box-sizing":"border-box"}),$(".top-promotion-area").show())}else $(element).is("#overview, #reputation, #review")&&("data120TopBottom"==name&&"up"==direction||"data120Top"==name&&"down"==direction)?($(".tabPart .tab").removeClass("active"),$(".tabPart .tab-"+$(element).attr("id")).addClass("active")):"dataBottomTop"==name&&"down"==direction&&$(element).hasClass("tabPart")&&$(element).css({top:"auto","box-shadow":"none"})}})},0),$scope.$on("disableChatBar",function(){angular.element(".tabPart").css({"padding-right":"0px"})}),$scope.$on("enableChatBar",function(){angular.element(".tabPart").css({"padding-right":"220px"})}),$rootScope.$on("$locationChangeStart",this.checkUrl))}).directive("helpListingDeleteBtn",function($window,$http){return{restrict:"E",replace:!0,scope:{hid:"="},template:'<a class="delete" ng-class="{deleting:doing}" href="#" ng-click="deleteHelpListing()"><i class="icon-remove"></i> <span>{{deleteText}}</span></a>',link:function(scope,elem){scope.deleteText="Delete",scope.doing=!1,scope.deleteHelpListing=function(){!scope.doing&&$window.confirm("Are you sure you want to delete this help listing?")&&(scope.doing=!0,scope.deleteText="Deleting...",$http["delete"]("/api/help_listing/"+scope.hid).success(function(){2==elem.parents(".help-listing-route").children().size()?elem.parents(".help-listing-route").remove():elem.parents(".help-listing").remove(),scope.doing=!1,scope.deleteText="Delete"}).error(function(){scope.doing=!1,scope.deleteText="Delete"}))}}}}),angular.module("appOfficeHour",[]).filter("htmlToPlainText",function(){return function(text){return String(text).replace(/<[^>]+>/gm,"").replace(/^(&nbsp;|\s)+/g,"")}}).directive("renderDataTable",function(){return{restrict:"A",scope:{orderBy:"@",ascOrDesc:"@"},link:function(scope,elem){var option={paging:!1,search:!0};scope.ascOrDesc||(scope.ascOrDesc="asc"),scope.orderBy&&(option.order=[[scope.orderBy,scope.ascOrDesc]]),elem.DataTable(option)}}}).controller("AdminOfficeHourCtrl",function($scope){$scope.selectedTab="created",$scope.initialSet=function(tab){$scope.selectedTab=tab},$scope.isSelected=function(tab){return tab==$scope.selectedTab},$scope.choose=function(tab){$scope.selectedTab=tab}}).controller("AdminAMACtrl",function($scope){$scope.selectedTab="created",$scope.initialSet=function(tab){$scope.selectedTab=tab},$scope.isSelected=function(tab){return tab==$scope.selectedTab},$scope.choose=function(tab){$scope.selectedTab=tab}}).controller("EditOfficeHourCtrl",function(){var that=this;this.startAt=new Date($("#office_hour_start_at").val()||Date.now()).toString(),this.submit=function(e){var isNew=$(e.currentTarget).hasClass("new_office_hour");that.errMsg="",$('[name="office_hour[title]"]').val()?$('[name="office_hour[title]"]').val().length>255?that.errMsg="Title too long (maximum is 255 characters)":CKEDITOR.instances.office_hour_body.getData()?new Date($('[name="office_hour[start_at]"]').val())<Date.now()+864e5&&"ready"!=$('[name="office_hour[state]"]').val()&&isNew?that.errMsg="Can't schedule office hours within 24 hours":0==$('[name="office_hour[categories][]"]').length?that.errMsg="Please select at least one tag":$('[name="office_hour[gmail]"]').val()||(that.errMsg="Google account is required"):that.errMsg="Detail is required":that.errMsg="Title is required",that.errMsg?e.preventDefault():that.submitting=!0}}),angular.module("appOfficeHourLanding",[]).controller("officeHourLandingCtrl",function($scope,$timeout){$scope.is_register_form_open=!1,$scope.selected_tab="events",$scope.switch_register_form=function(){$scope.is_register_form_open=!$scope.is_register_form_open,$scope.is_register_form_open&&$scope.scrollToSignUp()},$scope.scrollToSignUp=function(){$scope.is_register_form_open=!0,$timeout(function(){var to=$(".registerBtn").offset().top;$(".registered").find(".input_email")[0].focus(),$("html, body").animate({scrollTop:Math.max(to-70,0)},1e3)},50)},$scope.is_form_show=function(){return 1==$scope.is_register_form_open},$scope.showDate=function(timestamp){return new Date(1e3*timestamp).strftime("%B %o %Y")},$scope.changeTab=function(tab){$scope.selected_tab=tab},$scope.is_selected_tab=function(tab){return $scope.selected_tab==tab}}),angular.module("appOfflineHelp",[]).constant("requestModalClass","offline-help-modal").controller("NoOfflineHelpController",function(){var that=this;that.showScreenshots=!1}).controller("OfflineHelpModalCtrl",function($modalInstance,$http,$timeout,config,requestModalClass,RefreshAlert,User,Payment){function openCardSettingForm(e){var $form=$(e.currentTarget),warning="Please set up your credit card info or <a href='/users/buy_credit'>buy more credit</a> before proceeding.";User.credit>0&&(warning=User.free_credit>0&&that.cost<User.credit?"You don't have enough credit (free credit can't be used for offline help). "+warning:"You don't have enough credit. "+warning),$("."+requestModalClass).hide(),Payment.openCardSettingForm({ok:function(){User.hasPayment=!0,User.cardAuthorized=!0,$timeout(function(){$form.submit()},0)},cancel:function(){$("."+requestModalClass).show()},warningHtmlUnsafe:warning})}var that=this;this.config=config;var checkNum=function(){return that.requiredMsgTitle="",that.cost=parseFloat(that.cost),isNaN(that.cost)||0==that.cost||parseFloat(that.cost)>1e5?(that.cost=0,that.errorMsg="Please input a valid number.",!1):(that.errorMsg="",!0)},isFilled=function(){return that.title?(that.requiredMsgTitle="",!0):(that.requiredMsgTitle="redborder",!1)};this.amountBlur=function(){checkNum()},this.submit=function(e){var confirmMsg;if(confirmMsg=that.delay_payment?"You are about to send delay payment of $"+that.cost+" to "+that.config.mentorName+".  Are you sure?":"You are about to send payment of $"+that.cost+" to "+that.config.mentorName+". By clicking on 'OK', the payment to "+that.config.mentorName+" will be processed and will be non-refundable. Are you sure?",checkNum()&&!that.loading&&isFilled()){if(!User.team_id&&User.credit-User.free_credit<that.cost&&(!User.hasPayment||!User.cardAuthorized))return openCardSettingForm(e),e.preventDefault(),void e.preventDefault();if(confirm(confirmMsg))return}e.preventDefault(),$("."+requestModalClass).show()}}).controller("HireForProjectsModalCtrl",function($modalInstance,$http,config){var that=this;this.config=config;var checkNum=function(){return that.requiredMsgTitle="",that.cost=parseFloat(that.cost),isNaN(that.cost)||0==that.cost||parseFloat(that.cost)>1e5?(that.cost=0,that.errorMsg="Please input a valid number.",!1):(that.errorMsg="",!0)},isFilled=function(){return that.title?(that.requiredMsgTitle="",!0):(that.requiredMsgTitle="redborder",!1)};this.amountBlur=function(){checkNum()},this.submit=function(e){var confirmMsg;confirmMsg="You are about to send delay payment of $"+that.cost+" to "+that.config.mentorName+".  Are you sure?",checkNum()&&!that.loading&&isFilled()&&confirm(confirmMsg)||e.preventDefault()}}).factory("OfflineHelpModals",function($modal,requestModalClass){function openRequestModal(mentorUsername,mentorName){$modal.open({windowClass:requestModalClass,templateUrl:"/template/offline-help-modal.html",resolve:{config:function(){var config={mentorUsername:mentorUsername,mentorName:mentorName};return config}},controller:"OfflineHelpModalCtrl as modal"})}return{openRequestModal:openRequestModal}}),angular.module("appScheduleCluster",[]).factory("ScheduleCluster",function(User,$http){var nextMidnight=function(d){return d=new Date(d),d.setDate(d.getDate()+1),d.setHours(0,0,0,0),d},isSameDate=function(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()},scheduleClusterMassage=function(sc){var nextScheduleIndex,now=new Date;
if(sc.schedules=_.sortBy(sc.schedules,function(s){return s.appointment_time}),nextScheduleIndex=_.findIndex(sc.schedules,function(s){return nextMidnight(s.appointment_time)>Date.now()}),-1==nextScheduleIndex)return sc.upcomingScheduleCount=0,sc.finishedScheduleCount=sc.size,void _.each(sc.schedules,function(s){s.tab="finished"});var nextSchedule=sc.schedules[nextScheduleIndex];sc.nextSchedule=nextSchedule,nextSchedule.isNext=!0,sc.upcomingScheduleCount=sc.schedules.length-nextScheduleIndex,sc.finishedScheduleCount=nextScheduleIndex,_.each(sc.schedules,function(s,i){nextScheduleIndex>i?s.tab="finished":(s.tab="upcoming",s.upcomingIndex=i-nextScheduleIndex,isSameDate(new Date(s.appointment_time),new Date(nextSchedule.appointment_time))&&isSameDate(new Date(s.appointment_time),now)&&(s.isNext=!0,s.isToday=!0,sc.nextSchedule.last_finished_sub_lesson_obfuscated_id&&(sc.nextSchedule=s)))}),sc.schedules=_.sortBy(sc.schedules,function(s,i){return nextScheduleIndex>i?-s.appointment_time:void 0})};return{funScheduleClusters:function(scope){var url;url=User.isMentor?"/api/dashboard/mentor/schedule_clusters":"/api/dashboard/mentee/schedule_clusters",$http.get(url).success(function(data){scope.db.hideScheduleClustersLoading=!0,scope.scheduleClusters=data.schedule_clusters,_.each(scope.scheduleClusters,scheduleClusterMassage)})},funFinishedScheduleClusters:function(scope){var url;url=User.isMentor?"/api/dashboard/mentor/finished_schedule_clusters":"/api/dashboard/mentee/finished_schedule_clusters",$http.get(url).success(function(data){scope.db.hideFinishedScheduleClustersLoading=!0,scope.scheduleClusters=data.schedule_clusters,_.each(scope.scheduleClusters,scheduleClusterMassage)})}}}).controller("ScheduleClustersRegistrationCtrl",function($scope){var that=this;this.scheduleClusterId=gon.scheduleClusterId,this.plans=gon.plans,this.schedule_num=gon.schedule_num,that.plan=getUrlParameterByName("plan")||this.plans[0].name,that.months=_.findWhere(gon.plans,{name:that.plan}).months,$scope.change_plan=function(plan){that.plan=plan},$scope.is_selected_plan=function(plan){return that.plan==plan},$scope.cost_per_month=function(){return _.findWhere(that.plans,{name:that.plan}).cost*that.schedule_num/4},$scope.total_cost=function(){return $scope.cost_per_month()*that.months}}).controller("ScheduleClustersConfirmCtrl",function($scope,$timeout,$http,NewModal){function stripeResponseHandler(status,response){var $form=$("form.edit_schedule_cluster");if(response.error)$form.find(".payment-errors").text(response.error.message).show(),$form.find("input[type=submit]").prop("disabled",!1).val("Confirm");else{var token=response.id;$form.append($('<input type="hidden" name="stripe_token" />').val(token)),openConfrimModal()}}function openConfrimModal(){var $form=$("form.edit_schedule_cluster"),plan=_.findWhere(that.plans,{name:that.plan}),traits={plan:that.plan,months:that.months,schedule_num:that.schedule_num,total_cost:$scope.total_cost()};mixpanel.track("/Monthly/Confirm/OpenConfrimModal",traits),_.extend(plan,{months:that.months,schedule_num:that.schedule_num,total_cost:$scope.total_cost()}),NewModal.open("schedule-cluster-payment-confirm",{windowClass:"schedule-cluster-payment-confirm-modal",footer:!1,plan:plan,ok:function(){$form.get(0).submit(),mixpanel.track("/Monthly/Confirm/ConfirmModal/OK",traits),ga("send","event","monthly","pay"),(window.optimizely||[]).push(["trackEvent","monthly_pay"])},cancel:function(){$form.find("input[type=submit]").prop("disabled",!1).val("Confirm"),mixpanel.track("/Monthly/Confirm/ConfirmModal/Cancel",traits)}})}var that=this,paypalAuthorizationUrls={};this.last4=gon.last4,this.addCard=!gon.last4,this.scheduleClusterId=gon.scheduleClusterId,this.plans=gon.plans,$timeout(function(){$("input.cc-num").payment("formatCardNumber")},0),this.toggleAddCard=function(){that.addCard=!that.addCard,$timeout(function(){$("input.cc-num").payment("formatCardNumber")},0)},that.plan=$("#schedule_cluster_plan").val(),that.months=_.findWhere(gon.plans,{name:that.plan}).months,that.monthsOptions=_.uniq(_.pluck(gon.plans,"months")),that.scheduleNums=_.reduce(this.plans,function(memo,p){return memo[p.name]=p.confirm_schedule_nums,memo},{}),$scope.labelForScheduleNum=function(num){var perWeek=num/4;return 1==perWeek?perWeek+" hour per week":perWeek+" hours per week"},$scope.changeScheduleNumPerWeek=function(){var n=parseInt(that.schedule_num_per_week,10);_.isNaN(n)||(_.contains(that.scheduleNums[that.plan],4*n)||(n=4*n>that.scheduleNums[that.plan][that.scheduleNums[that.plan].length-1]?that.scheduleNums[that.plan][that.scheduleNums[that.plan].length-1]/4:that.scheduleNums[that.plan][0]/4),that.schedule_num=4*n,that.schedule_num_per_week=n,$scope.load_paypal_authorization_link())},$scope.change_plan=function(plan){that.plan=plan,$scope.load_paypal_authorization_link()},$scope.is_selected_plan=function(plan){return that.plan==plan},$scope.cost_per_month=function(){var planObj=_.findWhere(that.plans,{name:that.plan});return(planObj.cost/4*that.schedule_num).toString()},$scope.total_cost=function(){return $scope.cost_per_month()*that.months},$scope.change_months=function(m){var i;i=_.findIndex(_.groupBy(gon.plans,"months")[that.months],{name:that.plan}),$scope.change_plan(_.groupBy(gon.plans,"months")[m][i].name),that.months=m},$scope.load_paypal_authorization_link=function(){var plan=that.plan,schedule_num=that.schedule_num;$scope.paypalAuthorizationUrl=null,$scope.loadingPaypalLink=!1,$scope.paypalError=null,paypalAuthorizationUrls[plan+"_"+schedule_num]?$scope.paypalAuthorizationUrl=paypalAuthorizationUrls[plan+"_"+schedule_num]:($scope.loadingPaypalLink=!0,$http.post("/paypal/schedule_clusters/"+that.scheduleClusterId+"/authorization_link",{plan:plan,schedule_num:schedule_num}).success(function(result){$scope.loadingPaypalLink=!1,$scope.paypalAuthorizationUrl=result.approval_url,paypalAuthorizationUrls[plan+"_"+schedule_num]=result.approval_url}).error(function(){$scope.loadingPaypalLink=!1,$scope.paypalError="Some error occurred, please try again later"}))},$("form.edit_schedule_cluster").submit(function(){var $form=$(this);return!$("input.cc-num").val()&&gon.last4?(openConfrimModal(),!1):($("input[type=submit]").prop("disabled",!0).val("Processing..."),Stripe.createToken($form,stripeResponseHandler),!1)})}).controller("RequestDetailCtrl",function(){var that=this;this.submit=function(e){var data=$(".edit_schedule_cluster").serializeArray();that.errors={},that.errors.description=0==_.findWhere(data,{name:"schedule_cluster[description]"}).value.trim().length,that.errors.categories=0==_.where(data,{name:"schedule_cluster[categories][]"}).length,that.errors.whyUse=_.where(data,{name:"user[why_use][]"}).length+_.findWhere(data,{name:"user[why_use_other]"}).value.trim().length==0,_.filter(that.errors,function(v){return v}).length>0&&(e.preventDefault(),e.stopPropagation())}}),angular.module("appOhShow",[]).controller("ohShowCtrl",function($scope,$http,$timeout,SignUpForm,NewModal){$scope.options=["Attending","Not Attending"],$scope.initSet=function(is_attending,open_sign_up,open_share,ohID){$scope.currentOption=is_attending?"Attending":"Not Attending",open_sign_up&&$timeout(function(){$scope.signUp(ohID)})},$scope.update=function(ohID){var url;url=$scope.isAttending()?"/api/officehours/"+ohID+"/attend":"/api/officehours/"+ohID+"/not_attend",$http.get(url).success(function(){})},$scope.signUp=function(ohID){SignUpForm.open({onopen:function(){angular.element('input[name="office_hour"]').val(ohID)},title:"Please Sign Up to RSVP for Office Hour",becomeMentorLink:!1})},$scope.isAttending=function(){return"Attending"==$scope.currentOption},$scope.openHowToStartOfficeHourModal=function(oh){NewModal.open("how-to-start-office-hours",{officeHour:oh,footer:!1,windowClass:"how-to-start-office-hours-modal"})}}),angular.module("appPayment",["app","mm.foundation.modal","mm.foundation.tpls"]).directive("stripeForm",function(){return{link:function(scopr,elem){elem.find(".cc-number").payment("formatCardNumber"),elem.find(".cc-exp").payment("formatCardExpiry"),elem.find(".cc-cvc").payment("formatCardCVC")}}}).factory("Payment",function($sce,NewModal){return{openAskForSettingForm:function(options){return options=options||{},NewModal.open("ask-for-setup-payment",{windowClass:"ask-for-setup-payment-modal",realCreditsToSessionTime:Math.round(parseFloat(options.realCreditsToSessionTime||0)),cardDeclined:options.cardDeclined,mentor:options.mentor,keyboard:!1,footer:!1,ok:options.ok||function(){},cancel:options.cancel||function(){},next:options.next||function(){}})},openSettingForm:function(options){return options=options||{},NewModal.open("setup-payment",{windowClass:"setup-payment-modal",mentor:options.mentor,backdrop:options.backdrop||"static",keyboard:!1,footer:!1,warning:options.warning,successMsg:options.successMsg||"Thanks! You've set up billing info successfully.",ok:options.ok,cancel:options.cancel||function(){}})},openCardSettingForm:function(options){return options=options||{},NewModal.open("setup-credit-card",{windowClass:"setup-credit-card-modal",mentor:options.mentor,backdrop:"static",keyboard:!1,footer:!1,warning:options.warning,warningHtmlUnsafe:options.warningHtmlUnsafe,successMsg:options.successMsg||"Thanks! You've set up credit card info successfully.",ok:options.ok,cancel:options.cancel||function(){}})}}}).controller("BuyCreditController",function($scope,$http,$timeout,$document,User){function loadPaypalLinks(plans){$http.post("/paypal/plan_approval_links",{plans:plans}).then(function(res){$scope.paypalApprovalLinks=res.data.links})}function loadCoinbaseButtons(plans){$scope.coinbaseButtonScriptLoaded=!1,$http.post("/coinbase/plan_buttons",{plans:plans}).then(function(res){$scope.coinbaseButtons=res.data.buttons,$timeout(function(){$scope.coinbaseButtonScriptLoaded=!0},100)})}$scope.totalCredit=parseFloat(User.credit),$scope.payWith="",$scope.bitcoinFormData={},$scope.coinbaseButtonScriptLoaded=!1,$document.ready(function(){var plans=$(".plan").map(function(i,v){return $(v).data("plan")}).get();loadPaypalLinks(plans),loadCoinbaseButtons(plans)}),$scope.changePlan=function(){$scope.setPlan(),$scope.setSpend(),$scope.setCredit()},$scope.$watch("payWith",$scope.changePlan),$scope.setPlan=function(){$scope.plan=window.cmvar.pricingTable.getPlan(),"plan1"==$scope.plan?$scope.payWith="card":$scope.plan||($scope.payWith="")},$scope.setSpend=function(){$scope.spend=window.cmvar.pricingTable.getSpend()},$scope.setCredit=function(){$scope.credit=window.cmvar.pricingTable.getCredit()},$scope.openCoinbaseBitcoinModal=function(code){$document.trigger("coinbase_show_modal",code)},$document.on("coinbase_payment_complete",function(event,code){console.log("Payment completed for button "+code),$scope.totalCredit+=$scope.credit}),$document.on("coinbase_payment_mispaid",function(event,code){console.log("Payment mispaid for button "+code)}),$document.on("coinbase_payment_expired",function(event,code){console.log("Payment expired for button "+code)})}),angular.module("appPrepareLesson",[]).controller("prepareLessonCtrl",function($scope,$rootScope,$timeout,$window,User){$scope.lesson=gon.prepare_lesson,$scope.state="waiting",$rootScope.$on("firebase_auth_success",function(){$scope.sessionRef=$rootScope.firebaseRef.child("sessions").child($scope.lesson.token),$scope.myOnlineRef=$scope.sessionRef.child("online").child(User.firebaseId),$scope.myOnlineRef.update({status:!0}),$scope.myOnlineRef.onDisconnect().update({status:!1}),$scope.opposite_user=User.username==$scope.lesson.mentee.username?$scope.lesson.mentor:$scope.lesson.mentee,$scope.oppositeUserRef=$scope.sessionRef.child("online").child($scope.opposite_user.firebase_hash_id),$scope.oppositeUserRef.child("status").on("value",function(snapshot){var value=snapshot.val()?snapshot.val():!1;1==value?($scope.state="ready",$("#lessonStart")[0].play()):$scope.state="waiting",$scope.$digest()})}),$rootScope.$on("connect_now_declined",function(){$scope.state="declined"}),$rootScope.$on("connect_now_expired",function(){"waiting"==$scope.state&&($scope.state="retry")}),$scope.tryAgain=function(url){mixpanel.track("click /prepare_lesson/try_again"),getUrlParameterByName("realtime")?$window.location.href=url:$window.location.reload()},$scope.startSession=function(url){mixpanel.track("click /prepare_lesson/start_session_now"),$window.location.href=url},$scope.findMentor=function(url){mixpanel.track("click /prepare_lesson/find_mentor"),$window.location.href=$scope.lesson.question.isDirect?"/experts":url}}),angular.module("appPresence",["appFirebase"]).factory("Idle",function($timeout,$http){return{setIdleTimer:function(time){time=time||12e4,this.idleTimer||(this.idleTimer=$timeout(function(){$http.post("/api/users/me/idle").success(function(){}).error(function(data,status){401==status&&RefreshAlert.open("logout")})},time))},cancelIdleTimer:function(){return this.idleTimer&&($timeout.cancel(this.idleTimer),this.idleTimer=null),!0}}}).directive("presence",function(User,Firebase){return{restrict:"E",scope:{status:"=status"},templateUrl:"template/presence.html",replace:!0,link:function(scope,elem,attrs){var username=attrs.un.replace(/\./g,"^"),presence=Firebase("presence/"+username+"/magic");scope.showStatus=!!attrs.showStatus,scope.hideOffline=!!attrs.hideOffline,scope.presenceStatus="offline",scope.presenceStatusName="offline",_.contains(User.targets,md5(attrs.un))||presence.$on$("value",function(response){var _v=response.snapshot.value;if($.isEmptyObject(_v))scope.presenceStatusName="Offline",scope.presenceStatus="offline",scope.status="offline";else switch(scope.presenceStatus=_v,scope.status=_v,_v){case"available":scope.presenceStatusName="Instant session";break;case"online":scope.presenceStatusName="Online";break;case"away":scope.presenceStatusName="Away";break;case"session":scope.presenceStatusName="In Session";break;case"offline":scope.presenceStatusName="Offline";break;default:scope.presenceStatusName="Offline",scope.presenceStatus="offline",scope.status="offline"}})}}}).directive("mentorPresenceToggle",function($rootScope,$http,$timeout,Firebase,User,Idle,NewModal,RefreshAlert){return{restrict:"E",replace:!0,templateUrl:"template/mentorPresenceToggle.html",scope:{},controller:function($scope){var username=User.username.replace(/\./g,"^");$scope.showMenu=!1,$scope.loading=!0,$scope.userStatus="offline",$scope.toggleMenu=function(){$scope.showMenu=!$scope.showMenu},$scope.updateStatus=function(status){function exec(){$scope.loading=!0,$http.post("/online_users/update_status",{status:status}).error(function(data,status){401==status&&RefreshAlert.open("logout")}),$scope.showMenu=!1,$timeout(function(){$scope.loading=!1},5e3)}"available"!=status||gon.mentorInfo.knewInstantHelp?exec():NewModal.open("instant-help-info",{windowClass:"instant-help-info-modal",backdrop:"static",keyboard:!1,actions:["Make Me Available for Instant Sessions","Cancel"],ok:function(){gon.mentorInfo.knewInstantHelp=!0,exec()},cancel:function(){}})};var presence=Firebase("presence/"+username+"/magic");presence.$on$("value",function(response){var _v=response.snapshot.value;$scope.userStatus=$.isEmptyObject(_v)?"offline":"available"==_v||"online"==_v||"away"==_v||"session"==_v?_v:"offline","available"==_v&&window.Notification&&"granted"!==Notification.permission&&Notification.requestPermission(function(status){Notification.permission!==status&&(Notification.permission=status)}),$scope.loading=!1});var insessionRef=$rootScope.firebaseRef.child("presence").child(User.username.replace(/\./g,"^")).child("session");insessionRef.set(!1)},link:function(scope){scope.$on("bodyClicked",function(e,$event){0==$($event.target).parents(".mentor-presence-toggle").size()&&(scope.showMenu=!1),scope.$digest()})}}}).run(function($templateCache,$rootScope,$timeout,User){User.username&&$rootScope.$on("firebase_auth_success",function(){var userRef=$rootScope.firebaseRef.child("presence").child(User.username.replace(/\./g,"^")).child("web"),insessionRef=$rootScope.firebaseRef.child("presence").child(User.username.replace(/\./g,"^")).child("session");userRef.on("value",function(snap){snap.val()===!1&&$timeout(function(){userRef.set(!0)},1e3)}),userRef.onDisconnect().set(!1),userRef.set(!0),insessionRef.set(!1)}),$templateCache.put("template/mentorPresenceToggle.html",'<div class="mentor-presence-toggle presence-{{userStatus}}" ng-cloak ng-class="{\'loading\':loading}">    <div class="mentor-presence-status" ng-click="showMenu=!showMenu">      <i ng-class="{\'icon-circle\':userStatus!=\'available\', \'icon-ok fa fa-flash\':userStatus==\'available\'}"></i>      <span us-spinner="{radius:4, width:2, length:3, lines:9, color:\'#fff\'}" ng-cloak></span>      <span class="status">{{userStatus == \'available\' ? \'instant\' : userStatus}}</span>      <i class="icon-caret-down"></i>    </div>    <div class="mentor-presence-menu" ng-cloak ng-show="showMenu">      <div class="presence-available" ng-click="updateStatus(\'available\')"><i class="icon-ok fa fa-flash"></i> instant session ($2/min)</div>      <div class="presence-online" ng-click="updateStatus(\'online\')"><i class="icon-circle"></i> online</div>      <div class="presence-away" ng-click="updateStatus(\'away\')"><i class="icon-circle"></i> away</div>      <div class="presence-offline" ng-click="updateStatus(\'offline\')"><i class="icon-circle"></i> offline</div>    </div>  </div>'),$templateCache.put("template/presence.html","<span class=\"presence presence-{{presenceStatus}}\" ng-hide=\"hideOffline&&presenceStatus=='offline'\" ng-cloak>    <i ng-class=\"{'icon-circle':presenceStatus!='available', 'icon-ok fa fa-flash':presenceStatus=='available'}\"></i>    <span ng-show=\"showStatus\">{{presenceStatusName}}</span>  </span>")}),angular.module("appPromoteMentor",[]).controller("PromoteMentorCtrl",function($scope,$http,RefreshAlert){$scope.mentorProfile="",$scope.promoteText="",$scope.finishedLoading=!1,$scope.expHashTag="",$scope.setMentorUrl=function(path,expHashTag){$scope.mentorProfile=path,$scope.expHashTag=expHashTag,$scope.promoteText="Get live 1:1"+expHashTag+" #code help and #pairprogram with me.  "+$scope.mentorProfile+" @CodementorIO",$scope.finishLoading=!0},$scope.$watch("availableFreeLength",function(nv){"undefined"!=typeof nv&&$scope.updateFreeStatus()}),$scope.updateFreeStatus=function(){var url="/api/mentor_config/update";$scope.finishLoading&&"undefined"!=typeof $scope.availableFreeLength&&($http.post(url,{availableFreeLength:$scope.availableFreeLength,freeLength:15}).success(function(){}).error(function(data,status){401==status&&RefreshAlert.open("logout")}),1==$scope.availableFreeLength&&$scope.finishLoading?($scope.promoteText="Get live 1:1"+$scope.expHashTag+" #code help and #pairprogram with me. First 15 minutes free: "+$scope.mentorProfile+" @CodementorIO",$(".twitter-share-button").hide(),twttr.widgets.createShareButton("#",$(".twitterBtn")[0],function(){},{text:$scope.promoteText}),$(".twitterBtn").removeClass("invisible"),$(".twitterBtn").show()):$scope.promoteText="Get live 1:1"+$scope.expHashTag+" #code help and #pairprogram with me.  "+$scope.mentorProfile+" @CodementorIO")}}),angular.module("appQuestion",[]).controller("QuestionShowCtrl",function($scope,$http,$timeout,NewModal,Chat,User){function anyError(){var error=!1;return!mentorInfoData.rate||!parseFloat(mentorInfoData.rate)&&0!=parseFloat(mentorInfoData.rate)?(mentorInfoData.error.rate=!0,error=!0):mentorInfoData.error.rate=!1,mentorInfoData.aboutMe&&mentorInfoData.aboutMe.trim()?mentorInfoData.error.aboutMe=!1:(mentorInfoData.error.aboutMe=!0,error=!0),mentorInfoData.helpWith&&mentorInfoData.helpWith.trim()?mentorInfoData.error.aboutMe=!1:(mentorInfoData.error.helpWith=!0,error=!0),error}var mentorInfoData={error:{},rate:"15.00"};this.openRegModal=function(menteeName){mixpanel.track("/public_question/i_can_help"),NewModal.open("guest-mentor-reg",{windowClass:"guest-mentor-reg",actions:["Cancel"],menteeName:menteeName,footer:!1})},this.init=function(questionId,questionBudget,isPublic){$scope.questionId=questionId;var budget=parseFloat(questionBudget);budget>0&&(mentorInfoData.rate=budget),isPublic&&1==isPublic&&mixpanel.track("/public_question/view")},this.askToStartSession=function(username,sessionLink){User.isMentor&&Chat.send(username,{},{type:"sessionLink",sessionLink:sessionLink})},this.openNewMentorInfoModal=function(){mixpanel.track("/public_question/confirmed"),NewModal.open("new-mentor-info-form",{windowClass:"new-mentor-info-form",footer:!1,data:mentorInfoData,backdrop:"static",keyboard:!1,cancel:function(){gon.auto_applied=!1},submit:function(){return anyError()||void 0==gon.auto_applied||void 0==$scope.questionId?!1:($http.put("/api/users/new_mentor_info",{question_id:$scope.questionId,default_rate:mentorInfoData.rate,about:mentorInfoData.aboutMe,help_with:mentorInfoData.helpWith}).then(function(response){var im=response.data;Chat.openChatroom({id:im.chatroom_id,chatroomFirebaseId:im.chatroom_firebase_id,contact:{name:im.receiver.name,username:im.receiver.username,avatarUrl:im.receiver.avatar_url}}),$timeout(function(){$(".q-icanhelp a").click()})}),!0)}})},gon.auto_applied&&this.openNewMentorInfoModal()}),angular.module("appRequest",["appCategory"]).controller("NewRequestCtrl",function($q,$http,$scope,RefreshAlert){$scope.mentorCount=-1,$scope.updateMentorCount=!1,$scope.onInit=function(tags){$scope.updateTags(tags)},$scope.updateTags=function(tags){tags&&$scope.updateMentorCount&&(0==tags.length?$scope.mentorCount=-1:$http({url:"/api/related_mentor_count",method:"POST",data:{tags:_.map(tags,function(tag){return tag.text})}}).success(function(data){parseInt(data)>=0&&($scope.mentorCount=parseInt(data))}).error(function(data,status){401==status&&RefreshAlert.open("logout")}))},$("#faq-public-request").popover()}),angular.module("appRateForClient",[]).directive("scheduleRate",function($rootScope,$http,$modal,RefreshAlert){return{restrict:"A",template:'${{rate}} <small>/15min</small> <i class="icon-edit"></i>',scope:{},link:function(scope,elem,attrs){scope.rate=attrs.scheduleRate,scope.scheduleId=attrs.sid,elem.click(function(){$modal.open({windowClass:"rate-modal",templateUrl:"template/appScheduleRateModal.html",resolve:{config:function(){var config={rate:scope.rate,scheduleId:scope.scheduleId,username:attrs.un};return config}},controller:function($scope,$modalInstance,config){$scope.config=config,$scope.check=function(){var _tmp=String($scope.config.rate||0).trim().replace(/[^\d\.]+/g,"");return $scope.config.rate=Math.round(100*parseFloat(_tmp,10))/100,$scope.config.rate>=0?($scope.errorMsg="",!0):($scope.errorMsg="The input is invalid.",!1)},$scope.sumbit=function(){return $scope.check()?void($scope.config.rate==$scope.config.original?$modalInstance.dismiss():($scope.loading=!0,$http.post("/api/schedule/"+$scope.config.scheduleId+"/rate",{rate:$scope.config.rate}).success(function(data){$modalInstance.dismiss(data),$rootScope.$broadcast("rate-update-"+$scope.config.username,data)}).error(function(data,status){$scope.loading=!1,401==status&&RefreshAlert.open("logout")}))):($scope.loading=!1,!1)}}}).result.then(function(){},function(rate){rate&&rate.rate>=0&&(scope.rate=rate.rate)})})}}}).directive("rateForClient",function($rootScope,$http,User,$modal,RefreshAlert){return{restrict:"E",replace:!0,scope:{isDisabled:"=",isMonthlyClient:"="},templateUrl:"template/appRateForClient.html",controller:function($scope){$scope.rate="-",$scope.rateReason="",$scope.rateLabel="Rate: ",$scope.$watch("rateReason",function(nv){switch(nv){case"longterm_rate":$scope.rateLabel="Long-Term Rate: ";break;case"special_deal":$scope.rateLabel="Special Rate: ";break;case"group_rate":$scope.rateLabel=$scope.group.title+" Rate: ";break;default:$scope.rateLabel="Rate: "}})},link:function(scope,elem,attrs){if(User.isMentor){scope.mentee=JSON.parse(attrs.mentee),scope.label="false"==attrs.label?!1:!0;var updateRate=function(){$http.get("/api/rate_for/"+attrs.un).success(function(data){scope.rate=data.rate,scope.rateReason=data.reason,scope.group=data.group}).error(function(data,status){401==status&&RefreshAlert.open("logout")})};$rootScope.$on("rate-update-"+attrs.un,function(e,data){scope.rate=data.rate,scope.rateReason=data.reason,scope.group=data.group}),updateRate(),elem.find(".rate-editor").click(function(){$modal.open({windowClass:"rate-modal",templateUrl:"template/appRateForClientModal.html",resolve:{config:function(){var config={mentee:scope.mentee,rate:scope.rate,rateReason:scope.rateReason,group:scope.group};return config}},controller:function($scope,$modalInstance,config){$scope.focus=!1,$scope.config=config,$scope.check=function(){var _tmp=String($scope.config.rate||0).trim().replace(/[^\d\.]+/g,"");$scope.config.rate=Math.round(100*parseFloat(_tmp,10))/100,$scope.errorMsg=$scope.config.rate>=0?"":"The input is invalid."},$scope.sumbit=function(){var rate;"longterm_rate"!=scope.rateReason&&((rate=parseFloat($scope.config.rate))>=0?($scope.loading=!0,$http.post("/api/rate_for/"+config.mentee.username,{rate:rate}).success(function(data){$scope.errorMsg="",$scope.loading=!1,$modalInstance.dismiss(data.rate),$rootScope.$broadcast("rate-update-"+config.mentee.username,data)}).error(function(data,status){$scope.loading=!1,401==status&&RefreshAlert.open("logout")})):($scope.loading=!1,$scope.errorMsg="The input is invalid."))}}}).result.then(function(){},function(mentorRate){mentorRate&&2==mentorRate.length&&(scope.rate=mentorRate.rate,scope.rateReason=mentorRate.reason)})})}}}}).run(function($templateCache){$templateCache.put("template/appRateForClient.html",'<div>    <button class="rate-editor {{rateReason}}" ng-disabled="isDisabled" ng-hide="isMonthlyClient"><span>${{rate | number:2}}</sapn> <small>/15min</small></button>  </div>'),$templateCache.put("template/appScheduleRateModal.html",'<div class="modal-body">    <h3>Adjust your rate for this session</h3>    <p>You can choose to offer a special discounted rate for this session.</p>    <div class="editor">      <span class="editor-dollar-sign">$</span>      <input ng-enter="sumbit()" ng-blur="check()" class="rate-input" type="text" maxlength="7" ng-model="config.rate">      <span class="editor-time-label"> / 15min</span>    </div>    <div class="error-msg" ng-show="errorMsg">{{errorMsg}}</div>  </div>  <div class="modal-footer text-center">    <button class="btn" ng-click="$dismiss()">      <i class="icon-remove"></i>      Cancel    </button>    <button ng-class="{\'btn-primary\':!loading}" class="btn submit" ng-click="sumbit()">      <i ng-hide="loading" class="icon-ok"></i>      <img ng-show="loading" src="/assets/loading_w_l.gif" style="width:16px;">      <span>Save</span>    </button>  </div>'),$templateCache.put("template/appRateForClientModal.html",'<div class="modal-body">    <h3 ng-show="config.rateReason==\'longterm_rate\'">Long-term Rate for {{config.mentee.name}}</h3>    <h3 ng-show="config.rateReason==\'group_rate\'">{{config.group.title}} Rate for {{config.mentee.name}}</h3>    <h3 ng-show="config.rateReason!=\'longterm_rate\' && config.rateReason!=\'group_rate\'">Offer a Special Rate for {{config.mentee.name}}</h3>    <p ng-show="config.rateReason==\'default_rate\'">Customize your rate for {{config.mentee.name}}</p>    <p ng-show="config.rateReason==\'special_deal\'">Customize your rate for {{config.mentee.name}}</p>    <p ng-show="config.rateReason==\'longterm_rate\'" style="margin-bottom: 0px;">You have a dedicated long-term mentorship arrangement with {{config.mentee.name}}. <br> The special long-term rate is:</p>    <p ng-show="config.rateReason==\'group_rate\'" style="margin-bottom: 0px;"><img ng-src="{{config.group.icon}}" width="24"> You are in group of {{config.group.title}}. <br> The group rate is:</p>    <div class="editor">      <span class="editor-dollar-sign">$</span>      <input ng-enter="sumbit()" ng-blur="check()" class="rate-input" ng-disabled="config.rateReason==\'longterm_rate\' || config.rateReason==\'group_rate\'" type="text" maxlength="7" ng-model="config.rate">      <span class="editor-time-label"> / 15min</span>    </div>    <p><small>(Your normal rate is ${{User.default_rate}} / 15min)</small></p>    <div class="error-msg" ng-show="errorMsg">{{errorMsg}}</div>  </div>  <div class="modal-footer text-center">    <button class="btn" ng-click="$dismiss()">      <i class="icon-remove"></i>      Cancel    </button>    <button ng-class="{\'btn-primary\':!loading}" ng-hide="config.rateReason==\'longterm_rate\' || config.rateReason==\'group_rate\'" class="btn submit" ng-click="sumbit()">      <i ng-hide="loading" class="icon-ok"></i>      <img ng-show="loading" src="/assets/loading_w_l.gif" style="width:16px;">      <span>Save</span>    </button>  </div>')}),angular.module("appRightSideBar",["appFavorite"]).controller("rightSideBarCtrl",function($resource,$scope,$modal,$element,NewModal,OfflineHelpModals,LongtermModals){this.openOfflineHelpModal=OfflineHelpModals.openRequestModal,$element.find(".disabledOfflineHelpBtn").tooltip({title:"The mentor has reached the limit of ongoing offline requests and cannot accept new requests at this time.",placement:"left"}),this.openDirectLongtermModal=LongtermModals.openDirectRequestModal}),angular.module("appSchedule",[]).factory("Schedule",function($http){return{showScheduleForm:function(){},showConnectForm:function(){},submit:function(data,cb){$http({method:"POST",url:"/direct_schedule",data:$.param(data),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(s){angular.isFunction(cb)&&cb(s)})}}}).factory("SelectableTimes",function(){var str_h_12,str_h_24,str_m,ampm,hour_time={},hours=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],mins=[0,30];return hours.forEach(function(h){mins.forEach(function(m){str_h_12=h>=12?h-12==0?12:h-12:0==h?12:h,str_h_24=10>h?"0"+h:h,str_m=10>m?"0"+m:m,ampm=12>h?"AM":"PM",hour_time[str_h_24+":"+str_m]=str_h_12+":"+str_m+" "+ampm})}),hour_time}).factory("DateTimeTool",function(){function timezone_convert(userDatetime,cOffset,oOffset){var utime=userDatetime.getTime(),utc=utime-cOffset,otime=utc+oOffset;return new Date(otime)}function add_zero(i){return 10>i&&(i="0"+i),i}function datetime_to_string(otime){var ny=otime.getFullYear(),nm=add_zero(otime.getMonth()+1),nd=add_zero(otime.getDate()),nh=otime.getHours(),nmin=add_zero(otime.getMinutes());if(nh>=12)var ampm="PM";else var ampm="AM";var is_bad=!1;return 6>nh&&nh>2&&(is_bad=!0),nh>12?nh-=12:0==nh&&(nh=12),[ny+"-"+nm+"-"+nd+" "+nh+":"+nmin+ampm,is_bad]}return{timezone_convert:timezone_convert,add_zero:add_zero,datetime_to_string:datetime_to_string}}).directive("connectForm",function($q,$http,$window,$timeout,User,Schedule,RefreshAlert,Payment){return{restrict:"A",controller:function($scope){$scope.getNumber=function(num){return new Array(num)}},controllerAs:"cf",link:function(scope,element){var totalCheckBoxes=0,checked=0;scope.allChecked=!0,Schedule.showConnectForm=function(params){if(User.username==params.mentor.username)return alert("You could not have session with self."),!1;var deferred=$q.defer();if(User.team_id){if(User.over_capacity)return alert("Your monthly spending has exceeded the organization's monthly cap.  Please contact your organization's admin or email support@codementor.io"),$window.location.href="/users/organization",deferred.resolve(!1),deferred.promise}else if(User.hasPayment){if(!User.cardAuthorized&&!User.allowNoCard)return alert("Your credit card was declined or expired. Please update your credit card before proceeding."),$window.location.href="/users/payment_setting",deferred.resolve(!1),deferred.promise}else if(!User.allowNoCard)return alert("Please complete your billing info before proceeding."),$window.location.href="/users/buy_credit",deferred.resolve(!1),deferred.promise;scope.mentor=params.mentor;var updateRequests=function(mentorUsername){$http.get("/users/get_requests?mentor="+mentorUsername).success(function(data){scope.requests=data}).error(function(data,status){401==status&&RefreshAlert.open("logout")})};return $http.get("/users/info?username="+params.mentor.username).success(function(data){angular.extend(scope.mentor,data);var openModal=function(){element.modal()},openSettingForm=function(){Payment.openSettingForm({ok:function(){User.hasPayment=!0,User.cardAuthorized=!0,openModal()}})};scope.real_credits_to_session_time=data.real_credits_to_session_time,scope.need_authorize=User.hasPayment&&scope.real_credits_to_session_time<15&&0==User.pre_authorized_amount&&User.total_spending<500,User.allowNoCard&&(!User.hasPayment||!User.cardAuthorized)&&data.real_credits_to_session_time<60?Payment.openAskForSettingForm({realCreditsToSessionTime:data.real_credits_to_session_time,cardDeclined:User.hasPayment&&!User.cardAuthorized,mentor:scope.mentor,ok:openSettingForm,next:openModal}):openModal()
}).error(function(data,status){401==status&&RefreshAlert.open("logout")}),updateRequests(params.mentor.username),scope.submitDeferred=deferred,scope.$$phase||scope.$digest(),deferred.promise},element.on("shown",function(){checked=0,totalCheckBoxes=element.find(".check-input").size(),$timeout(function(){scope.allChecked=totalCheckBoxes===checked||0==totalCheckBoxes})}),element.on("hide",function(){$timeout(function(){scope.cf.checkbox_1=!1,scope.cf.checkbox_2=!1,scope.cf.checkbox_3=!1},0)}),scope.addChecked=function(bool){bool?checked+=1:checked-=1,scope.allChecked=totalCheckBoxes===checked||0==totalCheckBoxes},scope.onSubmit=function(e){return scope.loading?(e.preventDefault(),void e.stopPropagation()):($http.post("/api/users/increase_start_session_conut"),scope.loading=!0,void scope.submitDeferred.resolve(!0))}}}}).directive("scheduleForm",function($q,$http,$window,Schedule,SelectableTimes,User,DateTimeTool,RefreshAlert,Payment){return{restrict:"A",controller:function($scope){$scope.SelectableTimes=SelectableTimes,$scope.formType="datetime",$scope.datetimeOnly=!1,$scope.currentUserTimezoneOffset=1e3*-(60*(new Date).getTimezoneOffset()),$scope.mentorTimezoneOffset=$scope.currentUserTimezoneOffset,$scope.selectAvailability=function(datetime,endTime){endTime&&new Date(endTime)-new Date(datetime)>=86399999&&(datetime=new Date(datetime).todayStartTime()),$scope.formType="datetime",$scope.update(datetime,!0)},$scope.update=function(datetime,force){"string"==typeof datetime&&(datetime=new Date(datetime));var h=datetime.getHours(),m=datetime.getMinutes();59==m?(m=0,h+=1):29==m&&(m+=1),force?(10>h&&(h="0"+h),0==m&&(m="00")):m>=30?(m="00",10>h+1?h="0"+(h+1):h+=1,h>=24&&(h="00")):(m="30",10>h&&(h="0"+h)),$scope.datepicker&&$scope.datepicker.datepicker("setDate",datetime.strftime("%Y-%m-%d")),$scope.selectedTime=h+":"+m},this.updateMentorTime=function(){if(!$scope.selectedDate||!$scope.selectedTime)return!1;var date_str=$scope.selectedDate.split("-"),time_str=$scope.selectedTime.split(":"),y=date_str[0],m=date_str[1]-1,d=date_str[2],h=time_str[0],min=time_str[1],user_datetime=new Date(y,m,d,h,min),other_datetime=DateTimeTool.timezone_convert(user_datetime,$scope.currentUserTimezoneOffset,$scope.mentorTimezoneOffset),mentorTime=DateTimeTool.datetime_to_string(other_datetime);$scope.mentorTime=mentorTime[0],$scope.mentorWarning=mentorTime[1]},$scope.$watch("selectedDate",this.updateMentorTime),$scope.$watch("selectedTime",this.updateMentorTime),$scope.$watch("formType",function(){$scope.warning=""}),$scope.requestOptionTitle=function(request){return request.isDirect?request.title+" - "+new Date(request.createdAt).strftime("%Y-%m-%d"):request.title+" - "+request.body}},link:function(scope,element){scope.datepicker=element.find("#datepickerNew"),scope.datepicker.datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(e){scope.selectedDate=e.date.strftime("%Y-%m-%d"),scope.$$phase||scope.$digest()}),scope.timepicker=element.find(".timepickerNew"),Schedule.showScheduleForm=function(params){if(params.from)try{mixpanel.track("/user/click/schedule",{from:params.from})}catch(e){console.log(e)}if(User.username==params.mentor.username)return alert("You could not setup schedule with self."),!1;if(params.hasScheduleCluster&&confirm("You have an ongoing Codementor Monthly mentorship with "+params.mentor.name+".  Would you like to manage your Codementor Monthly schedules instead of adding an extra paid session?"))return void($window.location.href="/dashboard#monthly");var deferred=$q.defer();if(User.team_id){if(User.over_capacity)return alert("Your monthly spending has exceeded the organization's monthly cap.  Please contact your organization's admin or email support@codementor.io"),$window.location.href="/users/organization",deferred.resolve(!1),deferred.promise}else if(User.hasPayment){if(!User.cardAuthorized&&!User.allowNoCard)return alert("Your credit card was declined or expired. Please update your credit card before proceeding."),$window.location.href="/users/payment_setting",deferred.resolve(!1),deferred.promise}else if(!User.allowNoCard)return alert("Please complete your billing info before proceeding."),$window.location.href="/users/buy_credit",deferred.resolve(!1),deferred.promise;var $target=element;scope.mentorName=params.mentor.name;var updateRequests=function(mentorUsername){$http.get("/users/get_requests?mentor="+mentorUsername).success(function(data){scope.requests=data}).error(function(data,status){401==status&&RefreshAlert.open("logout")})};return $http.get("/users/info?username="+params.mentor.username).success(function(data){scope.mentorId=data.id,data.availability.length>0?(scope.formType="availability",scope.availabilities=data.availability,scope.datetimeOnly=!1):(scope.formType="datetime",scope.datetimeOnly=!0),scope.free_length=data.free_length,scope.mentorTimezoneOffset=1e3*data.timezoneOffset;var openModal=function(){$target.on("show",function(){scope.update(new Date)}),$target.modal()},openSettingForm=function(){Payment.openSettingForm({ok:function(){User.hasPayment=!0,User.cardAuthorized=!0,openModal()}})};User.allowNoCard&&(!User.hasPayment||!User.cardAuthorized)&&data.real_credits_to_session_time<60?Payment.openAskForSettingForm({realCreditsToSessionTime:data.real_credits_to_session_time,cardDeclined:User.hasPayment&&!User.cardAuthorized,mentor:params.mentor,ok:openSettingForm,next:openModal}):openModal()}).error(function(data,status){401==status&&RefreshAlert.open("logout")}),updateRequests(params.mentor.username),scope.submitDeferred=deferred,scope.$$phase||scope.$digest(),deferred.promise},scope.submit=function(){if("datetime"!=scope.formType)scope.warning="Please select a date and time for this schedule.";else if(!scope.warning&&!scope.loading){scope.loading=!0;var yyyy_mm_dd=scope.selectedDate.split("-"),yyyy=parseInt(yyyy_mm_dd[0],10),mm=parseInt(yyyy_mm_dd[1],10)-1,dd=parseInt(yyyy_mm_dd[2],10),h_m=scope.selectedTime.split(":"),h=parseInt(h_m[0],10),m=parseInt(h_m[1],10),submitData={datetime:new Date(yyyy,mm,dd,h,m,0).getTime()/1e3,mentor:scope.mentorId,question_id:scope.scheduleRequestId};$http({method:"POST",url:"/direct_schedule",data:$.param(submitData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(s){return s.error?void($window.location.href=s.redirectTo):(scope.loading=!1,element.modal("hide"),scope.submitDeferred&&scope.submitDeferred.resolve(s),void($window.location.href=s.url))}).error(function(data,status){401==status&&RefreshAlert.open("logout")})}}}}}),angular.module("appSeoNew",[]).controller("seoNewCtrl",function($timeout,$scope,$location,Viewport){$("body").attr("id","skrollr-body"),bowser.mobile||($timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(element,name,direction){if("data50Top"==name){var mq=window.matchMedia("(min-width: 1280px)");if("down"==direction){if(mq.matches&&document.getElementsByClassName("chat-side-bar").length>0){{$(element)}$(element).css({top:50,width:"100%","padding-right":Viewport.width>=1280?"220px":"0px","box-shadow":"0px 3px 4px rgba(0,0,0,0.2)","z-index":6,"box-sizing":"border-box"})}else $(element).css({top:50,"box-shadow":"0px 3px 4px rgba(0,0,0,0.2)","z-index":6});$(".menuCard").css({top:130,"z-index":4,position:"fixed"}),$(".contentPart").css({"margin-top":"55px"})}else"up"==direction&&($(element).css(mq.matches&&document.getElementsByClassName("chat-side-bar").length>0?{top:"auto",width:"100%","padding-right":"0px","box-shadow":"none","z-index":3,"box-sizing":"border-box"}:{top:"auto","box-shadow":"none","z-index":3}),$(".menuCard").css({top:"auto","z-index":3,position:"relative"}),$(".contentPart").css({"margin-top":"0px"}))}"data129Top"==name&&"menu"!=$(element).data("target")&&("down"==direction?$scope.currentBlock=$(element).data("down"):"up"==direction&&($scope.currentBlock=$(element).data("up")),$scope.$digest()),"dataBottomTop"==name&&"down"==direction&&$(element).hasClass("tabPart")&&$(element).css({top:"auto","box-shadow":"none"})}})},0),$scope.changeBlock=function(menu,topic){var scrollOffset,speed;scrollOffset=window.scrollY,speed=30*Math.pow(Math.abs(scrollOffset-$("#"+menu).offset().top),1/3),$scope.currentBlock=topic,$("html, body").animate({scrollTop:$("#"+menu).offset().top-132+1},speed)},$scope.redirectToMonthly=function(categoryName,e){e.preventDefault(),mixpanel.track("/Monthly/Guide"),mixpanel.track("/Monthly/Guide/"+categoryName),window.location="/monthly"},$scope.popReceiveTutorialForm=function(){$("#email_collection_modal").modal()})}),angular.module("appStoryShow",[]).controller("storyShowCtrl",function($timeout,$scope){$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(){}})},0)}),angular.module("available_time_app",[]).directive("nat",function(){return{restrict:"C",scope:{_ngStart:"@varNgStartTime",_ngEnd:"@varNgEndTime",_ngCurrentuserTimezone:"@varNgCurrentuserTimezone"},link:function(scope,element){var _start=element.data("start"),_end=element.data("end"),_currentuserTimezone=element.data("currentuser-timezone");scope._ngStart&&scope._ngEnd&&(_start=new Date(parseInt(scope._ngStart)).getTime(),_end=new Date(parseInt(scope._ngEnd)).getTime(),_currentuserTimezone=scope._ngCurrentuserTimezone),_start%1e4!=0&&(_start+=1e3),_end%1e4!=0&&(_end+=1e3);var start=new Date(_start),end=new Date(_end),now=new Date,current_offset=-(60*now.getTimezoneOffset()*1e3),currentuserTimezone=1e3*parseInt(_currentuserTimezone,10);-1e3==currentuserTimezone&&(currentuserTimezone=current_offset);var start_offset=start,end_offset=end,now_offset=now,allDay=!1,endOfStartDay=start_offset.nextDayStartTime();end_offset-start_offset>=86399999?allDay=!0:end_offset>=endOfStartDay&&end_offset.setTime(endOfStartDay.getTime()-1);var time,endOfWeek=now_offset.endOfWeek(),date="";time=allDay?"All Day":start_offset.strftime("%l:%M%p")+" - "+end_offset.strftime("%l:%M%p"),date=start_offset.theSameDate(now_offset)?"Today":start_offset.strftime(start_offset>endOfWeek?"%b %d, %Y":"%A"),element.find(".date").text(date),element.find(".time").text(time)}}}).directive("cmUserTimeZone",function(){return{restrict:"A",link:function(scope,element){element.text((new Date).currentTimeZoneText())}}}),angular.module("notification_app",[]).controller("notificationSettingCtrl",function($scope,$window){$scope.status=!1,$scope.status=$window.Notification&&"granted"!==$window.Notification.permission||$window.Notification&&"granted"===$window.Notification.permission&&"granted"!==$.cookie("notification_permisson")?!1:!0,$scope.turn=function(to_status){"on"==to_status?($window.Notification&&"granted"!==$window.Notification.permission&&$window.Notification&&"denied"!==$window.Notification.permission&&$window.Notification.requestPermission(function(status){$window.Notification.permission!==status&&($window.Notification.permission=status),$.cookie("notification_permisson",status,{path:"/",expires:365}),$scope.status=!0,$scope.$digest()}),$window.Notification&&"granted"===$window.Notification.permission&&($.cookie("notification_permisson","granted",{path:"/",expires:365}),$scope.status=!0)):($.cookie("notification_permisson","declined",{path:"/",expires:365}),$scope.status=!1)}}).run(function($rootScope,$window,User){void 0==$.cookie("notification_permisson")&&$.cookie("notification_permisson","granted",{path:"/"}),User&&User.isMentor&&$window.Notification&&"granted"!==$window.Notification.permission&&"hide"!==$.cookie("notification_permisson")&&showMessage("info",'<b><a href="#" class="notify_enable">Click here to enable</a></b> desktop notifications for Codementor so you won\'t miss an incoming request. &nbsp;&nbsp; <a href="#" class="notify_no">No thanks</a>',function(domObj){domObj.find(".notify_enable").click(function(){return $window.Notification&&"denied"!==$window.Notification.permission&&$window.Notification.requestPermission(function(status){$window.Notification.permission!==status&&($window.Notification.permission=status),$.cookie("notification_permisson",status,{path:"/",expires:365}),domObj.find(".close").click()}),!1}),domObj.find(".notify_no").click(function(){return $.cookie("notification_permisson","hide",{path:"/",expires:3}),domObj.find(".close").click(),!1})})}),angular.module("mentor_calendar_app",["ngResource","ui.calendar"]).constant("DayNames",["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]).factory("Availabilities",function($resource){return $resource("/api/available_time/:id",{id:"@id"},{create:{method:"POST"},read:{method:"GET",isArray:!0,transformResponse:function(data){return angular.fromJson(data).map(function(availability){return availability.title="",availability.start=new Date(availability.start),availability.end=new Date(availability.end),availability})}},update:{method:"PUT"}})}).directive("fcEvent",function(){return{restrict:"C",transclude:!0,template:'<div class="full-height" ng-transclude></div><div class="absolute-top-right text-center app-scheduler-event-delete" ng-click="delete(id)">&#10006;</div>'}}).directive("fcEventTime",function(){return{restrict:"C",replace:!0,transclude:!0,template:'<div ng-click="edit(id)" ng-transclude></div>'}}).controller("SchedulerCtrl",function($scope,$filter,$compile,$http,DayNames,Availabilities){$scope.DayNames=DayNames,$scope.saving=!1,$scope.loading=!1;var _override=function(start,end,eventId){var events=$scope.calendar.fullCalendar("clientEvents",function(e){return!(start<=e.start&&end>e.start||start<e.end&&end>=e.end||start>=e.start&&end<=e.end)||eventId&&e.id==eventId?!1:!0});if(events.length>0){var answer=confirm("This action will delete other available time which are overlaped by new one.");if(!answer)return $scope.calendar.fullCalendar("unselect"),!1;for(var ids=_.map(events,function(e){return e.id}),i=0,len=ids.length;len>i;i++){var e=$scope.calendar.fullCalendar("clientEvents",ids[i])[0];$scope["delete"](e.id)}}return!0},_eventResize=function(event,dayDelta,minuteDelta,revert){Availabilities.read(function(availabilities){var _availability=$filter("filter")(availabilities,{id:event.id})[0];event.interval=_availability.interval;var endOfStartDay=event.start.nextDayStartTime();event.end>endOfStartDay&&(event.end=endOfStartDay),_override(event.start,event.end,event.id)?$scope.update(event):revert()})},_select=function(start,end,allDay,jsEvent,view){var endOfStartDay=start.nextDayStartTime();end>endOfStartDay&&(end=endOfStartDay),new Date>start?(alert("You can only select the time in the future."),$scope.calendar.fullCalendar("unselect")):"month"===view.name?($scope.calendar.fullCalendar("changeView","agendaDay"),$scope.calendar.fullCalendar("gotoDate",start)):_override(start,end)&&($scope.saving=!0,new Availabilities({title:"",start:start,end:end,allDay:allDay,interval:0}).$create(function(){$scope.saving=!1,$scope.calendar.fullCalendar("refetchEvents")}),$scope.calendar.fullCalendar("unselect"))};$scope.update_my_vacation=function(bool){$http.post("/api/users/on_vacation",{on_vacation:bool}).then(function(){return bool})},$scope.scheduler={config:{height:576,editable:!0,selectable:!0,selectHelper:!0,eventStartEditable:!1,allDaySlot:!1,ignoreTimezone:!1,axisFormat:"HH:mm",timeFormat:"HH:mm{ - HH:mm}",header:{right:"today, month, agendaWeek, prev, next"},defaultView:"agendaWeek",eventRender:function(event,element){$compile(element)(angular.extend($scope.$new(),{id:event.id}))},eventResize:_eventResize,select:_select},availabilities:[function(start,end,callback){var viewStartTimestamp=start.getTime();Availabilities.read(function(availabilities){var _createRepeat=function(availability,options){options=options||{};var repeatEnd,delta={day:void 0!==options.day?options.day:availability.start.getDay(),hour:availability.start.getHours(),minute:availability.start.getMinutes(),length:availability.end-availability.start},repeatStart=new Date(start);repeatStart.setTime(viewStartTimestamp+864e5*delta.day+36e5*delta.hour+6e4*delta.minute),start.dst()!=repeatStart.dst()&&repeatStart.setTime(repeatStart.dst()?repeatStart.getTime()-36e5:repeatStart.getTime()+36e5),repeatStart>availability.start&&(repeatEnd=new Date(repeatStart),repeatEnd.setTime(repeatStart.getTime()+delta.length),availabilities.push({id:availability.id,title:"",start:repeatStart,end:repeatEnd,allDay:!1}))};angular.forEach(availabilities,function(availability){if(availability.interval)switch(availability.interval){case 1:if("agendaWeek"===$scope.calendar.fullCalendar("getView").name)for(var i=7;i--;)_createRepeat(availability,{day:i});else for(var i=42;i--;)_createRepeat(availability,{day:i});break;case 7:if("agendaWeek"===$scope.calendar.fullCalendar("getView").name)_createRepeat(availability);else for(var i=6;i--;)_createRepeat(availability,{day:availability.start.getDay()+7*i})}}),callback(availabilities)})}]},$scope.edit=function(id){Availabilities.read(function(availabilities){$scope.activeAvailability=$filter("filter")(availabilities,{id:id})[0],$scope.activeAvailability.startDate=$scope.activeAvailability.start.getFullYear()+"-"+($scope.activeAvailability.start.getMonth()+1)+"-"+$scope.activeAvailability.start.getDate(),$scope.activeAvailability.endDate=$scope.activeAvailability.end.getFullYear()+"-"+($scope.activeAvailability.end.getMonth()+1)+"-"+$scope.activeAvailability.end.getDate(),$scope.activeAvailability.startTime=$scope.activeAvailability.start.toTimeString().substr(0,5),$scope.activeAvailability.endTime=$scope.activeAvailability.end.toTimeString().substr(0,5)})},$scope.update=function(availability){if(availability.startTime){var _sD=$("#ugly-hack-1").val().split("-"),_sT=availability.startTime.split(":"),_eD=$("#ugly-hack-2").val().split("-"),_eT=availability.endTime.split(":"),_s=new Date(_sD[0],_sD[1]-1,_sD[2],_sT[0],_sT[1]),_e=new Date(_eD[0],_eD[1]-1,_eD[2],_eT[0],_eT[1]);_e>_s&&(availability.start=_s,availability.end=_e)}Availabilities.update(availability).$promise.then(function(){$scope.calendar.fullCalendar("refetchEvents")})},$scope["delete"]=function(id){Availabilities.read(function(availabilities){var _availability=$filter("filter")(availabilities,{id:id})[0];(!_availability.interval||_availability.interval&&confirm("This action will delete all available times in this series. Continue?"))&&($scope.saving=!0,Availabilities["delete"]({id:id}).$promise.then(function(){$scope.saving=!1}),$scope.calendar.fullCalendar("removeEvents",id))})}}),angular.module("online_status_toggle_app",[]).directive("onlineStatusToggle",["$rootScope","$http","$interval",function($rootScope,$http,$interval){return{restrict:"E",template:'<a class="online-indicator-{{status}}" ng-click="toggleStatus($event)" href="#">{{status}}</a>',replace:!0,controller:["$scope",function($scope){$scope.toggleStatus=function(e){e&&($scope.status="online"===$scope.status?"offline":"online",$http.post($scope.updateStatusUrl,{status:$scope.status}))}}],link:function(scope,element,attrs){scope.status=attrs.status,scope.updateStatusUrl=attrs.updateStatusUrl,$interval(function(){$http.get(attrs.statusUrl).success(function(data){("online"==data||"offline"==data)&&(scope.status=data)})},3e3)}}}]),angular.module("timezone_app",[]).directive("timezoneDisplayer",function(){return{link:function(scope,element,attrs){function _timezone_convert(user_datetime,c_offset,o_offset){var utime=user_datetime.getTime(),utc=utime-c_offset,otime=utc+o_offset;return new Date(otime)}function _add_zero(i){return 10>i&&(i="0"+i),i}function _datetime_to_string(otime){var ny=otime.getFullYear(),nm=_add_zero(otime.getMonth()+1),nd=_add_zero(otime.getDate()),nh=otime.getHours(),nmin=_add_zero(otime.getMinutes());if(nh>=12)var ampm="PM";else var ampm="AM";var is_bad=!1;return 6>nh&&nh>2&&(is_bad=!0),nh>12?nh-=12:0==nh&&(nh=12),[ny+"-"+nm+"-"+nd+" "+nh+":"+nmin+ampm,is_bad]}function _refresh(e){if(e&&e.date)var date_str=e.date.strftime("%Y-%m-%d");else var date_str=date_picker.datepicker("getDate").strftime("%Y-%m-%d");if(date_str=date_str.split("-"),time_picker.size()>1)var v=$(time_picker.selector+":checked").val(),time_str=v?v.split(":"):void 0;else var time_str=time_picker.val().split(":");var now=new Date;scope.$emit("timeChanged",date_str,time_str);var y=date_str[0],m=date_str[1]-1,d=date_str[2],h=time_str?time_str[0]:now.getHours(),min=time_str?time_str[1]:now.getMinutes(),user_datetime=new Date(y,m,d,h,min),other_datetime=_timezone_convert(user_datetime,scope.current_user_timezone_offset,scope.other_user_timezone_offset),str=_datetime_to_string(other_datetime);$(".timeDisplay").text(str[0]),str[1]?element.find(".warning").show():element.find(".warning").hide(),user_datetime<new Date&&scope.$emit("timeChangedToPast")}var time_picker=element.find(attrs.timePicker||".time_picker"),date_picker=element.find(attrs.datePicker||"#datepicker");scope.$on("timezoneInit",function(e,data){if(data.default_time)var now=new Date(data.default_time);else var now=new Date;var h=now.getHours(),m=now.getMinutes();59==m?(m=0,h+=1):29==m&&(m+=1),data.default_time?(10>h&&(h="0"+h),0==m&&(m="00")):m>=30?(m="00",10>h+1?h="0"+(h+1):h+=1,h>=24&&(h="00")):(m="30",10>h&&(h="0"+h)),date_picker.datepicker("setDate",now.strftime("%Y-%m-%d")),time_picker.size()>1?time_picker.each(function(){return this.value==h+":"+m?(this.checked=!0,!1):void 0}):time_picker.val(h+":"+m),scope.current_user_timezone_offset=data.current_user_timezone_offset,scope.other_user_timezone_offset=data.other_user_timezone_offset,_refresh()}),scope.$on("timezoneChangeOffset",function(e,data){scope.current_user_timezone_offset=data.current_user_timezone_offset,scope.other_user_timezone_offset=data.other_user_timezone_offset,_refresh()}),time_picker.on("change",_refresh),date_picker.on("changeDate",_refresh),date_picker.on("show",function(e){e.stopPropagation(),e.preventDefault()})}}}).directive("checkTimeZone",function($rootScope,User){return{restrict:"A",link:function(){var browser_time_zone_offset=(new Date).getTimezoneOffset(),except_re_list=[/\/questions\/\d+/],_is_except=function(str,list){for(var i=0,len=except_re_list.length;len>i;i++)if(str.match(list[i]))return!1;return!0},serverTimezone=null;if(User&&User.time_zone){serverTimezone=User.time_zone.utc_offset;var _tmpServerTimezone=serverTimezone.split(":");if(2!=_tmpServerTimezone.length)return;var _tmpServerTimezoneHour=parseInt(_tmpServerTimezone[0]),_tmpServerTimezoneMin=0;_tmpServerTimezoneMin=_tmpServerTimezoneHour>0?parseInt(_tmpServerTimezone[1]):-parseInt(_tmpServerTimezone[1]),serverTimezone=60*_tmpServerTimezoneHour+_tmpServerTimezoneMin,serverTimezone!=-browser_time_zone_offset&&"true"!=$.cookie("never_ask_time_zone")&&_is_except(window.location.href,except_re_list)&&window.showMessage("other","Your time zone setting may be incorrect. Update time zone to GMT"+(new Date).currentTimeZoneText()+' ? <a class="yes" style="padding-left:10px;text-decoration:underline;" href="/users/profile_setting">Yes, take me to profile setting page</a> &nbsp; <a style="padding-left:10px;text-decoration:underline;" class="never_ask muted" href="#">Never ask again</a>',function(element){element.find(".yes").click(function(){mixpanel.track("Change Time Zone",{type:"yes",user:User.username})}),element.find(".never_ask").click(function(){$.cookie("never_ask_time_zone","true",{path:"/",expires:99999}),mixpanel.track("Change Time Zone",{type:"never_ask",user:User.username}),element.find(".close").click()})})}}}}),angular.module("userInfoService",[]).factory("userInfo",function($http){return{getUserInfo:function(username){return $http.get("/users/mentor_popover?username="+username)}}}),angular.module("surveyService",[]).factory("survey",function(){return{getExperienceLevelText:function(){return[{id:0,title:"Beginner"},{id:1,title:"Intermediate"},{id:2,title:"Advanced"}]},getWhyUseText:function(){return[{id:0,title:"I'm working on a side project",selected:!1},{id:1,title:"I'm building a startup",selected:!1},{id:2,title:"I'm a freelance developer",selected:!1},{id:3,title:"I'm a student",selected:!1},{id:4,title:"I'd like to find a job as a developer",selected:!1},{id:5,title:"I'm working as a full-time developer at a company",selected:!1}]}}}),angular.module("BadgePreviewerCtrl",[]).controller("BadgePreviewerCtrl",function($scope,User){var profileUrl="https://www.codementor.io/"+User.username;this.style="badge",this.tab="github",this.theme="light",this.githubBadge="contact-me",this.githubBadgeCode="",this.githubBadgeCodeType="markdown",this.githubBadgeTypes={"contact-me":{name:"Contact me on Codementor",src:"/badges/contact_me_github.svg"},"book-session":{name:"Book session on Codementor",src:"/badges/book_session_github.svg"},"get-help":{name:"Get help on Codementor",src:"/badges/get_help_github.svg"}},this.githubBadgeTypeKeys=Object.keys(this.githubBadgeTypes),this.genGithubCode=function(type){return"html"==this.githubBadgeCodeType?'<a href="'+profileUrl+'"><img src="https://cdn.codementor.io'+this.githubBadgeTypes[type].src+'" alt="'+this.githubBadgeTypes[type].name+'" style="max-width:100%" /></a>':"[!["+this.githubBadgeTypes[type].name+"](https://cdn.codementor.io"+this.githubBadgeTypes[type].src+")]("+profileUrl+")"}.bind(this),$scope.$watch("previewer.githubBadge",function(n){n&&(this.githubBadgeCode=this.genGithubCode(n))}.bind(this)),$scope.$watch("previewer.githubBadgeCodeType",function(n){n&&(this.githubBadgeCode=this.genGithubCode(this.githubBadge))}.bind(this)),this.websiteBadge="i-am-a-codementor-dark",this.websiteBadgeCode="",this.websiteBadgeTypes={"i-am-a-codementor-dark":{name:"I am a codementor",src:"/badges/i_am_a_codementor_dark.svg"},"codementor-dark":{name:"Codementor",src:"/badges/codementor_dark.svg"},"i-am-a-codementor-light":{name:"I am a codementor",src:"/badges/i_am_a_codementor_light.svg"},"codementor-light":{name:"Codementor",src:"/badges/codementor_light.svg"}},this.websiteBadgeTypeKeys=Object.keys(this.websiteBadgeTypes),this.genWebsiteCode=function(type){return'<a href="'+profileUrl+'"><img src="https://cdn.codementor.io'+this.websiteBadgeTypes[type].src+'" alt="'+this.websiteBadgeTypes[type].name+'" style="max-width:100%"/></a>'}.bind(this),$scope.$watch("previewer.websiteBadge",function(n){n&&(this.websiteBadgeCode=this.genWebsiteCode(n))}.bind(this))}),angular.module("appCMGeneralFilters",[]).factory("noteFilePattern",function(){return/\n\[Attachment: (<a codementor-attach-file target="_blank" href=".+">.+<\/a>)\]/g}).filter("truncate",function(){return function(text,length,end){if(isNaN(length)&&(length=10),void 0===end&&(end=" ..."),text.length<=length||text.length-end.length<=length)return text;var result=String(text).substring(0,length-end.length);return result=result.substr(0,Math.min(result.length,result.lastIndexOf(" "))),result+end}}).filter("min",function(){return function(count,min){return Math.min(count,min)}}).filter("fileSize",function(){return function(size){var num="",unit="";return 1e3>size?(num=Math.round(size/1e3*100)/100,unit="K"):1e6>size?(num=Math.round(size/1e3),unit="K"):(num=Math.round(size/1e6*100)/100,unit="M"),isNaN(num)?"":num+unit}}).filter("reverse",function(){return function(items){return items.slice().reverse()}}).filter("newLine",function(){return function(text){return text.replace(/\n/g,"<br>").replace(/&#10;/g,"<br>")}}).filter("parseNote",function($filter,noteFilePattern){return function(text){var p=noteFilePattern,match=text.match(p);return text=text.replace(p,""),text=$filter("linky")(text,"_blank"),text=$filter("newLine")(text),angular.forEach(match,function(t){text+=t.replace(p,'<div class="note-li-attachment"><i class="icon-paper-clip"></i> $1</div>')}),text}}).filter("strftime",function(){return function(str,format){return new Date(str).strftime(format)}}).filter("firstName",function(){return function(str){return str.split(" ")[0]}}).filter("last",function(){return function(obj,n){if(obj){for(var lastN={},lastNkeys=_.last(Object.keys(obj),n),i=0,len=lastNkeys.length;len>i;i++)lastN[lastNkeys[i]]=obj[lastNkeys[i]];return lastN}return obj}}),angular.module("debounceService",[]).factory("debounce",function($timeout,$q){return function(func,wait,immediate){var timeout,deferred=$q.defer();return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||(deferred.resolve(func.apply(context,args)),deferred=$q.defer())},callNow=immediate&&!timeout;return timeout&&$timeout.cancel(timeout),timeout=$timeout(later,wait),callNow&&(deferred.resolve(func.apply(context,args)),deferred=$q.defer()),deferred.promise}}}),angular.module("template/appInboxNotification.html",[]).run(function($templateCache){$templateCache.put("template/appInboxNotification.html",'<div class="inboxNotification pull-right ng-cloak"><a class="cm-notify" ng-class="{active:show}" href="#" ng-click="toggleNoti()"><i class="icon-bell-alt"></i><i class="count" ng-hide="count<=0 || hideCount">{{count|min:99}}</i></a><div class="notification-list list-group" ng-show="show"><div class="list-group-heading clearfix"><h3 class="list-group-title pull-left">Notifications<img ng-src="/assets/ajax-loader.gif" ng-cloak ng-show="loading"></h3><div class="action pull-right"><a href="#" ng-click="markAllAsRead()">Mark as Read</a></div></div><div class="list-group-body"><div ng-class="{read:noti.read}" class="list-group-item clearfix" ng-repeat="noti in notifications" ng-click="goto(noti.id, noti.url)"><a ng-href="{{noti.url}}" style="position:absolute;width:100%;height:100%;top:0;left:0;text-decoration:none;z-index:10;background-color:#fff;opacity:0;filter:alpha(opacity=1)"></a><span class="cm-avatar pull-left"><img ng-src="{{noti.sender.avatar_url}}"></span><h4 class="list-group-item-heading">{{noti.title.replace("Message from","Note from")}}</h4><p class="list-group-item-text">{{getDisplayBody(noti)|truncate:70}}</p></div><div class="empty-notification list-group-item read center" ng-cloak ng-show="notifications.length==0">No notifications.</div></div><div class="list-group-footer center clearfix"><a href="/notifications">See All</a></div></div></div>')}),angular.module("appInboxNotification",["template/appInboxNotification.html","debounceService"]).factory("Notifications",function($resource){return $resource("/api/notifications/:nid",{nid:"@nid"},{get:{method:"GET",isArray:!1},markAsRead:{method:"PUT"},markAllAsRead:{url:"/api/notifications/read_all",isArray:!1,method:"PUT"}})}).directive("cmNotify",function($rootScope,$window,Sound,Notifications,noteFilePattern,Idle){return{restrict:"E",replace:!0,controller:function($scope){$scope.notifications=[],$scope.count=0,$scope.show=!1,$scope.loading=!1,$scope.hideCount=!1,$scope.getNoti=function(){$scope.loading=!0,Notifications.get(function(data){$scope.notifications=data.notifications,$scope.count=data.count||$scope.count,$scope.loading=!1,document.title=$scope.count>0&&!$scope.hideCount?"("+$scope.count+") "+document.title.replace(/^\(\d+\) /,""):document.title.replace(/^\(\d+\) /,"")},function(){console.log("FAILURE - notifications"),$scope.loading=!1})},$scope._clickOut=function(event){$(event.target).parents(".inboxNotification").size()>0||$(event.target).hasClass("inboxNotification")||($scope.show=!1,$scope.$digest())},$rootScope.$on("profileAvatarClicked",function(){$scope.show=!1}),$scope.getDisplayBody=function(noti){return noti.body.replace(noteFilePattern,"")},$scope.toggleNoti=function(){$scope.show||($scope.hideCount=!0,$scope.getNoti()),$scope.show=!$scope.show,$(document).off("click",$scope._clickOut),$(document).off("touchend",$scope._clickOut),$(document).on("click",$scope._clickOut),$(document).on("touchend",$scope._clickOut)},$scope.markAllAsRead=function(){$scope.loading=!0,Notifications.markAllAsRead(function(){$scope.loading=!1,$scope.count=0;for(var i=$scope.notifications.length;i--;)$scope.notifications[i].read=!0},function(){console.log("FAILURE - notifications - Mark All As Read"),$scope.loading=!1}),Idle.cancelIdleTimer()};var _read=function(id){var target=_.find($scope.notifications,function(noti){return noti.id==id?noti:void 0});Idle.cancelIdleTimer(),target.read||(target.read=!0,$scope.count-=1,$scope.count<0&&($scope.count=0))};$scope["goto"]=function(id){$scope.loading=!0,_read(id),Notifications.markAsRead({nid:id},function(){$scope.loading=!1},function(){$scope.loading=!1})},$rootScope.$on("new_notification",function(data){$scope.hideCount=!1,$scope.count=data.unread_count||$scope.count,$scope.getNoti(!0),$scope.count>0&&Sound.notify()}),$scope.getNoti()},link:function(scope,element){var _getHeight=function(){var winHeight=angular.element($window).height(),result=winHeight-149;return 0>result&&(result=0),result>400&&(result=400),result};angular.element($window).bind("resize",function(){element.find(".list-group-body").css("max-height",_getHeight()+"px")})},templateUrl:"template/appInboxNotification.html"}
}).controller("notificationPageCtrl",function($scope,$window,$http,RefreshAlert){$scope.goTo=function(notiPath){console.log(notiPath),$http({method:"GET",url:notiPath}).success(function(){}).error(function(data,status){401==status&&RefreshAlert.open("logout")})}}),angular.module("appTutorialList",[]).factory("SubMenuTopAfterScroll",function(){return{get:function(){return 50-$(".fixed-bar").height()}}}).controller("tutorialListCtrl",function($timeout,$scope){$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(){}})},0),$scope.getHelpNow=function(){window.IHRc&&window.IHRc.getHelpNow(event,"header")},$scope.showSignUpModal=function(){$("#email_collection_modal_for_articles").modal()}}).directive("subMenuStickAtBottom",function($window,User,SubMenuTopAfterScroll){return{restrict:"A",link:function(){var updatePosition=function(){{var top=angular.element($window).scrollTop(),test=$("footer").position().top<top+$(".signup").height()+$(".top-posts").height()+120;SubMenuTopAfterScroll.get()}test?($(".top-posts").css({position:"relative",bottom:top-$("footer").position().top+$(".top-posts").height()+$("footer").height()-20}),$(".signup").css({position:"relative",bottom:top-$("footer").position().top+$(".top-posts").height()+$("footer").height()-20})):($(".top-posts").css({bottom:"inherit"}),$(".signup").css({bottom:"inherit"}))};angular.element($window).bind("resize",updatePosition),angular.element($window).bind("scroll",updatePosition)}}}),angular.module("appTutorialNew",[]).controller("tutorialNewCtrl",function($scope,$timeout,$location,$http){$scope.state="draft",$scope.realTags=[],$scope.need_auto_save=!1;var inSaveProcess=!1;$scope.initialSet=function(selected_category,action_url,update_time,need_auto_save,imgUrl){$("#generateIndexHint").popover(),$("#SelectTopicModal").on("hidden",function(){"other"==$(".tutorialSelector").val()&&($(".tutorialSelector option").removeAttr("selected"),$(".tutorialSelector option[value='']").attr("selected",!0),$scope.selectedItem="")}),void 0!==selected_category&&""!=selected_category&&($scope.selectedItem=selected_category),$scope.tutorialTitle=$(".tutorialTitleInput").val(),$scope.featurePhoto=imgUrl||"",$scope.tutorialContent=decodeURIComponent(gon.article_content),$scope.lastUpdateTime=update_time,$scope.action_url=action_url,$scope.need_auto_save=need_auto_save,$scope.need_auto_save&&($scope.$watch("tutorialContent",_.debounce(SaveUpdates,1e3)),$scope.$watch("featurePhoto",_.debounce(SaveUpdates,1e3)),$scope.$watch("selectedItem",_.debounce(SaveUpdates,1e3)),$scope.$watch("tutorialTags",_.debounce(SaveUpdates,1e3))),$(".tutorialSelector").on("change",function(){if("other"==$(".tutorialSelector").val()){var category=prompt("What's the main topic for your tutorial?","");null!=category&&""!=category.trim()?addOptionAndChangeSelected(category.trim()):($(".tutorialSelector option").removeAttr("selected"),$(".tutorialSelector option[value='']").attr("selected",!0),$scope.selectedItem="")}}),$timeout(function(){$("#markdownText").markdown({autofocus:!1,savable:!1}),$("#markdownText").data("markdown").showPreview()},500)},$scope.uploadFeaturePhoto=function(){filepicker.pick(function(Blob){$scope.featurePhoto=Blob.url,$scope.saveFunction(),$scope.$digest()})},$scope.cancelFeaturePhoto=function(){$scope.featurePhoto="",$scope.saveFunction(),$scope.$digest()};var SaveUpdates=function(newVal,oldVal){newVal!=oldVal&&$scope.saveFunction()};$scope.saveFunction=function(){if($scope.need_auto_save&&!inSaveProcess&&!$scope.checkSaveInvalid()){inSaveProcess=!0;var data={authenticity_token:$('meta[name="csrf-token"]').attr("content"),title:$scope.tutorialTitle,content:$scope.tutorialContent,feature_photo_url:$scope.featurePhoto,main_category:$scope.selectedItem,tags:$scope.tutorialTags};$http.post($scope.action_url,data).success(function(data){$scope.lastUpdateTime=new Date,$scope.action_url=data.next_url,$scope.previewUrl=$location.protocol()+"://"+$location.host()+":"+$location.port()+data.preview_url,$(".newTutorial").attr("action",data.submit_url),inSaveProcess=!1})}},$scope.checkSaveInvalid=function(){return void 0===$scope.tutorialTitle||""==$scope.tutorialTitle?!0:void 0===$scope.selectedItem||""==$scope.selectedItem?!0:!1},$scope.updateTags=function(tags){$scope.tutorialTags=tags.map(function(t){return t.text.toLowerCase()})},$scope.showTime=function(d){return""!=d?new Date(d).strftime("%F %T"):"-"},$scope.submitForm=function(type){$scope.state=type,$(".state").val(type),"submitted"!=type||confirm("The Codementor team will review your submitted tutorial shortly and you\u2019ll be notified once it is approved.")||event.preventDefault()};var addOptionAndChangeSelected=function(s){$(".tutorialSelector").append("<option value='"+s+"'>"+s+"</option>"),$(".tutorialSelector").val(s),$scope.selectedItem=s}}),angular.module("appTutorialShow",[]).factory("SubMenuTopAfterScroll",function(){return{get:function(){return 30-($(".tutorialType").height()+$(".leftSignUpBlock").height())}}}).controller("tutorialShowCtrl",function($scope,$timeout,Viewport,User,SubMenuTopAfterScroll){$("body").attr("id","skrollr-body"),$("[data-typer-targets]").typer();var last_topic="mainTitle",$dom_h2=$("h2"),$dom_h3=$("h3");$dom_h2.length>0?$dom_h2.each(function(index,element){$(element).attr("data-71-top",""),$(element).attr("data-emit-events",""),$(element).attr("data-up",last_topic),$(element).attr("data-down",$(element).attr("id")),last_topic=$(element).attr("id")}):$dom_h3.each(function(index,element){$(element).attr("data-71-top",""),$(element).attr("data-emit-events",""),$(element).attr("data-up",last_topic),$(element).attr("data-down",$(element).attr("id")),last_topic=$(element).attr("id")}),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(element,name,direction){"data-51Top"==name?"down"==direction?$(".top-promotion-area").hide():"up"==direction&&$(".top-promotion-area").show():"data50Top"==name?"down"==direction?($(".subMenu").css({top:SubMenuTopAfterScroll.get(),"z-index":4,position:"fixed"}),$(".fixed-sharing-box").css({display:"block"}),$("body").width()>767&&$(".content").css({"margin-left":"240px"})):"up"==direction&&($(".subMenu").css({top:"initial","z-index":3,position:"inherit"}),$(".fixed-sharing-box").css({display:"none"}),$(".content").css({"margin-left":"0px"})):"data71Top"==name&&"subMenu"!=$(element).data("target")&&("down"==direction?$scope.currentBlock=$(element).data("down"):"up"==direction&&($scope.currentBlock=$(element).data("up")),$scope.$digest())}})},0),$scope.initialSet=function(postTime){$scope.postTime=postTime,$scope.currentBlock="mainTitle"},$scope.showDate=function(timestamp){return new Date(1e3*timestamp).strftime("%B %o %Y")},$scope.changeBlock=function(id){var scrollOffset,speed;scrollOffset=window.scrollY,speed=30*Math.pow(Math.abs(scrollOffset-$("#"+id).offset().top),1/3),$scope.currentBlock=id,$("html, body").animate({scrollTop:$("#"+id).offset().top-70+1},speed)},$scope.showSignUpModal=function(){$("#email_collection_modal_for_articles").modal()},$scope.scrollTop=function(){$scope.changeBlock("article")}}).directive("subMenuStickAtBottom",function($window,User,SubMenuTopAfterScroll){return{restrict:"A",link:function(){var updatePosition=function(){var top=angular.element($window).scrollTop();if($("body").width()<=767)return $(".subMenu").css({position:"relative"}),void $(".leftSignUpBlock .header").hide();var topAfterScroll=SubMenuTopAfterScroll.get();$("footer").position().top-top-150<$(".quickIndex").height()?$(".subMenu").css({top:topAfterScroll-($(".quickIndex").height()-($("footer").position().top-top)+150)}):top>-500-parseInt($(".scrollHeight").val())&&$(".subMenu").css({top:topAfterScroll})};angular.element($window).bind("resize",updatePosition),angular.element($window).bind("scroll",updatePosition)}}}),angular.module("codementor",["ngRoute","ngResource","ngStorage","angularSpinner","available_time_app","BadgePreviewerCtrl","mentor_calendar_app","modal/hellosign-tutorial.html","notification_app","online_status_toggle_app","timezone_app","ui.bootstrap.datetimepicker","template/profileImage.html","modal/crop-image-modal.html","app","appAlert","appApplicantNew","appAvatar","appBlogList","appBlogShow","appBusiness","appCMGeneralFilters","appChat","appCodementorMonthly","appCourse","appDashboard","appDirectory","appDirectoryTopic","appEditExpertise","appExpertiseForm","appExpertiseSorting","appFindMentor","appFaq","appFavorite","appFreeCredit","appHelpListingShow","appHourOfCode","appInboxNotification","appInvoice","appLearn","appLanguage","appLongterm","appMenteeProfile","appMentorApplyEdit","appMentorProfile","appPopoverProfile","appNote","appOfficeHour","appOfficeHourLanding","appOfflineHelp","appOhShow","appScheduleCluster","appPayment","appPayoutSettings","appPrepareLesson","appPresence","appPromoteMentor","appQuestion","appRateForClient","appRequest","appRightSideBar","appSchedule","appSelectAllText","appSeoNew","appSound","appStoryShow","appTutorialList","appTutorialNew","appTutorialShow"]).config(function($routeProvider){return gon.searchPage||gon.normalHashPage?void 0:$routeProvider.when("/online_mentors",{}).when("/available_mentors",{}).when("/broadcast_mentors",{})}).config(function($compileProvider){$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|bitcoin):/)}).directive("minibarEvent",function(){return{restrict:"A",link:function(scope,elem,attrs){if("false"!=attrs.minibarEvent){var update=function(){var top=$(document).scrollTop();top>35?elem.addClass("minibar"):(top>20&&$(".navbar .navbar-inner").css("padding-top",top),0>=top&&$(".navbar .navbar-inner").css("padding-top",20),elem.removeClass("minibar"))};$(window).scroll(update),update()}}}}).directive("body",function($rootScope){return{restrict:"E",link:function(scope,elem){elem.bind("click",function(e){$rootScope.$broadcast("bodyClicked",e)}),scope.$on("enableChatBar",function(){elem.addClass("chat-side-bar")}),scope.$on("disableChatBar",function(){elem.removeClass("chat-side-bar")})}}}).directive("sideBarStickAtBottom",function($window){return{restrict:"A",link:function(scope,elem){var updatePosition=function(){var top=angular.element($window).scrollTop();return $("body").width()<=767?void elem.css({position:"relative",top:"auto","z-index":4}):void(document.getElementsByClassName("footer-block").length>0?elem.height()+100+top>$("footer").position().top-40?(elem.css({position:"absolute",top:$("footer").position().top-40-elem.height()-100}),elem.position().top>$(".secondPart").position().top&&elem.css({"z-index":3})):(elem.css({position:"fixed",top:"137px","z-index":4}),100+top>$(".secondPart").position().top&&elem.css({"z-index":3})):elem.height()+100+top>document.body.offsetHeight-40?(elem.css({position:"absolute",top:document.body.offsetHeight-40-elem.height()-100}),elem.position().top>$(".secondPart").position().top&&elem.css({"z-index":3})):(elem.css({position:"fixed",top:"137px","z-index":4}),100+top>$(".secondPart").position().top&&elem.css({"z-index":3})))};angular.element($window).bind("resize",updatePosition),angular.element($window).bind("scroll",updatePosition)}}}).directive("a",function(){return{restrict:"E",link:function(scope,elem,attrs){(""===attrs.href||"#"===attrs.href)&&elem.on("click",function(e){e.preventDefault()})}}}).directive("wbr",function(){return{restrict:"A",link:function(scope,elem){elem.find(">div a").each(function(){var v=$(this).html();$(this).html(v.replace(/(\%|\&|-|\=)/gi,function(v){return"<wbr>"+v}))})}}}).directive("hideGravatar404",function(){return{restrict:"C",link:function(scope,elem){elem.on("load",function(){elem.show()}).on("error",function(){elem.hide()})}}}).directive("expandable",function(){return{restrict:"A",link:function(scope,elem){elem.click(function(e){$(e.target).is("a")||($(this).parents("li").hasClass("expanded")?$(this).parents("li").removeClass("expanded"):($(".issues-list li").removeClass("expanded"),$(this).parents("li").addClass("expanded")))})}}}).controller("MainCtrl",function($scope,Chat,Schedule){$scope.Chat=Chat,$scope.Schedule=Schedule}).controller("cookieHideCtrl",function($scope){$scope.show=!1,$scope.init=function(key){key&&($scope.key=key,$.cookie(key)||($scope.show=!0))},$scope.doHide=function(){$scope.key&&($.cookie($scope.key,!0,{path:"/"}),$scope.show=!1)}}).controller("headerProfileAvatarCtrl",function($scope,$rootScope){$scope.profileMenu=!1,$scope.imgUrl=null,$scope.init=function(imgUrl){$scope.imgUrl=imgUrl},$scope._clickOut=function(e){0==$(e.target).parents(".profile-avatar").size()&&($scope.profileMenu=!1,$(document).off("touchend",$scope._clickOut),$(document).off("click",$scope._clickOut),$scope.$digest())},$scope.onClick=function(e){$rootScope.$broadcast("profileAvatarClicked"),e.stopPropagation(),$scope.profileMenu=!$scope.profileMenu,$(document).off("touchend",$scope._clickOut),$(document).on("touchend",$scope._clickOut),$(document).off("click",$scope._clickOut),$(document).on("click",$scope._clickOut)},$rootScope.$on("onProfileImgChange",function(event,imgUrl){$scope.imgUrl=imgUrl})}).controller("connectNowNotifyCtrl",function($scope,$rootScope,$http,$timeout,User){var canceled_notifications={};$scope.show=!1,$scope.snapshot_name="",$scope.data={},$rootScope.$on("firebase_auth_success",function(){$scope.userRef=$rootScope.firebaseRef.child("realtime").child(User.firebaseId);var browser_notifies=[];$scope.cancelNotify=function(){for(var i=0,len=browser_notifies.length;len>i;i++){var browser_notify=browser_notifies[i];browser_notify&&_.isFunction(browser_notify.close)&&browser_notify.close()}},$scope.audio=$("#chatAudio")[0],$scope.audioPlay=function(doLoop){var loop=function(){this.currentTime=0,this.play()};$scope.audio.removeEventListener("ended",loop,!1),doLoop&&$scope.audio.addEventListener("ended",loop,!1),$scope.audio.play()},$scope.userRef.on("child_added",function(snapshot){var data=snapshot.val();if(null!==data){var browser_notify=null,name=snapshot.name(),now=(new Date).getTime();if("undefined"!=typeof data.expired_at&&data.expired_at<now)return void $scope.userRef.child(name).remove();if("new_realtime_lesson"===data.type){if(gon.prepare_lesson&&gon.prepare_lesson.question.id==data.question_id)return;$http.get("/users/info?username="+data.user_name).success(function(data_info){$scope.free_length=data_info.free_length>0?"(first "+data_info.free_length/60+" minutes free)":"",browser_notify=sendNotification("Connect Now",data.user_name+" would like to connect with you now "+(data.question_is_direct?"":"about: "+data.title)+$scope.free_length),browser_notifies.push(browser_notify),$scope.show=!0,mixpanel.track("/connect_now/notification/show")})}else{if("reject_realtime_lesson"===data.type)return canceled_notifications[$scope.snapshot_name]=!0,void $scope.userRef.child($scope.snapshot_name).remove();if("expire_realtime_lesson"===data.type)return User.isMentor&&($scope.expire_timer&&$timeout.cancel($scope.expire_timer),name in canceled_notifications||(canceled_notifications[name]=!0,$scope.data.type="miss_connection"),cancelFlashTitle(),browser_notify&&_.isFunction(browser_notify.close)&&browser_notify.close()),canceled_notifications[$scope.snapshot_name]=!0,void $scope.userRef.child($scope.snapshot_name).remove();if("in_prepare_lesson"!==data.type)return"new_notification"===data.type?($rootScope.$broadcast("new_notification",{unread_count:data.unread_count}),void $scope.userRef.child(snapshot.name()).remove()):!1;if(gon.prepare_lesson&&gon.prepare_lesson.question.id==data.question_id)return;browser_notify=sendNotification("The Session is Ready",data.user_name+" is waiting to start the session with you "+(data.question_is_direct?"":"about: "+data.title)),browser_notifies.push(browser_notify),$scope.show=!0}$scope.snapshot_name&&($scope.userRef.child($scope.snapshot_name).remove(),$scope.cancelNotify(),$scope.data.question_id==data.question_id&&$timeout.cancel($scope.expire_timer)),$scope.data=data,$scope.snapshot_name=name,flashTitle("(1) Incoming request!",1e3),$scope.audioPlay("new_realtime_lesson"===data.type),User.isMentor&&($scope.expire_timer=$timeout(function(){name in canceled_notifications||(canceled_notifications[name]=!0,$scope.dismiss(data.cancel_url,!0),$scope.data.type="miss_connection"),cancelFlashTitle(),browser_notify&&_.isFunction(browser_notify.close)&&browser_notify.close()},12e4)),$scope.$digest()}}),$scope.userRef.child("ongoing_session").limit(1).on("child_added",function(snapshot){var data=snapshot.val(),lesson=(snapshot.name(),data[Object.keys(data)[0]]);gon.prepare_lesson&&gon.prepare_lesson.question.id==lesson.question.id||$http.get("/api/lessons/"+lesson.id+"/check_ongoing").then(function(r){if(!r.data||!r.data.ongoing)return void $rootScope.firebaseRef.child("presence").child(User.username.replace(/\./g,"^")).child("session").set(!1);lesson.type="ongoing_session",lesson.opposite_user=lesson.mentor.username==User.username?lesson.mentee:lesson.mentor,lesson.user_image_url=lesson.opposite_user.profile_image;var browser_notify=sendNotification("Ongoing Session","You have an ongoing session with "+lesson.opposite_user.display_name+" about: "+lesson.question.title);browser_notifies.push(browser_notify),$scope.show=!0,$scope.data=lesson,$scope.audioPlay(!1)})})}),$scope.stopSound=function(){$scope.audio&&($scope.audio.pause(),$scope.audio.currentTime=0)};var _act=function(doNotRemove){$scope.stopSound(),doNotRemove||(canceled_notifications[$scope.snapshot_name]=!0,$scope.userRef.child($scope.snapshot_name).remove()),cancelFlashTitle(),$scope.cancelNotify(),$timeout.cancel($scope.expire_timer)};$scope.accept=function(url){_act(),$scope.show=!1,window.location.href=url},$scope.dismiss=function(url,is_cancel){_act(),is_cancel||($scope.show=!1),url?($http.post(url+"?ajax=true"),is_cancel?mixpanel.track("/connect_now/notification",{action:"Expired - Cancel Lesson"}):mixpanel.track("/connect_now/notification",{action:"No Thanks"})):mixpanel.track("/connect_now/notification/user",{action:"OK"})},$scope.joinDismiss=function(){_act(!0),$scope.show=!1,mixpanel.track("/ongoing_session/notification",{action:"OK - ONGOING SESSION"})},$scope.toDashboard=function(url){_act(),$scope.show=!1,mixpanel.track("/connect_now/notification",{action:"View Details"}),window.location.href=url.replace("active","open")},$scope.tryAgain=function(url){_act(),$scope.show=!1,mixpanel.track("/connect_now/notification/user",{action:"Try Again"}),window.location.href=url},$scope.startNow=function(url){_act(),$scope.show=!1,mixpanel.track("/connect_now/notification",{action:"Start Now"}),window.location.href=url},$scope.joinSession=function(url){_act(!0),$scope.show=!1,mixpanel.track("/ongoing_session/notification",{action:"Join Now"}),window.location.href=url},$scope.otherMentors=function(url){_act(),$scope.show=!1,mixpanel.track("/connect_now/notification/user",{action:"Find Another Mentor"}),window.location.href=$scope.data.question_is_direct?"/experts":url}}).directive("ngEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.ngEnter)}),event.preventDefault())})}}).directive("clearStorage",function(){return{restrict:"A",link:function(scope,elem){elem.click(function(){localStorage["ngStorage-chatrooms"]=JSON.stringify([])})}}}).directive("currentTime",function($timeout){return{restrict:"E",scope:!0,template:'<span class="current-time">{{currentTime}}</span>',replace:!0,link:function(scope,elem,attrs){var timezoneOffset=parseInt(1e3*attrs.offset),update=function(){isNaN(timezoneOffset)||$timeout(function(){var timezoneTxt=timezoneToText(-(timezoneOffset/1e3/60));scope.currentTime=(new Date).offset(timezoneOffset).strftime("%a %l:%M %p ")+"GMT"+timezoneTxt.sign+timezoneTxt.h+timezoneTxt.m})},debounceUpdate=_.debounce(update,200);elem.parents(".appChatList-li").on("mouseover",debounceUpdate),update(),scope.$on("$destroy",function(){elem.parents(".appChatList-li").off("mouseover",debounceUpdate)})}}}).directive("timeDisplayer",function(){return{restrict:"E",scope:{datetime:"="},template:'<span class="time-displayer">{{time}}</span>',replace:!0,link:function(scope){var date=new Date(scope.datetime);scope.time=date.strftime("%b %d, %Y, %l:%M %p")+" ("+date.currentTimeZoneText()+")"}}}).run(function($rootScope,$http,$timeout,$route,$init,Chat){if(filepicker.setKey("AnYaDARpUTGKmQ2PClaFrz"),$rootScope.firebaseRef=new Firebase($init.firebase.path),$timeout(function(){$rootScope.firebaseRef.auth($init.firebase.token,function(error){error||$rootScope.$broadcast("firebase_auth_success")})},0),$rootScope.cmTrack=function(eventName,payload){mixpanel.track(eventName,payload)},window.getUrlParameterByName){var username=window.getUrlParameterByName("openchat");username&&$http.get("/api/chat_info/"+username).success(function(result){Chat.openChatroom({id:result.chatroom_id_for,chatroomFirebaseId:result.chatroom_firebase_id_for,contact:{name:result.display_name,username:username,avatarUrl:result.avatar}})}).error(function(data,status){401==status&&RefreshAlert.open("logout")})}}).directive("profileImage",function($resource,$location,$modal){return{restrict:"E",scope:{imgSrc:"@"},transclude:!0,templateUrl:"template/profileImage.html",link:function(scope){function cropAndUpload(url,width,height,top,left){scope.imgShow=!1;var blob={url:url,mimetype:"image/jpeg",isWriteable:!1},option={fit:"clip",crop:[left,top,200,200]};width&&(option.width=width),height&&(option.height=height),filepicker.convert(blob,option,function(new_Blob){var uploadPhotoResource=$resource(baseUrl+"/users/upload_photo",{},{post:{method:"POST",isArray:!1}});uploadPhotoResource.post(null,{photoUrl:new_Blob.url},function(){if(scope.imgSrc.indexOf("https://www.gravatar.com")<0){var oldBlob={url:scope.imgSrc,mimetype:"image/jpeg"};filepicker.remove(oldBlob)}scope.imgSrc=new_Blob.url,scope.isGravatar=!1,scope.$emit("onProfileImgChange",scope.imgSrc)}),filepicker.remove(blob)},function(e){console.log("Fail to convert image: "+e)})}var baseUrl=$location.protocol()+"://"+$location.host()+":"+$location.port();scope.imgShow=!0,scope.showText=!1,scope.isShowUpdateOption=!1,scope.isGravatar=scope.imgSrc.indexOf("https://www.gravatar.com")>=0,angular.element("#profile-photo")[0].onload=function(){scope.$apply(function(){scope.imgShow=!0})},scope.imgMouseOver=function(){scope.showText=!0},scope.imgMouseLeave=function(){scope.isShowUpdateOption||(scope.showText=!1)},scope.showUpdateOption=function(){scope.isShowUpdateOption=!scope.isShowUpdateOption},scope.uploadPhoto=function(){scope.showText=!1,scope.isShowUpdateOption=!1,filepicker.pick({mimetype:"image/*"},function(Blob){var blob={url:Blob.url},modalInstance=$modal.open({templateUrl:"modal/crop-image-modal.html",controller:"cropImageModalCtrl",resolve:{imgMetadata:function(){return{url:Blob.url}}}});modalInstance.result.then(function(data){cropAndUpload(Blob.url,data.width,data.height,data.top,data.left)},function(){filepicker.remove(blob)})})},scope.redirectGravatar=function(){window.open("https://www.gravatar.com/","_blank")},scope.removePhoto=function(){if(!(scope.imgSrc.indexOf("https://www.gravatar.com")>=0)){scope.showText=!1,scope.isShowUpdateOption=!1,scope.imgShow=!1;var removePhotoResource=$resource(baseUrl+"/users/remove_photo",{},{post:{method:"POST",isArray:!1}}),blob={url:scope.imgSrc,mimetype:"image/jpeg"};filepicker.remove(blob),removePhotoResource.post(null,{},function(data){scope.imgSrc=data.metadata.url,scope.$emit("onProfileImgChange",scope.imgSrc),scope.imgShow=!0,scope.isGravatar=!0})}},angular.element(document).on("click",function(e){0===angular.element(e.target).closest("#update-wrapper").length&&scope.$apply(function(){scope.showText=!1,scope.isShowUpdateOption=!1})})}}}).controller("cropImageModalCtrl",function($scope,$modalInstance,$timeout,imgMetadata){$scope.imgUrl=imgMetadata.url,$scope.showImg=!1;var finalTop=0,finalLeft=0,finalWidth=null,finalHeight=null;$timeout(function(){var wrapper=angular.element("#profile-wrapper")[0],imgElement=angular.element("#profile-image-crop")[0],imgFrame=angular.element("#profile-image-frame"),borderWidth=0,draggable=!1;imgElement.onload=function(){if(imgElement.width<imgElement.height){imgElement.height=Math.round(200*imgElement.height/imgElement.width),imgElement.width=200,borderWidth=Math.ceil(imgElement.height-200),imgFrame[0].style.borderWidth=borderWidth+"px 0px "+borderWidth+"px 0px",imgFrame[0].style.top=-borderWidth/2+"px",finalTop=borderWidth/2,finalWidth=200;var posY=0,startY=0;imgFrame.on("mousedown",function(){startY=posY-imgFrame[0].offsetTop,draggable=!0}),angular.element(document).on("mouseup",function(){draggable=!1}),angular.element(document).on("mousemove",function(e){if(posY=document.all?window.event.clientY:e.pageY,draggable){var diff=posY-startY;-borderWidth>diff?diff=-borderWidth:diff>0&&(diff=0),imgFrame[0].style.top=diff+"px",finalTop=diff+borderWidth}})}else{imgElement.width=Math.round(200*imgElement.width/imgElement.height),imgElement.height=200,borderWidth=Math.ceil(imgElement.width-200),imgFrame[0].style.borderWidth="0px "+borderWidth+"px 0px "+borderWidth+"px",imgFrame[0].style.left=-borderWidth/2+"px",wrapper.style.width=imgElement.width+"px",finalLeft=borderWidth/2,finalHeight=200;var posX=0,startX=0;imgFrame.on("mousedown",function(){startX=posX-imgFrame[0].offsetLeft,draggable=!0}),angular.element(document).on("mouseup",function(){draggable=!1}),angular.element(document).on("mousemove",function(e){if(posX=document.all?window.event.clientX:e.pageX,draggable){var diff=posX-startX;-borderWidth>diff?diff=-borderWidth:diff>0&&(diff=0),imgFrame[0].style.left=diff+"px",finalLeft=diff+borderWidth}})}$scope.$apply(function(){$scope.showImg=!0}),imgElement.onload=null}},0),$scope.ok=function(){$modalInstance.close({top:finalTop,left:finalLeft,width:finalWidth,height:finalHeight})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}});